{
    "demo_user": "Docker\tDeep\tDive\tv4\n\t\nNigel\tPoulton\t-\t@nigelpoulton\nThis\tis\tversion\t4\n\tof\tthe\tbook\tpublished\ton\t3rd\tOctober\t2017.\tThis\tversion.\tThis\nversion\tadded\ta\tnew\tchapter\ttitled\t\"Containerizing\tan\tapp\".\tIt\talso\tadded\tcontent\nabout\tmulti-architecture\timages\tand\tcrypto\tID's.\nVersion\t3\n\tadded\tThe\tDocker\tEngine\tchapter.\nVersion\t2\n\tadded\tthe\tSecurity\tin\tDocker\tchapter.\n©\t2016\t-\t2017\tNigel\tPoulton\n\t(All\ttypos\tare\tmine.\tOr\tis\tthat\ttypo's)Huge\tthanks\tto\tmy\twife\tand\tkids\tfor\tputting\tup\twith\ta\tgeek\tin\tthe\thouse\twho\ngenuinely\tthinks\the’s\ta\tbunch\tof\tsoftware\trunning\tinside\tof\ta\tcontainer\ton\ttop\tof\nmidrange\tbiological\thardware.\tIt\tcan’t\tbe\teasy\tliving\twith\tme!\nMassive\tthanks\tas\twell\tto\teveryone\twho\twatches\tmy\tPluralsight\tvideos.\tI\tlove\nconnecting\twith\tyou\tand\treally\tappreciate\tall\tthe\tfeedback\tI’ve\tgotten\tover\tthe\nyears.\tThis\twas\tone\tof\tthe\tmajor\treasons\tI\tdecided\tto\twrite\tthis\tbook!\tI\thope\tit’ll\nbe\tan\tamazing\ttool\tto\thelp\tyou\tdrive\tyour\tcareers\teven\tfurther\tforward.\nOne\tfinal\tword\tto\tall\tyou\t'old\tdogs'\tout\tthere...\tget\tready\tto\tlearn\tsome\tnew\ntricks!Table\tof\tContents\n0:\tAbout\tthe\tbook\nWhat\tabout\ta\tprint\t(paperback)\tversion\nWhy\tshould\tI\tread\tthis\tbook\tor\tcare\tabout\tDocker?\nIsn’t\tDocker\tjust\tfor\tdevelopers?\nShould\tI\tbuy\tthe\tbook\tif\tI’ve\talready\twatched\tyour\tvideo\ttraining\tcourses?\nHow\tthe\tbook\tis\torganized\nVersions\tof\tthe\tbook\nPart\t1:\tThe\tbig\tpicture\tstuff\n1:\tContainers\tfrom\t30,000\tfeet\nThe\tbad\told\tdays\nHello\tVMware!\nVMwarts\nHello\tContainers!\nLinux\tcontainers\nHello\tDocker!\nWindows\tcontainers\nWindows\tcontainers\tvs\tLinux\tcontainers\nWhat\tabout\tMac\tcontainers?\nChapter\tSummary\n2:\tDocker\nDocker\t-\tThe\tTLDR\nDocker,\tInc.\nThe\tDocker\truntime\tand\torchestration\tengine\nThe\tDocker\topen-source\tproject\t(Moby)\nThe\tcontainer\tecosystem\nThe\tOpen\tContainer\tInitiative\t(OCI)\nChapter\tsummary\n3:\tInstalling\tDocker\nDocker\tfor\tWindows\t(DfW)\nDocker\tfor\tMac\t(DfM)\nInstalling\tDocker\ton\tLinux\nInstalling\tDocker\ton\tWindows\tServer\t2016\nChapter\tSummary\n4:\tThe\tbig\tpicture\nThe\tOps\tPerspective\nThe\tDev\tPerspective\nChapter\tSummary\nPart\t2:\tThe\ttechnical\tstuff\n5:\tThe\tDocker\tEngineDocker\tEngine\t-\tThe\tTLDR\nDocker\tEngine\t-\tThe\tDeep\tDive\nChapter\tsummary\n6:\tImages\nDocker\timages\t-\tThe\tTLDR\nDocker\timages\t-\tThe\tdeep\tdive\nImages\t-\tThe\tcommands\nChapter\tsummary\n7:\tContainers\nDocker\tcontainers\t-\tThe\tTLDR\nDocker\tcontainers\t-\tThe\tdeep\tdive\nContainers\t-\tThe\tcommands\nChapter\tsummary\n8:\tContainerizing\tan\tApp\nContainerizing\tan\tApp\t-\tThe\tTLDR\nContainerizing\tan\tApp\t-\tThe\tdeep\tdive\nContainerizing\tan\tapp\t-\tThe\tcommands\nChapter\tsummary\n9:\tSwarm\tMode\nSwarm\tmode\t-\tThe\tTLDR\nSwarm\tmode\t-\tThe\tdeep\tdive\nSwarm\tmode\t-\tThe\tcommands\nChapter\tsummary\n10:\tDocker\toverlay\tnetworking\nDocker\toverlay\tnetworking\t-\tThe\tTLDR\nDocker\toverlay\tnetworking\t-\tThe\tdeep\tdive\nDocker\toverlay\tnetworking\t-\tThe\tcommands\nChapter\tSummary\n11:\tSecurity\tin\tDocker\nSecurity\tin\tDocker\t-\tThe\tTLDR\nSecurity\tin\tDocker\t-\tThe\tdeep\tdive\nChapter\tSummary\n12:\tWhat\tnext\nFeedback0:\tAbout\tthe\tbook\nThis\tis\ta\tbook\tabout\tDocker.\tNo\tprior\tknowledge\trequired!\nIf\tyou’re\tinterested\tin\tDocker\tand\t\nwant\tto\tknow\thow\tit\tworks\tand\thow\tto\tdo\nthings\tproperly\n\tthis\tbook\tis\tdedicated\tto\tyou!\nIf\tyou\tjust\twant\tto\tuse\tDocker\tand\tyou\tdon’t\tcare\tabout\thow\tit\tall\tworks,\tthis\nbook\tis\t\nnot\n\tfor\tyou.\tBye.\nWhat\tabout\ta\tprint\t(paperback)\tversion\nNo\toffense\tLeanpub\tand\tAmazon\tKindle,\tbut\tas\tgood\tas\tmodern\te-books\tare,\nI’m\tstill\ta\tfan\tof\tink\tand\tpaper!\tSo….\tthis\tbook\tis\tavailable\tas\ta\thigh-quality,\nfull-color,\tpaperback\tedition\tvia\tAmazon\t-\tand\tit’s\tthe\tbusiness!\t\nNone\tof\tthis\nblack-and-white\tnonsense.\nOn\tthe\ttopic\tof\tAmazon…\tI’d\tappreciate\tit\tif\tyou’d\tgive\tthe\tbook\tsome\tstars\nand\ta\tquick\treview.\tCheers!\nWhy\tshould\tI\tread\tthis\tbook\tor\tcare\tabout\tDocker?\nDocker\tis\there\tand\tthere’s\tno\tpoint\thiding.\tDevelopers\tare\tall\tover\tit,\tand\tIT\tOps\nneed\tto\tbe\ton\ttheir\tgame!\tWe\tdamn\twell\tbetter\tknow\thow\tto\tbuild\tand\tsupport\nproduction-quality\t\nDockerized\n\tapps\tin\tour\tbusiness-critical\tproduction\nenvironments.\tThis\tbook\twill\thelp\tyou.\nIsn’t\tDocker\tjust\tfor\tdevelopers?\nIf\tyou\tthink\tDocker\tis\tjust\tfor\tdevelopers\tthen\tprepare\tto\thave\tyour\tworld\nflipped\ton\tits\thead!\nAll\tthe\t\nDockerized\n\tapps\tthat\tdevelopers\tare\tchurning\tout\tneed\tsomewhere\tto\trun\nand\tsomeone\tto\tmanage\tthem.\tIf\tyou\tthink\tdevelopers\tare\tgoing\tto\tdo\tthat,\nyou’re\tdreaming.\tOps\twill\tneed\tto\tbuild\tand\trun\thigh\tperformance\tand\thighly\navailable\tDocker\tinfrastructures.\tIf\tyou’ve\tgot\tan\tOps\tfocus\tand\tyou’re\tnot\nskilled-up\ton\tDocker,\tyou’re\tin\tfor\ta\tworld\tof\tpain.\tBut\tdon’t\tstress,\tthis\tbook\nwill\tskill\tyou\tup!\nShould\tI\tbuy\tthe\tbook\tif\tI’ve\talready\twatched\tyour\tvideo\ntraining\tcourses?\nIf\tyou\tlike\tmy\t\nvideo\tcourses\n\tyou’ll\tprobably\tlike\tthe\tbook.\tIf\tyou\tdon’t\tlike\tmy\nvideo\tcourses\tyou\tprobably\twon’t\tlike\tthe\tbook.\nHow\tthe\tbook\tis\torganized\nI’ve\tdivided\tthe\tbook\tinto\ttwo\tsections:\nThe\tbig\tpicture\tstuff\nThe\ttechnical\tstuff\nThe\tbig\tpicture\tstuff\n\tcovers\tthings\tlike\t-\tWho\tis\tDocker,\tInc.\tWhat\tis\tthe\tDocker\n(Moby)\tproject.\tWhat\tis\tthe\tOCI.\tWhy\tdo\twe\teven\thave\tcontainers…\tNot\tthe\ncoolest\tpart\tof\tthe\tbook,\tbut\tthe\tkind\tof\tstuff\tthat\tyou\tneed\tto\tknow\tif\tyou\twant\tagood\trounded\tknowledge\tof\tDocker\tand\tcontainers.\tIt’s\tonly\ta\tshort\tsection\tand\nyou\tshould\tprobably\tread\tit.\nThe\ttechnical\tstuff\n\tis\twhat\tthe\tbook\tis\tall\tabout!\tThis\tis\twhere\tyou’ll\tfind\neverything\tyou\tneed\tto\tstart\tworking\twith\tDocker.\tIt\tgets\tinto\tthe\tdetail\tof\nimages\n,\t\ncontainers\n\tand\tthe\tincreasingly\timportant\ttopic\tof\t\norchestration\n.\tYou’ll\nget\tthe\ttheory\tso\tthat\tyou\tknow\thow\tit\tall\tfits\ttogether,\tand\tyou’ll\tget\tcommands\nand\texamples\tto\tshow\tyou\thow\tit\tall\tworks\tin\tpractice.\nEvery\tchapter\tin\tthe\t\ntechnical\tstuff\n\tsection\tis\tdivided\tinto\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nThe\tTLDR\n\twill\tgive\tyou\ttwo\tor\tthree\tparagraphs\tthat\tyou\tcan\tuse\tto\texplain\tthe\ntopic\tat\tthe\tcoffee\tmachine.\nThe\tdeep\tdive\n\tis\twhere\twe\texplain\thow\teverything\tworks\tand\tgo\tthrough\tthe\nexamples.\nThe\tCommands\n\tlists\tout\tall\tthe\trelevant\tcommands\tin\tan\teasy\tto\tread\tlist\twith\nbrief\treminders\tof\twhat\teach\tone\tdoes.\nI\tthink\tyou’ll\tlove\tthat\tformat.Versions\tof\tthe\tbook\nDocker\tis\tdeveloping\tat\ta\twarp\tspeed!\tAs\ta\tresult,\tthe\tvalue\tof\ta\tbook\tlike\tthis\tis\ninversely\tproportional\tto\thow\told\tit\tis!\tPut\tanother\tway,\tthe\tolder\tthis\tbook\tis,\nthe\tless\tvaluable\tit\tis.\tSo\tI\tkeep\tit\tup-to-date!\nIf\tthis\tseems\tstrange…\t\nwelcome\tto\tthe\tnew\tnormal!\n\tWe\tno-longer\tlive\tin\ta\nworld\twhere\ta\t5-year\told\tbook\tis\tvaluable\t(believe\tme,\tit\thurts\tfor\tme\tto\tsay\nthat).\nDon’t\tworry\tthough,\tyour\tinvestment\tin\tthis\tbook\tis\tsafe!\nIf\tyou\tbuy\tthe\tpaperback\tcopy,\tyou\tget\tthe\tKindle\tversion\tfor\tdirt-cheap!\tThe\nKindle\tand\tLeanpub\tversions\tare\talways\tkept\tup-to-date.\tThat’s\tthe\tbest\twe\tcan\ncurrently\tdo!\nBelow\tis\ta\tlist\tof\tversions:\nVersion\t4.\n\t\nThis\tis\tversion\t4\tof\tthe\tbook,\tpublished\ton\t3rd\tOctober\t2017.\nThis\tversion\tadded\ta\tnew\tchapter\ttitled\t“Containerizing\tan\tapp”.\tIt\talso\nadded\tcontent\tabout\t\nmulti-architecture\timages\n\tand\t\ncrypto\tID’s\n\tto\tthe\nImages\n\tchapter,\tand\tsome\tadditional\tcontent\tto\t\nThe\tBig\tPicture\n\tchapter.\nVersion\t3.\n\tAdded\t\nThe\tDocker\tEngine\n\tchapter.\nVersion\t2.\n\tAdded\t\nSecurity\tin\tDocker\n\tchapter.P\nART\n\t1:\tT\nHE\n\t\nBIG\n\t\nPICTURE\n\t\nSTUFF1:\tContainers\tfrom\t30,000\tfeet\nContainers\tare\tdefinitely\ta\t\nthing\n.\nIn\tthis\tchapter\twe’ll\tget\tinto\tthings\tlike;\twhy\tdo\twe\thave\tcontainers,\twhat\tdo\nthey\tdo\tfor\tus,\tand\twhere\tcan\twe\tuse\tthem.\nThe\tbad\told\tdays\nApplications\trun\tbusinesses.\tIf\tapplications\tbreak,\tbusinesses\tsuffer\tand\nsometimes\tgo\taway.\tThese\tstatements\tget\ttruer\tevery\tday!\nMost\tapplications\trun\ton\tservers.\tAnd\tin\tthe\tpast,\twe\tcould\tonly\trun\tone\napplication\tper\tserver.\tThe\topen-systems\tworld\tof\tWindows\tand\tLinux\tjust\ndidn’t\thave\tthe\ttechnologies\tto\tsafely\tand\tsecurely\trun\tmultiple\tapplications\ton\nthe\tsame\tserver.\nSo,\tthe\tstory\tusually\twent\tsomething\tlike\tthis…\tEvery\ttime\tthe\tbusiness\tneeded\na\tnew\tapplication,\tIT\twould\tgo\tout\tand\tbuy\ta\tnew\tserver.\tAnd\tmost\tof\tthe\ttime\nnobody\tknew\tthe\tperformance\trequirements\tof\tthe\tnew\tapplication!\tThis\tmeant\nIT\thad\tto\tmake\tguesses\twhen\tchoosing\tthe\tmodel\tand\tsize\tof\tservers\tto\tbuy.\nAs\ta\tresult,\tIT\tdid\tthe\tonly\tthing\tit\tcould\tdo\t-\tit\tbought\tbig\tfast\tservers\twith\tlots\nof\tresiliency.\tAfter\tall,\tthe\tlast\tthing\tanyone\twanted\t-\tincluding\tthe\tbusiness\t-\nwas\tunder-powered\tservers.\tUnder-powered\tservers\tmight\tbe\tunable\tto\texecute\ntransactions,\twhich\tmight\tresult\tin\tlost\tcustomers\tand\tlost\trevenue.\tSo,\tIT\nusually\tbought\tbigger\tservers\tthan\twere\tactually\tneeded.\tThis\tresulted\tin\thuge\nnumbers\tof\tservers\toperating\tas\tlow\tas\t5-10%\tof\ttheir\tpotential\tcapacity.\t\nA\ntragic\twaste\tof\tcompany\tcapital\tand\tresources!\nHello\tVMware!\nAmid\tall\tof\tthis,\tVMware,\tInc.\tgave\tthe\tworld\ta\tgift\t-\tthe\tvirtual\tmachine\t(VM).\nAnd\talmost\tovernight\tthe\tworld\tchanged\tinto\ta\tmuch\tbetter\tplace!\tWe\tfinally\nhad\ta\ttechnology\tthat\twould\tlet\tus\tsafely\tand\tsecurely\trun\tmultiple\tbusiness\napplications\ton\ta\tsingle\tserver.This\twas\ta\tgame\tchanger!\tIT\tno\tlonger\tneeded\tto\tprocure\ta\tbrand\tnew\toversized\nserver\tevery\ttime\tthe\tbusiness\tasked\tfor\ta\tnew\tapplication.\tMore\toften\tthan\tnot\nthey\tcould\trun\tnew\tapps\ton\texisting\tservers\tthat\twere\tsitting\taround\twith\tspare\ncapacity.\nAll\tof\ta\tsudden,\twe\tcould\tsqueeze\tmassive\tamounts\tof\tvalue\tout\tof\texisting\ncorporate\tassets,\tsuch\tas\tservers,\tresulting\tin\ta\tlot\tmore\tbang\tfor\tthe\tcompany’s\nbuck.\nVMwarts\nBut…\tand\tthere’s\talways\ta\t\nbut!\n\tAs\tgreat\tas\tVMs\tare,\tthey’re\tnot\tperfect!\nThe\tfact\tthat\tevery\tVM\trequires\tits\town\tdedicated\tOS\tis\ta\tmajor\tflaw.\tEvery\tOS\nconsumes\tCPU,\tRAM\tand\tstorage\tthat\tcould\totherwise\tbe\tused\tto\tpower\tmore\napplications.\tEvery\tOS\tneeds\tpatching\tand\tmonitoring.\tAnd\tin\tsome\tcases,\nevery\tOS\trequires\ta\tlicense.\tAll\tof\tthis\tis\ta\twaste\tof\top-ex\tand\tcap-ex.\nThe\tVM\tmodel\thas\tother\tchallenges\ttoo.\tVMs\tare\tslow\tto\tboot\tand\tportability\nisn’t\tgreat\t-\tmigrating\tand\tmoving\tVM\tworkloads\tbetween\thypervisors\tand\ncloud\tplatforms\tis\tharder\tthan\tit\tneeds\tto\tbe.\nHello\tContainers!\nFor\ta\tlong\ttime,\tthe\tbig\tweb-scale\tplayers\tlike\tGoogle\thave\tbeen\tusing\tcontainer\ntechnologies\tto\taddress\tthese\tshortcomings\tof\tthe\tVM\tmodel.\nIn\tthe\tcontainer\tmodel\tthe\tcontainer\tis\troughly\tanalogous\tto\tthe\tVM.\tThe\tmajor\ndifference\tthrough,\tis\tthat\tevery\tcontainer\tdoes\tnot\trequire\ta\tfull-blown\tOS.\tIn\nfact,\tall\tcontainers\ton\ta\tsingle\thost\tshare\ta\tsingle\tOS.\tThis\tfrees\tup\thuge\namounts\tof\tsystem\tresources\tsuch\tas\tCPU,\tRAM,\tand\tstorage.\tIt\talso\treduces\npotential\tlicensing\tcosts\tand\treduces\tthe\toverhead\tof\tOS\tpatching\tand\tother\nmaintenance.\tThis\tresults\tin\tsavings\ton\tthe\tcap-ex\tand\top-ex\tfronts.\nContainers\tare\talso\tfast\tto\tstart\tand\tultra-portable.\tMoving\tcontainer\tworkloads\nfrom\tyour\tlaptop,\tto\tthe\tcloud,\tand\tthen\tto\tVMs\tor\tbare\tmetal\tin\tyour\tdata\tcenter\nis\ta\tbreeze.\nLinux\tcontainersModern\tcontainers\tstarted\tin\tthe\tLinux\tworld\tand\tare\tthe\tproduct\tof\tan\timmense\namount\tof\twork\tfrom\ta\twide\tvariety\tof\tpeople\tover\ta\tlong\tperiod\tof\ttime.\tJust\tas\none\texample,\tGoogle\tInc.\thas\tcontributed\tmany\tcontainer-related\ttechnologies\tto\nthe\tLinux\tkernel.\tWithout\tthese,\tand\tother\tcontributions,\twe\twouldn’t\thave\nmodern\tcontainers\ttoday.\nSome\tof\tthe\tmajor\ttechnologies\tthat\tenabled\tthe\tmassive\tgrowth\tof\tcontainers\tin\nrecent\tyears\tinclude\t\nkernel\tnamespaces\n,\t\ncontrol\tgroups\n,\tand\tof\tcourse\t\nDocker\n.\nTo\tre-emphasize\twhat\twas\tsaid\tearlier\t-\tthe\tmodern\tcontainer\tecosystem\tis\ndeeply\tindebted\tto\tthe\tmany\tindividuals\tand\torganizations\tthat\tlaid\tthe\tstrong\nfoundations\tthat\twe\tcurrently\tbuild\ton!\nDespite\tall\tof\tthis,\tcontainers\tremained\tcomplex\tand\toutside\tof\tthe\treach\tof\tmost\norganizations.\tIt\twasn’t\tuntil\tDocker\tcame\talong\tthat\tcontainers\twere\teffectively\ndemocratized\tand\taccessible\tto\tthe\tmasses.\n*\tThere\tare\tmany\toperating\tsystem\tvirtualization\ttechnologies\tsimilar\tto\ncontainers\tthat\tpre-date\tDocker\tand\tmodern\tcontainers.\tSome\teven\tdate\nback\tto\tSystem/360\ton\tthe\tMainframe.\tBSD\tJails\tand\tSolaris\tZones\tare\nsome\tother\twell-known\texamples\tof\tUnix-type\tcontainer\ttechnologies.\nHowever,\tin\tthis\tsection\twe\tare\trestricting\tour\tconversation\tand\tcomments\nto\t\nmodern\tcontainers\n\tthat\thave\tbeen\tmade\tpopular\tby\tDocker.\nHello\tDocker!\nWe’ll\ttalk\tabout\tDocker\tin\ta\tbit\tmore\tdetail\tin\tthe\tnext\tchapter.\tBut\tfor\tnow,\tit’s\nenough\tto\tsay\tthat\tDocker\twas\tthe\tmagic\tthat\tmade\tLinux\tcontainers\tusable\tfor\nmere\tmortals.\tPut\tanother\tway,\tDocker,\tInc.\tmade\tcontainers\tsimple!\nWindows\tcontainers\nOver\tthe\tpast\tfew\tyears,\tMicrosoft\tCorp.\thas\tworked\textremely\thard\tto\tbring\nDocker\tand\tcontainer\ttechnologies\tto\tthe\tWindows\tplatform.\nAt\tthe\ttime\tof\twriting,\tWindows\tcontainers\tare\tavailable\ton\tthe\tWindows\t10\tand\nWindows\tServer\t2016\tplatforms.\tIn\tachieving\tthis,\tMicrosoft\thas\tworked\tclosely\nwith\tDocker,\tInc.The\tcore\tWindows\ttechnologies\trequired\tto\timplement\tcontainers\tare\ncollectively\treferred\tto\tas\t\nWindows\tContainers\n.\tThe\tuser-space\ttooling\tto\twork\nwith\tthese\t\nWindows\tContainers\n\tis\tDocker.\tThis\tmakes\tthe\tDocker\texperience\ton\nWindows\talmost\texactly\tthe\tsame\tas\tDocker\ton\tLinux.\tThis\tway\tdevelopers\tand\nsysadmins\tfamiliar\twith\tthe\tDocker\ttoolset\tfrom\tthe\tLinux\tplatform\twill\tfeel\tat\nhome\tusing\tWindows\tcontainers.\nThis\trevision\tof\tthe\tbook\tincludes\tLinux\tand\tWindows\texamples\tfor\talmost\nevery\texample\tcited.\nWindows\tcontainers\tvs\tLinux\tcontainers\nIt’s\tvital\tto\tunderstand\tthat\ta\trunning\tcontainer\tuses\tthe\tkernel\tof\tthe\thost\nmachine\tit\tis\trunning\ton.\tThis\tmeans\tthat\ta\tcontainer\tdesigned\tto\trun\ton\ta\thost\nwith\ta\tWindows\tkernel\twill\tnot\trun\ton\ta\tLinux\thost.\tThis\tmeans\tthat\tyou\tcan\nthink\tof\tit\tlike\tthis\tat\ta\thigh\tlevel\t-\tWindows\tcontainers\trequire\ta\tWindows\tHost,\nand\tLinux\tcontainers\trequire\ta\tLinux\thost.\tHowever,\tit’s\tnot\tthat\tsimple…\nAt\tthe\ttime\tof\twriting\tthis\trevision\tof\tthe\tbook,\tit\tis\tpossible\tto\trun\tLinux\ncontainers\ton\tWindows\tmachines.\tFor\texample,\t\nDocker\tfor\tWindows\n\t(a\tproduct\noffering\tfrom\tDocker,\tInc.\tdesigned\tfor\tWindows\t10)\tcan\tswitch\tmodes\tbetween\nWindows\tcontainers\n\tand\t\nLinux\tcontainers\n.\tThis\tis\tan\tarea\tthat\tis\tdeveloping\tfast\nand\tyou\tshould\tconsult\tthe\tDocker\tdocumentation\tfor\tthe\tlatest.\nWhat\tabout\tMac\tcontainers?\nThere\tis\tcurrently\tno\tsuch\tthing\tas\tMac\tcontainers.\nHowever,\tyou\tcan\trun\tLinux\tcontainers\ton\tyour\tMac\tusing\tthe\t\nDocker\tfor\tMac\nproduct.\tThis\tworks\tby\tseamlessly\trunning\tyour\tcontainers\tinside\tof\ta\nlightweight\tLinux\tVM\trunning\ton\tyour\tMac.\tIt’s\textremely\tpopular\twith\ndevelopers\twho\tcan\teasily\tdevelop\tand\ttest\ttheir\tLinux\tcontainers\ton\ttheir\tMac.Chapter\tSummary\nWe\tused\tto\tlive\tin\ta\tworld\twhere\tevery\ttime\tthe\tbusiness\twanted\ta\tnew\napplication\twe\thad\tto\tbuy\ta\tbrand-new\tserver\tfor\tit.\tThen\tVMware\tcame\talong\nand\tenabled\tIT\tdepartments\tto\tdrive\tmore\tvalue\tout\tof\tnew\tand\texisting\ncompany\tIT\tassets.\tBut\tas\tgood\tas\tVMware\tand\tthe\tVM\tmodel\tis,\tit’s\tnot\nperfect.\tFollowing\tthe\tsuccess\tof\tVMware\tand\thypervisors\tcame\ta\tnewer\tmore\nefficient\tand\tlightweight\tvirtualization\ttechnology\tcalled\tcontainers.\tBut\ncontainers\twere\tinitially\thard\tto\timplement\tand\twere\tonly\tfound\tin\tthe\tdata\ncenters\tof\tweb\tgiants\tthat\thad\tLinux\tkernel\tengineers\ton\tstaff.\tThen\talong\tcame\nDocker\tInc.\tand\tsuddenly\tcontainer\tvirtualization\ttechnologies\twere\tavailable\tto\nthe\tmasses.\nSpeaking\tof\tDocker…\tlet’s\tgo\tfind\twho,\twhat,\tand\twhy\tDocker\tis!2:\tDocker\nNo\tbook\tor\tconversation\tabout\tcontainers\tis\tcomplete\twithout\ttalking\tabout\nDocker.\tBut\twhen\tsomebody\tsays\t“Docker”\tthey\tcan\tbe\treferring\tto\tany\tof\tat\nleast\tthree\tthings:\n1\n.\t\nDocker,\tInc.\tthe\tcompany\n2\n.\t\nDocker\tthe\tcontainer\truntime\tand\torchestration\ttechnology\n3\n.\t\nDocker\tthe\topen\tsource\tproject\t(this\tis\tnow\tcalled\tMoby)\nIf\tyou’re\tgoing\tto\t\nmake\tit\n\tin\tthe\tcontainer\tworld,\tyou’ll\tneed\tto\tknow\ta\tbit\tabout\nall\tthree.Docker\t-\tThe\tTLDR\nDocker\tis\tsoftware\tthat\truns\ton\tLinux\tand\tWindows.\tIt\tcreates,\tmanages\tand\norchestrates\tcontainers.\tThe\tsoftware\tis\tdeveloped\tin\tthe\topen\tas\tpart\tof\tthe\nMoby\n\topen-source\tproject\ton\tGitHub.\tDocker,\tInc.\tis\ta\tcompany\tbased\tout\tof\nSan\tFrancisco\tand\tis\tthe\toverall\tmaintainer\tof\tthe\topen-source\tproject.\tDocker,\nInc.\talso\thas\toffers\tcommercial\tversions\tof\tDocker\twith\tsupport\tcontracts\tetc.\nOk\tthat’s\tthe\tquick\tversion.\tNow\twe’ll\texplore\teach\tin\ta\tbit\tmore\tdetail.\tWe’ll\nalso\ttalk\ta\tbit\tabout\tthe\tcontainer\tecosystem,\tand\twe’ll\tmention\tthe\tOpen\nContainer\tInitiative\t(OCI).\nDocker,\tInc.\nDocker,\tInc.\tis\tthe\tSan\tFrancisco\tbased\ttechnology\tstartup\tfounded\tby\tFrench-\nborn\tAmerican\tdeveloper\tand\tentrepreneur\tSolomon\tHykes.\nFigure\t2.1\tDocker,\tInc.\tlogo.\nInterestingly,\tDocker,\tInc.\tstarted\tits\tlife\tas\ta\tplatform\tas\ta\tservice\t(PaaS)\nprovider\tcalled\t\ndotCloud\n.\tBehind\tthe\tscenes,\tthe\tdotCloud\tplatform\tleveraged\nLinux\tcontainers.\tTo\thelp\tthem\tcreate\tand\tmanage\tthese\tcontainers\tthey\tbuilt\tan\ninternal\ttool\tthat\tthey\tnick-named\t“Docker”.\tAnd\tthat’s\thow\tDocker\twas\tborn!\nIn\t2013\tthe\tdotCloud\tPaaS\tbusiness\twas\tstruggling\tand\tthe\tcompany\tneeded\ta\nnew\tlease\tof\tlife.\tTo\thelp\twith\tthis\tthey\thired\tBen\tGolub\tas\tnew\tCEO,\trebranded\nthe\tcompany\tas\t“Docker,\tInc.”,\tgot\trid\tof\tthe\tdotCloud\tPaaS\tplatform,\tand\nstarted\ta\tnew\tjourney\twith\ta\tmission\tto\tbring\tDocker\tand\tcontainers\tto\tthe\nworld.\nToday\tDocker,\tInc.\tis\twidely\trecognized\tas\tan\tinnovative\ttechnology\tcompany\nwith\ta\tmarket\tvaluation\tsaid\tto\tbe\tin\tthe\tregion\tof\t$1BN.\tAt\tthe\ttime\tof\twriting,\nit\thas\traised\tover\t$180M\tvia\t7\trounds\tof\tfunding\tfrom\tsome\tof\tthe\tbiggestnames\tin\tSilicon\tValley\tventure\tcapital.\tAlmost\tall\tof\tthis\tfunding\twas\traised\nafter\tthe\tcompany\tpivoted\tto\tbecome\t\nDocker,\tInc.\nSince\tbecoming\tDocker,\tInc.\tthey’ve\tmade\tseveral\tsmall\tacquisitions,\tfor\nundisclosed\tfees,\tto\thelp\tgrow\ttheir\tportfolio\tof\tproducts\tand\tservices.\nAt\tthe\ttime\tof\twriting,\tDocker,\tInc.\thas\tsomewhere\tin\tthe\tregion\tof\t200-300\nemployees\tand\tholds\tan\tannual\tconference\tcalled\tDockercon.\tThe\tgoal\tof\nDockercon\tis\tto\tbring\ttogether\tthe\tgrowing\tcontainer\tecosystem\tand\tdrive\tthe\nadoption\tof\tDocker\tand\tcontainer\ttechnologies.\nThroughout\tthis\tbook\twe’ll\tuse\tthe\tterm\t“Docker,\tInc.”\twhen\treferring\tto\nDocker\tthe\tcompany.\tAll\tother\tuses\tof\tthe\tterm\t“Docker”\twill\trefer\tto\tthe\ntechnology\tor\tthe\topen-source\tproject.\nNote:\n\tThe\tword\t“Docker”\tcomes\tfrom\ta\tBritish\tcolloquialism\tmeaning\ndock\tworker\t-\tsomebody\twho\tloads\tand\tunloads\tships.\nThe\tDocker\truntime\tand\torchestration\tengine\nWhen\tmost\t\ntechnologists\n\ttalk\tabout\tDocker,\tthey’re\treferring\tto\tthe\t\nDocker\nEngine\n.\nThe\t\nDocker\tEngine\n\tis\tthe\tinfrastructure\tplumbing\tsoftware\tthat\truns\tand\norchestrates\tcontainers.\tIf\tyou’re\ta\tVMware\tadmin,\tyou\tcan\tthink\tof\tit\tas\tbeing\nsimilar\tto\tESXi.\tIn\tthe\tsame\tway\tthat\tESXi\tis\tthe\tcore\thypervisor\ttechnology\nthat\truns\tvirtual\tmachines,\tthe\tDocker\tEngine\tis\tthe\tcore\tcontainer\truntime\tthat\nruns\tcontainers.\nAll\tother\tDocker,\tInc.\tand\t3rd\tparty\tproducts\tplug\tinto\tthe\tDocker\tEngine\tand\nbuild\taround\tit.\tFigure\t2.2\tshows\tthe\tDocker\tEngine\tat\tthe\tcenter.\tAll\tof\tthe\nother\tproducts\tin\tthe\tdiagram\tbuild\ton\ttop\tof\tthe\tEngine\tand\tleverage\tits\tcore\ncapabilities.Figure\t2.2\nThe\tDocker\tEngine\tcan\tbe\tdownloaded\tfrom\tthe\tDocker\twebsite\tor\tbuilt\tfrom\nsource\tfrom\tGitHub.\tIt’s\tavailable\ton\tLinux\tand\tWindows,\twith\topen-source\tand\ncommercially\tsupported\tofferings.\nAt\tthe\ttime\tof\twriting\tthere\ttwo\tmain\teditions:\nEnterprise\tEdition\t(EE)\nCommunity\tEdition\t(CE)\nThe\tEnterprise\tEdition\tand\tthe\tCommunity\tEdition\tboth\thave\ta\tstable\trelease\nchannel\twith\tquarterly\treleases.\tEach\tCommunity\tEdition\twill\tbe\tsupported\tfor\t4\nmonths\tand\teach\tEnterprise\tEdition\twill\tbe\tsupported\tfor\t12\tmonths.\nThe\tCommunity\tEdition\thas\tan\tadditional\tmonthly\trelease\tvia\tan\t\nedge\n\tchannel.\nStarting\tfrom\tQ1\t2017\tDocker\tversion\tnumbers\tfollow\tthe\tYY.MM-xx\nversioning\tscheme\tsimilar\tto\tUbuntu\tand\tother\tprojects.\tFor\texample,\tthe\tfirst\nrelease\tof\tthe\tCommunity\tEdition\tin\tJune\t2017\twill\tbe\t17.06.0-ce.\nNote:\n\tPrior\tto\tQ1\t2017,\tDocker\tversion\tnumbers\tfollowed\tthe\t\nmajor.minor\nversioning\tscheme.\tThe\tlast\tversion\tprior\tto\tthe\tnew\tversion\tscheme\tas\nDocker\t1.13.x.\nThe\tDocker\topen-source\tproject\t(Moby)\nThe\tterm\t“Docker”\tis\talso\tused\tto\trefer\tto\tthe\topen-source\t\nDocker\tproject\n.\t\nThis\nis\tthe\tset\tof\ttools\tthat\tget\tcombined\tinto\tthings\tlike\tthe\tDocker\tdaemon\tand\nclient\tyou\tcan\tdownload\tand\tinstall\tfrom\tdocker.com.\tHowever,\tthe\tproject\twasofficially\trenamed\tas\tthe\t\nMoby\n\tproject\tat\tDockerCon\t2017\tin\tAustin,\tTx.\tAs\tpart\nof\tthis\trename\tthe\tGitHub\trepo\twas\tmoved\tfrom\tdocker/docker\tto\tmoby/moby\nand\tthe\tproject\tgot\tits\town\tlogo.\nFigure\t2.3\nThe\tgoal\tof\tthe\tMoby\tproject\tis\tto\tbreak\tDocker\tdown\tinto\tmore\tmodular\ncomponents,\tand\tto\tdo\tthis\tin\tthe\topen.\tIt’s\thosted\ton\tGitHub\tand\tyou\tcan\tsee\ta\nlist\tof\tthe\tcurrent\tsub-projects\tand\ttools\tincluded\tin\tthe\tMoby\trepository\tat\nhttps://github.com/moby.\tThe\tcore\t\nDocker\tEngine\n\tproject\tis\tcurrently\tlocated\tat\nhttps://github.com/moby/moby\tbut\tparts\tare\tbeing\tbroken\tout\tand\tmodularized\nall\tthe\ttime.\nAs\tan\topen-source\tproject,\tthe\tsource\tcode\tis\tpublicly\tavailable\tand\tyou\tare\tfree\nto\tdownload\tit,\tcontribute\tto\tit,\ttweak\tit,\tand\tuse\tit,\tas\tlong\tas\tyou\tadhere\tto\tthe\nterms\tof\tthe\t\nApache\tLicense\t2.0\n.\nIf\tyou\ttake\tthe\ttime\tto\tlook\tat\tthe\tproject’s\tcommit\thistory\tyou’ll\tsee\tthe\twho’s-\nwho\tof\tinfrastructure\ttechnology\tincluding;\tRedHat,\tMicrosoft,\tIBM,\tCisco,\tand\nHPE.\tYou’ll\talso\tsee\tthe\tnames\tof\tindividuals\tnot\tassociated\twith\tlarge\ncorporations.\nMost\tof\tthe\tproject\tand\tits\ttools\tare\twritten\tin\t\nGolang\n\t-\tthe\trelatively\tnew\nsystem-level\tprogramming\tlanguage\tfrom\tGoogle\talso\tknown\tas\t\nGo\n.\tIf\tyou\tcode\nin\tGo\tyou’re\tin\ta\tgreat\tposition\tto\tcontribute\tto\tthe\tproject!\nA\tnice\tside\teffect\tof\tMoby/Docker\tbeing\tan\topen-source\tproject\tis\tthe\tfact\tthat\nso\tmuch\tof\tit\tis\tdeveloped\tand\tdesigned\tin\tthe\topen.\tThis\tdoes\taway\twith\ta\tlot\nof\tthe\t\nold\tways\n\twhere\tcode\twas\tproprietary\tand\tlocked\tbehind\tclosed\tdoors.\tIt\nalso\tmeans\tthat\trelease\tcycles\tare\tpublished\tand\tworked\ton\tin\tthe\topen.\tNo\tmore\nuncertain\trelease\tcycles\tthat\tare\tkept\ta\tsecret\tand\tthen\tpre-announced\tmonths-in-\nadvance\tto\tridiculous\tpomp\tand\tceremony.\tThe\tMoby/Docker\tproject\tdoesn’t\nwork\tlike\tthat.\tMost\tthings\tare\tdone\tin\tthe\topen\tfor\tall\tto\tsee\tand\tall\tto\ncontribute\tto.The\tMoby\tproject,\tand\tthe\twider\tDocker\tmovement\tis\thuge\tand\tgaining\nmomentum.\tIt\thas\tthousands\tof\tGitHub\tpull\trequests,\ttens\tof\tthousands\tof\nDockerized\tprojects,\tnot\tto\tmention\tthe\tbillions\tof\timage\tpulls\tfrom\tDocker\nHub.\tThe\tproject\tliterally\tis\ttaking\tthe\tindustry\tby\tstorm!\nBe\tunder\tno\tillusions,\tDocker\tis\tbeing\tused!\nThe\tcontainer\tecosystem\nOne\tof\tthe\tcore\tphilosophies\tat\tDocker,\tInc.\tis\toften\treferred\tto\tas\t\nBatteries\nincluded\tbut\tremovable\n.\nThis\tis\ta\tway\tof\tsaying\tyou\tcan\tswap\tout\ta\tlot\tof\tthe\tnative\tDocker\t\nstuff\n\tand\nreplace\tit\twith\t\nstuff\n\tfrom\t3rd\tparties.\tA\tgood\texample\tof\tthis\tis\tthe\tnetworking\nstack.\tThe\tcore\tDocker\tproduct\tships\twith\tbuilt-in\tnetworking.\tBut\tthe\nnetworking\tstack\tis\tpluggable\tmeaning\tyou\tcan\trip\tout\tthe\tnative\tDocker\nnetworking\tand\treplace\tit\twith\tsomething\telse\tfrom\ta\t3rd\tparty.\tPlenty\tof\tpeople\ndo\tthat.\nIn\tthe\tearly\tdays\tit\twas\tcommon\tfor\t3rd\tparty\tplugins\tto\tbe\tbetter\tthan\tthe\tnative\nofferings\tthat\tshipped\twith\tDocker.\tHowever,\tthis\tpresented\tsome\tbusiness\nmodel\tchallenges\tfor\tDocker,\tInc.\tAfter\tall,\tDocker,\tInc.\thas\tto\tturn\ta\tprofit\tat\nsome\tpoint\tto\tbe\ta\tviable\tlong-term\tbusiness.\tAs\ta\tresult,\tthe\tbatteries\tthat\tare\nincluded\n\tare\tgetting\tbetter\tand\tbetter.\tThis\tis\tcausing\ttension\tand\traising\tlevels\ncompetition\twithin\tthe\tecosystem.\nTo\tcut\ta\tlong\tstory\tshort,\tthe\tnative\tDocker\tbatteries\tare\tstill\tremovable,\tthere’s\njust\tless\tand\tless\treason\tto\t\nneed\n\tto\tremove\tthem.\nDespite\tthis,\tthe\tcontainer\tecosystem\tis\tflourishing\twith\ta\thealthy\tbalance\tof\tco-\noperation\tand\tcompetition.\tYou’ll\toften\thear\tpeople\tuse\tterms\tlike\t\nco-opetition\n(a\tbalance\tof\tco-operation\tand\tcompetition)\tand\t\nfrenemy\n\t(a\tmix\tof\ta\tfriend\tand\nan\tenemy)\twhen\ttalking\tabout\tthe\tcontainer\tecosystem.\tThis\tis\tgreat!\t\nHealthy\ncompetition\tis\tthe\tmother\tof\tinnovation!\nThe\tOpen\tContainer\tInitiative\t(OCI)\nNo\tdiscussion\tof\tDocker\tand\tthe\tcontainer\tecosystem\tis\tcomplete\twithout\nmentioning\tthe\t\nOpen\tContainers\tInitiative\t-\tOCI\n.Figure\t2.4\nThe\tOCI\tis\ta\trelatively\tnew\tgovernance\tcouncil\tresponsible\tfor\tstandardizing\tthe\nmost\tfundamental\tcomponents\tof\tcontainer\tinfrastructure\tsuch\tas\t\nimage\tformat\nand\t\ncontainer\truntime\n\t(don’t\tworry\tif\tthese\tterms\tare\tnew\tto\tyou,\twe’ll\tcover\nthem\tin\tthe\tbook).\nIt’s\talso\ttrue\tthat\tno\tdiscussion\tof\tthe\tOCI\tis\tcomplete\twithout\tmentioning\ta\tbit\nof\thistory.\tAnd\tas\twith\tall\taccounts\tof\thistory,\tthe\tversion\tyou\tget\tdepends\ton\nwho’s\tdoing\tthe\ttalking.\tSo,\tthis\tis\tthe\tversion\tof\thistory\taccording\tto\tNigel\t:-D\nFrom\tday\tone,\tuse\tof\tDocker\thas\tgrown\tlike\tcrazy.\tMore\tand\tmore\tpeople\tused\nit\tin\tmore\tand\tmore\tways\tfor\tmore\tand\tmore\tthings.\tSo,\tit\twas\tinevitable\tthat\nsomebody\twas\tgoing\tto\tget\tfrustrated.\tThis\tis\tnormal\tand\thealthy.\nThe\tTLDR\tof\tthis\t\nhistory\taccording\tto\tNigel\n\tis\tthat\ta\tcompany\tcalled\t\nCoreOS\ndidn’t\tlike\tthe\tway\tDocker\tdid\tcertain\tthings.\tSo\tthey\tdid\tsomething\tabout\tit!\nThey\tcreated\ta\tnew\topen\tstandard\tcalled\t\nappc\n\tthat\tdefined\tthings\tlike\timage\nformat\tand\tcontainer\truntime.\tThey\talso\tcreated\tan\timplementation\tof\tthe\tspec\ncalled\t\nrkt\n\t(pronounced\t“rocket”).\nThis\tput\tthe\tcontainer\tecosystem\tin\tan\tawkward\tposition\twith\ttwo\tcompeting\nstandards.\nGetting\tback\tto\tthe\tstory\tthough,\tthis\tthreatened\tto\tfracture\tthe\tecosystem\tand\npresent\tusers\tand\tcustomers\twith\ta\tdilemma.\tWhile\tcompetition\tis\tusually\ta\ngood\tthing,\t\ncompeting\tstandards\n\tis\tusually\tnot.\tThey\tcause\tconfusion\tand\nslowdown\tuser\tadoption.\tNot\tgood\tfor\tanybody.\nWith\tthis\tin\tmind,\teverybody\tdid\ttheir\tbest\tto\tact\tlike\tadults\tand\tcame\ttogether\nto\tform\tthe\tOCI\t-\ta\tlightweight\tagile\tcouncil\tto\tgovern\tcontainer\tstandards.\nAt\tthe\ttime\tof\twriting,\tthe\tOCI\thas\tpublished\ttwo\tspecifications\t(standards)\t-\nThe\t\nimage-spec\nThe\t\nruntime-specAn\tanalogy\tthat’s\toften\tused\twhen\treferring\tto\tthese\ttwo\tstandards\tis\t\nrail\ttracks\n.\nThese\ttwo\tstandards\tare\tlike\tagreeing\ton\tstandard\tsizes\tand\tproperties\tof\trail\ntracks.\tLeaving\teveryone\telse\tfree\tto\tbuild\tbetter\ttrains,\tbetter\tcarriages,\tbetter\nsignalling\tsystems,\tbetter\tstations…\tall\tsafe\tin\tthe\tknowledge\tthat\tthey’ll\twork\non\tthe\tstandardized\ttracks.\tNobody\twants\ttwo\tcompeting\tstandards\tfor\trail\ttrack\nsizes!\nIt’s\tfair\tto\tsay\tthat\tthe\ttwo\tOCI\tspecifications\thave\thad\ta\tmajor\timpact\ton\tthe\narchitecture\tand\tdesign\tof\tthe\tcore\tDocker\tproduct.\tAs\tof\tDocker\t1.11,\tthe\nDocker\tEngine\tarchitecture\tconforms\tto\tthe\tOCI\truntime\tspec.\nSo\tfar,\tthe\tOCI\thas\tachieved\tgood\tthings\tand\tgone\tsome\tway\tto\tbringing\tthe\necosystem\ttogether.\tHowever,\tstandards\talways\tslow\tinnovation!\tEspecially\twith\nnew\ttechnologies\tthat\tare\tdeveloping\tat\tclose\tto\twarp\tspeed.\tThis\thas\tresulted\tin\nsome\t\nraging\targuments\n\tpassionate\tdiscussions\tin\tthe\tcontainer\tcommunity.\tIn\nthe\topinion\tof\tyour\tauthor,\tthis\tis\ta\tgood\tthing!\tThe\tcontainer\tindustry\tis\nchanging\tthe\tworld\tand\tit’s\tnormal\tfor\tthe\tpeople\tat\tthe\tvanguard\tto\tbe\npassionate\tand\topinionated.\tExpect\tmore\t\npassionate\tdiscussions\n\tabout\tstandards\nand\tinnovation!\nThe\tOCI\tis\torganized\tunder\tthe\tauspices\tof\tthe\tLinux\tFoundation\tand\tboth\nDocker,\tInc.\tand\tCoreOS,\tInc.\tare\tmajor\tcontributors.Chapter\tsummary\nIn\tthis\tchapter\twe\tlearned\ta\tbit\tabout\tDocker,\tInc.\tThey’re\ta\tstartup\ttech\ncompany\tout\tof\tSan\tFrancisco\twith\tan\tambition\tto\tchange\tthe\tway\twe\tdo\nsoftware.\tThey\twere\targuably\tthe\t\nfirst-movers\n\tand\tinstigators\tof\tthe\tcontainer\nrevolution.\tBut\ta\thuge\tecosystem\tof\tpartners\tand\tcompetitors\tnow\texists.\nThe\t\nDocker\tproject\n\tis\topen-source\tand\tlives\tin\tthe\t\nmoby/moby\n\trepo\ton\tGitHub.\nThe\tOpen\tContainer\tInitiative\t(OCI)\thas\tbeen\tinstrumental\tin\tstandardizing\tthe\ncontainer\truntime\tformat\tand\tcontainer\timage\tformat.3:\tInstalling\tDocker\nThere\tare\tloads\tof\tways\tand\tplaces\tto\tinstall\tDocker.\tThere’s\tWindows,\tthere’s\nMac,\tand\tthere’s\tobviously\tLinux.\tBut\tthere’s\talso\tin\tthe\tcloud,\ton\tpremises,\ton\nyour\tlaptop.\tNot\tto\tmention\tmanual\tinstalls,\tscripted\tinstalls,\twizard-based\ninstalls.\tThere\tliterally\tare\tloads\tof\tways\tand\tplaces\tto\tinstall\tDocker!\nBut\tdon’t\tlet\tthat\tscare\tyou!\tThey’re\tall\teasy.\nIn\tthis\tchapter\twe’ll\tcover\tsome\tof\tthe\tmost\timportant\tinstalls:\nDesktop\tinstalls\nDocker\tfor\tWindows\nDocker\tfor\tMac\nServer\tinstalls\nLinux\nWindows\tServer\t2016Docker\tfor\tWindows\t(DfW)\nThe\tfirst\tthing\tto\tnote\tis\tthat\t\nDocker\tfor\tWindows\n\tis\ta\tpackaged\tproduct\tfrom\nDocker,\tInc.\tThis\tmeans\tit’s\tgot\ta\tslick\tinstaller\tthat\tspins\tup\ta\tsingle-engine\nDocker\tenvironment\ton\ta\t64-bit\tWindows\t10\tdesktop\tor\tlaptop.\nThe\tsecond\tthing\tto\tnote\tis\tthat\tit\tis\ta\tCommunity\tEdition\t(CE)\tapp.\tThis\tmeans\nit\tis\tnot\tintended\tfor\tproduction\tworkloads.\nThe\tthird\tthing\tof\tnote\tis\tthat\tit\tmight\tsuffer\tsome\tfeature-lag.\tThis\tis\tbecause\nDocker,\tInc.\tare\ttaking\ta\t\nstability\tfirst,\tfeatures\tsecond\n\tapproach\twith\tthe\nproduct.\nAll\tthree\tpoints\tadd\tup\tto\ta\tquick\tand\teasy\tinstallation,\tbut\tone\tthat\tis\t\nnot\nintended\tfor\tproduction\tworkloads.\nEnough\twaffle.\tLet’s\tsee\thow\tto\tinstall\t\nDocker\tfor\tWindows\n.\nFirst\tup,\tpre-requisites.\t\nDocker\tfor\tWindows\n\trequires:\nWindows\t10\tPro\t|\tEnterprise\t|\tEducation\t(1511\tNovember\tupdate,\tBuild\n10586\tor\tlater)\nMust\tbe\t64-bit\nThe\t\nHyper-V\n\tand\t\nContainers\n\tfeatures\tmust\tbe\tenabled\tin\tWindows\nHardware\tvirtualization\tsupport\tmust\tbe\tenabled\tin\tyour\tsystem’s\tBIOS\nThe\tfollowing\twill\tassume\tthat\thardware\tvirtualization\tsupport\tis\talready\nenabled\tin\tyour\tsystem’s\tBIOS.\tIf\tit\tis\tnot,\tyou\tshould\tcarefully\tfollow\tthe\nprocedure\tfor\tyour\tparticular\tmachine.\nThe\tfirst\tthing\tto\tdo\tin\tWindows\t10\tis\tmake\tsure\tthe\t\nHyper-V\n\tand\t\nContainers\nfeatures\tare\tinstalled\tand\tenabled.\n1\n.\t\nRight-click\tthe\tWindows\tStart\tbutton\tand\tchoose\t\nApps\tand\tFeatures\n.\n2\n.\t\nClick\tthe\t\nPrograms\tand\tFeatures\n\tlink.\n3\n.\t\nClick\t\nTurn\tWindows\tfeatures\ton\tor\toff\n.\n4\n.\t\nCheck\tthe\t\nHyper-V\n\tand\t\nContainers\n\tcheckboxes\tand\tclick\t\nOK\n.This\twill\tinstall\tand\tenable\tthe\tHyper-V\tand\tContainers\tfeatures.\tYour\tsystem\nmay\trequire\ta\trestart.\nFigure\t3.1\nThe\t\nContainers\n\tfeature\tis\tonly\tavailable\tif\tyou\tare\trunning\tthe\tsummer\t2016\nWindows\t10\tAnniversary\tUpdate\t(build\t14393)\tor\tlater.\nOnce\tyou’ve\tinstalled\tthe\tHyper-V\tand\tContainers\tfeatures\tand\trestarted\tyour\nmachine,\tit’s\ttime\tto\tinstall\t\nDocker\tfor\tWindows\n.\n1\n.\t\nHead\tover\tto\twww.docker.com\tand\tclick\t\nGet\tDocker\n\tfrom\tthe\ttop\tof\tthe\npage.\tThis\twill\topen\ta\tdropdown\tmenu.\n2\n.\t\nChoose\t\nWindows\n\tfrom\tunder\tthe\t\nDesktop\n\tsection.\n3\n.\t\nClick\t\nDownload\tfrom\tDocker\tStore\n.\n4\n.\t\nClick\tone\tof\tthe\t\nGet\tDocker\n\tdownload\tlinks.\nThere\tare\tvarious\tstable\tand\tedge\tversions\tavailable.\tThe\tedge\tversion\tcontains\nnewer\tfeatures\tbut\tmay\tnot\tbe\tas\tstable.\nAn\tinstaller\tpackage\tcalled\t\nInstallDocker.msi\n\twill\tbe\tdownloaded\tto\tyour\ndefault\tdownloads\tdirectory.\n1\n.\t\nLocate\tand\tlaunch\tthe\t\nInstallDocker.msi\n\tpackage\tthat\tyou\tjust\ndownloaded.\nStep\tthrough\tthe\tinstallation\twizard\tand\tprovide\tlocal\tadministrator\tcredentials\nto\tcomplete\tthe\tinstallation.\tDocker\twill\tautomatically\tstart\tas\ta\tsystem\tservice\nand\ta\tMoby\tDock\twhale\ticon\twill\tappear\tin\tthe\tWindows\tnotifications\ttray.Congratulations!\tYou\thave\tinstalled\t\nDocker\tfor\tWindows\n.\nNow\tthat\t\nDocker\tfor\tWindows\n\tis\tinstalled\tyou\tcan\topen\ta\tcommand\tprompt\tor\nPowerShell\twindow\tand\trun\tsome\tDocker\tcommands.\tTry\tthe\tfollowing\ncommands:\n\t\t\tC:\\>\tdocker\tversion\n\t\t\tClient:\n\t\t\t\t\tVersion:\t\t\t\t\t\t17.05.0-ce\n\t\t\t\t\tAPI\tversion:\t\t1.29\n\t\t\t\t\tGo\tversion:\t\t\tgo1.7.5\n\t\t\t\t\tGit\tcommit:\t\t\t89658be\n\t\t\t\t\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t4\t21:43:09\t2017\n\t\t\t\t\tOS/Arch:\t\t\t\t\t\twindows/amd64\n\t\t\tServer:\n\t\t\t\t\tVersion:\t\t\t\t\t\t17.05.0-ce\n\t\t\t\t\tAPI\tversion:\t\t1.29\t(minimum\tversion\t1.12)\n\t\t\t\t\tGo\tversion:\t\t\tgo1.7.5\n\t\t\t\t\tGit\tcommit:\t\t\t89658be\n\t\t\t\t\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t4\t21:43:09\t2017\n\t\t\t\t\tOS/Arch:\t\t\t\t\t\tlinux/amd64\n\t\t\t\t\tExperimental:\tfalse\nNotice\tthat\tthe\t\nOS/Arch:\n\tfor\tthe\t\nServer\n\tcomponent\tis\tshowing\tas\t\nlinux/amd64\nin\tthe\toutput\tabove.\tThis\tis\tbecause\tthe\tdefault\tinstallation\tcurrently\tinstalls\tthe\nDocker\tdaemon\tinside\tof\ta\tlightweight\tLinux\tHyper-V\tVM.\tIn\tthis\tdefault\nscenario\tyou\twill\tonly\tbe\table\tto\trun\tLinux\tcontainers\ton\tyour\t\nDocker\tfor\nWindows\n\tinstall.\nIf\tyou\twant\tto\trun\t\nnative\tWindows\tcontainers\n\tyou\tcan\tright\tclick\tthe\tDocker\nwhale\ticon\tin\tthe\tWindows\tnotifications\ttray\tand\tselect\tthe\toption\tto\t\nSwitch\tto\nWindows\tcontainers...\n.\tYou\tcan\tachieve\tthe\tsame\tthing\tform\tthe\tcommand\nline\twith\tthe\tfollowing\tcommand\t(located\tin\tthe\t\n\\Program\nFiles\\Docker\\Docker\n\tdirectory):\nC:\\Program\tFiles\\Docker\\Docker>dockercli\t-SwitchDaemon\nYou\twill\tget\tthe\tfollowing\talert\tif\tyou\thave\tnot\tenabled\tthe\t\nWindows\nContainers\n\tfeature.Figure\t3.2\nIf\tyou\talready\thave\tthe\tWindows\tContainers\tfeature\tenabled\tit\twill\tonly\ttake\ta\nfew\tseconds\tto\tmake\tthe\tswitch.\tOnce\tthe\tswitch\thas\tbeen\tmade\tthe\toutput\tto\nthe\t\ndocker\tversion\n\tcommand\twill\tlook\tlike\tthis.\nC:\\>\tdocker\tversion\nClient:\n\t\tVersion:\t\t\t\t\t\t17.05.0-ce\n\t\tAPI\tversion:\t\t1.29\n\t\tGo\tversion:\t\t\tgo1.7.5\n\t\tGit\tcommit:\t\t\t89658be\n\t\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t4\t21:43:09\t2017\n\t\tOS/Arch:\t\t\t\t\t\twindows/amd64\nServer:\n\t\tVersion:\t\t\t\t\t\t17.05.0-ce\n\t\tAPI\tversion:\t\t1.29\t(minimum\tversion\t1.12)\n\t\tGo\tversion:\t\t\tgo1.7.5\n\t\tGit\tcommit:\t\t\t89658be\n\t\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t4\t21:43:09\t2017\n\t\tOS/Arch:\t\t\t\t\t\twindows/amd64\n\t\tExperimental:\ttrue\nNotice\tthat\tthe\tServer\tversion\tis\tnow\tshowing\tas\t\nwindows/amd64\n.\tThis\tmeans\nthe\tdaemon\tis\tnow\trunning\tnatively\ton\tthe\tWindows\tkernel\tand\twill\ttherefore\nonly\trun\tWindows\tcontainers.\nAlso\tnote\tthat\tthe\tsystem\tabove\tis\tnow\trunning\tthe\t\nexperimental\n\tversion\tof\nDocker\t(\nExperimental:\ttrue\n).\tAs\tpreviously\tmentioned,\t\nDocker\tfor\tWindows\nhas\ta\tstable\tand\tan\tedge\tchannel.\tThe\texample\tabove\tis\tfrom\ta\tWindows\t10\nmachine\trunning\tthe\t\nedge\n\tchannel.\tThe\tWindows\tcontainers\tfeature\tof\tthe\tedge\nchannel\tis\tcurrently\tan\texperimental\tfeature.\nYou\tcan\tcheck\twhich\tchannel\tyou\tare\trunning\twith\tthe\t\ndockercli\t-Version\ncommand.\tThe\t\ndockercli\n\tcommand\tis\tlocated\tin\t\nC:\\Program\nFiles\\Docker\\Docker\n.\nC:\\>\tdockercli\t-Version\nDocker\tfor\tWindows\nVersion:\t17.05.0-ce-win11\t(12053)\nChannel:\tedgeSha1:\tffbc5f5871f44611dfb2bbf49e8312332531c112\nOS\tName:\tWindows\t10\tPro\nWindows\tEdition:\tProfessional\nWindows\tBuild\tNumber:\t15063\nAs\tshown\tbelow,\tother\tregular\tDocker\tcommands\twork\tas\tnormal.\n\t\t\tC:\\>docker\tinfo\n\t\t\tContainers:\t1\n\t\t\t\t\tRunning:\t0\n\t\t\t\t\tPaused:\t0\n\t\t\t\t\tStopped:\t1\n\t\t\tImages:\t1\n\t\t\tServer\tVersion:\t17.05.0-ce\n\t\t\tStorage\tDriver:\twindowsfilter\n\t\t\t\t\tWindows:\n\t\t\tLogging\tDriver:\tjson-file\n\t\t\tPlugins:\n\t\t\t\t\tVolume:\tlocal\n\t\t\t\t\tNetwork:\tl2bridge\tl2tunnel\tnat\tnull\toverlay\ttransparent\n\t\t\t<SNIP>\n\t\t\tExperimental:\ttrue\n\t\t\tInsecure\tRegistries:\n\t\t\t\t127.0.0.0/8\n\t\t\tLive\tRestore\tEnabled:\tfalse\nDocker\tfor\tWindows\tincludes\tthe\tDocker\tEngine\t(client\tand\tdaemon),\tDocker\nCompose,\tDocker\tMachine,\tand\tthe\tDocker\tNotary\tcommand\tline.\tUse\tthe\nfollowing\tcommands\tto\tverify\tthat\teach\twas\tsuccessfully\tinstalled\tand\twhich\nversions\tof\teach\tyou\thave:\nC:\\>\tdocker\t--version\nDocker\tversion\t1.12.1,\tbuild\t23cf638,\texperimental\nC:\\>\tdocker-compose\t--version\ndocker-compose\tversion\t1.13.0,\tbuild\t1719ceb8\nC:\\>\tdocker-machine\t--version\ndocker-machine\tversion\t0.11.0,\tbuild\t5b27455\nC:\\>\tnotary\tversion\nnotary\n\tVersion:\t\t\t\t0.4.3\n\tGit\tcommit:\t9211198\nDocker\tfor\tMac\t(DfM)\nDocker\tfor\tMac\n\tis\talso\ta\tpackaged\tproduct\tfrom\tDocker,\tInc.\tSo\trelax,\tyou\tdon’t\nneed\tto\tbe\ta\tkernel\tengineer,\tand\twe’re\tnot\tabout\tto\twalk\tthrough\ta\tcomplex\nhack\tfor\tgetting\tDocker\tonto\tyour\tMac.\tWe’ll\twalk\tyou\tthrough\tthe\tprocess\tof\ninstalling\t\nDocker\tfor\tMac\n\ton\tyour\tMac\tdesktop\tor\tlaptop,\tand\tit’s\tridiculously\neasy.So\twhat\tis\t\nDocker\tfor\tMac?\nFirst\tup,\t\nDocker\tfor\tMac\n\tis\ta\tpackaged\tproduct\tfrom\tDocker,\tInc.\tthat\tis\tbased\non\tthe\tCommunity\tEdition\tof\tDocker.\tThis\tmeans\tit’s\tan\teasy\tway\tto\tinstall\ta\nsingle-engine\tversion\tof\tDocker\ton\tyou\tMac.\tIt\talso\tmeans\tthat\tit’s\tnot\tintended\nfor\tproduction\tuse.\tIf\tyou’ve\theard\tof\t\nboot2docker\n\tthen\t\nDocker\tfor\tMac\n\tis\twhat\nyou\talways\twished\t\nboot2docker\n\twas\t-\tit’s\tsmooth,\tsimple\tand\tstable.\nIt’s\talso\tworth\tnoting\tthat\t\nDocker\tfor\tMac\n\twill\tnot\tgive\tyou\tthe\tDocker\tEngine\nrunning\tnatively\ton\tthe\tMac\tOS\tDarwin\tkernel.\tBehind\tthe\tscenes\tit\truns\tthe\nDocker\tdaemon\tinside\tof\ta\tlightweight\tLinux\tVM.\tIt\tthen\tseamlessly\texposes\nthe\tdaemon\tand\tAPI\tto\tyour\tMac\tenvironment.\tBut\tit\tdoes\tit\tall\tin\ta\tway\tthat\tthe\nmystery\tand\tmagic\tthat\tpulls\tit\tall\ttogether\tis\thidden\taway\tbehind\tthe\tscenes.\tAll\nyou\tneed\tto\tknow\tis\tthat\tyou\tcan\topen\ta\tterminal\ton\tyour\tMac\tand\tuse\tthe\nregular\tDocker\tcommands\tto\thit\tthe\tDocker\tAPI.\nAlthough\tthis\tseamlessly\tworks\ton\tyour\tMac,\tit’s\tobviously\tDocker\ton\tLinux\nunder\tthe\thood,\tso\tit’s\tonly\tgoing\twork\twith\tLinux-based\tDocker\tcontainers.\nThis\tis\tgood\tthough,\tas\tthis\tis\twhere\tmost\tof\tthe\tcontainer\taction\tis.\nFigure\t3.3\tshows\ta\thigh-level\trepresentation\tof\tthe\t\nDocker\tfor\tMac\n\tarchitecture.\nFigure\t3.3\nNote:\n\tFor\tthe\tcurious\treader,\t\nDocker\tfor\tMac\n\tleverages\t\nHyperKit\n\tto\nimplement\tan\textremely\tlightweight\thypervisor.\tHyperKit\tis\tbased\ton\tthe\nxhive\thypervisor\n.\t\nDocker\tfor\tMac\n\talso\tleverages\tfeatures\tfrom\t\nDataKit\n\tand\nruns\ta\thighly\ttuned\tLinux\tdistro\tcalled\t\nMoby\n\tthat\tis\tbased\toff\tof\t\nAlpine\nLinux\n.\nLet’s\tget\t\nDocker\tfor\tMac\n\tinstalled.1\n.\t\nPoint\tyour\tbrowser\tto\twww.docker.com\tand\tclick\t\nGet\tDocker\n\tfrom\tthe\ttop\nof\tthe\tpage.\tThis\twill\topen\ta\tdropdown\tmenu.\n2\n.\t\nChoose\t\nMac\n\tfrom\tunder\tthe\t\nDesktop\n\tsection.\n3\n.\t\nClick\t\nDownload\tfrom\tDocker\tStore\n.\n4\n.\t\nClick\tone\tof\tthe\t\nGet\tDocker\n\tdownload\tlinks.\nThere\tare\tvarious\tstable\tand\tedge\tversions\tavailable.\tThe\tedge\tversion\tcontains\nnewer\tfeatures\tbut\tmay\tnot\tbe\tstable.\nA\t\nDocker.dmg\n\tinstallation\tpackage\twill\tbe\tdownloaded.\n1\n.\t\nLaunch\tthe\t\nDocker.dmg\n\tfile\tthat\tyou\tdownloaded\tin\tthe\tprevious\tstep.\tYou\nwill\tbe\tasked\tto\tdrag\tand\tdrop\tthe\tMoby\tDock\twhale\timage\tinto\tthe\nApplications\n\tfolder.\n2\n.\t\nOpen\tyour\t\nApplications\n\tfolder\t(it\tmay\topen\tautomatically)\tand\tdouble-\nclick\tthe\tDocker\tapplication\ticon\tto\tStart\tit.\tYou\tmay\tbe\tasked\tto\tconfirm\nthe\taction\tbecause\tthe\tapplication\twas\tdownloaded\tfrom\tthe\tinternet.\n3\n.\t\nEnter\tyour\tpassword\tso\tthat\tthe\tinstaller\tcan\tcreate\tcomponents,\tsuch\tas\nnetworking,\tthat\trequire\televated\tprivileges.\n4\n.\t\nThe\tDocker\tdaemon\twill\tnow\tstart.\nAn\tanimated\twhale\ticon\twill\tappear\tin\tthe\tstatus\tbar\tat\tthe\ttop\tof\tyour\nscreen\twhile\tthe\tdaemon\tstarts.\tOnce\tDocker\thas\tsuccessfully\tstarted\tthe\nwhale\twill\tstop\tbeing\tanimated.\tYou\tcan\tclick\tthe\twhale\ticon\tand\tperform\nbasic\tactions\tsuch\tas\trestarting\tthe\tdaemon,\tchecking\tfor\tupdates,\tand\nopening\tthe\tUI.\nNow\tthat\t\nDocker\tfor\tMac\n\tis\tinstalled\tyou\tcan\topen\ta\tterminal\twindow\tand\trun\nsome\tregular\tDocker\tcommands.\tTry\tthe\tcommands\tlisted\tbelow.\n$\tdocker\tversion\nClient:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\n4\n\t\n21\n:43:09\t\n2017\n\tOS/Arch:\t\t\t\t\t\tdarwin/amd64\nServer:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\t\n(\nminimum\tversion\t\n1\n.12\n)\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\n4\n\t\n21\n:43:09\t\n2017\n\tOS/Arch:\t\t\t\t\t\tlinux/amd64\n\tExperimental:\t\ntrueNotice\tin\tthe\toutput\tabove\tthat\tthe\t\nOS/Arch:\n\tfor\tthe\t\nServer\n\tcomponent\tis\nshowing\tas\t\nlinux/amd64\n.\tThis\tis\tbecause\tthe\tserver\tportion\tof\tthe\tDocker\nEngine\t(a.k.a.\tthe\t“daemon”)\tis\trunning\tinside\tof\tthe\tLinux\tVM\twe\tmentioned\nearlier.\tThe\t\nClient\n\tcomponent\tis\ta\tnative\tMac\tapplication\tand\truns\tdirectly\ton\nthe\tMac\tOS\tDarwin\tkernel\t(\nOS/Arch:\tdarwin/amd64\n).\nAlso\tnote\tthat\tthe\tsystem\tis\trunning\tthe\texperimental\tversion\t(\nExperimental:\ntrue\n)\tof\tDocker.\tThis\tis\tbecause\tthe\tsystem\tis\trunning\tthe\t\nedge\n\tversion\twhich\ncomes\twith\texperimental\tfeatures\tturned\ton.\nRun\tsome\tmore\tDocker\tcommands.\n$\tdocker\tinfo\nContainers:\t\n0\n\tRunning:\t\n0\n\tPaused:\t\n0\n\tStopped:\t\n0\nImages:\t\n0\nServer\tVersion:\t\n17\n.05.0-ce\n<Snip>\nRegistry:\thttps://index.docker.io/v1/\nExperimental:\t\ntrue\nInsecure\tRegistries:\n\t\n127\n.0.0.0/8\nLive\tRestore\tEnabled:\t\nfalse\nDocker\tfor\tMac\tinstalls\tthe\tDocker\tEngine\t(client\tand\tdaemon),\tDocker\nCompose,\tand\tDocker\tmachine\tand\tthe\tNotary\tcommand\tline.\tThe\tfollowing\nthree\tcommands\tshow\tyou\thow\tto\tverify\tthat\tall\tof\tthese\tcomponents\tinstalled\nsuccessfully\tand\tfind\tout\twhich\tversions\tyou\thave.\n$\t\tdocker\t--version\nDocker\tversion\t\n17\n.05.0-ce,\tbuild\t89658be\n$\t\tdocker-compose\t--version\ndocker-compose\tversion\t\n1\n.13.0,\tbuild\t1719ceb\n$\t\tdocker-machine\t--version\ndocker-machine\tversion\t\n0\n.11.0,\tbuild\t5b27455\n$\tnotary\tversion\nnotary\n\t\tVersion:\t\t\t\t\n0\n.4.3\n\t\tGit\tcommit:\t\n9211198\nInstalling\tDocker\ton\tLinuxInstalling\tDocker\ton\tLinux\tis\tthe\tmost\tcommon\tinstallation\ttype\tand\tit’s\nsurprisingly\teasy.\tThe\tmost\tcommon\tdifficulty\tis\tthe\tslight\tvariations\tbetween\nLinux\tdistros\tsuch\tas\tUbuntu\tvs\tCentOS.\tThe\texample\twe’ll\tuse\tin\tthis\tsection\nis\tbased\ton\tUbuntu\tLinux,\tbut\tshould\twork\ton\tupstream\tand\tdownstream\tforks.\nIt\tshould\talso\twork\ton\tCentOS\tand\tits\tupstream\tand\tdownstream\tforks.\tIt\tmakes\nabsolutely\tno\tdifference\tif\tyour\tLinux\tmachine\tis\ta\tphysical\tserver\tin\tyour\town\ndata\tcenter,\ton\tthe\tother\tside\tof\tthe\tplanet\tin\ta\tpublic\tcloud,\tor\ta\tVM\ton\tyour\nlaptop.\tThe\tonly\trequirements\tare\tthat\tthe\tmachine\tbe\trunning\tLinux\tand\thas\naccess\tto\thttps://get.docker.com.\nThe\tfirst\tthing\tyou\tneed\tto\tdecide\tbefore\tyou\tinstall\tDocker\ton\tLinux\tis\twhich\nedition\tto\tinstall.\tThere\tare\tcurrently\ttwo\teditions:\nCommunity\tEdition\t(CE)\nEnterprise\tEdition\t(EE)\nDocker\tCE\tis\tfree\tand\tis\tthe\tversion\twe\twill\tbe\tdemonstrating\there.\tDocker\tEE\nis\tthe\tsame\tas\tCE\tbut\tcomes\twith\tcommercial\tsupport\tand\taccess\tto\tother\nDocker\tproducts\tsuch\tas\tDocker\tTrusted\tRegistry\tand\tUniversal\tControl\tPlane.\nIn\tthe\texamples\tbelow\twe’ll\tuse\tthe\t\nwget\n\tcommand\tto\tcall\ta\tshell\tscript\tthat\ninstalls\tDocker\tCE.\tFor\tinformation\ton\tother\tways\tto\tinstall\tDocker\ton\tLinux\tgo\nto\thttps://www.docker.com\tand\tclick\ton\t\nGet\tDocker\n.\nNote:\n\tYou\tshould\tensure\tthat\tyour\tsystem\tis\tup-to-date\twith\tthe\tlatest\npackages\tand\tsecurity\tpatches\tbefore\tcontinuing.\n1\n.\t\nOpen\ta\tnew\tshell\ton\tyour\tLinux\tmachine.\n2\n.\t\nUse\t\nwget\n\tto\tretrieve\tand\trun\tthe\tDocker\tinstall\tscript\tfrom\nhttps://get.docker.com\n\tand\tpipe\tit\tthrough\tyour\tshell.\n\t\t\t$\twget\t-qO-\thttps://get.docker.com/\t|\tsh\n\t\t\tmodprobe:\tFATAL:\tModule\taufs\tnot\tfound\t/lib/modules/4.4.0-36-generic\n\t\t\t+\tsh\t-c\t'sleep\t3;\tyum\t-y\t-q\tinstall\tdocker-engine'\n\t\t\t<Snip>\n\t\t\tIf\tyou\twould\tlike\tto\tuse\tDocker\tas\ta\tnon-root\tuser,\tyou\tshould\n\t\t\t\tnow\tconsider\tadding\tyour\tuser\tto\tthe\t\"docker\"\tgroup\twith\n\t\t\t\tsomething\tlike:\n\t\t\tsudo\tusermod\t-aG\tdocker\tyour-user\n\t\t\tRemember\tthat\tyou\twill\thave\tto\tlog\tout\tand\tback\tin...1\n.\t\nIt\tis\tbest\tpractice\tto\tonly\tuse\tnon-root\tusers\twhen\tworking\twith\tDocker.\tTo\ndo\tthis\tyou\tneed\tto\tadd\tyour\tnon-root\tusers\tto\tthe\tlocal\t\ndocker\n\tUnix\tgroup\non\tyour\tLinux\tmachine.\tThe\tcommands\tbelow\tshow\thow\tto\tadd\tthe\nnpoulton\n\tuser\tto\tthe\t\ndocker\n\tgroup\tand\tverify\tthat\tthe\toperation\tsucceeded.\nYou\twill\tneed\tto\tuse\ta\tvalid\tuser\taccount\ton\tyour\town\tsystem.\n$\tsudo\tusermod\t-aG\tdocker\tnpoulton\n$\n$\tcat\t/etc/group\t\n|\n\tgrep\tdocker\ndocker:x:999:npoulton\nIf\tyou\tare\talready\tlogged\tin\tas\tthe\tuser\tthat\tyou\tjust\tadded\tto\tthe\t\ndocker\ngroup,\tyou\twill\tneed\tto\tlog\tout\tand\tlog\tback\tin\tfor\tthe\tgroup\tmembership\tto\ntake\teffect.\nCongratulations!\tDocker\tis\tnow\tinstalled\ton\tyour\tLinux\tmachine.\tRun\tthe\nfollowing\tcommands\tto\tverify\tyour\tinstallation.\n$\tdocker\t--version\nDocker\tversion\t\n17\n.05.0-ce,\tbuild\t89658be\n$\n$\tdocker\tinfo\nContainers:\t\n0\n\tRunning:\t\n0\n\tPaused:\t\n0\n\tStopped:\t\n0\nImages:\t\n0\n<Snip>\nKernel\tVersion:\t\n4\n.4.0-1013-aws\nOperating\tSystem:\tUbuntu\t\n16\n.04.2\tLTS\nOSType:\tlinux\nArchitecture:\tx86_64\nCPUs:\t\n1\nTotal\tMemory:\t\n990\n.7MiB\nName:\tip-172-31-45-57\nID:\tL3GX:LLFI:YABL:WVUS:DHLL:2ZQU:44E3:V6BB:LWUY:WIGX:Z6RJ:JBVL\nDocker\tRoot\tDir:\t/var/lib/docker\nDebug\tMode\t\n(\nclient\n)\n:\t\nfalse\nDebug\tMode\t\n(\nserver\n)\n:\t\nfalse\nRegistry:\thttps://index.docker.io/v1/\nExperimental:\t\nfalse\nInsecure\tRegistries:\n\t\n127\n.0.0.0/8\nLive\tRestore\tEnabled:\t\nfalse\nIf\tthe\tprocess\tdescribed\tabove\tdoesn’t\twork\tfor\tyour\tLinux\tdistro,\tyou\tcan\tgo\tto\nthe\t\nDocker\tDocs\n\twebsite\tand\tclick\ton\tthe\tlink\trelating\tto\tyour\tdistro.\tThis\twill\ntake\tyou\tto\tthe\tofficial\tDocker\tinstallation\tinstructions\twhich\tare\tusually\tkept\tup\nto\tdate.\tBe\twarned\tthough,\tthe\tinstructions\ton\tthe\tDocker\twebsite\ttend\tuse\tthe\npackage\tmanager\tand\trequire\ta\tlot\tmore\tsteps\tthan\tthe\tprocedure\twe\tused\tabove.In\tfact,\tif\tyou\topen\ta\tweb\tbrowser\tto\thttps://get.docker.com\tyou\twill\tsee\tthat\tit’s\na\tshell\tscript\tthat\tdoes\tall\tof\tthe\thard\twork\tof\tinstallation\tfor\tyou.\nWarning:\n\tIf\tyou\tinstall\tDocker\tfrom\ta\tsource\tother\tthan\tthe\tofficial\tDocker\nrepositories\tyou\tmay\tend\tup\twith\ta\tforked\tversion\tof\tDocker.\tThis\tis\nbecause\tsome\tvendors\tand\tdistros\tchoose\tto\tfork\tthe\tDocker\tproject\tand\ndevelop\ttheir\town\tslightly\tcustomized\tversions.\tYou\tneed\tto\tbe\taware\tof\nthings\tlike\tthis\tif\tyou\tare\tinstalling\tfrom\tcustom\trepositories\tas\tyou\tcould\nunwittingly\tend\tup\tin\ta\tsituation\twhere\tyou\tare\trunning\ta\tfork\tthat\thas\ndiverged\tfrom\tthe\tofficial\tDocker\tproject.\tThis\tisn’t\ta\tproblem\tif\tthis\tis\nwhat\tyou\tintend\tto\tdo.\tIf\tit\tis\tnot\twhat\tyou\tintend,\tit\tcan\tlead\tto\tsituations\nwhere\tmodifications\tand\tfixes\tyour\tvendor\tmakes\tdo\tnot\tmake\tit\tback\nupstream\tin\tto\tthe\tofficial\tDocker\tproject.\tIn\tthese\tsituations,\tyou\twill\tnot\nbe\table\tto\tget\tcommercial\tsupport\tfor\tyour\tinstallation\tfrom\tDocker,\tInc.\tor\nits\tauthorized\tservice\tpartners.\nInstalling\tDocker\ton\tWindows\tServer\t2016\nIn\tthis\tsection\twe’ll\tlook\tat\tone\tof\tthe\tways\tto\tinstall\tDocker\ton\tWindows\nServer\t2016.\t\nWe’ll\tcomplete\tthe\tfollowing\thigh-level\tsteps:\n1\n.\t\nInstall\tthe\tWindows\tContainers\tfeature\n2\n.\t\nInstall\tDocker\n3\n.\t\nVerify\tthe\tinstallation\nBefore\tproceeding\tyou\tshould\tensure\tthat\tyour\tsystem\tis\tup-to-date\twith\tthe\nlatest\tpackage\tversions\tand\tsecurity\tupdates.\tYou\tcan\tdo\tthis\tquickly\twith\tthe\nsconfig\n\tcommand\tand\tchoosing\toption\t6\tto\tinstall\tupdates.\tThis\tmay\trequire\ta\nsystem\trestart.\nWe’ll\tbe\tdemonstrating\tan\tinstallation\ton\ta\tversion\tof\tWindows\tServer\t2016\tthat\ndoes\tnot\talready\thave\tthe\tContainers\tfeature\tor\tan\tolder\tversion\tof\tDocker\nalready\tinstalled.\nEnsure\tthat\tthe\tContainers\tfeature\tis\tinstalled\tand\tenabled.\n1\n.\t\nRight-click\tthe\tWindows\tStart\tbutton\tand\tselect\t\nPrograms\tand\tFeatures\n.\nThis\twill\topen\tthe\t\nServer\tManager\n\tapp.\n2\n.\t\nSelect\tthe\t\nDashboard\n\tand\tclick\t\nAdd\tRoles\tand\tFeatures\n.3\n.\t\nClick\tthrough\tthe\twizard\tuntil\tyou\tget\tto\tthe\t\nFeatures\n\tpage.\n4\n.\t\nMake\tsure\tthat\tthe\t\nContainers\n\tfeature\tis\tchecked\tand\tcomplete\tthe\twizard.\nThis\tmay\trequire\ta\tsystem\trestart.\nNow\tthat\tthe\tWindows\tContainers\tfeature\tis\tinstalled\tyou\tcan\tinstall\tDocker.\nWe’ll\tuse\tPowerShell\tto\tdo\tthis.\n1\n.\t\nOpen\ta\tnew\tPowerShell\tAdministrator\tterminal.\n2\n.\t\nUse\tthe\tfollowing\tcommand\tto\tinstall\tthe\tDocker-Microsoft\tpackage\nmanagement\tprovider.\n>\tInstall-Module\t-Name\tDockerMsftProvider\t-Repository\tPSGallery\t-Force\nAccept\tthe\tNuGet\tprovider\tinstall\tif\tprompted.\n3\n.\t\nInstall\tDocker.\n\t>\tInstall-Package\t-Name\tdocker\t-ProviderName\tDockerMsftProvider\nSelect\t\nA\n\tto\tconfirm\tpackage\tinstallation\tand\tsuppress\tany\tfurther\tprompts.\nOnce\tthe\tinstallation\tis\tcomplete\tyou\twill\tget\ta\tsummary\tas\tshown\tbelow.\nName\t\t\t\t\t\tVersion\t\t\t\t\t\t\tSource\t\t\t\t\t\t\t\t\t\t\tSummary\n----\t\t\t\t\t\t-------\t\t\t\t\t\t\t------\t\t\t\t\t\t\t\t\t\t\t-------\nDocker\t\t\t\t17.03.1-ee\t\t\t\tDockerDefault\t\t\t\tContains\tDocker\tEE...\n4\n.\t\nRestart\tyour\tsystem\nDocker\tis\tnow\tinstalled\tand\tyou\tcan\tstart\tdeploying\tcontainers.\tThe\tfollowing\ntwo\tcommands\tare\tgood\tways\tto\tverify\tthat\tthe\tinstallation\tsucceeded.\n>\tdocker\tversion\nClient:\n\tVersion:\t\t\t\t\t\t17.03.1-ee-3\n\tAPI\tversion:\t\t1.27\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t3fcee33\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMar\t30\t19:31:22\t2017\n\tOS/Arch:\t\t\t\t\t\twindows/amd64\nServer:\n\tVersion:\t\t\t\t\t\t17.03.1-ee-3\n\tAPI\tversion:\t\t1.27\t(minimum\tversion\t1.24)\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t3fcee33\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMar\t30\t19:31:22\t2017\n\tOS/Arch:\t\t\t\t\t\twindows/amd64\n\tExperimental:\tfalse>\tdocker\tinfo\nContainers:\t0\n\tRunning:\t0\n\tPaused:\t0\n\tStopped:\t0\nImages:\t0\nServer\tVersion:\t17.03.1-ee-3\nStorage\tDriver:\twindowsfilter\n\tWindows:\nLogging\tDriver:\tjson-file\nPlugins:\n\tVolume:\tlocal\n\tNetwork:\tl2bridge\tl2tunnel\tnat\tnull\toverlay\ttransparent\n<SNIP>\nInsecure\tRegistries:\n\t127.0.0.0/8\nLive\tRestore\tEnabled:\tfalse\nDocker\tis\tnow\tinstalled\tand\tyou\tare\tready\tto\tstart\tusing\tWindows\tcontainers.Chapter\tSummary\nIn\tthis\tchapter\tyou\tsaw\thow\tto\tinstall\tDocker\ton\tWindows\t10,\tMac\tOS\tX,\nLinux,\tand\tWindows\tServer\t2016.\tNow\tthat\tyou\tknow\thow\tto\tinstall\tDocker\nyou\tare\tready\tto\tstart\tworking\twith\timages\tand\tcontainers.4:\tThe\tbig\tpicture\nThe\tidea\tof\tthis\tchapter\tis\tto\tgive\tyou\ta\tquick\tbig\tpicture\tof\twhat\tDocker\tis\tall\nabout\tbefore\twe\tdive\tin\tdeeper\tin\tlater\tchapters.\nWe’ll\tbreak\tthis\tchapter\tinto\ttwo:\nThe\tOps\tperspective\nThe\tDev\tperspective\nThe\tOps\tPerspective\tsection\twill\tdownload\tan\timage,\tstart\ta\tnew\tcontainer,\tlog\nin\tto\tthe\tnew\tcontainer,\trun\ta\tcommand\tinside\tof\tit,\tand\tthen\tdestroy\tit.\nThe\tDev\tPerspective\tsection\twill\tpull\tsome\tapp-code\tfrom\tGitHub,\tinspect\ta\nDockerfile,\tcontainerize\tthe\tapp,\trun\tit\tas\ta\tcontainer.\nThese\ttwo\tsections\twill\tgive\tyou\ta\tgood\tidea\tof\twhat\tDocker\tis\tall\tabout\tand\nhow\tsome\tof\tthe\tmajor\tcomponents\tfit\ttogether.\t\nIt\tis\trecommended\tthat\tyou\nread\tboth\tsections\tto\tget\tthe\t\ndev\n\tand\tthe\t\nops\n\tperspectives!\nDon’t\tworry\tif\tsome\tof\tthe\tstuff\twe\tdo\there\tis\ttotally\tnew\tto\tyou.\tWe’re\tnot\ntrying\tto\tmake\tyou\tan\texpert\tby\tthe\tend\tof\tthis\tchapter.\tThis\tis\tall\tabout\tgiving\nyou\ta\t\nfeel\n\tof\tthings\t-\tsetting\tyou\tup\tso\tthat\twhen\twe\tget\tinto\tthe\tdetails\tin\tlater\nchapters,\tyou\thave\tan\tidea\tof\thow\tthe\tpieces\tfit\ttogether.\nAll\tyou\tneed\tto\tfollow\talong\twith\tthe\texercises\tin\tthis\tchapter\tis\ta\tsingle\tDocker\nhost\twith\tan\tinternet\tconnection.\tYour\tDocker\tHost\tcan\tbe\tLinux\tor\tWindows,\nand\tit\tdoesn’t\tmatter\tif\tit’s\ta\tVM\ton\tyour\tlaptop,\tan\tinstance\tin\tthe\tpublic\tcloud,\nor\ta\tbare\tmetal\tserver\tin\tyour\tdata\tcenter.\tAll\tit\tneeds,\tis\tto\tbe\trunning\tDocker\nwith\ta\tconnection\tto\tthe\tinternet.\t\nWe’ll\tbe\tshowing\texamples\tusing\tLinux\tand\nWindows!The\tOps\tPerspective\nWhen\tyou\tinstall\tDocker,\tyou\tget\ttwo\tmajor\tcomponents:\nthe\tDocker\tclient\nthe\tDocker\tdaemon\t(sometimes\tcalled\t“server”\tor\t“engine”)\nThe\tdaemon\timplements\tthe\t\nDocker\tRemote\tAPI\n.\nIn\ta\tdefault\tLinux\tinstallation,\tthe\tclient\ttalks\tto\tthe\tdaemon\tvia\ta\tlocal\nIPC/Unix\tsocket\tat\t\n/var/run/docker.sock\n.\tOn\tWindows\tthis\thappens\tvia\ta\nnamed\tpipe\tat\t\nnpipe:////./pipe/docker_engine\n.\tYou\tcan\ttest\tthat\tthe\tclient\nand\tdaemon\tare\trunning\tand\tcan\ttalk\tto\teach\tother\twith\tthe\t\ndocker\tversion\ncommand.\n$\tdocker\tversion\nClient:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t\n4\n\t\n22\n:10:54\t\n2017\n\tOS/Arch:\t\t\t\t\t\tlinux/amd64\nServer:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\t\n(\nminimum\tversion\t\n1\n.12\n)\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t\n4\n\t\n22\n:10:54\t\n2017\n\tOS/Arch:\t\t\t\t\t\tlinux/amd64\n\tExperimental:\t\nfalse\nIf\tyou\tget\ta\tresponse\tback\tfrom\tthe\t\nClient\n\t\nand\n\t\nServer\n\tcomponents\tyou\tshould\nbe\tgood\tto\tgo.\tIf\tyou\tare\tusing\tLinux\tand\tget\tan\terror\tresponse\tfrom\tthe\tServer\ncomponent,\ttry\tthe\tcommand\tagain\twith\t\nsudo\n\tin\tfront\tof\tit:\t\nsudo\tdocker\nversion\n.\tIf\tit\tworks\twith\t\nsudo\n\tyou\twill\tneed\tto\tadd\tyour\tuser\taccount\tto\tthe\nlocal\t\ndocker\n\tgroup,\tor\tprefix\tthe\tremainder\tof\tthe\tcommands\tin\tthis\tchapter\twith\nsudo\n.\nImages\nA\tgood\tway\tto\tthink\tof\ta\tDocker\timage\tis\tas\tan\tobject\tthat\tcontains\tan\tOS\nfilesystem\tand\tan\tapplication.\tIf\tyou\twork\tin\toperations,\tit’s\tlike\ta\tvirtual\nmachine\ttemplate.\tA\tvirtual\tmachine\ttemplate\tis\tessentially\ta\tstopped\tvirtualmachine.\tIn\tthe\tDocker\tworld,\tan\timage\tis\teffectively\ta\tstopped\tcontainer.\tIf\nyou’re\ta\tdeveloper,\tyou\tcan\tthink\tof\tan\timage\tas\ta\t\nclass\n.\nRun\tthe\t\ndocker\timage\tls\n\tcommand\ton\tyour\tDocker\thost.\n$\tdocker\timage\tls\nREPOSITORY\t\t\t\tTAG\t\t\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\tSIZE\nIf\tyou\tare\tworking\tfrom\ta\tfreshly\tinstalled\tDocker\thost\tit\twill\thave\tno\timages\nand\twill\tlook\tlike\tthe\toutput\tabove.\nGetting\timages\tonto\tyour\tDocker\thost\tis\tcalled\t“pulling”.\tIf\tyou\tare\tfollowing\nalong\twith\tLinux,\tpull\tthe\t\nubuntu:latest\n.\tIf\tyou\tare\tfollowing\talong\ton\nWindows,\tpull\tthe\t\nmicrosoft/powershell:nanoserver\n\timage.\n$\tdocker\timage\tpull\tubuntu:latest\nlatest:\tPulling\tfrom\tlibrary/ubuntu\nb6f892c0043b:\tPull\t\ncomplete\n55010f332b04:\tPull\t\ncomplete\n2955fb827c94:\tPull\t\ncomplete\n3deef3fcbd30:\tPull\t\ncomplete\ncf9722e506aa:\tPull\t\ncomplete\nDigest:\tsha256:382452f82a8b....463c62a9848133ecb1aa8\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tubuntu:latest\nRun\tthe\t\ndocker\timage\tls\n\tcommand\tagain\tto\tsee\tthe\timage\tyou\tjust\tpulled.\n$\tdocker\timages\nREPOSITORY\t\t\t\t\t\tTAG\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\t\tSIZE\nubuntu\t\t\t\t\t\t\t\t\t\tlatest\t\t\tbd3d4369aebc\t\t\t\t\n11\n\tdays\tago\t\t\t\t\t\n126\n.6\tMB\nWe’ll\tget\tinto\tthe\tdetails\tof\twhere\tthe\timage\tis\tstored\tand\twhat’s\tinside\tof\tit\tin\nlater\tchapters.\tFor\tnow,\tit’s\tenough\tto\tunderstand\tthat\tan\timage\tcontains\tenough\nof\tan\toperating\tsystem\t(OS),\tas\twell\tas\tall\tthe\tcode\tand\tdependencies\tto\trun\nwhatever\tapplication\tit’s\tdesigned\tfor.\tThe\t\nubuntu\n\timage\tthat\twe’ve\tpulled\thas\ta\nstripped-down\tversion\tof\tthe\tUbuntu\tLinux\tfilesystem\tincluding\ta\tfew\tof\tthe\ncommon\tUbuntu\tutilities.\tThe\t\nmicrosoft/powershell\n\timage\tpulled\tin\tthe\nWindows\texample\tcontains\ta\tWindows\tNano\tServer\tOS\twith\tPowerShell.\nIf\tyou\tpull\tan\tapplication\tcontainer\tsuch\tas\t\nnginx\n\tor\t\nmicrosoft/iis\n,\tyou\twill\nget\tan\timage\tthat\tcontains\tsome\tOS\tas\twell\tas\tthe\tcode\tto\trun\teither\t\nnginx\n\tor\nIIS\n.\nIt’s\talso\tworth\tnoting\tthat\teach\timage\tgets\tits\town\tunique\tID.\tWhen\tworking\nwith\tthe\timages\tyou\tcan\trefer\tto\tthem\tusing\teither\t\nIDs\n\tor\tnames.Containers\nNow\tthat\twe\thave\tan\timage\tpulled\tlocally\ton\tour\tDocker\thost,\twe\tcan\tuse\tthe\ndocker\tcontainer\trun\n\tcommand\tto\tlaunch\ta\tcontainer\tfrom\tit.\nFor\tLinux:\n$\n\t\ndocker\n\t\ncontainer\n\t\nrun\n\t\n-\nit\n\t\nubuntu\n:\nlatest\n\t\n/\nbin\n/\nbash\nroot\n@6\ndc20d508db0\n:\n/\n#\nFor\tWindows:\n>\tdocker\tcontainer\trun\t-it\tmicrosoft/powershell:nanoserver\tPowerShell.exe\nWindows\tPowerShell\nCopyright\t(C)\t2016\tMicrosoft\tCorporation.\tAll\trights\treserved.\nPS\tC:\\>\nLook\tclosely\tat\tthe\toutput\tfrom\tthe\tcommands\tabove.\tYou\tshould\tnotice\tthat\tthe\nshell\tprompt\thas\tchanged\tin\teach\tinstance.\tThis\tis\tbecause\tyour\tshell\tis\tnow\nattached\tto\tthe\tshell\tof\tthe\tnew\tcontainer\t-\tyou\tare\tliterally\tinside\tof\tthe\tnew\ncontainer!\nLet’s\texamine\tthat\t\ndocker\tcontainer\trun\n\tcommand.\t\ndocker\tcontainer\trun\ntells\tthe\tDocker\tdaemon\tto\tstart\ta\tnew\tcontainer.\tThe\t\n-it\n\tflags\ttell\tthe\tdaemon\nto\tmake\tthe\tcontainer\tinteractive\tand\tto\tattach\tour\tcurrent\tterminal\tto\tthe\tshell\tof\nthe\tcontainer\t(we’ll\tget\tmore\tspecific\tabout\tthis\tin\tthe\tchapter\ton\tcontainers).\nNext,\tthe\tcommand\ttells\tDocker\tthat\twe\twant\tthe\tcontainer\tto\tbe\tbased\ton\tthe\nubuntu:latest\n\timage\t(or\tthe\tmicrosoft/powershell:nanoserver\timage\tif\tyou’re\nfollowing\talong\twith\tWindows).\t\nFinally,\twe\ttell\tDocker\twhich\tprocess\twe\twant\nto\trun\tinside\tof\tthe\tcontainer.\t\nFor\tthe\tLinux\texample\twe’re\trunning\ta\tBash\tshell,\nfor\tthe\tWindows\tcontainer\twere\trunning\tPowerShell.\nRun\ta\t\nps\n\tcommand\tfrom\tinside\tof\tthe\tcontainer\tto\tlist\tall\trunning\tprocesses.\nLinux\texample:\nroot\n@6\ndc20d508db0\n:\n/\n#\n\t\nps\n\t\n-\nelf\nF\n\t\nS\n\t\nUID\n\t\t\t\t\nPID\n\t\t\nPPID\n\t\t\t\nNI\n\t\nADDR\n\t\nSZ\n\t\nWCHAN\n\t\t\nSTIME\n\t\nTTY\n\t\t\nTIME\n\t\nCMD\n4\n\t\nS\n\t\nroot\n\t\t\t\t\t\n1\n\t\t\t\t\t\n0\n\t\t\t\t\n0\n\t\n-\n\t\t\n4560\n\t\nwait\n\t\t\t\n13\n:\n38\n\t\n?\n\t\t\t\t\n00\n:\n00\n:\n00\n\t\n/\nbin\n/\nbash\n0\n\t\nR\n\t\nroot\n\t\t\t\t\t\n9\n\t\t\t\t\t\n1\n\t\t\t\t\n0\n\t\n-\n\t\t\n8606\n\t\n-\n\t\t\t\t\t\t\n13\n:\n38\n\t\n?\n\t\t\t\t\n00\n:\n00\n:\n00\n\t\nps\n\t\n-\nelf\nWindows\texample:PS\tC:\\>\tps\nHandles\t\tNPM(K)\t\t\t\tPM(K)\t\t\t\t\t\tWS(K)\t\t\t\t\tCPU(s)\t\t\t\t\tId\t\tSI\tProcessName\n-------\t\t------\t\t\t\t-----\t\t\t\t\t\t-----\t\t\t\t\t------\t\t\t\t\t--\t\t--\t-----------\n\t\t\t\t\t\t0\t\t\t\t\t\t\t5\t\t\t\t\t\t964\t\t\t\t\t\t\t1292\t\t\t\t\t\t\t0.00\t\t\t4716\t\t\t4\tCExecSvc\n\t\t\t\t\t\t0\t\t\t\t\t\t\t5\t\t\t\t\t\t592\t\t\t\t\t\t\t\t956\t\t\t\t\t\t\t0.00\t\t\t4524\t\t\t4\tcsrss\n\t\t\t\t\t\t0\t\t\t\t\t\t\t0\t\t\t\t\t\t\t\t0\t\t\t\t\t\t\t\t\t\t4\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0\t\t\t0\tIdle\n\t\t\t\t\t\t0\t\t\t\t\t\t18\t\t\t\t\t3984\t\t\t\t\t\t\t8624\t\t\t\t\t\t\t0.13\t\t\t\t700\t\t\t4\tlsass\n\t\t\t\t\t\t0\t\t\t\t\t\t52\t\t\t\t26624\t\t\t\t\t\t19400\t\t\t\t\t\t\t1.64\t\t\t2100\t\t\t4\tpowershell\n\t\t\t\t\t\t0\t\t\t\t\t\t38\t\t\t\t28324\t\t\t\t\t\t49616\t\t\t\t\t\t\t1.69\t\t\t4464\t\t\t4\tpowershell\n\t\t\t\t\t\t0\t\t\t\t\t\t\t8\t\t\t\t\t1488\t\t\t\t\t\t\t3032\t\t\t\t\t\t\t0.06\t\t\t2488\t\t\t4\tservices\n\t\t\t\t\t\t0\t\t\t\t\t\t\t2\t\t\t\t\t\t288\t\t\t\t\t\t\t\t504\t\t\t\t\t\t\t0.00\t\t\t4508\t\t\t0\tsmss\n\t\t\t\t\t\t0\t\t\t\t\t\t\t8\t\t\t\t\t1600\t\t\t\t\t\t\t3004\t\t\t\t\t\t\t0.03\t\t\t\t908\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t12\t\t\t\t\t1492\t\t\t\t\t\t\t3504\t\t\t\t\t\t\t0.06\t\t\t4572\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t15\t\t\t\t20284\t\t\t\t\t\t23428\t\t\t\t\t\t\t5.64\t\t\t4628\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t15\t\t\t\t\t3704\t\t\t\t\t\t\t7536\t\t\t\t\t\t\t0.09\t\t\t4688\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t28\t\t\t\t\t5708\t\t\t\t\t\t\t6588\t\t\t\t\t\t\t0.45\t\t\t4712\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t10\t\t\t\t\t2028\t\t\t\t\t\t\t4736\t\t\t\t\t\t\t0.03\t\t\t4840\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t11\t\t\t\t\t5364\t\t\t\t\t\t\t4824\t\t\t\t\t\t\t0.08\t\t\t4928\t\t\t4\tsvchost\n\t\t\t\t\t\t0\t\t\t\t\t\t\t0\t\t\t\t\t\t128\t\t\t\t\t\t\t\t136\t\t\t\t\t\t37.02\t\t\t\t\t\t4\t\t\t0\tSystem\n\t\t\t\t\t\t0\t\t\t\t\t\t\t7\t\t\t\t\t\t920\t\t\t\t\t\t\t1832\t\t\t\t\t\t\t0.02\t\t\t3752\t\t\t4\twininit\n\t\t\t\t\t\t0\t\t\t\t\t\t\t8\t\t\t\t\t5472\t\t\t\t\t\t11124\t\t\t\t\t\t\t0.77\t\t\t5568\t\t\t4\tWmiPrvSE\nInside\tthe\tLinux\tcontainer\tthere\tare\tonly\ttwo\tprocesses\trunning:\nPID\t1.\t\nThis\tis\tthe\t\n/bin/bash\n\tprocess\tthat\twe\ttold\tthe\tcontainer\tto\trun\twith\nthe\t\ndocker\tcontainer\trun\n\tcommand.\nPID\t9.\t\nThis\tis\tthe\t\nps\t-elf\n\tcommand/process\tthat\twe\tran\tto\tlist\tthe\trunning\nprocesses.\nThe\tpresence\tof\tthe\t\nps\t-elf\n\tprocess\tin\tthe\tLinux\toutput\tabove\tcould\tbe\ta\tbit\nmisleading\tas\tit\tis\ta\tshort-lived\tprocess\tthat\tdies\tas\tsoon\tas\tthe\t\nps\n\tcommand\nexits.\tThis\tmeans\tthat\tthe\tonly\tlong-running\tprocess\tinside\tof\tthe\tcontainer\tis\tthe\n/bin/bash\n\tprocess.\nThe\tWindows\tcontainer\thas\ta\tlot\tmore\tinternal\tprocesses\trunning.\tThis\tis\tan\nartefact\tof\tthe\tway\tthe\tWindows\tOperating\tSystem\tworks.\tAlthough\tthe\nWindows\tcontainer\thas\ta\tlot\tmore\tprocesses\tthan\tthe\tLinux\tcontainer,\tit\tis\tstill\ta\nlot\tless\tthan\ta\tregular\tWindows\tServer.\nPress\t\nCtrl-PQ\n\tto\texit\tthe\tcontainer\twithout\tterminating\tit.\tThis\twill\tland\tyou\nback\tin\tthe\tshell\tof\tyour\tDocker\thost.\tYou\tcan\tverify\tthis\tby\tlooking\tat\tyour\nshell\tprompt.\nNow\tthat\tyou\tare\tback\tat\tthe\tshell\tprompt\tof\tyour\tDocker\thost,\trun\tthe\t\nps\ncommand\tagain.\nLinux\texample:$\tps\t-elf\nF\tS\tUID\t\t\t\t\t\t\t\tPID\t\tPPID\t\t\t\tNI\tADDR\tSZ\tWCHAN\t\tTIME\tCMD\n4\n\tS\troot\t\t\t\t\t\t\t\t\t\n1\n\t\t\t\t\t\n0\n\t\t\t\t\t\n0\n\t-\t\t\n9407\n\t-\t\t\t\t\t\t\n00\n:00:03\t/sbin/init\n1\n\tS\troot\t\t\t\t\t\t\t\t\t\n2\n\t\t\t\t\t\n0\n\t\t\t\t\t\n0\n\t-\t\t\t\t\t\n0\n\t-\t\t\t\t\t\t\n00\n:00:00\t\n[\nkthreadd\n]\n1\n\tS\troot\t\t\t\t\t\t\t\t\t\n3\n\t\t\t\t\t\n2\n\t\t\t\t\t\n0\n\t-\t\t\t\t\t\n0\n\t-\t\t\t\t\t\t\n00\n:00:00\t\n[\nksoftirqd/0\n]\n1\n\tS\troot\t\t\t\t\t\t\t\t\t\n5\n\t\t\t\t\t\n2\n\t\t\t-20\t-\t\t\t\t\t\n0\n\t-\t\t\t\t\t\t\n00\n:00:00\t\n[\nkworker/0:0H\n]\n1\n\tS\troot\t\t\t\t\t\t\t\t\t\n7\n\t\t\t\t\t\n2\n\t\t\t\t\t\n0\n\t-\t\t\t\t\t\n0\n\t-\t\t\t\t\t\t\n00\n:00:00\t\n[\nrcu_sched\n]\n<Snip>\n0\n\tR\tubuntu\t\t\t\n22783\n\t\n22475\n\t\t\t\t\t\n0\n\t-\t\t\n9021\n\t-\t\t\t\t\t\t\n00\n:00:00\tps\t-elf\nWindows\texample:\n>\tps\nHandles\t\tNPM(K)\t\t\t\tPM(K)\t\t\t\t\t\tWS(K)\t\t\t\t\tCPU(s)\t\t\t\t\tId\t\tSI\tProcessName\n-------\t\t------\t\t\t\t-----\t\t\t\t\t\t-----\t\t\t\t\t------\t\t\t\t\t--\t\t--\t-----------\n\t\t\t\t220\t\t\t\t\t\t11\t\t\t\t\t7396\t\t\t\t\t\t\t7872\t\t\t\t\t\t\t0.33\t\t\t1732\t\t\t0\tamazon-ssm-agen\n\t\t\t\t\t84\t\t\t\t\t\t\t5\t\t\t\t\t\t908\t\t\t\t\t\t\t2096\t\t\t\t\t\t\t0.00\t\t\t2428\t\t\t3\tCExecSvc\n\t\t\t\t\t87\t\t\t\t\t\t\t5\t\t\t\t\t\t936\t\t\t\t\t\t\t1336\t\t\t\t\t\t\t0.00\t\t\t4716\t\t\t4\tCExecSvc\n\t\t\t\t203\t\t\t\t\t\t13\t\t\t\t\t3600\t\t\t\t\t\t13132\t\t\t\t\t\t\t2.53\t\t\t3192\t\t\t2\tconhost\n\t\t\t\t210\t\t\t\t\t\t13\t\t\t\t\t3768\t\t\t\t\t\t22948\t\t\t\t\t\t\t0.08\t\t\t5260\t\t\t2\tconhost\n\t\t\t\t257\t\t\t\t\t\t11\t\t\t\t\t1808\t\t\t\t\t\t\t\t992\t\t\t\t\t\t\t0.64\t\t\t\t524\t\t\t0\tcsrss\n\t\t\t\t116\t\t\t\t\t\t\t8\t\t\t\t\t1348\t\t\t\t\t\t\t\t580\t\t\t\t\t\t\t0.08\t\t\t\t592\t\t\t1\tcsrss\n\t\t\t\t\t85\t\t\t\t\t\t\t5\t\t\t\t\t\t532\t\t\t\t\t\t\t1136\t\t\t\t\t\t\t0.23\t\t\t2440\t\t\t3\tcsrss\n\t\t\t\t242\t\t\t\t\t\t11\t\t\t\t\t1848\t\t\t\t\t\t\t\t952\t\t\t\t\t\t\t0.42\t\t\t2708\t\t\t2\tcsrss\n\t\t\t\t\t95\t\t\t\t\t\t\t5\t\t\t\t\t\t592\t\t\t\t\t\t\t\t980\t\t\t\t\t\t\t0.00\t\t\t4524\t\t\t4\tcsrss\n\t\t\t\t137\t\t\t\t\t\t\t9\t\t\t\t\t7784\t\t\t\t\t\t\t6776\t\t\t\t\t\t\t0.05\t\t\t5080\t\t\t2\tdocker\n\t\t\t\t401\t\t\t\t\t\t17\t\t\t\t22744\t\t\t\t\t\t14016\t\t\t\t\t\t28.59\t\t\t1748\t\t\t0\tdockerd\n\t\t\t\t307\t\t\t\t\t\t18\t\t\t\t13344\t\t\t\t\t\t\t1628\t\t\t\t\t\t\t0.17\t\t\t\t936\t\t\t1\tdwm\n\t\t\t\t<SNIP>\n\t\t\t1888\t\t\t\t\t\t\t0\t\t\t\t\t\t128\t\t\t\t\t\t\t\t136\t\t\t\t\t\t37.17\t\t\t\t\t\t4\t\t\t0\tSystem\n\t\t\t\t272\t\t\t\t\t\t15\t\t\t\t\t3372\t\t\t\t\t\t\t2452\t\t\t\t\t\t\t0.23\t\t\t3340\t\t\t2\tTabTip\n\t\t\t\t\t72\t\t\t\t\t\t\t7\t\t\t\t\t1184\t\t\t\t\t\t\t\t\t\t8\t\t\t\t\t\t\t0.00\t\t\t3400\t\t\t2\tTabTip32\n\t\t\t\t244\t\t\t\t\t\t16\t\t\t\t\t2676\t\t\t\t\t\t\t3148\t\t\t\t\t\t\t0.06\t\t\t1880\t\t\t2\ttaskhostw\n\t\t\t\t142\t\t\t\t\t\t\t7\t\t\t\t\t6172\t\t\t\t\t\t\t6680\t\t\t\t\t\t\t0.78\t\t\t4952\t\t\t3\tWmiPrvSE\n\t\t\t\t148\t\t\t\t\t\t\t8\t\t\t\t\t5620\t\t\t\t\t\t11028\t\t\t\t\t\t\t0.77\t\t\t5568\t\t\t4\tWmiPrvSE\nNotice\thow\tmany\tmore\tprocesses\tare\trunning\ton\tyour\tDocker\thost\tcompared\tto\nthe\tcontainers\twe\tran.\nIn\ta\tprevious\tstep\tyou\tpressed\t\nCtrl-PQ\n\tto\texit\tfrom\tthe\tcontainer.\tDoing\tthis\nfrom\tinside\tof\ta\tcontainer\twill\texit\tyou\tfrom\tthe\tcontainer\twithout\tkilling\tit.\tYou\ncan\tsee\tall\trunning\tcontainers\ton\tyour\tsystem\tusing\tthe\t\ndocker\tcontainer\tls\ncommand.\n$\tdocker\tcontainer\tls\nCONTAINER\tID\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\t\t\t\tCREATED\t\tSTATUS\t\t\t\tNAMES\ne2b69eeb55cb\t\t\tubuntu:latest\t\t\n\"/bin/bash\"\n\t\t\t\n7\n\tmins\t\t\tUp\t\n7\n\tmin\t\tvigilant_borg\nThe\toutput\tabove\tshows\ta\tsingle\trunning\tcontainer.\tThis\tis\tthe\tcontainer\tthat\tyou\ncreated\tearlier.\tThe\tpresence\tof\tyour\tcontainer\tin\tthis\toutput\tproves\tthat\tit’s\tstill\nrunning.\tYou\tcan\talso\tsee\tthat\tit\twas\tcreated\t7\tminutes\tago\tand\thas\tbeen\trunning\nfor\t7\tminutes.Attaching\tto\trunning\tcontainers\nYou\tcan\tattach\tyour\tshell\tto\trunning\tcontainers\twith\tthe\t\ndocker\tcontainer\nexec\n\tcommand.\tAs\tthe\tcontainer\tfrom\tthe\tprevious\tsteps\tis\tstill\trunning,\tlet’s\nconnect\tback\tto\tit.\nLinux\texample:\nThis\texample\treferences\ta\tcontainer\tcalled\t“vigilant_borg”.\tThe\tname\tof\tyour\ncontainer\twill\tbe\tdifferent,\tso\tremember\tto\tsubstitute\t“vigilant_borg”\twith\tthe\nname\tor\tID\tof\tthe\tcontainer\trunning\ton\tyour\tDocker\thost.\n$\tdocker\tcontainer\t\nexec\n\t-it\tvigilant_borg\tbash\nroot@e2b69eeb55cb:/#\nWindows\texample:\nThis\texample\treferences\ta\tcontainer\tcalled\t“pensive_hamilton”.\tThe\tname\tof\nyour\tcontainer\twill\tbe\tdifferent,\tso\tremember\tto\tsubstitute\t“pensive_hamilton”\nwith\tthe\tname\tor\tID\tof\tthe\tcontainer\trunning\ton\tyour\tDocker\thost.\n>\tdocker\tcontainer\texec\t-it\tpensive_hamilton\tPowerShell.exe\nWindows\tPowerShell\nCopyright\t(C)\t2016\tMicrosoft\tCorporation.\tAll\trights\treserved.\nPS\tC:\\>\nNotice\tthat\tyour\tshell\tprompt\thas\tchanged\tagain.\tYou\tare\tback\tinside\tthe\ncontainer.\nThe\tformat\tof\tthe\t\ndocker\tcontainer\texec\n\tcommand\tis:\t\ndocker\tcontainer\nexec\t-options\t<container-name\tor\tcontainer-id>\t<command>\n.\tIn\tour\nexample\twe\tused\tthe\t\n-it\n\toptions\tto\tattach\tour\tshell\tto\tthe\tcontainer’s\tshell.\tWe\nreferenced\tthe\tcontainer\tby\tname\tand\ttold\tit\tto\trun\tthe\tbash\tshell\t(PowerShell\tin\nthe\tWindows\texample).\t\nWe\tcould\teasily\thave\treferenced\tthe\tcontainer\tby\tits\tID.\nExit\tthe\tcontainer\tagain\tby\tpressing\t\nCtrl-PQ\n.\nYour\tshell\tprompt\tshould\tbe\tback\tto\tyour\tDocker\thost.\nRun\tthe\t\ndocker\tcontainer\tls\n\tcommand\tagain\tto\tverify\tthat\tyour\tcontainer\tis\nstill\trunning.\n$\tdocker\tcontainer\tlsCONTAINER\tID\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\t\t\t\tCREATED\t\tSTATUS\t\t\t\tNAMES\ne2b69eeb55cb\t\t\tubuntu:latest\t\t\n\"/bin/bash\"\n\t\t\t\n9\n\tmins\t\t\tUp\t\n9\n\tmin\t\tvigilant_borg\nStop\tthe\tcontainer\tand\tkill\tit\tusing\tthe\t\ndocker\tcontainer\tstop\n\tand\t\ndocker\ncontainer\trm\n\tcommands.\tRemember\tto\tsubstitute\tthe\tnames/IDs\tof\tyour\town\ncontainers.\n$\tdocker\tcontainer\tstop\tvigilant_borg\nvigilant_borg\n$\n$\tdocker\tcontainer\trm\tvigilant_borg\nvigilant_borg\nVerify\tthat\tthe\tcontainer\twas\tsuccessfully\tdeleted\tby\trunning\tanother\t\ndocker\ncontainer\tls\n\tcommand.\n$\tdocker\tcontainer\tls\nCONTAINER\tID\t\t\t\tIMAGE\t\t\t\tCOMMAND\t\t\t\tCREATED\t\t\t\tSTATUS\t\t\t\tPORTS\t\t\t\tNAMESThe\tDev\tPerspective\nContainers\tare\tall\tabout\tthe\tapps!\nIn\tthis\tsection\twe’ll\tclone\tan\tapp\tfrom\ta\tGit\trepo,\tinspect\tits\tDockerfile,\ncontainerize\tit,\tand\trun\tit\tas\ta\tcontainer.\nThe\tLinux\tapp\tcan\tbe\tlocated\tfrom:\thttps://github.com/nigelpoulton/psweb.git\nThe\tWindows\tapp\tcan\tbe\tlocated\tfrom:\thttps://github.com/nigelpoulton/dotnet-\ndocker-samples.git\nThe\trest\tof\tthis\tsection\twill\twalk\tyou\tthrough\tthe\tLinux\texample.\tHowever,\tboth\nexamples\tare\tcontainerizing\tsimple\tweb\tapps\tso\tthe\tprocess\tis\tthe\tsame.\tWhere\nthere\tare\tdifferences\tin\tthe\tWindows\texample\twe\twill\thighlight\tthem\tto\thelp\tyou\nfollow\talong.\nRun\tall\tof\tthe\tfollowing\tcommands\tfrom\ta\tterminal\ton\tyour\tDocker\thost.\nClone\tthe\trepo\tlocally.\tThis\twill\tpull\tthe\tapplication\tcode\tto\tyour\tlocal\tDocker\nhost\tready\tfor\tyou\tto\tcontainerize\tit.\nBe\tsure\tto\tsubstitute\tthe\trepo\tbelow\twith\tthe\tWindows\trepo\tif\tyou\tare\tfollowing\nalong\twith\tthe\tWindows\texample.\n$\tgit\tclone\thttps://github.com/nigelpoulton/psweb.git\nCloning\tinto\t\n'psweb'\n...\nremote:\tCounting\tobjects:\t\n15\n,\t\ndone\n.\nremote:\tCompressing\tobjects:\t\n100\n%\t\n(\n11\n/11\n)\n,\t\ndone\n.\nremote:\tTotal\t\n15\n\t\n(\ndelta\t\n2\n)\n,\treused\t\n15\n\t\n(\ndelta\t\n2\n)\n,\tpack-reused\t\n0\nUnpacking\tobjects:\t\n100\n%\t\n(\n15\n/15\n)\n,\t\ndone\n.\nChecking\tconnectivity...\t\ndone\n.\nChange\tdirectory\tinto\tthe\tcloned\trepo’s\tdirectory\tand\tlist\tthe\tcontents\tof\tthe\ndirectory.\n$\t\ncd\n\tpsweb\n$\tls\t-l\ntotal\t\n28\n-rw-rw-r--\t\n1\n\tubuntu\tubuntu\t\t\n341\n\tSep\t\n29\n\t\n12\n:15\tapp.js\n-rw-rw-r--\t\n1\n\tubuntu\tubuntu\t\t\n216\n\tSep\t\n29\n\t\n12\n:15\tcircle.yml\n-rw-rw-r--\t\n1\n\tubuntu\tubuntu\t\t\n338\n\tSep\t\n29\n\t\n12\n:15\tDockerfile\n-rw-rw-r--\t\n1\n\tubuntu\tubuntu\t\t\n421\n\tSep\t\n29\n\t\n12\n:15\tpackage.json\n-rw-rw-r--\t\n1\n\tubuntu\tubuntu\t\t\n370\n\tSep\t\n29\n\t\n12\n:15\tREADME.md\ndrwxrwxr-x\t\n2\n\tubuntu\tubuntu\t\n4096\n\tSep\t\n29\n\t\n12\n:15\t\ntest\ndrwxrwxr-x\t\n2\n\tubuntu\tubuntu\t\n4096\n\tSep\t\n29\n\t\n12\n:15\tviewsFor\tthe\tWindows\texample\tyou\tshould\t\ncd\n\tinto\tthe\t\ndotnet-docker-\nsamples\\aspnetapp\n\tdirectory.\nThe\tLinux\texample\tis\ta\tsimple\tnodejs\tweb\tapp.\tThe\tWindows\texample\tis\ta\nsimple\tASP.NET\tCore\tweb\tapp.\nBoth\tGit\trepos\tcontain\ta\tfile\tcalled\t\nDockerfile\n.\tA\tDockerfile\tis\ta\tplain-text\ndocument\tdescribing\thow\tto\tbuild\ta\tDocker\timage.\nList\tthe\tcontents\tof\tthe\tDockerfile.\n$\tcat\tDockerfile\nFROM\talpine\nLABEL\t\nmaintainer\n=\n\"nigelpoulton@hotmail.com\"\nRUN\tapk\tadd\t--update\tnodejs\tnodejs-npm\nCOPY\t.\t/src\nWORKDIR\t/src\nRUN\t\tnpm\tinstall\nEXPOSE\t\n8080\nENTRYPOINT\t\n[\n\"node\"\n,\t\n\"./app.js\"\n]\nThe\tcontents\tof\tthe\tDockerfile\tin\tthe\tWindows\texample\tare\tdifferent.\tHowever,\nthis\tis\tnot\timportant\tat\tthis\tstage.\tWe’ll\tcover\tDockerfiles\tin\tmore\tdetail\tlater\tin\nthe\tbook.\tFor\tnow,\tit’s\tenough\tto\tunderstand\tthat\teach\tline\trepresents\tan\ninstruction\tthat\tis\tused\tto\tbuild\tan\timage.\nAt\tthis\tpoint\twe\thave\tpulled\tsome\tapplication\tcode\tfrom\ta\tremote\tGit\trepo.\tWe\nalso\thave\ta\tDockerfile\tcontaining\tinstructions\tthat\tdescribe\thow\tto\tcreate\ta\tnew\nDocker\timage\twith\tthe\tapplication\tinside.\nUse\tthe\t\ndocker\timage\tbuild\n\tcommand\tto\tcreate\ta\tnew\timage\tusing\tthe\ninstructions\tcontained\tin\tthe\tDockerfile.\tThis\texample\tcreates\ta\tnew\tDocker\nimage\tcalled\t\ntest:latest\n.\nBe\tsure\tto\tperform\tthis\tcommand\tfrom\twithin\tthe\tdirectory\tcontaining\tthe\tapp\ncode\tand\tDockerfile.\n$\tdocker\timage\tbuild\t-t\ttest:latest\t.\nSending\tbuild\tcontext\tto\tDocker\tdaemon\t\t\n74\n.75kB\nStep\t\n1\n/8\t:\tFROM\talpine\nlatest:\tPulling\tfrom\tlibrary/alpine\n88286f41530e:\tPull\t\ncomplete\nDigest:\tsha256:f006ecbb824...0c103f4820a417d\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine:latest\n\t--->\t76da55c8019d\n<Snip>Successfully\tbuilt\tf154cb3ddbd4\nSuccessfully\ttagged\ttest:latest\nNote:\n\tIt\tmay\ttake\ta\tlong\ttime\tfor\tthe\tbuild\tto\tfinish\tin\tthe\tWindows\nexample.\tThis\tis\tbecause\tof\tthe\tsize\tand\tcomplexity\tof\tthe\tlayers\tbeing\npulled.\nCheck\tto\tmake\tsure\tthat\tthe\tnew\t\ntest:latest\n\timage\texists\ton\tyour\thost.\n$\tdocker\timage\tls\nREPO\t\t\t\t\tTAG\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\t\tSIZE\ntest\n\t\t\t\t\tlatest\t\t\tf154cb3ddbd4\t\t\t\t\n1\n\tminute\tago\t\t\t\t\n55\n.6MB\n...\nYou\tnow\thave\ta\tnewly\tbuilt\timage\twith\tthe\tapp\tinside.\nRun\ta\tcontainer\tfrom\tthe\timage\tand\ttest\tthe\tapp.\nLinux\texample:\n$\tdocker\tcontainer\trun\t-d\t\n\\\n\t\t--name\tweb1\t\n\\\n\t\t-p\t\n8080\n:8080\t\n\\\n\t\ttest:latest\nOpen\ta\tweb\tbrowser\tand\tnavigate\tto\tthe\tDNS\tname\tor\tIP\taddress\tof\tthe\thost\tthat\nyou\tare\trunning\tthe\tcontainer\tfrom\tand\tpoint\tit\tto\tport\t8080.\tYou\twill\tsee\tthe\nfollowing\tweb\tpage.\nFigure\t4.1\nWindows\texample:>\tdocker\tcontainer\trun\t-d\t\\\n\t\t--name\tweb1\t\\\n\t\t-p\t8000:80\t\\\n\t\ttest:latest\nOpen\ta\tweb\tbrowser\tand\tnavigate\tto\tthe\tDNS\tname\tor\tIP\taddress\tof\tthe\thost\tthat\nyou\tare\trunning\tthe\tcontainer\tfrom\tand\tpoint\tit\tto\tport\t8080.\tYou\twill\tsee\tthe\nfollowing\tweb\tpage.\nFigure\t4.2\nWell\tdone.\tYou’ve\ttaken\tan\tapplication\tand\tcontainerized\tit\t(built\ta\tDocker\nimage\tfrom\tit).Chapter\tSummary\nIn\tthis\tchapter\tyou\tperformed\tthe\tfollowing\toperations-related\ttasks;\ndownloaded\ta\tDocker\timage,\tlaunched\ta\tcontainer\tfrom\tthe\timage,\texecuted\ta\ncommand\tinside\tof\tthe\tcontainer\t(\nps\n),\tand\tthen\tstopped\tand\tdeleted\tthe\ncontainer.\tYou\talso\tcontainerized\ta\tsimple\tapplication\tby\tpulling\tsome\tsource\ncode\tfrom\tGitHub\tand\tbuilding\tit\tinto\tan\timage\tusing\tinstructions\tin\ta\nDockerfile.\nThis\t\nbig\tpicture\n\tview\tshould\thelp\tyou\twith\tthe\tup-coming\tchapters\twhere\twe\nwill\tdig\tdeeper\tinto\timages\tand\tcontainers.P\nART\n\t2:\tT\nHE\n\t\nTECHNICAL\n\t\nSTUFF5:\tThe\tDocker\tEngine\nIn\tthis\tchapter,\twe’ll\ttake\ta\tquick\tlook\tunder\tthe\thood\tof\tthe\tDocker\tEngine.\nYou\tcan\tuse\tDocker\twithout\tunderstanding\tany\tof\tthe\tthings\twe’ll\tcover\tin\tthis\nchapter.\tSo,\tfeel\tfree\tto\tskip\tit.\tHowever,\tto\tbe\ta\treal\tmaster\tof\tanything,\tyou\nneed\tto\tunderstand\twhat’s\tgoing\ton\tunder\tthe\thood.\nThis\twill\tbe\ta\ttheory-based\tchapter\twith\tno\thands-on\texercises.\nAs\tthis\tchapter\tis\tpart\tof\tthe\t\nTechnical\tsection\n\tof\tthe\tbook,\twe’re\tgoing\tto\nemploy\tthe\tthree-tiered\tapproach\twhere\twe\tsplit\tthe\tchapter\tinto\tthree\tsections:\nThe\tTLDR:\tTwo\tor\tthree\tquick\tparagraphs\tthat\tyou\tcan\tread\twhile\tstanding\nin\tline\tfor\ta\tcoffee\nThe\tdeep\tdive:\tThe\treally\tlong\tbit\twhere\twe\tget\tinto\tthe\tdetail\nThe\tcommands:\tA\tquick\trecap\tof\tthe\tcommands\twe\tlearned\nLet’s\tgo\tlearn\tabout\tthe\tDocker\tEngine!Docker\tEngine\t-\tThe\tTLDR\nThe\t\nDocker\tengine\n\tis\tthe\tcore\tsoftware\tthat\truns\tand\tmanages\tcontainers.\tWe\noften\trefer\tto\tit\tsimply\tas\t\nDocker\n,\tor\t\nthe\tDocker\tplatform\n.\tIf\tyou\tknow\ta\tthing\tor\ntwo\tabout\tVMware,\tit\tmight\tbe\tuseful\tto\tthink\tof\tit\tas\tbeing\tlike\tESXi\tin\tthe\nVMware\tworld.\nThe\tDocker\tengine\tis\tmodular\tin\tdesign\twith\tmany\tswappable\tcomponents.\nWhere\tpossible,\tthese\tare\tbased\ton\topen-standards\toutlined\tby\tthe\tOpen\nContainer\tInitiative\t(OCI).\nIn\tmany\tways,\tthe\tDocker\tEngine\tis\tlike\ta\tcar\tengine\t-\tboth\tare\tmodular\tand\ncreated\tby\tconnecting\tmany\tsmall\tspecialized\tparts:\t-\tA\tcar\tengine\tis\tmade\tfrom\nmany\tspecialized\tparts\tthat\twork\ttogether\tto\tmake\ta\tcar\tdrive\t-\tintake\tmanifolds,\nthrottle\tbody,\tcylinders,\tspark\tplugs,\texhaust\tmanifolds\tetc.\t-\tThe\tDocker\tEngine\nis\tmade\tfrom\tmany\tspecialized\ttools\tthat\twork\ttogether\tto\tcreate\tand\trun\ncontainers\t-\timages,\tAPIs,\texecution\tdriver,\truntime,\tshims\tetc.\nAt\tthe\ttime\tof\twriting,\tthe\tmajor\tcomponents\tthat\tmake\tup\tthe\tDocker\tengine\nare:\tthe\t\nDocker\tclient\n,\tthe\t\nDocker\tdaemon\n,\t\ncontainerd\n,\tand\t\nrunc\n.\tTogether,\tthese\ncreate\tand\trun\tcontainers.\nFigure\t5.1\tshows\ta\thigh-level\tview.\nFigure\t5.1Docker\tEngine\t-\tThe\tDeep\tDive\nWhen\tDocker\twas\tfirst\treleased,\tthe\tDocker\tengine\thad\ttwo\tmajor\tcomponents:\nThe\tDocker\tdaemon\t(hereafter\treferred\tto\tas\tjust\t“the\tdaemon”)\nLXC\nThe\tDocker\tdaemon\twas\ta\tmonolithic\tbinary.\tIt\tcontains\tall\tof\tthe\tcode\tfor\tthe\nDocker\tclient,\tthe\tDocker\tAPI,\tthe\tcontainer\truntime,\timage\tbuilds,\tand\tmuch\nmore.\nThe\tLXC\tcomponent\tprovided\tthe\tdaemon\twith\taccess\tto\tthe\tfundamental\nbuilding-blocks\tof\tcontainers\tsuch\tas\t\nkernel\tnamespaces\n\tand\t\ncontrol\tgroups\n(cgroups)\n.\nThe\tinteraction\tbetween\tthe\tdaemon,\tLXC\tand\tthe\tOS\tis\tshown\tin\tFigure\t5.2.\nFigure\t5.2\nGetting\trid\tof\tLXC\nThe\treliance\ton\tLXC\twas\tan\tissue\tfrom\tthe\tstart.\nFirst\tup,\tLXC\tis\tLinux-specific.\tThis\twas\ta\tproblem\tfor\ta\tproject\tthat\thad\naspirations\tof\tbeing\tmulti-platform.\nSecond\tup,\tbeing\treliant\ton\tan\texternal\ttool\tfor\tsomething\tso\tcore\tto\tthe\tproject\nwas\ta\thuge\trisk\tthat\tcould\thinder\tdevelopment.As\ta\tresult,\tDocker.\tInc.\tdeveloped\ttheir\town\ttool\tcalled\t\nlibcontainer\n\tas\ta\nreplacement\tfor\tLXC.\tThe\tgoal\tof\t\nlibcontainer\n\twas\tto\tbe\ta\tplatform-agnostic\ntool\tthat\tprovided\tDocker\twith\taccess\tto\tthe\tfundamental\tcontainer\tbuilding-\nblocks\tthat\texist\tinside\tthe\tOS.\nLibcontainer\treplaced\tLXC\tas\tthe\tdefault\t\nexecution\tdriver\n\tin\tDocker\t0.9.\nGetting\trid\tof\tthe\tmonolithic\tDocker\tdaemon\nOver\ttime,\tthe\tmonolithic\tnature\tof\tthe\tDocker\tdaemon\tbecame\tmore\tand\tmore\nproblematic:\n1\n.\t\nIt’s\thard\tto\tinnovate\ton.\n2\n.\t\nIt\tgot\tslower.\n3\n.\t\nIt\twasn’t\twhat\tthe\tecosystem\t(or\tDocker,\tInc.)\twanted.\nDocker,\tInc.\twas\taware\tof\tthese\tchallenges,\tand\tbegan\ta\thuge\teffort\tto\tbreak\napart\tthe\tmonolithic\tdaemon\tand\tmodularize\tit.\tThe\taim\tof\tthis\twork\tis\tto\tbreak\nout\tas\tmuch\tof\tthe\tfunctionality\tas\tpossible\tfrom\tthe\tdaemon,\tand\tre-implement\nit\tin\tsmaller\tspecialized\ttools.\tThese\tspecialized\ttools\tcan\tbe\tswapped\tout,\tas\nwell\tas\teasily\tused\tby\tthird\tparties\tto\tbuild\tother\ttools.\tThis\tplan\tfollows\tthe\ntried-and-tested\tUnix\tphilosophy\tof\tbuilding\tsmall\tspecialized\ttools\tthat\tcan\tbe\npieced\ttogether\tinto\tlarger\ttools.\nThis\twork\tof\tbreaking\tapart\tand\tre-factoring\tthe\tDocker\tengine\tis\tan\tongoing\nprocess.\tHowever,\tit\thas\talready\tseen\t\nall\tof\tthe\t\ncontainer\texecution\n\tand\ncontainer\t\nruntime\n\tcode\tentirely\tremoved\tfrom\tthe\tdaemon\tand\trefactored\ninto\tsmall,\tspecialized\ttools\n.\nFigure\t5.3\tshows\ta\thigh-level\tview\tof\tthe\tDocker\tengine\tarchitecture\twith\tbrief\ndescriptions.Figure\t5.3\nThe\tinfluence\tof\tthe\tOpen\tContainer\tInitiative\t(OCI)\nWhile\tDocker,\tInc.\twas\tbreaking\tthe\tdaemon\tapart\tand\trefactoring\tcode,\tthe\t\nOCI\nwas\tin\tthe\tprocess\tof\tdefining\ttwo\tcontainer-related\tstandards:\n1\n.\t\nImage\tspec\n2\n.\t\nContainer\truntime\tspec\nBoth\tspecifications\twere\treleased\tas\tversion\t1.0\tin\tJuly\t2017.\nDocker,\tInc.\twas\theavily\tinvolved\tin\tcreating\tthese\tspecifications\tand\ncontributed\ta\tlot\tof\tcode\tto\tthem.\nAs\tof\tDocker\t1.11\t(early\t2016),\tthe\tDocker\tengine\timplements\tthe\tOCI\nspecifications\tas\tclosely\tas\tpossible.\tFor\texample,\tthe\tDocker\tdaemon\tno\tlonger\ncontains\tany\tcontainer\truntime\tcode\t-\tall\tcontainer\truntime\tcode\tis\timplemented\nin\ta\tseparate\tOCI-compliant\tlayer.\tBy\tdefault,\tDocker\tuses\ta\ttool\tcalled\t\nrunc\n\tfor\nthis.\trunc\tis\tthe\t\nreference\timplementation\n\tof\tthe\tOCI\tcontainer-runtime-spec,\tand\na\tgoal\tof\tthe\trunc\tproject\tkeep\trunc\tin\tlockstep\twith\tthe\tOCI\tspec.\nAs\twell\tas\tthis,\tthe\t\ncontainerd\n\tcomponent\tof\tthe\tDocker\tEngine\tmakes\tsure\nDocker\timages\tare\tpresented\tto\t\nrunc\n\tas\tvalid\tOCI\tbundles.\nNote:\n\tThe\tDocker\tengine\timplemented\tportions\tof\tthe\tOCI\tspecs\tbefore\tthe\nspecs\twere\tofficially\treleased\tas\tversion\t1.0.runc\nAs\tpreviously\tmentioned,\t\nrunc\n\tis\tthe\treference\timplementation\tof\tthe\tOCI\ncontainer-runtime-spec.\tDocker,\tInc.\twas\theavily\tinvolved\tin\tdefining\tthe\tspec\nand\tdeveloping\trunc.\nrunc\tis\tsmall.\tIt’s\teffectively\ta\tlightweight\tCLI\tthat\twraps\taround\tlibcontainer.\tIt\nhas\ta\tsingle\tpurpose\tin\tlife\t-\tto\tcreate\tcontainers.\tAnd\tit’s\tdamn\tgood\tat\tit.\tAnd\nfast!\nWe\toften\trefer\tto\trunc\tas\ta\tcontainer\t\nruntime\n.\nYou\tcan\tsee\trunc\trelease\tinformation\tat:\nhttps://github.com/opencontainers/runc/releases\ncontainerd\nIn\torder\tto\tuse\trunc,\tthe\tDocker\tengine\tneeded\tsomething\tto\tact\tas\ta\tbridge\nbetween\tthe\tdaemon\tand\trunc.\tThis\tis\twhere\tcontainerd\tcomes\tinto\tthe\tpicture.\ncontainerd\timplements\tthe\texecution\tlogic\tthat\twas\tpulled\tout\tof\tthe\tDocker\ndaemon.\tThis\tlogic\twas\tobviously\trefactored\tand\ttuned\twhen\tit\twas\tre-written\tas\ncontainerd.\nIt’s\thelpful\tto\tthink\tof\tcontainerd\tas\ta\tcontainer\t\nsupervisor\n\t-\tthe\tcomponent\tthat\nis\tresponsible\tfor\tcontainer\tlifecycle\toperations\tsuch\tas;\tstarting\tand\tstopping\ncontainers,\tpausing\tand\tun-pausing\tthem,\tand\tdestroying\tthem.\nLike\trunc,\tcontainerd\tis\tsmall,\tlightweight,\tand\tdesigned\tfor\ta\tsingle\ttask\tin\tlife\n-\tcontainerd\tis\tonly\tinterested\tcontainer\tlifecycle\toperations.\ncontainerd\twas\tdeveloped\tby\tDocker,\tInc.\tand\tdonated\tto\tthe\tCloud\tNative\nComputing\tFoundation\t(CNCF).\nYou\tcan\tsee\tcontainerd\trelease\tinformation\tat:\nhttps://github.com/containerd/containerd/releases\nStarting\ta\tnew\tcontainer\t(example)Now\tthat\twe\thave\ta\tview\tof\tthe\tbig\tpicture,\tand\tsome\tof\tthe\thistory,\tlet’s\twalk\nthrough\tthe\tprocess\tof\tcreating\ta\tnew\tcontainer.\nThe\tmost\tcommon\tway\tof\tstarting\tcontainers\tis\tusing\tthe\tDocker\tCLI.\tThe\nfollowing\t\ndocker\tcontainer\trun\n\tcommand\twill\tstart\ta\tsimple\tnew\tcontainer\nbased\ton\tthe\t\nalpine:latest\n\timage.\n$\tdocker\tcontainer\trun\t--name\tctr1\t-it\talpine:latest\tsh\nWhen\tyou\ttype\tcommands\tlike\tthis\tinto\tthe\tDocker\tCLI,\tthe\tDocker\tclient\nconverts\tthem\tinto\tthe\tappropriate\tAPI\tpayload\tand\tPOSTs\tthem\tto\tthe\tcorrect\nAPI\tendpoint.\nThe\tAPI\tis\timplemented\tin\tthe\tdaemon.\tIt\tis\tthe\tsame\trich,\tversioned,\tREST\tAPI\nthat\thas\tbecome\ta\thallmark\tof\tDocker\tand\tis\taccepted\tin\tthe\tindustry\tas\tthe\tde\nfacto\tcontainer\tAPI.\nOnce\tthe\tdaemon\treceives\tthe\tcommand\tto\tcreate\ta\tnew\tcontainer,\tit\tmakes\ta\ncall\tto\tcontainerd.\tRemember\tthat\tthe\tdaemon\tno-longer\tcontains\tany\tcode\tto\ncreate\tcontainers!\nThe\tdaemon\tcommunicates\twith\tcontainerd\tvia\ta\tCRUD-style\tAPI\tover\t\ngRPC\n.\nDespite\tits\tname,\t\ncontainerd\n\tcannot\tactually\tcreate\tcontainers.\tIt\tuses\t\nrunc\n\tto\tdo\nthat.\tIt\tconverts\tthe\trequired\tDocker\timage\tinto\tan\tOCI\tbundle\tand\ttells\trunc\tto\nuse\tthis\tto\tcreate\ta\tnew\tcontainer.\nrunc\tinterfaces\twith\tthe\tOS\tkernel\tto\tpull\ttogether\tall\tof\tthe\tconstructs\tnecessary\nto\tcreate\ta\tcontainer\t(in\tLinux\tthese\tinclude\tnamespaces\tand\tcgroups).\tThe\ncontainer\tprocess\tis\tstarted\tas\ta\tchild-process\tof\trunc,\tand\tas\tsoon\tas\tit\tis\tstarted\nrunc\twill\texit.\nVoila!\tThe\tcontainer\tis\tnow\tstarted.\nFigure\t5.4\tsummarises\tthe\tprocessFigure\t5.4\nOne\thuge\tbenefit\tof\tthis\tmodel\nHaving\tall\tof\tthe\tlogic\tand\tcode\tto\tstart\tand\tmanage\tcontainers\tremoved\tfrom\nthe\tdaemon\tmeans\tthat\tthe\tentire\tcontainer\truntime\tis\tdecoupled\tfrom\tthe\nDocker\tdaemon.\tWe\tsometimes\tcall\tthis\t“daemonless\tcontainers”,\tand\tit\tmakes\nit\tpossible\tto\tperform\tmaintenance\tand\tupgrades\ton\tthe\tDocker\tdaemon\twithout\nimpacting\trunning\tcontainers!\nIn\tthe\told\tmodel,\twhere\tall\tof\tcontainer\truntime\tlogic\twas\timplemented\tin\tthe\ndaemon,\tstarting\tand\tstopping\tthe\tdaemon\twould\tkill\tall\trunning\tcontainers\ton\nthe\thost.\tThis\twas\ta\thuge\tproblem\tin\tproduction\tenvironments\t-\tespecially\twhen\nyou\tconsider\thow\tfrequently\tnew\tversions\tof\tDocker\tare\treleased!\tEvery\ndaemon\tupgrade\twould\tkill\tall\tcontainers\ton\tthat\thost\t-\tnot\tgood!\nFortunately,\tthis\tis\tno\tlonger\ta\tproblem.\nWhat’s\tthis\tshim\tall\tabout?\nSome\tof\tthe\tdiagrams\tin\tthe\tchapter\thave\tshown\ta\tshim\tcomponent.\nThe\tshim\tis\tintegral\tto\tthe\timplementation\tof\tdaemonless\tcontainers\t(the\tthing\nwe\tjust\tmentioned\tabout\tdecoupling\trunning\tcontainers\tfrom\tthe\tdaemon\tfor\nthings\tlike\tupgrading\tthe\tdaemon\twithout\tkilling\tcontainers).We\tmentioned\tearlier\tthat\t\ncontainerd\n\tuses\trunc\tto\tcreate\tnew\tcontainers.\tIn\tfact,\nit\tforks\ta\tnew\tinstance\tof\trunc\tfor\tevery\tcontainer\tit\tcreates.\tHowever,\tonce\teach\ncontainer\tis\tcreated,\tits\tparent\trunc\tprocess\texits.\tThis\tmeans\twe\tcan\trun\nhundreds\tof\tcontainers\twithout\thaving\tto\trun\thundreds\tof\trunc\tinstances.\nOnce\ta\tcontainer’s\tparent\trunc\tprocess\texits,\tthe\tassociated\tcontainerd-shim\nprocess\tbecomes\tthe\tcontainer’s\tparent\tprocess.\tSome\tof\tthe\tresponsibilities\tthe\nshim\tperforms\tas\ta\tcontainer’s\tparent\tinclude:\nKeeping\tany\tSTDIN\tand\tSTDOUT\tstreams\topen\tso\tthat\twhen\tthe\tdaemon\nis\trestarted,\tthe\tcontainer\tdoesn’t\tterminate\tdue\tto\tpipes\tbeing\tclosed\tetc.\nReports\tthe\tcontainer’s\texit\tstatus\tback\tto\tthe\tdaemon.\nHow\tit’s\timplemented\ton\tLinux\nOn\ta\tLinux\tsystem,\tthe\tcomponents\twe’ve\tdiscussed\tare\timplemented\tas\nseparate\tbinaries\tas\tfollows:\t-\t\ndockerd\n\t(the\tDocker\tdaemon)\t-\t\ndocker-\ncontainerd\n\t(containerd)\t-\t\ndocker-containerd-shim\n\t(shim)\t-\t\ndocker-runc\n(runc)\nYou\tcan\tsee\tall\tof\tthese\ton\ta\tLinux\tsystem\tby\trunning\ta\t\nps\n\tcommand\ton\tthe\nDocker\thost.\tObviously,\tsome\tof\tthem\twill\tonly\tbe\tpresent\twhen\tthe\tsystem\thas\nrunning\tcontainers.\nSo\twhat’s\tthe\tpoint\tof\tthe\tdaemon\nWith\tall\tof\tthe\texecution\tand\truntime\tcode\tstripped\tout\tof\tthe\tdaemon\tyou\tmight\nbe\tasking\tthe\tquestion:\t“what\tis\tleft\tin\tthe\tdaemon?”.\nObviously,\tthe\tanswer\tto\tthis\tquestion\twill\tchange\tover\ttime\tas\tmore\tand\tmore\nfunctionality\tis\tstripped\tout\tand\tmodularized.\tHowever,\tat\tthe\ttime\tof\twriting,\nsome\tof\tthe\tmajor\tfunctionality\tthat\tstill\texists\tin\tthe\tdaemon\tincludes;\timage\nmanagement,\timage\tbuilds,\tthe\tREST\tAPI,\tauthentication,\tsecurity,\tcore\nnetworking,\tand\torchestration.Chapter\tsummary\nThe\tDocker\tengine\tis\tmodular\tin\tdesign\tand\tbased\theavily\ton\topen-standards\nfrom\tthe\tOCI.\nThe\t\nDocker\tdaemon\n\timplements\tthe\tDocker\tAPI\twhich\tis\tcurrently\ta\trich,\nversioned,\tHTTP\tAPI\tthat\thas\tdeveloped\talongside\tthe\trest\tof\tthe\tDocker\nproject.\tThis\tDocker\tAPI\tis\taccepted\tas\tthe\tindustry-standard\tcontainer\tAPI.\nContainer\texecution\tis\thandled\tby\t\ncontainerd\n.\tcontainerd\twas\twritten\tby\tDocker,\nInc.\tand\tcontributed\tto\tthe\tCNCF.\tYou\tcan\tthink\tof\tit\tas\ta\tcontainer\tsupervisor\nthat\thandles\tcontainer\tlifecycle\toperations.\tIt\tis\tsmall\tand\tlightweight\tand\tcan\tbe\nused\tby\tother\tprojects\tand\tthird-party\ttools.\ncontainerd\tneeds\tto\ttalk\tto\tan\tOCI-compliant\tcontainer\truntime\tto\tactually\tcreate\ncontainers.\tBy\tdefault,\tDocker\tuses\t\nrunc\n\tas\tits\tdefault\tcontainer\truntime.\trunc\tis\nthe\tde\tfacto\timplementation\tof\tthe\tOCI\tcontainer-runtime-spec\tand\texpects\tto\nstart\tcontainers\tfrom\tOCI-compliant\tbundles.\tcontainerd\ttalks\tto\trunc\tand\nensures\tDocker\timages\tare\tpresented\tto\trunc\tas\tOCI-compliant\tbundles.\nrunc\tcan\tbe\tused\tas\ta\tstandalone\ttool\tto\tcreate\tcontainers.\tIt\tcan\talso\tbe\tused\tby\nother\tprojects\tand\tthird-party\ttools.\nThere\tis\tstill\ta\tlot\tof\tfunctionality\timplemented\twithin\tthe\tDocker\tdaemon.\tMore\nof\tthis\tmay\tbe\tbroken\tout\tover\ttime.\tFunctionality\tcurrently\tstill\tinside\tof\tthe\nDocker\tdaemon\tinclude,\tbut\tis\tnot\tlimited\tto:\tthe\tAPI,\timage\tmanagement,\nauthentication,\tsecurity\tfeatures,\tcore\tnetworking.\nThe\twork\tof\tmodularizing\tthe\tDocker\tengine\tis\tongoing.6:\tImages\nIn\tthis\tchapter\twe’ll\tdive\tinto\tDocker\timages.\tThe\taim\tof\tthe\tgame\tis\tto\tgive\nyou\ta\t\nsolid\tunderstanding\n\tof\twhat\tDocker\timages\tare\tand\thow\tto\tperform\tbasic\noperations.\tIn\ta\tlater\tchapter\twe’ll\tsee\thow\tto\tbuild\tnew\timages\twith\tour\town\napplications\tinside\tof\tthem\t(containerizing\tan\tapp).\nWe’ll\tsplit\tthis\tchapter\tinto\tthe\tusual\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nLet’s\tgo\tlearn\tabout\timages!Docker\timages\t-\tThe\tTLDR\nIf\tyou’re\ta\tformer\tVM\tadmin\tyou\tcan\tthink\tof\tDocker\timages\tas\tbeing\tlike\tVM\ntemplates.\tA\tVM\ttemplate\tis\tlike\ta\tstopped\tVM\t-\ta\tDocker\timage\tis\tlike\ta\nstopped\tcontainer.\t\nIf\tyou’re\ta\tdeveloper\tyou\tcan\tthink\tof\tthem\tas\tbeing\tsimilar\nto\t\nclasses\n.\nYou\tstart\tby\t\npulling\n\timages\tfrom\tan\timage\tregistry.\tThe\tmost\tpopular\tregistry\tis\nDocker\tHub\n,\tbut\tothers\tdo\texist.\tThe\t\npull\n\toperation\tdownloads\tthe\timage\tto\nyour\tlocal\tDocker\thost\twhere\tyou\tcan\tuse\tit\tto\tstart\tone\tor\tmore\tDocker\ncontainers.\nImages\tare\tmade\tup\tof\tmultiple\tlayers\tthat\tget\tstacked\ton\ttop\tof\teach\tother\tand\nrepresented\tas\ta\tsingle\tobject.\tInside\tof\tthe\timage\tis\ta\tcut-down\toperating\nsystem\t(OS)\tand\tall\tof\tthe\tfiles\tand\tdependencies\trequired\tto\trun\tan\tapplication.\nBecause\tcontainers\tare\tintended\tto\tbe\tfast\tand\tlightweight,\timages\ttend\tto\tbe\nsmall.\nCongrats!\tYou’ve\tnow\tgot\thalf\ta\tclue\twhat\ta\tDocker\timage\tis\t:-D\t\nNow\tit’s\ttime\nto\tblow\tyour\tmind!Docker\timages\t-\tThe\tdeep\tdive\nWe’ve\tmentioned\ta\tcouple\tof\ttimes\talready\tthat\t\nimages\n\tare\tlike\tstopped\ncontainers\t(or\t\nclasses\n\tif\tyou’re\ta\tdeveloper).\tIn\tfact,\tyou\tcan\tstop\ta\tcontainer\nand\tcreate\ta\tnew\timage\tfrom\tit.\tWith\tthis\tin\tmind,\timages\tare\tconsidered\t\nbuild-\ntime\n\tconstructs\twhereas\tcontainers\tare\t\nrun-time\n\tconstructs.\nFigure\t6.1\nImages\tand\tcontainers\nFigure\t6.1\tshows\thigh-level\tview\tof\tthe\trelationship\tbetween\timages\tand\ncontainers.\tWe\tuse\tthe\t\ndocker\tcontainer\trun\n\tand\t\ndocker\tservice\tcreate\ncommands\tto\tstart\tone\tor\tmore\tcontainers\tfrom\ta\tsingle\timage.\tHowever,\tonce\nyou’ve\tstarted\ta\tcontainer\tfrom\tan\timage,\tthe\ttwo\tconstructs\tbecome\tdependent\non\teach\tother\tand\tyou\tcannot\tdelete\tthe\timage\tuntil\tthe\tlast\tcontainer\tusing\tit\nhas\tbeen\tstopped\tand\tdestroyed.\tAttempting\tto\tdelete\tan\timage\twithout\tstopping\nand\tdestroying\tall\tcontainers\tusing\tit\twill\tresult\tin\tthe\tfollowing\terror:\n$\tdocker\timage\trm\t<image-name>\nError\tresponse\tfrom\tdaemon:\tconflict:\tunable\tto\tremove\trepository\treference\t\n\\\n\"<image-name>\"\n\t\n(\nmust\tforce\n)\n\t-\tcontainer\t<container-id>\tis\tusing\tits\treferenc\n\\\ned\timage\t<image-id>\nImages\tare\tusually\tsmall\nThe\twhole\tpurpose\tof\ta\tcontainer\tis\tto\trun\tan\tapplication\tor\tservice.\tThis\tmeans\nthat\tthe\timage\ta\tcontainer\tis\tcreated\tfrom\tmust\tcontain\tall\tOS\tand\tapplication\nfiles\trequired\tto\trun\tthe\tapp/service.\tHowever,\tcontainers\tare\tall\tabout\tbeing\tfast\nand\tlightweight.\tThis\tmeans\tthat\tthe\timages\tthey’re\tbuilt\tfrom\tare\tusually\tsmall\nand\tstripped\tof\tall\tnon-essential\tparts.\nFor\texample,\tDocker\timages\tdo\tnot\tship\twith\t6\tdifferent\tshells\tfor\tyou\tto\tchoose\nfrom\t-\tthey\tusually\tship\twith\ta\tsingle\tminimalist\tshell,\tor\tno\tshell\tat\tall.\tThey\nalso\tdon’t\tcontain\ta\tkernel\t-\tall\tcontainers\trunning\ton\ta\tDocker\thost\tshare\taccess\nto\tthe\thost’s\tkernel.\tFor\tthese\treasons,\twe\tsometimes\tsay\timages\tcontain\t\njust\nenough\toperating\tsystem\n\t(usually\tjust\tOS-related\tfiles\tand\tfilesystem\tobjects).Note:\n\tHyper-V\tcontainers\trun\tinside\tof\ta\tdedicated\tlightweight\tVM\tand\nleverage\tthe\tkernel\tof\tthe\tOS\trunning\tinside\tthe\tVM.\nThe\tofficial\t\nAlpine\tLinux\n\tDocker\timage\tis\tabout\t4MB\tin\tsize\tand\tis\tan\textreme\nexample\tof\thow\tsmall\tDocker\timages\tcan\tbe.\tThat’s\tnot\ta\ttypo!\tIt\treally\tis\tabout\n4\tmegabytes!\tHowever,\ta\tmore\ttypical\texample\tmight\tbe\tsomething\tlike\tthe\nofficial\tUbuntu\tDocker\timage\twhich\tis\tcurrently\tabout\t120MB.\t\nThese\tare\nclearly\tstripped\tof\tmost\tnon-essential\tparts!\nWindows-based\timages\ttend\tto\tbe\tbigger\tthan\tLinux-based\timages\tbecause\tof\nthe\tway\tthat\tthe\tWindows\tOS\tworks.\tFor\texample,\tthe\tlatest\tMicrosoft\t.NET\nimage\t(\nmicrosoft/dotnet:latest\n)\tis\tover\t2GB\twhen\tpulled\tan\tuncompressed.\nThe\tWindows\tServer\t2016\tNano\tServer\timage\tis\tslightly\tover\t1GB\twhen\tpulled\nand\tuncompressed.\nPulling\timages\nA\tcleanly\tinstalled\tDocker\thost\thas\tno\timages\tin\tits\tlocal\trepository.\nThe\tlocal\timage\trepository\ton\ta\tLinux-based\tDocker\thost\tis\tusually\tlocated\tat\n/var/lib/docker/<storage-driver>\n.\tOn\tWindows-based\tDocker\thosts\tthis\tis\nC:\\\tProgramData\\docker\\windowsfilter\n.\nYou\tcan\tcheck\tif\tyour\tDocker\thost\thas\tany\timages\tin\tits\tlocal\trepository\twith\tthe\nfollowing\tcommand.\n$\tdocker\timage\tls\nREPOSITORY\t\tTAG\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\t\tSIZE\nThe\tprocess\tof\tgetting\timages\tonto\ta\tDocker\thost\tis\tcalled\t\npulling\n.\tSo,\tif\tyou\nwant\tthe\tlatest\tUbuntu\timage\ton\tyour\tDocker\thost,\tyou’d\thave\tto\t\npull\n\tit.\tUse\tthe\ncommands\tbelow\tto\t\npull\n\tsome\timages\tand\tthen\tcheck\ttheir\tsizes.\nIf\tyou\tare\tfollowing\talong\ton\tLinux\tand\thaven’t\tadded\tyour\tuser\taccount\tto\nthe\tlocal\t\ndocker\n\tUnix\tgroup,\tyou\tmay\tneed\tto\tadd\t\nsudo\n\tto\tthe\tbeginning\tof\nall\tthe\tfollowing\tcommands.\nLinux\texample:$\tdocker\timage\tpull\tubuntu:latest\nlatest:\tPulling\tfrom\tlibrary/ubuntu\nb6f892c0043b:\tPull\t\ncomplete\n55010f332b04:\tPull\t\ncomplete\n2955fb827c94:\tPull\t\ncomplete\n3deef3fcbd30:\tPull\t\ncomplete\ncf9722e506aa:\tPull\t\ncomplete\nDigest:\tsha256:38245....44463c62a9848133ecb1aa8\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tubuntu:latest\n$\n$\tdocker\timage\tpull\talpine:latest\nlatest:\tPulling\tfrom\tlibrary/alpine\ncfc728c1c558:\tPull\t\ncomplete\nDigest:\tsha256:c0537...497c0a7726c88e2bb7584dc96\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine:latest\n$\n$\tdocker\timage\tls\nREPOSITORY\t\t\tTAG\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\tSIZE\nubuntu\t\t\t\t\t\t\tlatest\t\tebcd9d4fca80\t\t\t\t\n3\n\tdays\tago\t\t\t\t118MB\nalpine\t\t\t\t\t\t\tlatest\t\t02674b9cb179\t\t\t\t\n8\n\tdays\tago\t\t\t\t\n3\n.99MB\nWindows\texample:\n>\tdocker\timage\tpull\tmicrosoft/powershell:nanoserver\nnanoserver:\tPulling\tfrom\tmicrosoft/powershell\nbce2fbc256ea:\tPull\tcomplete\n58f68fa0ceda:\tPull\tcomplete\n04083aac0446:\tPull\tcomplete\ne42e2e34b3c8:\tPull\tcomplete\n0c10d79c24d4:\tPull\tcomplete\n715cb214dca4:\tPull\tcomplete\na4837c9c9af3:\tPull\tcomplete\n2c79a32d92ed:\tPull\tcomplete\n11a9edd5694f:\tPull\tcomplete\nd223b37dbed9:\tPull\tcomplete\naee0b4393afb:\tPull\tcomplete\n0288d4577536:\tPull\tcomplete\n8055826c4f25:\tPull\tcomplete\nDigest:\tsha256:090fe875...fdd9a8779592ea50c9d4524842\nStatus:\tDownloaded\tnewer\timage\tfor\tmicrosoft/powershell:nanoserver\n>\n>\tdocker\timage\tpull\tmicrosoft/dotnet:latest\nlatest:\tPulling\tfrom\tmicrosoft/dotnet\nbce2fbc256ea:\tAlready\texists\n4a8c367fd46d:\tPull\tcomplete\n9f49060f1112:\tPull\tcomplete\n0334ad7e5880:\tPull\tcomplete\nea8546db77c6:\tPull\tcomplete\n710880d5cbd5:\tPull\tcomplete\nd665d26d9a25:\tPull\tcomplete\ncaa8d44fb0b1:\tPull\tcomplete\ncfd178ff221e:\tPull\tcomplete\nDigest:\tsha256:530343cd483dc3e1...6f0378e24310bd67d2a\nStatus:\tDownloaded\tnewer\timage\tfor\tmicrosoft/dotnet:latest\n>\n>\tdocker\timage\tls\nREPOSITORY\t\t\t\t\t\t\t\t\t\t\t\tTAG\t\t\t\t\t\t\t\t\tIMAGE\tID\t\t\t\tCREATED\t\t\t\t\tSIZEmicrosoft/dotnet\t\t\t\t\t\tlatest\t\t\t\t\t\t831..686d\t\t\t7\thrs\tago\t\t\t1.65\tGB\nmicrosoft/powershell\t\tnanoserver\t\td06..5427\t\t\t8\tdays\tago\t\t1.21\tGB\nAs\tyou\tcan\tsee,\tthe\timages\tyou\tjust\tpulled\tare\tnow\tpresent\tin\tyour\tDocker\thost’s\nlocal\trepository.\nImage\tnaming\nAs\tpart\tof\teach\tcommand\twe\thad\tto\tspecify\twhich\timage\tto\tpull.\tSo\tlet’s\ttake\ta\nminute\tto\tlook\tat\timage\tnaming.\tTo\tdo\tthat\twe\tneed\ta\tbit\tof\tbackground\ton\thow\nwe\tstore\timages.\nImage\tregistries\nDocker\timages\tare\tstored\tin\t\nimage\tregistries\n.\tThe\tmost\tcommon\tregistry\tis\nDocker\tHub\t(https://hub.docker.com).\tOther\tregistries\texist,\tincluding\t3rd\tparty\nregistries\tand\tsecure\ton-premises\tregistries.\tHowever,\tthe\tDocker\tclient\tis\nopinionated\tand\tdefaults\tto\tusing\tDocker\tHub.\tWe’ll\tbe\tusing\tDocker\tHub\tfor\nthe\trest\tof\tthe\tbook.\nImage\tregistries\tcontain\tmultiple\t\nimage\trepositories\n.\tIn\tturn,\timage\trepositories\ncan\tcontain\tmultiple\timages.\tThat\tmight\tbe\ta\tbit\tconfusing,\tso\tFigure\t6.2\tshows\na\tpicture\tof\tan\timage\tregistry\tcontaining\t3\trepositories,\tand\teach\trepository\ncontains\tone\tor\tmore\timages.\nFigure\t6.2\nOfficial\tand\tunofficial\trepositories\nDocker\tHub\talso\thas\tthe\tconcept\tof\t\nofficial\trepositories\n\tand\t\nunofficial\nrepositories\n.As\tthe\tname\tsuggests,\t\nofficial\trepositories\n\tcontain\timages\tthat\thave\tbeen\tvetted\nby\tDocker,\tInc.\tThis\tmeans\tthey\tshould\tcontain\tup-to-date,\thigh-quality\tcode,\nthat\tis\tsecure,\twell-documented,\tand\tin-line\twith\tbest\tpractices\t(please\tcan\tI\nhave\tan\taward\tfor\tusing\tfive\thyphens\tin\ta\tsingle\tsentence).\nUnofficial\trepositories\n\tcan\tbe\tlike\tthe\twild-west\t-\tyou\tshould\tnot\t\nexpect\n\tthem\tto\nbe\tsafe,\twell-documented\tor\tbuilt\taccording\tto\tbest\tpractices.\tThat’s\tnot\tsaying\neverything\tin\t\nunofficial\trepositories\n\tis\tbad!\tThere’s\tsome\t\nbrilliant\n\tstuff\tin\nunofficial\trepositories\n.\tYou\tjust\tneed\tto\tbe\tvery\tcareful\tbefore\ttrusting\tcode\tfrom\nthem.\tTo\tbe\thonest,\tyou\tshould\talways\tbe\tcareful\twhen\tgetting\tsoftware\tfrom\nthe\tinternet\t-\teven\timages\tfrom\t\nofficial\trepositories!\nMost\tof\tthe\tpopular\toperating\tsystems\tand\tapplications\thave\ttheir\town\t\nofficial\nrepositories\n\ton\tDocker\tHub.\tThey’re\teasy\tto\tspot\tbecause\tthey\tlive\tat\tthe\ttop\nlevel\tof\tthe\tDocker\tHub\tnamespace.\tThe\tlist\tbelow\tcontains\ta\tfew\tof\tthe\t\nofficial\nrepositories\n,\tand\tshows\ttheir\tURLs\tthat\texist\tat\tthe\ttop-level\tof\tthe\tDocker\tHub\nnamespace:\nnginx\n\t-\thttps://hub.docker.com/_/nginx/\nbusybox\n\t-\thttps://hub.docker.com/_/busybox/\nredis\n\t-\thttps://hub.docker.com/_/redis/\nmongo\n\t-\thttps://hub.docker.com/_/mongo/\nOn\tthe\tother\thand,\tmy\town\tpersonal\timages\tlive\tin\tthe\twild\twest\tof\t\nunofficial\nrepositories\n\tand\tshould\t\nnot\n\tbe\ttrusted!\tBelow\tare\tsome\texamples\tof\timages\tin\nmy\trepositories:\nnigelpoulton/tu-demo\nhttps://hub.docker.com/r/nigelpoulton/tu-demo/\nnigelpoulton/pluralsight-docker-ci\nhttps://hub.docker.com/r/nigelpoulton/pluralsight-docker-ci/\nNot\tonly\tare\timages\tin\tmy\trepositories\t\nnot\n\tvetted,\t\nnot\n\tkept\tup-to-date,\t\nnot\nsecure,\tand\t\nnot\n\twell\tdocumented…\tyou\tshould\talso\tnotice\tthat\tthey\tdon’t\tlive\tat\nthe\ttop-level\tof\tthe\tDocker\tHub\tnamespace.\tMy\trepositories\tall\tlive\twithin\ta\nsecond-level\tnamespace\tcalled\t\nnigelpoulton\n.You’ll\tprobably\tnotice\tthat\tthe\tMicrosoft\timages\twe’ve\tused\tdo\tnot\texist\tat\tthe\ntop-level\tof\tthe\tDocker\tHub\tnamespace.\tAt\tthe\ttime\tof\twriting,\tthey\texist\tunder\nthe\t\nmicrosoft\n\tsecond-level\tnamespace.\nAfter\tall\tof\tthat,\twe\tcan\tfinally\tlook\tat\thow\twe\taddress\timages\ton\tthe\tDocker\ncommand\tline.\nImage\tnaming\tand\ttagging\nAddressing\timages\tfrom\tofficial\trepositories\tis\tas\tsimple\tas\tgiving\tthe\trepository\nname\tand\ttag\tseparated\tby\ta\tcolon\t(\n:\n).\tThe\tformat\tfor\t\ndocker\timage\tpull\n\twhen\nworking\twith\tan\timage\tfrom\tan\tofficial\trepository\tis:\ndocker\timage\tpull\t<repository>:<tag>\nIn\tthe\tLinux\texamples\tfrom\tearlier,\twe\tpulled\tan\tAlpine\tand\tan\tUbuntu\timages\nwith\tthe\tfollowing\ttwo\tcommands:\ndocker\timage\tpull\talpine:latest\n\tand\t\ndocker\timage\tpull\tubuntu:latest\nThese\ttwo\tcommands\tpull\tthe\timages\ttagged\tas\t“latest”\tfrom\tthe\t“alpine”\tand\n“ubuntu”\trepositories.\nThe\tfollowing\texamples\tshow\thow\tto\tpull\tvarious\tdifferent\timages\tfrom\t\nofficial\nrepositories\n:\n$\tdocker\timage\tpull\tmongo:3.3.11\n//This\twill\tpull\tthe\timage\ttagged\tas\t\n`\n3\n.3.11\n`\n//from\tthe\tofficial\t\n`\nmongo\n`\n\trepository.\n$\tdocker\timage\tpull\tredis:latest\n//This\twill\tpull\tthe\timage\ttagged\tas\t\n`\nlatest\n`\n//from\tthe\tofficial\t\n`\nredis\n`\n\trepository.\n$\tdocker\timage\tpull\talpine\n//This\twill\tpull\tthe\timage\ttagged\tas\t\n`\nlatest\n`\n//from\tthe\tofficial\t\n`\nalpine\n`\n\trepository.\nA\tcouple\tof\tpoints\tto\tnote\tabout\tthe\tcommands\tabove.\nFirst,\tif\tyou\t\ndo\tnot\n\tspecify\tan\timage\ttag\tafter\tthe\trepository\tname,\tDocker\twill\nassume\tyou\tare\treferring\tto\tthe\timage\ttagged\tas\t\nlatest\n.\nSecond,\tthe\t\nlatest\n\ttag\tdoesn’t\thave\tany\tmagical\tpowers!\tJust\tbecause\tan\timage\nis\ttagged\tas\t\nlatest\n\tdoes\tnot\tguarantee\tit\tis\tthe\tmost\trecent\timage\tin\tarepository!\tFor\texample,\tthe\tmost\trecent\timage\tin\tthe\t\nalpine\n\trepository\tis\nusually\ttagged\tas\t\nedge\n.\tMoral\tof\tthe\tstory\t-\ttake\tcare\twhen\tusing\tthe\t\nlatest\n\ttag!\nPulling\timages\tfrom\tan\t\nunofficial\trepository\n\tis\tessentially\tthe\tsame\t-\tyou\tjust\nneed\tto\tprepend\tthe\trepository\tname\twith\ta\tDocker\tHub\tusername\tor\norganization\tname.\tThe\texample\tbelow\tshows\thow\tto\tpull\tthe\t\nv2\n\timage\tfrom\tthe\ntu-demo\n\trepository\towned\tby\ta\tdodgy\tperson\twhose\tDocker\tHub\taccount\tname\nis\t\nnigelpoulton\n.\n$\tdocker\timage\tpull\tnigelpoulton/tu-demo:v2\n//This\twill\tpull\tthe\timage\ttagged\tas\t\n`\nv2\n`\n//from\tthe\t\n`\ntu-demo\n`\n\trepository\twithin\tthe\tnamespace\n//of\tmy\tpersonal\tDocker\tHub\taccount.\nIn\tour\tearlier\tWindows\texamples,\twe\tpulled\ta\tPowerShell\tand\ta\t.NET\timage\nwith\tthe\tfollowing\ttwo\tcommands:\n>\tdocker\timage\tpull\tmicrosoft/powershell:nanoserver\n>\tdocker\timage\tpull\tmicrosoft/dotnet:latest\nThe\tfirst\tcommand\tpulls\tthe\timage\ttagged\tas\t\nnanoserver\n\tfrom\tthe\nmicrosoft/powershell\n\trepository.\tThe\tsecond\tcommand\tpulls\tthe\timage\ttagged\nas\t\nlatest\n\tfrom\tthe\t\nmicrosoft/dotnet\n\trepository.\nIf\tyou\twant\tto\tpull\timages\tfrom\t3rd\tparty\tregistries\t(not\tDocker\tHub),\tyou\tneed\nto\tprepend\tthe\trepository\tname\twith\tthe\tDNS\tname\tof\tthe\tregistry.\tFor\texample,\nif\tthe\timage\tin\tthe\texample\tabove\twas\tin\tthe\tGoogle\tContainer\tRegistry\t(GCR)\nyou’d\tneed\tto\tadd\t\ngcr.io\n\tbefore\tthe\trepository\tname\tas\tfollows\t-\t\ndocker\tpull\ngcr.io/nigelpoulton/tu-demo:v2\n\t(no\tsuch\trepository\tand\timage\texists).\nYou\tmay\tneed\tto\thave\tan\taccount\ton\t3rd\tparty\tregistries\tand\tbe\tlogged\tinto\tthem\nbefore\tyou\tcan\tpull\timages\tfrom\tthem.\nImages\twith\tmultiple\ttags\nOne\tfinal\tword\tabout\timage\ttags…\tA\tsingle\timage\tcan\thave\tas\tmany\ttags\tas\tyou\nwant.\tThis\tis\tbecause\ttags\tare\tarbitrary\talpha-numeric\tvalues\tthat\tare\tstored\tas\nmetadata\talongside\tthe\timage.\tLet’s\tlook\tat\tan\texample.\nPull\tall\tof\tthe\timages\tin\ta\trepository\tby\tadding\tthe\t\n-a\n\tflag\tto\tthem\t\ndocker\nimage\tpull\n\tcommand.\tThen\trun\t\ndocker\timage\tls\n\tto\tlook\tat\tthe\timages\tpulled.If\tyou\tare\tfollowing\talong\twith\tWindows\tyou\tcan\tpull\tfrom\tthe\nmicrosoft/nanoserver\n\trepository\tinstead\tof\t\nnigelpoulton/tu-demo\n.\nNote:\n\tIf\tthe\trepository\tyou\tare\tpulling\tform\tcontains\timages\tfor\tmultiple\narchitectures\tand\tplatforms,\tsuch\tas\tLinux\t\nand\n\tWindows,\tthe\tcommand\tis\nlikely\tto\tfail.\n$\tdocker\timage\tpull\t-a\tnigelpoulton/tu-demo\nlatest:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tPull\t\ncomplete\na3ed95caeb02:\tPull\t\ncomplete\n<Snip>\nDigest:\tsha256:42e34e546cee61adb1...3a0c5b53f324a9e1c1aae451e9\nv1:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tAlready\texists\na3ed95caeb02:\tAlready\texists\n<Snip>\nDigest:\tsha256:9ccc0c67e5c5eaae4b...624c1d5c80f2c9623cbcc9b59a\nv2:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tAlready\texists\na3ed95caeb02:\tAlready\texists\n<Snip>\nDigest:\tsha256:d3c0d8c9d5719d31b7...9fef58a7e038cf0ef2ba5eb74c\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tnigelpoulton/tu-demo\n$\n$\tdocker\timage\tls\nREPOSITORY\t\t\t\t\t\t\t\t\t\t\t\tTAG\t\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\tCREATED\t\t\t\t\t\tSIZE\nnigelpoulton/tu-demo\t\t\tv2\t\t\t\t\t\t\t6ac2...ad\t\t\n12\n\tmonths\tago\t\t\t\n211\n.6\tMB\nnigelpoulton/tu-demo\t\t\tlatest\t\t\t9b91...29\t\t\n12\n\tmonths\tago\t\t\t\n211\n.6\tMB\nnigelpoulton/tu-demo\t\t\tv1\t\t\t\t\t\t\t9b91...29\t\t\n12\n\tmonths\tago\t\t\t\n211\n.6\tMB\nA\tcouple\tof\tthings\tabout\twhat\tjust\thappened\tin\tthe\texample\tcited\tabove:\nFirst.\tThe\tcommand\tpulled\tthree\timages\tfrom\tthe\trepository:\t\nlatest\n,\t\nv1\n,\tand\t\nv2\n.\nSecond.\tLook\tclosely\tat\tthe\t\nIMAGE\tID\n\tcolumn\tin\tthe\toutput\tof\tthe\t\ndocker\timage\nls\n\tcommand.\tYou’ll\tsee\tthat\tthere\tare\tonly\ttwo\tunique\timage\tIDs.\tThis\tis\nbecause\tonly\ttwo\timages\twere\tactually\tdownloaded.\tThis\tin\tturn,\tis\tbecause\ttwo\nof\tthe\ttags\trefer\tto\tthe\tsame\timage.\tPut\tanother\tway…\tone\tof\tthe\timages\thas\ttwo\ntags.\tIf\tyou\tlook\tclosely\tyou’ll\tsee\tthat\tthe\t\nv1\n\tand\t\nlatest\n\ttags\thave\tthe\tsame\nIMAGE\tID\n.\tThis\tmeans\tthey’re\ttwo\ttags\tof\tthe\tsame\timage.\nThis\tis\talso\ta\tperfect\texample\tof\tthe\twarning\twe\tissued\tearlier\tabout\tthe\t\nlatest\ntag.\tIn\tthis\texample,\tthe\t\nlatest\n\ttag\trefers\tto\tthe\tsame\timage\tas\tthe\t\nv1\n\ttag.\tThis\nmeans\tit’s\tpointing\tto\tthe\tolder\tof\tthe\ttwo\timages\t-\tnot\tthe\tnewest!\t\nlatest\n\tis\tan\narbitrary\ttag\tand\tis\tnot\tguaranteed\tto\tpoint\tto\tthe\tnewest\timage\tin\ta\trepository!Images\tand\tlayers\nA\tDocker\timage\tis\tjust\ta\tbunch\tof\tloosely-connected\tread-only\tlayers.\tThis\tis\nshown\tin\tFigure\t6.3.\nFigure\t6.3\nDocker\ttakes\tcare\tof\tstacking\tthese\tlayers\tand\trepresenting\tthem\tas\ta\tsingle\nunified\tobject.\nThere\tare\ta\tfew\tways\tto\tsee\tand\tinspect\tthe\tlayers\tthat\tmake\tup\tan\timage,\tand\nwe’ve\talready\tseen\tone\tof\tthem.\tLet’s\ttake\ta\tsecond\tlook\tat\tthe\toutput\tof\tthe\ndocker\timage\tpull\tubuntu:latest\n\tcommand\tfrom\tearlier:\n$\tdocker\timage\tpull\tubuntu:latest\nlatest:\tPulling\tfrom\tlibrary/ubuntu\n952132ac251a:\tPull\t\ncomplete\n82659f8f1b76:\tPull\t\ncomplete\nc19118ca682d:\tPull\t\ncomplete\n8296858250fe:\tPull\t\ncomplete\n24e0251a0e2c:\tPull\t\ncomplete\nDigest:\tsha256:f4691c96e6bbaa99d...28ae95a60369c506dd6e6f6ab\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tubuntu:latest\nEach\tline\tin\tthe\toutput\tabove\tthat\tends\twith\t“Pull\tcomplete”\trepresents\ta\tlayer\tin\nthe\timage\tthat\twas\tpulled.\tAs\twe\tcan\tsee,\tthis\timage\thas\t5\tlayers.\tFigure\t6.4\nbelow\tshows\tthis\tin\tpicture\tform.\nFigure\t6.4\nAnother\tway\tto\tsee\tthe\tlayers\tof\tan\timage\tis\tto\tinspect\tthe\timage\twith\tthe\ndocker\timage\tinspect\n\tcommand.\tThe\texample\tbelow\tinspects\tthe\tsame\nubuntu:latest\n\timage.\n$\tdocker\timage\tinspect\tubuntu:latest\n[\n\t\t\t\t\n{\n\t\t\t\t\t\t\t\t\n\"Id\"\n:\t\n\"sha256:bd3d4369ae.......fa2645f5699037d7d8c6b415a10\"\n,\n\t\t\t\t\t\t\t\t\n\"RepoTags\"\n:\t\n[\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"ubuntu:latest\"\n\t\t\t\t\t\t\t\t<Snip>\n\t\t\t\t\t\t\t\t\n\"RootFS\"\n:\t\n{\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Type\"\n:\t\n\"layers\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Layers\"\n:\t\n[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"sha256:c8a75145fc...894129005e461a43875a094b93412\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"sha256:c6f2b330b6...7214ed6aac305dd03f70b95cdc610\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"sha256:055757a193...3a9565d78962c7f368d5ac5984998\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"sha256:4837348061...12695f548406ea77feb5074e195e3\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"sha256:0cad5e07ba...4bae4cfc66b376265e16c32a0aae9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\n]\n\t\t\t\t\t\t\t\t\n}\n\t\t\t\t\n}\n]\nThe\ttrimmed\toutput\tshows\t5\tlayers\tagain.\tOnly\tthis\ttime\tthey’re\tshown\tusing\ntheir\tSHA256\thashes.\tHowever,\tboth\tcommands\tshow\tthat\tthe\timage\thas\t5\nlayers.\nNote:\n\tThe\t\ndocker\thistory\n\tcommand\tshows\tthe\tbuild\thistory\tof\tan\timage\nand\tis\t\nnot\n\ta\tstrict\tlist\tof\tlayers\tin\tthe\timage.\tFor\texample,\tsome\tDockerfile\ninstructions\tused\tto\tbuild\tan\timage\tdo\tnot\tresult\tin\tlayers\tbeing\tcreated.\nThese\tinclude;\t“MAINTAINER”,\t“ENV”,\t“EXPOSE”\tand\n“ENTRYPOINT”.\tInstead\tof\tthese\tcreating\tnew\tlayers,\tthey\tadd\tmetadata\nto\tthe\timage.\nAll\tDocker\timages\tstart\twith\ta\tbase\tlayer,\tand\tas\tchanges\tare\tmade\tand\tnew\ncontent\tis\tadded,\tnew\tlayers\tare\tadded\ton\ttop.\nAs\tan\tover-simplified\texample,\tyou\tmight\tcreate\ta\tnew\timage\tbased\toff\tUbuntu\nLinux\t16.04.\tThis\twould\tbe\tyour\timage’s\tfirst\tlayer.\tIf\tyou\tlater\tadd\tthe\tPython\npackage,\tthis\twould\tbe\tadded\tas\ta\tsecond\tlayer\ton\ttop\tof\tthe\tbase\tlayer.\tIf\tyou\nthen\tadded\ta\tsecurity\tpatch,\tthis\twould\tbe\tadded\tas\ta\tthird\tlayer\tat\tthe\ttop.\tYourimage\twould\tnow\thave\tthree\tlayers\tas\tshown\tin\tFigure\t6.5\t(remember\tthis\tis\tan\nover-simplified\texample\tfor\tdemonstration\tpurposes).\nFigure\t6.5\nIt’s\timportant\tto\tunderstand\tthat\tas\tadditional\tlayers\tare\tadded,\tthe\timage\nbecomes\tthe\tcombination\tof\tall\tlayers.\tTake\ta\tsimple\texample\tof\ttwo\tlayers\tas\nshown\tin\tFigure\t6.6.\tEach\t\nlayer\n\thas\t3\tfiles,\tbut\tthe\toverall\t\nimage\n\thas\t6\tfiles\tas\tit\nis\tthe\tcombination\tof\tboth\tlayers.\nFigure\t6.6\nWe’ve\tshown\tthe\timage\tlayers\tin\tFigure\t6.6\tin\ta\tslightly\tdifferent\tway\tto\nprevious\tfigures.\tThis\tis\tjust\tto\tmake\tshowing\tfiles\teasier.\nIn\tthe\tslightly\tmore\tcomplex\texample\tof\tthe\tthree-layered\timage\tin\tFigure\t6.7,\nthe\toverall\timage\tonly\tpresents\t6\tfiles\tin\tthe\tunified\tview.\tThis\tis\tbecause\tfile\t7\nin\tthe\ttop\tlayer\tis\tan\tupdated\tversion\tof\tfile\t5\tdirectly\tbelow\t(inline).\tIn\tthis\nsituation,\tthe\tfile\tin\tthe\thigher\tlayer\tobscures\tthe\tfile\tdirectly\tbelow\tit.\tThis\nallows\tupdated\tversions\tof\tfiles\tto\tbe\tadded\tas\tnew\tlayers\tto\tthe\timage.Figure\t6.7\nDocker\temploys\ta\tstorage\tdriver\tthat\tis\tresponsible\tfor\tstacking\tlayers\tand\npresenting\tthem\tas\ta\tsingle\tunified\tfilesystem.\tExamples\tof\tstorage\tdrivers\ton\nLinux\tinclude\t\nAUFS\n,\t\noverlay2\n,\t\ndevicemapper\n,\t\nbtrfs\n\tand\t\nzfs\n.\tAs\ttheir\tnames\nsuggest,\teach\tone\tis\tbased\ton\ta\tLinux\tfilesystem\tor\tblock-device\ttechnology,\tand\neach\thas\tits\town\tunique\tperformance\tcharacteristics.\tThe\tonly\tdriver\tsupported\nby\tDocker\ton\tWindows\tis\t\nwindowsfilter\n\tand\timplements\tlayering\tand\tCoW\ton\ntop\tof\tNTFS.\nSharing\timage\tlayers\nMultiple\timages\tcan,\tand\tdo,\tshare\tlayers.\tThis\tleads\tto\tefficiencies\tin\tspace\tand\nperformance.\nLet’s\ttake\ta\tsecond\tlook\tat\tthe\t\ndocker\timage\tpull\n\tcommand\twith\tthe\t\n-a\n\tflag\nthat\twe\tran\ta\tminute\tor\ttwo\tago\tto\tpull\tall\ttagged\timages\tin\tthe\nnigelpoulton/tu-demo\n\trepository.\n$\tdocker\timage\tpull\t-a\tnigelpoulton/tu-demo\nlatest:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tPull\t\ncomplete\na3ed95caeb02:\tPull\t\ncomplete\n<Snip>\nDigest:\tsha256:42e34e546cee61adb100...a0c5b53f324a9e1c1aae451e9\nv1:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tAlready\texists\na3ed95caeb02:\tAlready\texists\n<Snip>\nDigest:\tsha256:9ccc0c67e5c5eaae4beb...24c1d5c80f2c9623cbcc9b59a\nv2:\tPulling\tfrom\tnigelpoulton/tu-demo\n237d5fcd25cf:\tAlready\texists\na3ed95caeb02:\tAlready\texists\n<Snip>\neab5aaac65de:\tPull\t\ncompleteDigest:\tsha256:d3c0d8c9d5719d31b79c...fef58a7e038cf0ef2ba5eb74c\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tnigelpoulton/tu-demo\n$\n$\tdocker\timage\tls\nREPOSITORY\t\t\t\t\t\t\t\t\t\t\t\t\tTAG\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\tSIZE\nnigelpoulton/tu-demo\t\t\tv2\t\t\t\t\t\t\t6ac...ead\t\t\t\n4\n\tmonths\tago\t\t\t\n211\n.6\tMB\nnigelpoulton/tu-demo\t\t\tlatest\t\t\t9b9...e29\t\t\t\n4\n\tmonths\tago\t\t\t\n211\n.6\tMB\nnigelpoulton/tu-demo\t\t\tv1\t\t\t\t\t\t\t9b9...e29\t\t\t\n4\n\tmonths\tago\t\t\t\n211\n.6\tMB\nNotice\tthe\tlines\tending\tin\t\nAlready\texists\n.\nThese\tlines\ttell\tus\tthat\tDocker\tis\tsmart\tenough\trecognize\twhen\tit’s\tbeing\tasked\nto\tpull\tan\timage\tlayer\tthat\tit\talready\thas\ta\tcopy\tof.\tIn\tthis\texample,\tDocker\npulled\tthe\timage\ttagged\tas\t\nlatest\n\tfirst.\tThen,\twhen\tit\twent\tto\tpull\tthe\t\nv1\n\tand\t\nv2\nimages\tit\tnoticed\tthat\tit\talready\thad\tsome\tof\tthe\tlayers\tthat\tmake\tup\tthose\nimages.\tThis\thappens\tbecause\tthe\tthree\timages\tin\tthis\trepository\tare\talmost\nidentical,\tand\ttherefore\tshare\tmany\tlayers.\nAs\tmentioned\tpreviously,\tDocker\ton\tLinux\tsupports\tmany\tdifferent\tfilesystems\nand\tstorage\tdrivers.\tEach\tis\tfree\tto\timplement\timage\tlayering,\tlayer\tsharing,\tand\ncopy-on-write\tbehaviour\tin\tits\town\tway.\tHowever,\tthe\toverall\tresult\tand\tuser\nexperience\tis\tessentially\tthe\tsame.\tAlthough\tWindows\tonly\tsupports\ta\tsingle\nstorage\tdriver,\tthat\tdriver\tprovides\tthe\tsame\texperience\tas\tLinux.\nPulling\timages\tby\tdigest\nSo\tfar,\twe’ve\tshown\tyou\thow\tto\tpull\timages\tby\ttag,\tand\tthis\tis\tby\tfar\tthe\tmost\ncommon\tway.\tBut\tit\thas\ta\tproblem\t-\ttags\tare\tmutable!\tThis\tmeans\tit’s\tpossible\nto\taccidentally\ttag\tan\timage\twith\tan\tincorrect\ttag.\tSometimes\tit’s\teven\tpossible\nto\ttag\tan\timage\twith\tthe\tsame\ttag\tas\tan\texisting,\tbut\tdifferent,\timage.\tThis\tcan\ncause\tproblems!\nAs\tan\texample,\timagine\tthat\tyou’ve\tgot\tan\timage\tcalled\t\ngolftrack:1.5\n\tand\tit\nhas\ta\tknown\tbug.\tYou\tpull\tthe\timage,\tapply\ta\tfix,\tand\tpush\tthe\tupdated\timage\nback\tto\tits\trepository\twith\tthe\t\nsame\ttag\n.\nTake\ta\tsecond\tto\tunderstand\twhat\tjust\thappened\tthere…\tYou\thave\tan\timage\ncalled\t\ngolftrack:1.5\n\tthat\thas\ta\tbug.\tThat\timage\tis\tbeing\tused\tin\tyour\nproduction\tenvironment.\tYou\tpull\tthe\timage\tand\tapply\ta\tfix.\tThen\tcomes\tthe\nmistake…\tyou\tpush\tthe\tfixed\timage\tback\tto\tits\trepository\twith\tthe\t\nsame\ttag\tas\nthe\tvulnerable\timage!\n\tHow\tare\tyou\tgoing\tto\tknow\twhich\tof\tyour\tproduction\nsystems\tare\trunning\tthe\tvulnerable\timage\tand\twhich\tare\trunning\tthe\tpatched\nimage?\tBoth\timages\thave\tthe\tsame\ttag!This\tis\twhere\t\nimage\tdigests\n\tcome\tto\tthe\trescue.\nDocker\t1.10\tintroduced\ta\tnew\tcontent\taddressable\tstorage\tmodel.\tAs\tpart\tof\tthis\nnew\tmodel,\tall\timages\tnow\tget\ta\tcryptographic\tcontent\thash.\tFor\tthe\tpurposes\tof\nthis\tdiscussion,\twe’ll\trefer\tto\tthis\thash\tas\tthe\t\ndigest\n.\tBecause\tthe\tdigest\tis\ta\thash\nof\tthe\tcontents\tof\tthe\timage,\tit\tis\tnot\tpossible\tto\tchange\tthe\tcontents\tof\tthe\nimage\twithout\tthe\tdigest\talso\tchanging.\tThis\tmeans\tdigests\tare\timmutable.\tThis\nhelps\tavoid\tthe\tproblem\twe\tjust\ttalked\tabout.\nEvery\ttime\tyou\tpull\tan\timage,\tthe\t\ndocker\timage\tpull\n\tcommand\twill\tinclude\nthe\timage’s\tdigest\tas\tpart\tof\tthe\treturn\tcode.\tYou\tcan\talso\tview\tthe\tdigests\tof\nimages\tin\tyour\tDocker\thost’s\tlocal\trepository\tby\tadding\tthe\t\n--digests\n\tflag\tto\nthe\t\ndocker\timage\tls\n\tcommand.\tThese\tare\tboth\tshown\tin\tthe\tfollowing\nexample.\n$\tdocker\timage\tpull\talpine\nUsing\tdefault\ttag:\tlatest\nlatest:\tPulling\tfrom\tlibrary/alpine\ne110a4a17941:\tPull\t\ncomplete\nDigest:\tsha256:3dcdb92d7432d56604d...6d99b889d0626de158f73a\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine:latest\n$\n$\tdocker\timage\tls\t--digests\talpine\nREPOSITORY\t\tTAG\t\t\t\t\tDIGEST\t\t\t\t\t\t\t\t\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\tCREATED\t\t\t\t\t\t\tSIZE\nalpine\t\t\t\t\t\tlatest\t\tsha256:3dcd...f73a\t\t4e38e38c8ce0\t\t\n10\n\tweeks\tago\t\t\n4\n.8\tMB\nThe\tsnipped\toutput\tabove\tshows\tthe\tdigest\tfor\tthe\t\nalpine\n\timage\tas\t-\nsha256:3dcdb92d7432d56604d...6d99b889d0626de158f73a\nNow\tthat\twe\tknow\tthe\tdigest\tof\tthe\timage,\twe\tcan\tuse\tit\twhen\tpulling\tthe\timage\nagain.\tThis\twill\tensure\tthat\twe\tget\t\nexactly\tthe\timage\twe\texpect!\nAt\tthe\ttime\tof\twriting,\tthere\tis\tno\tnative\tDocker\tcommand\tthat\twill\tretrieve\tthe\ndigest\tof\tan\timage\tfrom\ta\tremote\tregistry\tsuch\tas\tDocker\tHub.\tThis\tmeans\tthe\nonly\tway\tto\tdetermine\tthe\tdigest\tof\tan\timage\tis\tto\tpull\tit\tby\ttag\tand\tthen\tmake\ta\nnote\tof\tits\tdigest.\tThis\twill\tno\tdoubt\tchange\tin\tthe\tfuture.\nThe\texample\tbelow\tdeletes\tthe\t\nalpine:latest\n\timage\tfrom\tyour\tDocker\thost\nand\tthen\tshows\thow\tto\tpull\tit\tagain\tusing\tits\tdigest\tinstead\tof\tits\ttag.\n$\tdocker\timage\trm\talpine:latest\nUntagged:\talpine:latest\nUntagged:\talpine@sha256:c0537...7c0a7726c88e2bb7584dc96\nDeleted:\tsha256:02674b9cb179d...abff0c2bf5ceca5bad72cd9\nDeleted:\tsha256:e154057080f40...3823bab1be5b86926c6f860$\n$\tdocker\timage\tpull\talpine@sha256:c0537...7c0a7726c88e2bb7584dc96\nsha256:c0537...7726c88e2bb7584dc96:\tPulling\tfrom\tlibrary/alpine\ncfc728c1c558:\tPull\t\ncomplete\nDigest:\tsha256:c0537ff6a5218...7c0a7726c88e2bb7584dc96\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine@sha256:c0537...bb7584dc96\nA\tlittle\tbit\tmore\tabout\timage\thashes\t(digests)\nSince\tDocker\tversion\t1.10,\tan\timage\tis\ta\tvery\tloose\tcollection\tof\tindependent\nlayers.\nThe\t\nimage\n\titself\tis\treally\tjust\ta\tconfiguration\tobject\tthat\tlists\tthe\tlayers\tand\tas\nwell\tas\tsome\tmetadata.\nThe\t\nlayers\n\tthat\tmake\tup\tan\timage\tare\tfully\tindependent\tand\thave\tno\tconcept\tof\nbeing\tpart\tof\ta\tcollective\timage.\nEach\timage\tis\tidentified\tby\ta\tcrypto\tID\tthat\tis\ta\thash\tof\tthe\tconfig\tobject.\tEach\nlayer\tis\tidentified\tby\ta\tcrypto\tID\tthat\tis\ta\thash\tof\tthe\tcontent\tit\tcontains.\nThis\tmeans\tthat\tchanging\tthe\tcontents\tof\tthe\timage,\tor\tany\tof\tits\tlayers,\twill\ncause\tthe\tassociated\tcrypto\thashes\tto\tchange.\tAs\ta\tresult,\timages\tand\tlayers\tare\nimmutable.\nWe\tcall\tthese\thashes\t\ncontent\thashes\n.\nSo\tfar,\tthings\tare\tpretty\tsimple.\tBut\tthey’re\tabout\tto\tget\ta\tbit\tmore\tcomplicated.\nWhen\twe\tpush\tand\tpull\timages,\twe\tcompress\ttheir\tlayers\tto\tsave\tbandwidth\tas\nwell\tas\tspace\tin\tthe\tRegistry’s\tblob\tstore.\nCool,\tbut\tcompressing\ta\tlayer\tchanges\tits\tcontent!\tThis\tmeans\tthat\tit’s\tcontent\nhash\twill\tno\tlonger\tmatch\tafter\tthe\tpush\tor\tpull\toperation!\tThis\tis\tobviously\ta\nproblem.\nFor\texample,\twhen\tyou\tpush\tan\timage\tlayer\tto\tDocker\tHub,\tDocker\tHub\twill\nattempt\tto\tverify\tthat\tthe\timage\tarrived\twithout\tbeing\ttampered\twith\ten-route.\nTo\tdo\tthis,\tis\truns\ta\thash\tagainst\tthe\tlayer\tand\tchecks\tto\tsee\tif\tit\tmatches\tthe\nhash\tthat\twas\tsent\twith\tthe\tlayer.\tBecause\tthe\tlayer\twas\tcompressed\t(changed)\nthe\thash\tverification\twill\tfail.To\tget\taround\tthis,\teach\tlayer\talso\tgets\tsomething\tcalled\ta\tdistribution\thash.\tThis\nis\ta\thash\tof\tthe\tcompressed\tversion\tof\tthe\tlayer.\tWhen\ta\tlayer\tis\tpushed\tand\npulled\tfrom\tthe\tregistry,\tits\tdistribution\thash\tis\tincluded,\tand\tthis\tis\twhat\tis\tused\nto\tverify\tthat\tthe\tlayer\tarrived\twithout\tbeing\ttampered\twith.\nThis\tcontent-addressable\tstorage\tmodel\tvastly\timproves\tsecurity\tby\tgiving\tus\ta\nway\tto\tvery\timage\tand\tlayer\tdata\tafter\tpush\tand\tpull\toperations.\tIt\talso\tavoids\nID\tcollisions\tthat\tcould\toccur\tif\timage\tand\tlayer\tIDs\twere\trandomly\tgenerated.\nMulti-architecture\timages\nDocker\tnow\tincludes\tsupport\tfor\tmulti-platform\tand\tmulti-architecture\timages.\nThis\tmeans\ta\tsingle\timage\trepository\tand\ttag\tto\thave\tan\timage\tfor\tLinux\ton\tx64\nand\tLinux\ton\tPowerPC\tetc.\tOther\texamples\texist.\nTo\tenable\tthis,\tthe\tRegistry\tAPI\tsupports\ta\t\nfat\tmanifest\n\tas\twell\tas\tan\t\nimage\nmanifest\n.\t\nFat\tmanifests\tlist\tthe\tarchitectures\tsupported\tby\ta\tparticular\timage,\nwhereas\timage\tmanifests\tlist\tthe\tlayers\tthat\tmake\tup\ta\tparticular\timage.\nLet’s\tlook\tat\ta\tquick\texample.\nAssume\tyou\tare\trunning\tDocker\ton\tLinux\tx64.\tWhen\tyou\tpull\tan\timage\tfrom\nDocker\thub,\tyour\tDocker\tclient\tmakes\tthe\trelevant\tAPI\trequests\tto\tthe\tDocker\nRegistry\tAPI\trunning\ton\tDocker\tHub.\tIf\ta\tfat\tmanifest\texists\tfor\tthat\timage,\tit\nwill\tbe\tparsed\tto\tsee\tif\tan\tentry\texists\tfor\tLinux\ton\tx64.\tIf\tit\texists,\tthe\timage\nmanifest\tfor\tthat\timage\tis\tretrieved\tand\tparsed\tfor\tthe\tactual\tlayers\tthat\tmake\tup\nthe\timage.\tThe\tlayers\tare\tidentified\tby\ttheir\tcrypto\tIDs\tand\tare\tpulled\tfrom\tthe\nRegistry’s\tblob\tstore.\nDeleting\tImages\nWhen\tyou\tno\tlonger\tneed\tan\timage,\tyou\tcan\tdelete\tit\tfrom\tyour\tDocker\thost\nwith\tthe\t\ndocker\timage\trm\n\tcommand.\t\nrm\n\tis\tshort\tfor\tremove.\nDelete\tthe\timages\tpulled\tin\tthe\tprevious\tsteps\twith\tthe\t\ndocker\timage\trm\ncommand.\tThe\texample\tbelow\tdeletes\tan\timage\tby\tits\tID,\tthis\tmight\tbe\tdifferent\non\tyour\tsystem.\n$\tdocker\timage\trm\t02674b9cb179\nUntagged:\talpine@sha256:c0537ff6a5218...c0a7726c88e2bb7584dc96\nDeleted:\tsha256:02674b9cb179d57...31ba0abff0c2bf5ceca5bad72cd9\nDeleted:\tsha256:e154057080f4063...2a0d13823bab1be5b86926c6f860If\tthe\timage\tyou\tare\ttrying\tto\tdelete\tis\tin\tuse\tby\ta\trunning\tcontainer\tyou\twill\tnot\nbe\table\tto\tdelete\tit.\tStop\tand\tdelete\tany\tcontainers\tbefore\ttrying\tthe\tremove\noperation\tagain.\nA\thandy\tshortcut\tfor\tcleaning\tup\ta\tsystem\tand\t\ndeleting\tall\timages\n\ton\ta\tDocker\nhost\tis\tto\trun\tthe\t\ndocker\timage\trm\n\tcommand\tand\tpass\tit\ta\tlist\tof\tall\timage\tIDs\non\tthe\tsystem\tby\tcalling\t\ndocker\timage\tls\n\twith\tthe\t\n-q\n\tflag.\tThis\tis\tshown\nbelow.\nIf\tyou\tare\tperforming\tthe\tfollowing\tcommand\ton\ta\tWindows\tsystem,\tit\twill\tonly\nwork\tin\ta\tPowerShell\tterminal.\tIt\twill\tnot\twork\ton\ta\tCMD\tprompt.\n$\tdocker\timage\trm\t\n$(\ndocker\timage\tls\t-q\n)\n\t-f\nTo\tunderstand\thow\tthis\tworks,\tdownload\ta\tcouple\tof\timages\tand\tthen\trun\ndocker\timage\tls\t-q\n.\n$\tdocker\timage\tpull\talpine\nUsing\tdefault\ttag:\tlatest\nlatest:\tPulling\tfrom\tlibrary/alpine\ne110a4a17941:\tPull\t\ncomplete\nDigest:\tsha256:3dcdb92d7432d5...3626d99b889d0626de158f73a\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine:latest\n$\n$\tdocker\timage\tpull\tubuntu\nUsing\tdefault\ttag:\tlatest\nlatest:\tPulling\tfrom\tlibrary/ubuntu\n952132ac251a:\tPull\t\ncomplete\n82659f8f1b76:\tPull\t\ncomplete\nc19118ca682d:\tPull\t\ncomplete\n8296858250fe:\tPull\t\ncomplete\n24e0251a0e2c:\tPull\t\ncomplete\nDigest:\tsha256:f4691c96e6bba...128ae95a60369c506dd6e6f6ab\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tubuntu:latest\n$\n$\tdocker\timage\tls\t-q\nbd3d4369aebc\n4e38e38c8ce0\nSee\thow\t\ndocker\timage\tls\t-q\n\treturns\ta\tlist\tcontaining\tjust\tthe\timage\tIDs\tof\tall\nimages\tpulled\tlocally\ton\tthe\tsystem.\tPassing\tthis\tlist\tto\t\ndocker\timage\trm\n\twill\ndelete\tall\timages\ton\tthe\tsystem\tas\tshown\tbelow.\n$\tdocker\timage\trm\t\n$(\ndocker\timage\tls\t-q\n)\n\t-f\nUntagged:\tubuntu:latest\nUntagged:\tubuntu@sha256:f4691c9...2128ae95a60369c506dd6e6f6ab\nDeleted:\tsha256:bd3d4369aebc494...fa2645f5699037d7d8c6b415a10\nDeleted:\tsha256:cd10a3b73e247dd...c3a71fcf5b6c2bb28d4f2e5360b\nDeleted:\tsha256:4d4de39110cd250...28bfe816393d0f2e0dae82c363a\nDeleted:\tsha256:6a89826eba8d895...cb0d7dba1ef62409f037c6e608b\nDeleted:\tsha256:33efada9158c32d...195aa12859239d35e7fe9566056Deleted:\tsha256:c8a75145fcc4e1a...4129005e461a43875a094b93412\nUntagged:\talpine:latest\nUntagged:\talpine@sha256:3dcdb92...313626d99b889d0626de158f73a\nDeleted:\tsha256:4e38e38c8ce0b8d...6225e13b0bfe8cfa2321aec4bba\nDeleted:\tsha256:4fe15f8d0ae69e1...eeeeebb265cd2e328e15c6a869f\n$\n$\tdocker\timage\tls\nREPOSITORY\t\t\t\t\tTAG\t\t\t\tIMAGE\tID\t\t\t\tCREATED\t\t\t\t\tSIZE\nLet’s\tremind\tourselves\tof\tthe\tmajor\tcommands\twe\tuse\tto\twork\twith\tDocker\nimages.Images\t-\tThe\tcommands\ndocker\timage\tpull\n\tis\tthe\tcommand\tto\tdownload\timages.\tWe\tpull\timages\nfrom\trepositories\tinside\tof\tremote\tregistries.\tBy\tdefault,\timages\twill\tbe\npulled\tfrom\trepositories\ton\tDocker\tHub.\tThis\tcommand\twill\tpull\tthe\timage\ntagged\tas\t\nlatest\n\tfrom\tthe\t\nalpine\n\trepository\ton\tDocker\tHub\t\ndocker\timage\npull\talpine:latest\n.\ndocker\timage\tls\n\tlists\tall\tof\tthe\timages\tstored\tin\tyour\tDocker\thost’s\tlocal\ncache.\tTo\tsee\tthe\tSHA256\tdigests\tof\timages\tadd\tthe\t\n--digests\n\tflag.\ndocker\timage\tinspect\n\tis\ta\tthing\tof\tbeauty!\tIt\tgives\tyou\tall\tof\tthe\tglorious\ndetails\tof\timage\t-\tlayer\tdata\tand\tmetadata.\ndocker\timage\trm\n\tis\tthe\tcommand\tto\tdelete\timages.\tThis\tcommand\tshows\nhow\tto\tdelete\tthe\t\napline:latest\n\timage\t-\t\ndocker\timage\trm\nalpine:latest\n.\tYou\tcannot\tdelete\tan\timage\tthat\tis\tassociated\twith\ta\ncontainer\tin\tthe\trunning\t(Up)\tor\tstopped\t(Exited)\tstates.Chapter\tsummary\nIn\tthis\tchapter\twe\tlearned\tabout\tDocker\timages.\tWe\tlearned\tthat\tthey\tare\tlike\nvirtual\tmachine\ttemplates\tand\tare\tused\tto\tstart\tcontainers.\tUnder\tthe\thood\tthey\nare\tmade\tup\tone\tor\tmore\tread-only\tlayers\tthat\twhen\tstacked\ttogether\tmake\tup\nthe\toverall\timage.\nWe\tused\tthe\t\ndocker\timage\tpull\n\tcommand\tto\tpull\tsome\timages\tinto\tour\tDocker\nhost’s\tlocal\tregistry.\nWe\tcovered\timage\tnaming,\tofficial\tand\tunofficial\trepos,\tlayering,\tsharing,\tand\ncrypto\tIDs.\nWe\tfinished\toff\tby\tlooking\tat\tsome\tof\tthe\tmost\tcommon\tcommands\tused\tto\nwork\twith\timages.\nIn\tthe\tnext\tchapter\twe’ll\ttake\ta\tsimilar\ttour\tof\tcontainers\t-\tthe\truntime\tcousin\tof\nimages.7:\tContainers\nNow\tthat\twe\tknow\ta\tbit\tabout\timages,\tit’s\ttime\tto\tget\tinto\tcontainers.\tAs\tthis\tis\ta\nbook\tabout\tDocker,\twe’ll\tbe\ttalking\tspecifically\tabout\tDocker\tcontainers.\nHowever,\tthe\tDocker\tproject\thas\tbeen\thard\tat\twork\timplementing\tthe\timage\tand\ncontainer\tspecs\tpublished\tby\tthe\tOpen\tContainers\tInitiative\t(OCI)\tat\nhttps://www.opencontainers.org.\tThis\tmeans\t\nsome\n\tof\twhat\tyou\tlearn\there\twill\napply\tto\tother\tcontainer\truntimes\tthat\tare\tOCI\tcompliant.\nWe’ll\tsplit\tthis\tchapter\tinto\tthe\tusual\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nLet’s\tgo\tand\tlearn\tabout\tcontainers!Docker\tcontainers\t-\tThe\tTLDR\nA\tcontainer\tis\tthe\truntime\tinstance\tof\tan\timage.\tIn\tthe\tsame\tway\tthat\twe\tcan\nstart\ta\tvirtual\tmachine\t(VM)\tfrom\ta\tvirtual\tmachine\ttemplate,\twe\tstart\tone\tor\nmore\tcontainers\tfrom\ta\tsingle\timage.\tThe\tbig\tdifference\tbetween\ta\tVM\tand\ta\ncontainer\tis\tthat\tcontainers\tare\tfaster\tand\tmore\tlightweight\t-\tinstead\tof\trunning\ta\nfull-blown\tOS\tlike\ta\tVM,\tcontainers\tshare\tthe\tOS/kernel\twith\tthe\thost\tthey’re\nrunning\ton.\nFigure\t7.1\tshows\ta\tsingle\tDocker\timage\tbeing\tused\tto\tstart\tmultiple\tDocker\ncontainers.\nFigure\t7.1\nThe\tsimplest\tway\tto\tstart\ta\tcontainer\tis\twith\tthe\t\ndocker\tcontainer\trun\ncommand.\tThe\tcommand\tcan\ttake\ta\tlot\tof\targuments,\tbut\tin\tits\tmost\tbasic\tform\nyou\ttell\tit\tan\timage\tto\tuse\tand\ta\tcommand\tto\trun:\t\ndocker\tcontainer\trun\n<image>\t<command>\n.\tThis\tnext\tcommand\twill\tstart\tan\tUbuntu\tLinux\tcontainer\nrunning\tthe\tBash\tshell:\t\ndocker\tcontainer\trun\t-it\tubuntu\t/bin/bash\n.\tTo\nstart\ta\tWindows\tcontainer\trunning\tPowerShell\tyou\tcould\tdo\t\ndocker\tcontainer\nrun\t-it\tmicrosoft/powershell:nanoserver\tPowerShell.exe\n.\nThe\t\n-it\n\tflags\tused\tin\tthe\tcommands\tabove\twill\tconnect\tyour\tcurrent\tterminal\nwindow\tto\tthe\tcontainer’s\tshell.\nContainers\trun\tuntil\tthe\tprogram\tthey\tare\texecuting\texits.\tIn\tthe\ttwo\texamples\nabove,\tthe\tLinux\tcontainer\twill\texit\twhen\tthe\tBash\tshell\texits,\tand\tthe\tWindows\ncontainer\twill\texit\twhen\tthe\tPowerShell\tprocess\tterminates.\nA\treally\tsimple\tway\tto\tdemonstrate\tthis\tis\tto\tstart\ta\tnew\tcontainer\tand\ttell\tit\tto\nrun\tthe\tsleep\tcommand\tfor\t10\tseconds.\tThe\tcontainer\twill\tstart,\trun\tfor\t10\nseconds\tand\texit.\tIf\tyou\trun\tthe\tfollowing\tcommand\tfrom\ta\tLinux\thost\t(orWindows\thost\trunning\tin\tLinux\tcontainers\tmode)\tyour\tshell\twill\tattach\tto\tthe\ncontainer’s\tshell\tfor\t10\tseconds\tand\tthen\texit:\t\ndocker\tcontainer\trun\nalpine:latest\tsleep\t10\n.\t\nYou\tcan\tdo\tthe\tsame\twith\ta\tWindows\tcontainer\twith\nthe\tfollowing\tcommand\t\ndocker\tcontainer\trun\nmicrosoft/powershell:nanoserver\tStart-Sleep\t-s\t10\n.\nYou\tcan\tmanually\tstop\ta\tcontainer\twith\tthe\t\ndocker\tcontainer\tstop\n\tcommand,\nand\tthen\trestart\tit\twith\t\ndocker\tcontainer\tstart\n.\tTo\tget\trid\tof\ta\tcontainer\nforever\tyou\thave\tto\texplicitly\tdelete\tit\tusing\t\ndocker\tcontainer\trm\n.\nThat’s\tthe\televator\tpitch!\tNow\tlet’s\tget\tinto\tthe\tdetail…Docker\tcontainers\t-\tThe\tdeep\tdive\nThe\tfirst\tthings\twe’ll\tcover\there\tare\tthe\tfundamental\tdifferences\tbetween\ta\ncontainer\tand\ta\tVM.\tIt’s\tmainly\ttheory\tat\tthis\tstage,\tbut\tit’s\timportant\tstuff.\nAlong\tthe\tway\tWe’ll\tpoint\tout\twhere\tthe\tcontainer\tmodel\thas\tpotential\nadvantages\tover\tthe\tVM\tmodel.\nHeads-up:\n\tAs\tthe\tauthor\tI’m\tgoing\tto\tsay\tthis\tbefore\twe\tgo\tany\tfurther.\tA\nlot\tof\tus\tget\tpassionate\tabout\tthe\tthings\twe\tdo\tand\tthe\tskills\twe\thave.\tI\nremember\t\nbig\tUnix\n\tpeople\tresisting\tthe\trise\tof\tLinux.\tYou\tmight\tremember\nthe\tsame.\tYou\tmight\talso\tremember\tpeople\tattempting\tto\tresist\tVMware\nand\tthe\tVM\tjuggernaut.\tIn\tboth\tcases\t“resistance\twas\tfutile”.\tIn\tthis\tsection\nI’m\tgoing\tto\thighlight\twhat\tI\tconsider\tsome\tof\tthe\tadvantages\tthe\tcontainer\nmodel\thas\tover\tthe\tVM\tmodel.\tBut\tI’m\tguessing\ta\tlot\tof\tyou\twill\tbe\tVM\nexperts\twith\ta\tlot\tinvested\tin\tthe\tVM\tecosystem.\tAnd\tI’m\tguessing\tthat\tone\nor\ttwo\tof\tyou\tmight\twant\tto\tfight\tme\tover\tsome\tof\tthe\tthings\tI\tsay.\tSo\tlet\nme\tbe\tclear…\tI’m\ta\tbig\tguy\tand\tI’d\tbeat\tyou\tdown\tin\thand-to-hand\tcombat\n:-D\t\nJust\tkidding.\tBut\tI’m\tnot\ttrying\tto\tdestroy\tyour\tempire\tor\tcall\tyour\nbaby\tugly!\tI’m\ttrying\tto\thelp.\tThe\twhole\treason\tfor\tme\twriting\tthis\tbook\tis\nto\thelp\tyou\tget\tstarted\twith\tDocker\tand\tcontainers!\nAnyway,\there\twe\tgo.\nContainers\tvs\tVMs\nContainers\tand\tVMs\tboth\tneed\ta\thost\tto\trun\ton.\tThis\tcan\tbe\tanything\tfrom\tyour\nlaptop,\ta\tbare\tmetal\tserver\tin\tyour\tdata\tcenter,\tall\tthe\tway\tup\tto\tan\tinstance\tthe\npublic\tcloud.\tIn\tthis\texample\twe’ll\tassume\ta\tsingle\tphysical\tserver\tthat\twe\tneed\nto\trun\t4\tbusiness\tapplications\ton.\nIn\tthe\tVM\tmodel,\tthe\tphysical\tserver\tis\tpowered\ton\tand\tthe\thypervisor\tboots\n(we’re\tskipping\tthe\tBIOS\tand\tbootloader\tcode\tetc.).\tOnce\tthe\thypervisor\tboots\tit\nlays\tclaim\tto\tall\tphysical\tresources\ton\tthe\tsystem\tsuch\tas\tCPU,\tRAM,\tstorage,\nand\tNICs.\tThe\thypervisor\tthen\tcarves\tthese\thardware\tresources\tinto\tvirtual\nversions\tthat\tlook\tsmell\tand\tfeel\texactly\tlike\tthe\treal\tthing.\tIt\tthen\tpackages\nthem\tinto\ta\tsoftware\tconstruct\tcalled\ta\tvirtual\tmachine\t(VM).\tWe\tthen\ttake\nthose\tVMs\tand\tinstall\tan\toperating\tsystem\tand\tapplication\ton\teach\tone.\tWe\tsaid\nwe\thad\ta\tsingle\tphysical\tserver\tand\tneeded\tto\trun\t4\tapplications,\tso\twe’d\tcreate4\tVMs,\tinstall\t4\toperating\tsystems,\tand\tthen\tinstall\tthe\t4\tapplications.\tWhen\tit’s\nall\tdone\tit\tlooks\ta\tbit\tlike\tFigure\t7.2.\nFigure\t7.2\nThings\tare\ta\tbit\tdifferent\tin\tthe\tcontainer\tmodel.\nWhen\tthe\tserver\tis\tpowered\ton,\tyour\tchosen\tOS\tboots.\tIn\tthe\tDocker\tworld\tthis\ncan\tbe\tLinux,\tor\ta\tmodern\tversion\tof\tWindows\tthat\thas\tsupport\tfor\tthe\tcontainer\nprimitives\tin\tits\tkernel.\tAs\tper\tthe\tVM\tmodel,\tthe\tOS\tclaims\tall\thardware\nresources.\tOn\ttop\tof\tthe\tOS\twe\tinstall\ta\tcontainer\tengine\tsuch\tas\tDocker.\tThe\ncontainer\tengine\tthen\ttakes\t\nOS\tresources\n\tsuch\tas\tthe\t\nprocess\ttree\n,\tthe\nfilesystem\n,\tand\tthe\t\nnetwork\tstack\n,\tand\tcarves\tthem\tup\tinto\tsecure\tisolated\nconstructs\tcalled\t\ncontainers\n.\tEach\tcontainer\tlooks\tsmells\tand\tfeels\tjust\tlike\ta\nreal\tOS.\tInside\tof\teach\t\ncontainer\n\twe\tcan\trun\tan\tapplication.\tLike\tbefore,\twe’re\nassuming\ta\tsingle\tphysical\tserver\twith\t4\tapplications.\tTherefore\twe’d\tcarve\tout\n4\tcontainers\tand\trun\ta\tsingle\tapplication\tinside\tof\teach\tas\tshown\tin\tFigure\t7.3.\nFigure\t7.3\nAt\ta\thigh\tlevel\twe\tcan\tsay\tthat\thypervisors\tperform\t\nhardware\tvirtualization\n\t-\nthey\tcarve\tup\tphysical\thardware\tresources\tinto\tvirtual\tversions.\tOn\tthe\totherhand,\tcontainers\tperform\t\nOS\tvirtualization\n\t-\tthey\tcarve\tup\tOS\tresources\tinto\nvirtual\tversions.\nThe\tVM\ttax\nLet’s\tbuild\ton\twhat\twe\tjust\tcovered\tand\tdrill\tinto\tone\tof\tthe\tmain\tproblems\twith\nthe\thypervisor\tmodel.\nWe\tstarted\tout\twith\tthe\tsame\tphysical\tserver\tand\trequirement\tto\trun\t4\tbusiness\napplications.\tIn\tboth\tmodels\twe\tinstalled\teither\tan\tOS\tor\ta\thypervisor\t(a\ttype\tof\nOS\tthat\tis\thighly\ttuned\tfor\tVMs).\tSo\tfar\tthe\tmodels\tare\talmost\tidentical.\tBut\tthis\nis\twhere\tthe\tsimilarities\tstop.\nThe\tVM\tmodel\tthen\tcarves\t\nlow-level\thardware\tresources\n\tinto\tVMs.\tEach\tVM\nis\ta\tsoftware\tconstruct\tcontaining\tvirtual\tCPU,\tvirtual\tRAM,\tvirtual\tdisk\tetc.\tAs\nsuch,\tevery\tVM\tneeds\tits\town\tOS\tto\tclaim,\tinitialize\tand\tmanage\tall\tof\tthose\nvirtual\tresources.\tAnd\tsadly,\tevery\tOS\tcomes\twith\tits\town\tset\tof\tbaggage\tand\noverheads.\tFor\texample,\tevery\tOS\tconsumes\ta\tslice\tof\tCPU,\ta\tslice\tof\tRAM,\ta\nslice\tof\tstorage\tetc.\tMost\tneed\ttheir\town\tlicenses\tas\twell\tas\tpeople\tand\ninfrastructure\tto\tpatch\tand\tupgrade\tthem.\tEach\tOS\talso\tpresents\ta\tsizable\tattack\nsurface.\tWe\toften\trefer\tto\tall\tof\tthis\tas\tthe\t\nOS\ttax\n,\tor\t\nVM\ttax\n\t-\tevery\tOS\tyou\ninstall\tconsumes\tresources!\nThe\tcontainer\tmodel\thas\ta\tsingle\tkernel\trunning\tin\tthe\thost\tOS.\tIt’s\tpossible\tto\nrun\ttens\tor\thundreds\tof\tcontainers\ton\ta\tsingle\thost\twith\tevery\tcontainer\tsharing\nthat\tsingle\tOS/kernel.\tThat\tmeans\ta\tsingle\tOS\tconsuming\tCPU,\tRAM,\tand\nstorage.\tA\tsingle\tOS\tthat\tneeds\tlicensing.\tA\tsingle\tOS\tthat\tneeds\tupgrading\tand\npatching.\tAnd\ta\tsingle\tOS\tkernel\tpresenting\tan\tattack\tsurface.\tAll\tin\tall,\ta\tsingle\nOS\ttax\tbill!\nThat\tmight\tnot\tseem\ta\tlot\tin\tour\texample\tof\ta\tsingle\tserver\tneeding\tto\trun\t4\nbusiness\tapplications.\tBut\twhen\twe’re\ttalking\tabout\thundreds\tor\tthousands\tof\napps\t(VM\tor\tcontainers)\tthis\tcan\tbe\tgame\tchanging.\nAnother\tthing\tto\tconsider\tis\tthat\tbecause\ta\tcontainer\tisn’t\ta\tfull-blown\tOS,\tit\nstarts\t\nmuch\tfaster\n\tthan\ta\tVM.\tRemember,\tthere’s\tno\tkernel\tinside\tof\ta\tcontainer\nthat\tneeds\tlocating,\tdecompressing,\tand\tinitializing\t-\tnot\tto\tmention\tall\tof\tthe\nhardware\tenumerating\tand\tinitializing\tassociated\twith\ta\tnormal\tkernel\tbootstrap.\nNone\tof\tthat\tis\tneeded\twhen\tstarting\ta\tcontainer!\tThe\tsingle\tshared\tkernel\tdown\nat\tthe\tOS\tlevel\tis\talready\tstarted!\tNet\tresult,\tcontainers\tcan\tstart\tin\tless\tthan\tasecond.\tThe\tonly\tthing\tthat\thas\tan\timpact\ton\tcontainer\tstart\ttime\tis\tthe\ttime\tit\ntakes\tto\tstart\tthe\tapplication\tit’s\trunning.\nThis\tall\tamounts\tto\tthe\tcontainer\tmodel\tbeing\tleaner\tand\tmore\tefficient\tthan\tthe\nVM\tmodel.\tWe\tcan\tpack\tmore\tapplications\tonto\tless\tresources,\tstart\tthem\tfaster,\nand\tpay\tless\tin\tlicensing\tand\tadmin\tcosts,\tas\twell\tas\tpresent\tless\tof\tan\tattack\nsurface\tto\tthe\tdark\tside.\tWhat’s\tnot\tto\tlike\tabout\tthat!\nWith\tthat\ttheory\tout\tof\tthe\tway,\tlet’s\thave\ta\tplay\taround\twith\tsome\tcontainers.\nRunning\tcontainers\nTo\tfollow\talong\twith\tthese\texamples\tyou’ll\tneed\ta\tworking\tDocker\thost.\tFor\nmost\tof\tthe\tcommands\tit\twon’t\tmake\ta\tdifference\tif\tit’s\tLinux\tor\tWindows.\nChecking\tthe\tDocker\tdaemon\nThe\tfirst\tthing\tI\talways\tdo\twhen\tI\tlog\ton\tto\ta\tDocker\thost\tis\tcheck\tthat\tDocker\nis\trunning.\n$\tdocker\tversion\nClient:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t\n4\n\t\n22\n:10:54\t\n2017\n\tOS/Arch:\t\t\t\t\t\tlinux/amd64\nServer:\n\tVersion:\t\t\t\t\t\t\n17\n.05.0-ce\n\tAPI\tversion:\t\t\n1\n.29\t\n(\nminimum\tversion\t\n1\n.12\n)\n\tGo\tversion:\t\t\tgo1.7.5\n\tGit\tcommit:\t\t\t89658be\n\tBuilt:\t\t\t\t\t\t\t\tThu\tMay\t\t\n4\n\t\n22\n:10:54\t\n2017\n\tOS/Arch:\t\t\t\t\t\tlinux/amd64\n\tExperimental:\t\nfalse\nAs\tlong\tas\tyou\tget\ta\tresponse\tback\tin\tthe\t\nClient\n\tand\t\nServer\n\tsections\tyou\nshould\tbe\tgood\tto\tgo.\tIf\tyou\tget\tan\terror\tcode\tin\tthe\t\nServer\n\tsection\tthere’s\ta\ngood\tchance\tthat\tthe\tdocker\tdaemon\t(server)\tisn’t\trunning,\tor\tthat\tyour\tuser\naccount\tdoesn’t\thave\tpermission\tto\taccess\tit.\nIf\tyou’re\trunning\tLinux\tand\tyour\tuser\taccount\tdoesn’t\thave\tpermission\tto\taccess\nthe\tdaemon,\tyou\tneed\tto\tmake\tsure\tit’s\ta\tmember\tof\tthe\tlocal\t\ndocker\n\tUnix\ngroup.\tIf\tit\tisn’t,\tyou\tcan\tadd\tit\twith\t\nusermod\t-aG\tdocker\t<user>\n\tand\tthen\nyou’ll\thave\tto\tlogout\tand\tlog\tback\tin\tto\tyour\tshell\tfor\tthe\tchanges\tto\ttake\teffect.If\tyour\tuser\taccount\tis\talready\ta\tmember\tof\tthe\tlocal\t\ndocker\n\tgroup\tthen\tthe\nproblem\tmight\tbe\tthat\tthe\tDocker\tdaemon\tisn’t\trunning.\tTo\tcheck\tthe\tstatus\tof\nthe\tDocker\tdaemon\trun\tone\tof\tthe\tfollowing\tcommands\tdepending\ton\tyour\nDocker\thost’s\toperating\tsystem.\n//Run\tthis\tcommand\ton\tLinux\tsystems\tnot\tusing\tSystemd\n$\tservice\tdocker\tstatus\ndocker\tstart/running,\tprocess\t29393\n//Run\tthis\tcommand\ton\tLinux\tsystems\tthat\tare\tusing\tSystemd\n$\tsystemctl\tis-active\tdocker\nactive\n//Run\tthis\tcommand\ton\tWindows\tServer\t2016\tsystems\tfrom\ta\tPowerShell\twindow\n>\tGet-Service\tdocker\nStatus\t\t\t\tName\t\t\t\t\t\tDisplayName\n------\t\t\t\t----\t\t\t\t\t\t-----------\nRunning\t\t\tDocker\t\t\t\tdocker\nAssuming\tthe\tDocker\tdaemon\tis\trunning\tyou’re\tfine\tto\tcontinue.\nStarting\ta\tsimple\tcontainer\nThe\tsimplest\tway\tto\tstart\ta\tcontainer\tis\twith\tthe\t\ndocker\tcontainer\trun\ncommand.\nThe\tcommand\tbelow\tstarts\ta\tsimple\tcontainer\tthat\twill\trun\ta\tcontainerized\nversion\tof\tUbuntu\tLinux.\n$\n\t\ndocker\n\t\ncontainer\n\t\nrun\n\t\n-\nit\n\t\nubuntu\n:\nlatest\n\t\n/\nbin\n/\nbash\nUnable\n\t\nto\n\t\nfind\n\t\nimage\n\t\n'\nubuntu\n:\nlatest\n'\n\t\nlocally\nlatest\n:\n\t\nPulling\n\t\nfrom\n\t\nlibrary\n/\nubuntu\n952132\nac251a\n:\n\t\nPull\n\t\ncomplete\n82659f8f\n1\nb76\n:\n\t\nPull\n\t\ncomplete\nc19118ca682d\n:\n\t\nPull\n\t\ncomplete\n8296858250f\ne\n:\n\t\nPull\n\t\ncomplete\n24e0251\na0e2c\n:\n\t\nPull\n\t\ncomplete\nDigest\n:\n\t\nsha256\n:\nf4691c96e6bbaa99d9\n...\ne95a60369c506dd6e6f6ab\nStatus\n:\n\t\nDownloaded\n\t\nnewer\n\t\nimage\n\t\nfor\n\t\nubuntu\n:\nlatest\nroot\n@3027\neb644874\n:\n/\n#\nA\tWindows\texample\tcould\tbe\ndocker\tcontainer\trun\t-it\tmicrosoft/powershell:nanoserver\tPowerShell.exe\nThe\tformat\tof\tthe\tcommand\tis\tessentially\t\ndocker\tcontainer\trun\t-<options>\n<image>:<tag>\t<command>\n.\nLet’s\tbreak\tthe\tcommand\tdown\ta\tbit.We\tstarted\twith\t\ndocker\tcontainer\trun\n,\tthis\tis\tthe\tstandard\tcommand\tto\tstart\ta\nnew\tcontainer.\tWe\tthen\tused\tthe\t\n-it\n\tflags\tto\tmake\tthe\tcontainer\tinteractive\tand\nattach\tit\tto\tour\tterminal.\tNext\twe\ttold\tit\tto\tuse\tthe\t\nubuntu:latest\n\tor\nmicrosoft/powershell:nanoserver\n\timage.\tFinally\twe\ttold\tit\tto\trun\tthe\tBash\nshell\tin\tthe\tLinux\texample,\tand\tthe\tPowerShell.exe\tprogram\tin\tthe\tWindows\nexample..\nWhen\twe\thit\t\nReturn\n,\tthe\tDocker\tclient\tmade\tthe\tappropriate\tAPI\tcalls\tto\tthe\nDocker\tdaemon.\tThe\tDocker\tdaemon\taccepted\tthe\tcommand\tand\tsearched\tthe\nDocker\thost’s\tlocal\tcache\tto\tsee\tif\tit\talready\thad\ta\tcopy\tof\tthe\trequested\timage.\nIn\tthis\texample\tit\tdidn’t,\tso\tit\twent\tto\tDocker\tHub\tto\tsee\tif\tit\tcould\tfind\tit\tthere.\nIt\tcould,\tso\tit\t\npulled\n\tit\tlocally\tand\tstored\tit\tin\tits\tcache.\nNote:\n\tIn\ta\tstandard\tout-of-the-box\tLinux\tinstallation,\tthe\tDocker\tdaemon\nimplements\tthe\tDocker\tRemote\tAPI\ton\ta\tlocal\tIPC/Unix\tsocket\tat\n/var/run/docker.sock\n.\tOn\tWindows\tit\tlistens\ton\ta\tnamed\tpipe\tat\nnpipe:////./pipe/docker_engine\n.\tIt’s\talso\tpossible\tto\tconfigure\tthe\nDocker\tclient\tand\tdaemon\tto\toperate\tover\tthe\tnetwork.\tThe\tdefault\tnon-\nTLS\tnetwork\tport\tfor\tDocker\tis\t2375,\tthe\tdefault\tTLS\tport\tis\t2376.\nOnce\tthe\timage\twas\tpulled,\tthe\tdaemon\tcreated\tthe\tcontainer\tand\texecuted\tthe\nspecified\tcommand\tinside\tof\tit.\nIf\tyou\tlook\tclosely\tyou’ll\tsee\tthat\tyour\tshell\tprompt\thas\tchanged\tand\tyou’re\tnow\ninside\tof\tthe\tcontainer.\tIn\tthe\texample\tabove\tthe\tshell\tprompt\thas\tchanged\tto\nroot@3027eb644874:/#\n.\tThe\tlong\tnumber\tafter\tthe\t\n@\n\tis\tthe\tfirst\t12\tcharacters\tof\nthe\tcontainer’s\tunique\tID.\nTry\texecuting\tsome\tbasic\tcommands\tfrom\tinside\tof\tthe\tcontainer.\tYou\tmight\nnotice\tthat\tsome\tcommands\tdo\tnot\twork.\tThis\tis\tbecause\tthe\timages\twe\tused,\nlike\talmost\tall\tcontainer\timages,\tare\thighly\toptimized\tfor\tcontainers.\tThis\tmeans\nthey\tdon’t\thave\tall\tof\tthe\tnormal\tcommands\tand\tpackages\tinstalled.\tThe\nexample\tbelow\tshows\ta\tcouple\tof\tcommands\t-\tone\tsucceeds\tand\tthe\tother\tone\nfails.\nroot\n@3027\neb644874\n:\n/\n#\n\t\nls\n\t\n-\nl\ntotal\n\t\n64\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nbin\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nApr\n\t\n12\n\t\n20\n:\n14\n\t\nboot\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n5\n\t\nroot\n\t\nroot\n\t\t\n380\n\t\nSep\n\t\n13\n\t\n00\n:\n47\n\t\ndev\ndrwxr\n-\nxr\n-\nx\n\t\t\n45\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nSep\n\t\n13\n\t\n00\n:\n47\n\t\netcdrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nApr\n\t\n12\n\t\n20\n:\n14\n\t\nhome\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n8\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nSep\n\t\n13\n\t\t\n2015\n\t\nlib\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nlib64\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nmedia\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nmnt\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nopt\ndr\n-\nxr\n-\nxr\n-\nx\n\t\n129\n\t\nroot\n\t\nroot\n\t\t\t\t\n0\n\t\nSep\n\t\n13\n\t\n00\n:\n47\n\t\nproc\ndrwx\n------\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nroot\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n6\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n26\n\t\n18\n:\n50\n\t\nrun\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n26\n\t\n18\n:\n50\n\t\nsbin\ndrwxr\n-\nxr\n-\nx\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\nsrv\ndr\n-\nxr\n-\nxr\n-\nx\n\t\t\n13\n\t\nroot\n\t\nroot\n\t\t\t\t\n0\n\t\nSep\n\t\n13\n\t\n00\n:\n47\n\t\nsys\ndrwxrwxrwt\n\t\t\t\n2\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n19\n\t\n00\n:\n50\n\t\ntmp\ndrwxr\n-\nxr\n-\nx\n\t\t\n11\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n26\n\t\n18\n:\n50\n\t\nusr\ndrwxr\n-\nxr\n-\nx\n\t\t\n13\n\t\nroot\n\t\nroot\n\t\n4096\n\t\nAug\n\t\n26\n\t\n18\n:\n50\n\t\nvar\nroot\n@3027\neb644874\n:\n/\n#\nroot\n@3027\neb644874\n:\n/\n#\nroot\n@3027\neb644874\n:\n/\n#\n\t\nping\n\t\nwww\n.\ndocker\n.\ncom\nbash\n:\n\t\nping\n:\n\t\ncommand\n\t\nnot\n\t\nfound\nroot\n@3027\neb644874\n:\n/\n#\nAs\tshown\tin\tthe\toutput\tabove,\tthe\t\nping\n\tutility\tis\tnot\tincluded\tas\tpart\tof\tthe\nofficial\tUbuntu\timage.\nContainer\tprocesses\nWhen\twe\tstarted\tthe\tUbuntu\tcontainer\tin\tthe\tprevious\tsection\twe\ttold\tit\tto\trun\nthe\tBash\tshell\t(\n/bin/bash\n).\tThis\tmakes\tthe\tBash\tshell\tthe\t\none\tand\tonly\tprocess\nrunning\tinside\tof\tthe\tcontainer\n.\tYou\tcan\tsee\tthis\tby\trunning\t\nps\t-elf\n\tfrom\ninside\tthe\tcontainer.\nroot\n@3027\neb644874\n:\n/\n#\n\t\nps\n\t\n-\nelf\nF\n\t\nS\n\t\nUID\n\t\t\t\nPID\n\t\t\nPPID\n\t\t\t\nNI\n\t\nADDR\n\t\nSZ\n\t\nWCHAN\n\t\t\nSTIME\n\t\nTTY\n\t\t\t\t\t\nTIME\n\t\t\t\t\t\t\nCMD\n4\n\t\nS\n\t\nroot\n\t\t\t\t\n1\n\t\t\t\t\t\n0\n\t\t\t\t\n0\n\t\n-\n\t\t\n4558\n\t\nwait\n\t\t\t\n00\n:\n47\n\t\n?\n\t\t\t\t\t\n00\n:\n00\n:\n00\n\t\t\n/\nbin\n/\nbash\n0\n\t\nR\n\t\nroot\n\t\t\t\n11\n\t\t\t\t\t\n1\n\t\t\t\t\n0\n\t\n-\n\t\t\n8604\n\t\n-\n\t\t\t\t\t\t\n00\n:\n52\n\t\n?\n\t\t\t\t\t\n00\n:\n00\n:\n00\n\t\t\nps\n\t\n-\nelf\nAlthough\tit\tmight\tlook\tlike\tthere\tare\ttwo\tprocesses\trunning\tin\tthe\toutput\tabove,\nthere\taren’t.\tThe\tfirst\tprocess\tin\tthe\tlist,\twith\tPID\t1,\tis\tthe\tBash\tshell\twe\ttold\tthe\ncontainer\tto\trun.\tThe\tsecond\tprocess\tin\tthe\tlist\tis\tthe\t\nps\t-elf\n\tcommand\twe\tran\nto\tproduce\tthe\tlist.\tThis\tis\ta\tshort-lived\tprocess\tthat\thas\talready\texited\tby\tthe\ntime\tthe\toutput\tis\tdisplayed\ton\tthe\tterminal.\tLong\tstory\tshort,\tthis\tcontainer\tis\nrunning\ta\tsingle\tprocess\t-\t\n/bin/bash\n.\nNote:\n\tWindows\tcontainers\tare\tslightly\tdifferent\tand\ttend\tto\trun\tquite\ta\tfew\nprocesses.\nThis\tmeans\tthat\tif\tyou\ttype\t\nexit\n\tto\texit\tthe\tBash\tshell,\tthe\tcontainer\twill\talso\nexit\t(terminate).\tThe\treason\tfor\tthis\tis\tthat\ta\tcontainer\tcannot\texist\twithout\tarunning\tprocess\t-\tkilling\tthe\tBash\tshell\twould\tkill\tthe\tcontainer’s\tonly\tprocess,\nresulting\tin\tthe\tcontainer\talso\tbeing\tkilled.\t\nThis\tis\talso\ttrue\tof\tWindows\ncontainers\t-\tkilling\tthe\tmain\tprocess\tin\tthe\tcontainer\twill\talso\tkill\tthe\tcontainer.\nPress\t\nCtrl-PQ\n\tto\texit\tthe\tcontainer\twithout\tterminating\tit.\tDoing\tthis\twill\tplace\nyou\tback\tin\tthe\tshell\tof\tyour\tDocker\thost\tand\tleave\tthe\tcontainer\trunning\tin\tthe\nbackground.\tYou\tcan\tuse\tthe\t\ndocker\tcontainer\tls\n\tcommand\tto\tview\tthe\tlist\tof\nrunning\tcontainers\ton\tyour\tsystem.\n$\tdocker\tcontainer\tls\nCNTNR\tID\t\tIMAGE\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\tCREATED\t\tSTATUS\t\t\t\tNAMES\n302\n...74\t\tubuntu:latest\t\t/bin/bash\t\t\n6\n\tmins\t\t\tUp\t6mins\t\tsick_montalcini\nIt’s\timportant\tto\tunderstand\tthat\tthis\tcontainer\tis\tstill\trunning\tand\tyou\tcan\tre-\nattach\tyour\tterminal\tto\tit\twith\tthe\t\ndocker\tcontainer\texec\n\tcommand.\n$\n\t\ndocker\n\t\ncontainer\n\t\nexec\n\t\n-\nit\n\t\n3027\neb644874\n\t\nbash\nroot\n@3027\neb644874\n:\n/\n#\nNote:\n\tYou\tcan\taddress\ta\tcontainer\tby\tits\tname\tor\tID.\t\nThe\tcommand\tto\tre-\nattach\tto\tthe\tWindows\tNano\tServer\tPowerShell\tcontainer\twould\tbe\t\ndocker\ncontainer\texec\t-it\t<container-name-or-ID>\tPowerShell.exe\n.\nAs\tyou\tcan\tsee,\tthe\tshell\tprompt\thas\tchanged\tback\tto\tthe\tcontainer.\tIf\tyou\trun\nthe\t\nps\n\tcommand\tagain\tyou\twill\tnow\tsee\t\ntwo\n\tBash\tor\tPowerShell\tprocesses.\tThis\nis\tbecause\tthe\t\ndocker\tcontainer\texec\n\tcommand\tcreated\ta\tnew\tBash\tor\nPowerShell\tprocess\tand\tattached\tto\tthat.\tThis\tmeans\tthat\ttyping\t\nexit\n\tfrom\tthis\nshell\twill\tnot\tterminate\tthe\tcontainer\tbecause\tthe\toriginal\tBash\tor\tPowerShell\nprocess\twill\tcontinue\trunning.\tThe\tsame\tworks\tfor\tthe\tWindows\tPowerShell\ncontainer.\nType\t\nexit\n\tto\tleave\tthe\tcontainer\tand\tverify\tit’s\tstill\trunning\twith\ta\t\ndocker\ncontainer\tps\n.\tIt\tis\tstill\trunning.\nIf\tyou\tare\tfollowing\talong\twith\tthe\texamples\ton\tyour\town\tDocker\thost\tyou\nshould\tstop\tand\tdelete\tthe\tcontainer\twith\tthe\tfollowing\ttwo\tcommands\t(you\twill\nneed\tto\tsubstitute\tthe\tID\tof\tyour\tcontainer).\n$\tdocker\tcontainer\tstop\t3027eb64487\n3027eb64487\n$\tdocker\tcontainer\trm\t3027eb64487\n3027eb64487The\tcontainer(s)\tstarted\tin\tthe\tprevious\texamples\twill\tno\tlonger\tbe\tpresent\ton\nyour\tsystem.\nContainer\tlifecycle\nIt’s\ta\tcommon\tmyth\tthat\tcontainers\tcan’t\tpersist\tdata.\tThey\tcan!\nA\tbig\tpart\tof\tthe\treason\tpeople\tthink\tcontainers\taren’t\tgood\tfor\tpersistent\nworkloads,\tor\tpersisting\tdata,\tis\tbecause\tthey’re\tso\tgood\tat\tnon-persistent\tstuff.\nBut\tbeing\tgood\tat\tone\tthing\tdoesn’t\tmean\tyou\tcan’t\tdo\tother\tthings.\tA\tlot\tof\tVM\nadmins\tout\tthere\twill\tremember\tcompanies\tlike\tMicrosoft\tand\tOracle\ttelling\tyou\nthat\tyou\tcouldn’t\trun\ttheir\tapplications\tinside\tof\tVMs\t-\tor\tat\tleast\tthey\twouldn’t\nsupport\tyou\tif\tyou\tdid.\tI\twonder\tif\twe’re\tseeing\tsomething\tsimilar\twith\tthe\nmove\tto\tcontainerization\t-\tare\tthere\tpeople\tout\tthere\ttrying\tto\tprotect\ttheir\nempires\tof\tpersistent\tworkloads\tfrom\twhat\tthey\tperceive\tas\tthe\tthreat\tof\ncontainers?\nIn\tthis\tsection\twe’ll\tlook\tat\tthe\tlifecycle\tof\ta\tcontainer\t-\tfrom\tbirth,\tthrough\nwork\tand\tvacations,\tto\teventual\tdeath.\nWe’ve\talready\tseen\thow\tto\tstart\tcontainers\twith\tthe\t\ndocker\tcontainer\trun\ncommand.\tLet’s\tstart\tanother\tone\tso\twe\tcan\twalk\tit\tthrough\tits\tentire\tlifecycle.\nThe\texamples\tbelow\twill\tbe\tfrom\ta\tLinux\tDocker\thost\trunning\tan\tUbuntu\ncontainer.\tHowever,\tall\tof\tthe\texamples\twill\twork\twith\tthe\tWindows\tPowerShell\ncontainer\twe’ve\tused\tin\tprevious\texamples\t-\tthough\tyou’ll\thave\tto\tsubstitute\nLinux\tcommands\twith\ttheir\tequivalent\tWindows\tcommands.\n$\n\t\ndocker\n\t\ncontainer\n\t\nrun\n\t\n--\nname\n\t\npercy\n\t\n-\nit\n\t\nubuntu\n:\nlatest\n\t\n/\nbin\n/\nbash\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\nThat’s\tour\tcontainer\tcreated,\tand\twe\tnamed\tit\t“percy”\tfor\tpersistent\t:-S\nNow\tlet’s\tput\tit\tto\twork\tby\twriting\tsome\tdata\tto\tit.\nFrom\twithin\tthe\tshell\tof\tyour\tnew\tcontainer,\tfollow\tthe\tprocedure\tbelow\tto\twrite\nsome\tdata\tto\ta\tnew\tfile\tin\tthe\t\ntmp\n\tdirectory\tand\tverify\tthat\tthe\twrite\toperation\nsucceeded.\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\n\t\ncd\n\t\ntmp\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\n\t\nls\n\t\n-\nl\ntotal\n\t\n0\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#root\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\n\t\necho\n\t\n\"DevOps\tFTW\"\n\t\n>\n\t\nnewfile\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\n\t\nls\n\t\n-\nl\ntotal\n\t\n4\n-\nrw\n-\nr\n--\nr\n--\n\t\n1\n\t\nroot\n\t\nroot\n\t\n14\n\t\nMay\n\t\n23\n\t\n11\n:\n22\n\t\nnewfile\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\nroot\n@9\ncb2d2fd1d65\n:\n/\ntmp\n#\n\t\ncat\n\t\nnewfile\nDevOps\n\t\nFTW\nPress\t\nCtrl-PQ\n\tto\texit\tthe\tcontainer\twithout\tkilling\tit.\nNow\tuse\tthe\t\ndocker\tcontainer\tstop\n\tcommand\tto\tstop\tthe\tcontainer\tand\tput\tin\non\t\nvacation\n.\n$\tdocker\tcontainer\tstop\tpercy\npercy\nYou\tcan\tuse\tthe\tcontainer’s\tname\tor\tID\twith\tthe\t\ndocker\tcontainer\tstop\ncommand.\tThe\tformat\tis\t\ndocker\tcontainer\tstop\t<container-id\tor\ncontainer-name>\n.\nNow\trun\ta\t\ndocker\tcontainer\tls\n\tcommand\tto\tlist\tall\trunning\tcontainers.\n$\tdocker\tcontainer\tls\nCONTAINER\tID\t\t\tIMAGE\t\t\tCOMMAND\t\t\tCREATED\t\tSTATUS\t\tPORTS\t\t\tNAMES\nThe\tcontainer\tis\tnot\tlisted\tin\tthe\toutput\tabove\tbecause\tyou\tput\tit\tin\tthe\tstopped\nstate\twith\tthe\t\ndocker\tcontainer\tstop\n\tcommand.\tRun\tthe\tsame\tcommand\nagain,\tonly\tthis\ttime\tadd\tthe\t\n-a\n\tflag\tto\tshow\tall\tcontainers\tincluding\tthose\tthat\nare\tstopped.\n$\tdocker\tcontainer\tls\t-a\nCNTNR\tID\t\tIMAGE\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\tCREATED\t\tSTATUS\t\t\t\t\t\tNAMES\n9cb...65\t\tubuntu:latest\t\t/bin/bash\t\t\n4\n\tmins\t\t\tExited\t\n(\n0\n)\n\t\tpercy\nNow\twe\tcan\tsee\tthe\tcontainer\tshowing\tas\t\nExited\t(0)\n.\tStopping\ta\tcontainer\tis\nlike\tstopping\ta\tvirtual\tmachine.\tAlthough\tit’s\tnot\tcurrently\trunning,\tits\tentire\nconfiguration\tand\tcontents\tstill\texist\ton\tthe\tfilesystem\tof\tthe\tDocker\thost\tand\tit\ncan\tbe\trestarted\tat\tany\ttime.\nLet’s\tuse\tthe\t\ndocker\tcontainer\tstart\n\tcommand\tto\tbring\tit\tback\tfrom\tvacation.\n$\tdocker\tcontainer\tstart\tpercy\npercy\n$\n$\tdocker\tcontainer\tls\nCONTAINER\tID\t\tIMAGE\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\t\t\tCREATED\t\tSTATUS\t\t\t\t\tNAMES\n9cb2d2fd1d65\t\tubuntu:latest\t\t\n\"/bin/bash\"\n\t\t\n4\n\tmins\t\t\tUp\t\n3\n\tsecs\t\tpercyThe\tstopped\tcontainer\tis\tnow\trestarted.\tTime\tto\tverify\tthat\tthe\tfile\twe\tcreated\nearlier\tstill\texists.\tConnect\tto\tthe\trestarted\tcontainer\twith\tthe\t\ndocker\tcontainer\nexec\n\tcommand.\n$\n\t\ndocker\n\t\ncontainer\n\t\nexec\n\t\n-\nit\n\t\npercy\n\t\nbash\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\nYour\tshell\tprompt\twill\tchange\tto\tshow\tthat\tyou\tare\tnow\toperating\twithin\tthe\nnamespace\tof\tthe\tcontainer.\nVerify\tthat\tthe\tfile\tyou\tcreated\tearlier\tis\tstill\tthere\tand\tcontains\tthe\tdata\tyou\nwrote\tto\tit.\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\n\t\ncd\n\t\ntmp\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\n\t\nls\n\t\n-\nl\n-\nrw\n-\nr\n--\nr\n--\n\t\n1\n\t\nroot\n\t\nroot\n\t\n14\n\t\nSep\n\t\n13\n\t\n04\n:\n22\n\t\nnewfile\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\nroot\n@9\ncb2d2fd1d65\n:\n/\n#\n\t\ncat\n\t\nnewfile\nsysadmins\n\t\nFTW\nAs\tif\tby\tmagic,\tthe\tfile\tyou\tcreated\tis\tstill\tthere\tand\tthe\tdata\tit\tcontains\tis\nexactly\thow\tyou\tleft\tit!\tThis\tproves\tthat\tstopping\ta\tcontainer\tdoes\tnot\tdestroy\nthe\tcontainer\tor\tthe\tdata\tinside\tof\tit.\nWhile\tthis\texample\tillustrates\tthe\tpersistent\tnature\tof\tcontainers,\tI\tshould\tpoint\nout\tthat\t\nvolumes\n\tare\tthe\tpreferred\tway\tto\tstore\tpersistent\tdata\tin\tcontainers.\tBut\nat\tthis\tstage\tof\tour\tjourney\tI\tthink\tthis\tis\tan\teffective\texample\tof\tthe\tpersistent\nnature\tof\tcontainers.\nSo\tfar\tI\tthink\tyou’d\tbe\thard\tpressed\tto\tdraw\ta\tmajor\tdifference\tin\tthe\tbehavior\nof\ta\tcontainer\tvs\ta\tVM.\nNow\tlet’s\tkill\tthe\tcontainer\tand\tdelete\tit\tfrom\tour\tsystem.\nIt\tis\tpossible\tto\tdelete\ta\t\nrunning\n\tcontainer\twith\ta\tsingle\tcommand\tby\tpassing\tthe\n-f\n\tflag\tto\t\ndocker\tcontainer\trm\n.\tHowever,\tit’s\tconsidered\ta\tbest\tpractice\tto\ttake\nthe\ttwo-step\tapproach\tof\tstopping\tthe\tcontainer\tfirst\tand\tthen\tdeleting\tit.\tThis\ngives\tthe\tapplication/process\tthat\tthe\tcontainer\tis\trunning\ta\tfighting\tchance\tof\nstopping\tcleanly.\tMore\ton\tthis\tin\ta\tsecond.\nThe\texample\tbelow\twill\tstop\tthe\t\npercy\n\tcontainer,\tdelete\tit,\tand\tverify\tthe\noperation.\tIf\tyour\tterminal\tis\tstill\tattached\tto\tthe\tpercy\tcontainer\tyou\twill\tneed\nto\tget\tback\tto\tyour\tDocker\thost’s\tterminal\tby\tpressing\t\nCtrl-PQ\n.$\tdocker\tcontainer\tstop\tpercy\npercy\n$\n$\tdocker\tcontainer\trm\tpercy\npercy\n$\n$\tdocker\tcontainer\tls\t-a\nCONTAINER\tID\t\t\t\tIMAGE\t\t\t\t\t\tCOMMAND\t\t\t\tCREATED\t\tSTATUS\t\t\t\t\tPORTS\t\t\t\t\t\tNAMES\nThe\tcontainer\tis\tnow\tdeleted\t-\tliterally\twiped\toff\tthe\tface\tof\tthe\tplanet.\tIf\tit\twas\na\tgood\tcontainer,\tit\tbecomes\ta\tunikernel\tin\tthe\tafterlife.\tIf\tit\twas\ta\tnaughty\ncontainer,\tit\tbecomes\ta\tdumb\tterminal\t:-D\nTo\tsummarize\tthe\tlifecycle\tof\ta\tcontainer…\tYou\tcan\tstop,\tstart,\tpause,\tand\nrestart\ta\tcontainer\tas\tmany\ttimes\tas\tyou\twant.\tAnd\tit’ll\tall\thappen\treally\tfast.\nBut\tthe\tcontainer\tand\tit’s\tdata\twill\talways\tbe\tsafe.\tIt’s\tnot\tuntil\tyou\texplicitly\nkill\ta\tcontainer\tthat\tyou\trun\tany\tchance\tof\tlosing\tits\tdata.\tAnd\teven\tthen,\tif\nyou’re\tstoring\tcontainer\tdata\tin\ta\t\nvolume\n,\tthat\tdata’s\tgoing\tto\tpersist\teven\tafter\nthe\tcontainer\thas\tgone.\nLet’s\tquickly\tmention\twhy\twe\trecommended\ta\ttwo-stage\tapproach\tof\tstopping\nthe\tcontainer\tbefore\tdeleting\tit.\nStopping\tcontainers\tgracefully\nMost\tcontainers\tin\tthe\tLinux\tworld\twill\trun\ta\tsingle\tprocess.\tIn\tthe\tWindows\nworld\tthey\trun\ta\tfew\tprocesses,\tbut\tthe\tfollowing\trules\tstill\tapply.\nIn\tour\tprevious\texample\tthe\tcontainer\twas\trunning\tthe\t\n/bin/bash\n\tprogram.\nWhen\tyou\tkill\ta\trunning\tcontainer\twith\t\ndocker\tcontainer\trm\t<container>\t-f\nthe\tcontainer\twill\tbe\tkilled\twithout\twarning.\tThe\tprocedure\tis\tquite\tviolent\t-\ta\nbit\tlike\tsneaking\tup\tbehind\tthe\tcontainer\tit\tand\tshooting\tit\tin\tthe\tback\tof\tthe\nhead.\tYou’re\tliterally\tgiving\tthe\tcontainer,\tand\tthe\tprocess\tit’s\trunning,\tno\nchance\tto\tstraighten\tits\taffairs\tbefore\tbeing\tkilled.\nHowever,\tthe\t\ndocker\tcontainer\tstop\n\tcommand\tis\tfar\tmore\tpolite\t(like\npointing\ta\tgun\tto\tthe\tcontainers\thead\tand\tsaying\t“you’ve\tgot\t10\tseconds\tto\tsay\nany\tfinal\twords”).\tIt\tgives\tthe\tprocess\tinside\tof\tthe\tcontainer\ta\theads-up\tthat\tit’s\nabout\tto\tbe\tstopped,\tgiving\tit\ta\tchance\tto\tget\tthings\tin\torder\tbefore\tthe\tend\ncomes.\tOnce\tthe\t\ndocker\tstop\n\tcommand\treturns,\tyou\tcan\tthen\tdelete\tthe\ncontainer\twith\t\ndocker\t\ncontainer\trm\n.The\tmagic\tbehind\tthe\tscenes\there\tcan\tbe\texplained\twith\tLinux/POSIX\t\nsignals\n.\ndocker\tcontainer\tstop\n\tsends\ta\t\nSIGTERM\n\tsignal\tto\tthe\tprocess\twith\tPID\t1\ninside\tof\tthe\tcontainer.\tAs\twe\tjust\tsaid,\tthis\tgives\tthe\tprocess\ta\tchance\tto\tclean\nthings\tup\tand\tgracefully\tshut\titself\tdown.\tIf\tit\tdoesn’t\texit\twithin\t10\tseconds\tit\nwill\treceive\ta\t\nSIGKILL\n.\tThis\tis\teffectively\tthe\tbullet\tto\tthe\thead.\tBut\they,\tit\tgot\n10\tseconds\tto\tsort\titself\tout\tfirst!\ndocker\tcontainer\trm\t<container>\t-f\n\tdoesn’t\tbother\tasking\tnicely\twith\ta\nSIGTERM\n,\tit\tjust\tgoes\tstraight\tto\tthe\t\nSIGKILL\n.\tLike\twe\tsaid\ta\tsecond\tago,\nthis\tis\tlike\tcreeping\tup\tfrom\tbehind\tand\tsmashing\tit\tover\tthe\thead.\tI’m\tnot\ta\nviolent\tperson\tby\tthe\tway!\nWeb\tserver\texample\nSo\tfar\twe’ve\tseen\thow\tto\tstart\ta\tsimple\tcontainer\tand\tinteract\twith\tit.\tWe’ve\talso\nseen\thow\tto\tstop,\trestart\tand\tdestroy\tcontainers.\tNow\tlet’s\ttake\ta\tlook\tat\ta\tLinux\nweb\tserver\texample.\nIn\tthis\texample\twe’ll\tstart\ta\tnew\tcontainer\tfrom\tan\timage\tI\tuse\tin\ta\tfew\tof\tmy\nPluralsight\tvideo\tcourses\n.\tThe\timage\truns\tan\tinsanely\tsimple\tweb\tserver\ton\tport\n8080.\nUse\tthe\t\ndocker\tcontainer\tstop\n\tand\t\ndocker\tcontainer\trm\n\tcommands\tto\tclean\nup\tany\texisting\tcontainers\ton\tyour\tsystem.\tThen\trun\tthe\tfollowing\t\ndocker\ncontainer\trun\n\tcommand.\n$\tdocker\tcontainer\trun\t-d\t--name\twebserver\t-p\t\n80\n:8080\t\n\\\n\t\tnigelpoulton/pluralsight-docker-ci\nUnable\tto\tfind\timage\t\n'nigelpoulton/pluralsight-docker-ci:latest'\n\tlocally\nlatest:\tPulling\tfrom\tnigelpoulton/pluralsight-docker-ci\na3ed95caeb02:\tPull\t\ncomplete\n3b231ed5aa2f:\tPull\t\ncomplete\n7e4f9cd54d46:\tPull\t\ncomplete\n929432235e51:\tPull\t\ncomplete\n6899ef41c594:\tPull\t\ncomplete\n0b38fccd0dab:\tPull\t\ncomplete\nDigest:\tsha256:7a6b0125fe7893e70dc63b2...9b12a28e2c38bd8d3d\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\tnigelpoulton/plur...docker-ci:latest\n6efa1838cd51b92a4817e0e7483d103bf72a7ba7ffb5855080128d85043fef21\nNotice\tthat\tyour\tshell\tprompt\thasn’t\tchanged.\tThis\tis\tbecause\twe\tstarted\tthis\ncontainer\tin\tthe\tbackground\twith\tthe\t\n-d\n\tflag.\tStarting\ta\tcontainer\tin\tthe\nbackground\tdoes\tnot\tattach\tit\tto\tyour\tterminal.This\texample\tthrew\ta\tfew\tmore\targuments\tat\tthe\t\ndocker\tcontainer\trun\ncommand,\tso\tlet’s\ttake\ta\tquick\tlook\tat\tthem.\nWe\tknow\t\ndocker\tcontainer\trun\n\tstarts\ta\tnew\tcontainer.\tBut\tthis\ttime\twe\tgive\tit\nthe\t\n-d\n\tflag\tinstead\tof\t\n-it\n.\t\n-d\n\ttells\tthe\tcontainer\tto\trun\tin\tthe\tbackground\trather\nthan\tattaching\tto\tyour\tterminal\tin\tthe\tforeground.\tThe\t“d”\tstands\tfor\t\nd\naemon\nmode,\tand\t\n-d\n\tand\t\n-it\n\tare\tmutually\texclusive.\tThis\tmeans\tyou\tcan’t\tuse\tboth\ton\nthe\tsame\tcontainer.\nAfter\tthat,\twe\tname\tthe\tcontainer\tand\tthen\tgive\tit\t\n-p\t80:8080\n.\tThe\t\n-p\n\tflag\tmaps\nports\ton\tthe\tDocker\thost\tto\tports\tinside\tthe\tcontainer.\tThis\ttime\twe’re\tmapping\nport\t80\ton\tthe\tDocker\thost\tto\tport\t8080\tinside\tthe\tcontainer.\tThis\tmeans\tthat\ntraffic\thitting\tthe\tDocker\thost\ton\tport\t80\twill\tbe\tdirected\tto\tport\t8080\tinside\tof\nthe\tcontainer.\tIt\tjust\tso\thappens\tthat\tthe\timage\twe’re\tusing\tfor\tthis\tcontainer\ndefines\ta\tweb\tservice\tthat\tlistens\ton\tport\t8080.\tThis\tmeans\tour\tcontainer\twill\ncome\tup\trunning\ta\tweb\tserver\tlistening\ton\tport\t8080.\nFinally\twe\ttell\tit\twhich\timage\tto\tuse:\t\nnigelpoulton/pluralsight-docker-ci\n.\nThis\timage\tis\tnot\tkept\tup-to-date\tand\twill\tcontain\tsecurity\tvulnerabilities!\nRunning\ta\t\ndocker\tcontainer\tls\n\tcommand\twill\tshow\tthe\tcontainer\tas\trunning\nand\tshow\tthe\tports\tthat\tare\tmapped.\tIt’s\timportant\tto\tknow\tthat\tport\tmappings\nare\texpressed\tas\t\nhost-port:container-port\n.\n$\tdocker\tcontainer\tls\nCONTAINER\tID\t\tCOMMAND\t\t\t\t\t\t\t\tSTATUS\t\t\t\t\t\t\tPORTS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNAMES\n6efa1838cd51\t\t/bin/sh\t-c...\t\tUp\t\n2\n\tmins\t\t\n0\n.0.0.0:80->8080/tcp\t\twebserver\nNote:\n\tWe’ve\tremoved\tsome\tof\tthe\tcolumns\tfrom\tthe\toutput\tabove\tto\thelp\nwith\treadability.\nNow\tthat\tthe\tcontainer\tis\trunning\tand\tports\tare\tmapped,\twe\tcan\tconnect\tto\tthe\ncontainer\tby\tpointing\ta\tweb\tbrowser\tat\tthe\tIP\taddress\tor\tDNS\tname\tof\tthe\nDocker\thost\n\ton\tport\t80.\tFigure\t7.4\tshows\tthe\tweb\tpage\tthat\tis\tbeing\tserved\tup\nby\tthe\tcontainer.Figure\t7.4\nThe\tsame\t\ndocker\tcontainer\tstop\n,\t\ndocker\tcontainer\tpause\n,\t\ndocker\ncontainer\tstart\n,\tand\t\ndocker\tcontainer\trm\n\tcommands\tcan\tbe\tused\ton\tthe\ncontainer.\tAlso,\tthe\tsame\trules\tof\tpersistence\tapply\t-\tstopping\tor\tpausing\tthe\ncontainer\tdoes\tnot\tdestroy\tthe\tcontainer\tor\tany\tdata\tstored\tin\tit.\nInspecting\tcontainers\nIn\tthe\tprevious\texample\tyou\tmight\thave\tnoticed\tthat\twe\tdidn’t\tspecify\ta\nprogram\tfor\tthe\tcontainer\twhen\twe\tissued\tthe\t\ndocker\tcontainer\trun\ncommand.\tYet\tthe\tcontainer\tran\ta\tsimple\tweb\tservice.\tHow\tdid\tthis\thappen?\nWhen\tbuilding\ta\tDocker\timage\tit’s\tpossible\tto\tembed\ta\tdefault\tcommand\tor\nprogram\tyou\twant\tcontainers\tusing\tthe\timage\tto\trun.\tIf\twe\trun\ta\t\ndocker\timage\ninspect\n\tcommand\tagainst\tthe\timage\twe\tused\tto\trun\tour\tcontainer,\twe’ll\tbe\table\nto\tsee\tthe\tcommand/program\tthat\tthe\tcontainer\twill\trun\twhen\tit\tstarts.\n$\tdocker\timage\tinspect\tnigelpoulton/pluralsight-docker-ci\n[\n\t\t\t\t\n{\n\t\t\t\t\t\t\t\t\n\"Id\"\n:\t\n\"sha256:07e574331ce3768f30305519...49214bf3020ee69bba1\"\n,\n\t\t\t\t\t\t\t\t\n\"RepoTags\"\n:\t\n[\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"nigelpoulton/pluralsight-docker-ci:latest\"\n\t\t\t\t\t\t\t\t\t\t\t\t<Snip>\n\t\t\t\t\t\t\t\t\t\t\t\t\n]\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Cmd\"\n:\t\n[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"/bin/sh\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"-c\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"#(nop)\tCMD\t[\\\"/bin/sh\\\"\t\\\"-c\\\"\t\\\"cd\t/src\t\\u0026\\u0026\tnode\t\\\n./app.js\\\"]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\n]\n,\n<Snip>We’ve\tsnipped\tthe\toutput\tto\tmake\tis\teasier\tto\tfind\tthe\tinformation\twe’re\ninterested\tin.\nThe\tentries\tafter\t“Cmd”\tshow\tthe\tcommand(s)\tthat\tthe\tcontainer\twill\trun\tunless\nyou\toverride\tthe\twith\ta\tdifferent\tcommand\tas\tpart\tof\t\ndocker\tcontainer\trun\n.\tIf\nyou\tremove\tall\tof\tthe\tshell\tescapes\tin\tthe\texample\tabove,\tyou\tget\tthe\tfollowing\ncommand\t\n/bin/sh\t-c\t\"cd\t/src\t&&\tnode\t./app.js\"\n.\t\nThat’s\tthe\tdefault\ncommand\ta\tcontainer\tbased\ton\tthis\timage\twill\trun.\nIt’s\tcommon\tto\tbuild\timages\twith\tdefault\tcommands\tlike\tthis\tas\tit\tmakes\tstarting\ncontainers\teasier.\tIt\talso\tforces\ta\tdefault\tbehavior\tand\tis\ta\tform\tof\tself\ndocumentation\tfor\tthe\timage\t-\ti.e.\twe\tcan\t\ninspect\n\tthe\timage\tand\tknow\twhat\tit’s\nintended\tto\tdo.\nThat’s\tus\tdone\tfor\tthe\texamples\tin\tthis\tchapter.\tLet’s\tsee\ta\tquick\tway\tto\ttidy\tour\nsystem\tup.\nTidying\tup\nHere\twe’re\tgoing\tto\tshow\tyou\tthe\tsimplest\tand\tquickest\tway\tto\tget\trid\tof\t\nevery\nrunning\tcontainer\n\ton\tyour\tDocker\thost.\tBe\twarned\tthough,\tthe\tprocedure\twill\nforcible\tdestroy\t\nall\n\tcontainers\twithout\tgiving\tthem\ta\tchance\tto\tclean\tup.\t\nThis\nshould\tnever\tbe\tperformed\ton\tproduction\tsystems\tor\tsystems\trunning\nimportant\tcontainers.\nRun\tthe\tfollowing\tcommand\tfrom\tthe\tshell\tof\tyour\tDocker\thost\tto\tdelete\tall\ncontainers.\n$\tdocker\tcontainer\trm\t\n$(\ndocker\tcontainer\tls\t-aq\n)\n\t-f\n6efa1838cd51\nIn\tthis\texample\twe\tonly\thad\ta\tsingle\tcontainer\trunning,\tso\tonly\tone\twas\tdeleted\n(6efa1838cd51).\tHowever,\tthe\tcommand\tworks\tthe\tsame\tway\tas\tthe\t\ndocker\nimage\trm\t$(docker\timage\tls\t-q)\n\tcommand\twe\tused\tin\tthe\tprevious\tchapter\tto\ndelete\tall\timages\ton\ta\tsingle\tDocker\thost.\tWe\talready\tknow\tthe\t\ndocker\ncontainer\trm\n\tcommand\tdeletes\tcontainers.\tPassing\tit\t\n$(docker\tcontainer\tls\n-aq)\n\tas\tan\targument\teffectively\tpasses\tit\tthe\tID\tof\tevery\tcontainer\ton\tthe\nsystem.\tThe\t\n-f\n\tflag\tforces\tthe\toperation\tso\tthat\trunning\tcontainers\twill\talso\tbe\ndestroyed.\tNet\tresult…\tall\tcontainers,\trunning\tor\tstopped,\twill\tbe\tdestroyed\tand\nremoved\tfrom\tthe\tsystem.The\tabove\tcommand\twill\twork\tin\ta\tPowerShell\tterminal\ton\ta\tWindows\tDocker\nhost.Containers\t-\tThe\tcommands\ndocker\tcontainer\trun\n\tis\tthe\tcommand\tused\tto\tstart\tnew\tcontainers.\tIn\tits\nsimplest\tform\tit\taccepts\tan\t\nimage\n\tand\ta\t\ncommand\n\tas\targuments.\tThe\timage\nis\tused\tto\tcreate\tthe\tcontainer\tand\tthe\tcommand\tis\tthe\tprocess\tor\napplication\tyou\twant\tthe\tcontainer\tto\trun.\tThis\texample\twill\tstart\tan\nUbuntu\tcontainer\tin\tthe\tforeground\tand\trunning\tthe\tBash\tshell:\t\ndocker\ncontainer\trun\t-it\tubuntu\t/bin/bash\n.\nCtrl-PQ\n\twill\tdetach\tyour\tshell\tfrom\tthe\tterminal\tof\ta\tcontainer\tand\tleave\nthe\tcontainer\trunning\t\n(UP)\n\tin\tthe\tbackground.\ndocker\tcontainer\tls\n\tlists\tall\tcontainers\tin\tthe\trunning\t\n(UP)\n\tstate.\tIf\tyou\nadd\tthe\t\n-a\n\tflag\tyou\twill\talso\tsee\tcontainers\tin\tthe\tstopped\t\n(Exited)\n\tstate.\ndocker\tcontainer\texec\n\tlets\tyou\trun\ta\tnew\tprocess\tinside\tof\ta\trunning\ncontainer.\tIt’s\tuseful\tfor\tattaching\tthe\tshell\tof\tyour\tDocker\thost\tto\ta\nterminal\tinside\tof\ta\trunning\tcontainer.\tThis\tcommand\twill\tstart\ta\tnew\tBash\nshell\tinside\tof\ta\trunning\tcontainer\tand\tconnect\tto\tit:\t\ndocker\tcontainer\nexec\t-it\t<container-name\tor\tcontainer-id>\tbash\n.\tFor\tthis\tto\twork,\nthe\timage\tused\tto\tcreate\tyour\tcontainer\tmust\tcontain\tthe\tBash\tshell.\ndocker\tcontainer\tstop\n\twill\tstop\ta\trunning\tcontainer\tand\tput\tit\tin\tthe\n(Exited\t(0))\n\tstate.\tIt\tdoes\tthis\tby\tissuing\ta\t\nSIGTERM\n\tto\tthe\tprocess\twith\nPID\t1\tinside\tof\tthe\tcontainer.\tIf\tthe\tprocess\thas\tnot\tcleaned\tup\tand\tstopped\nwithin\t10\tseconds,\ta\tSIGKILL\twill\tbe\tissued\tto\tforcibly\tstop\tthe\tcontainer.\ndocker\tcontainer\tstop\n\taccepts\tcontainer\tIDs\tand\tcontainer\tnames\tas\narguments.\ndocker\tcontainer\tstart\n\twill\trestart\ta\tstopped\t\n(Exited)\n\tcontainer.\tYou\ncan\tgive\t\ndocker\tcontainer\tstart\n\tthe\tname\tor\tID\tof\ta\tcontainer.\ndocker\tcontainer\trm\n\twill\tdelete\ta\tstopped\tcontainer.\tYou\tcan\tspecify\ncontainers\tby\tname\tor\tID.\tIt\tis\trecommended\tthat\tyou\tstop\ta\tcontainer\twith\nthe\t\ndocker\tcontainer\tstop\n\tcommand\tbefore\tdeleting\tit\twith\t\ndocker\trm\n.\ndocker\tcontainer\tinspect\n\twill\tshow\tyou\tdetailed\tconfiguration\tand\nruntime\tinformation\tabout\ta\tcontainer.\tIt\taccepts\tcontainer\tnames\tand\ncontainer\tIDs\tas\tits\tmain\targument.Chapter\tsummary\nIn\tthis\tchapter\twe\tcompared\tand\tcontrasted\tthe\tcontainer\tand\tVM\tmodels.\tWe\nlooked\tat\tthe\t\nOS\ttax\n\tproblem\tof\tthe\tVM\tmodel\tand\tsaw\thow\tthe\tcontainer\nmodel\tcan\tbring\thuge\tefficiencies\tin\tmuch\tthe\tsame\tway\tas\tthe\tVM\tmodel\nbrought\thuge\tadvantages\tover\tthe\tphysical\tmodel.\nWe\tsaw\thow\tto\tuse\tthe\t\ndocker\tcontainer\trun\n\tcommand\tto\tstart\ta\tcouple\tof\nsimple\tcontainers,\tand\twe\tsaw\tthe\tdifference\tbetween\tinteractive\tcontainers\tin\nthe\tforeground\tversus\tcontainers\trunning\tin\tthe\tbackground.\nWe\tknow\tthat\tkilling\tthe\tprocess\twith\tPID\t1\tinside\tof\ta\tcontainer\twill\tkill\tthe\ncontainer.\tAnd\twe’ve\tseen\thow\tto\tstart,\tstop,\tand\tdelete\tcontainers.\nWe\tfinished\tthe\tchapter\tusing\tthe\t\ndocker\tcontainer\tinspect\n\tcommand\tto\nview\tdetailed\tconfiguration\tmetadata.\nSo\tfar\tso\tgood!\nIn\tthe\tnext\tchapter\twe’ll\tsee\thow\tto\torchestrate\tcontainerized\tapplications\tacross\nmultiple\tDocker\thosts\twith\tsome\tgame\tchanging\ttechnologies\tintroduced\tin\nDocker\t1.12.8:\tContainerizing\tan\tApp\nDocker\tis\tall\tabout\ttaking\tapplications\tand\trunning\tthem\tin\tcontainers.\nThe\tprocess\tof\ttaking\tan\tapplication\tand\tconfiguring\tit\tto\trun\tas\ta\tcontainer\tis\ncalled\t“containerizing”.\tSometimes\twe\tcall\tit\t“Dockerizing”.\nIn\tthis\tchapter\twe’ll\twalk\tthrough\tthe\tprocess\tof\tcontainerizing\ta\tsimple\tweb\napplication.\nWe’ll\tsplit\tthis\tchapter\tinto\tthe\tusual\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nLet’s\tgo\tcontainerize\tan\tapp!Containerizing\tan\tApp\t-\tThe\tTLDR\nContainers\tare\tall\tabout\tapps!\tIn\tparticular,\tthey’re\tabout\tmaking\tapps\tsimple\tto\nbuild\n,\t\nship\n,\tand\t\nrun\n.\nThe\tprocess\tof\tcontainerizing\tan\tapp\tlooks\tlike\tthis:\n1\n.\t\nStart\twith\tyour\tapplication\tcode.\n2\n.\t\nCreate\ta\t\nDockerfile\n\tthat\tdescribes\tyour\tapp,\tits\tdependencies,\tand\thow\tto\nrun\tit.\n3\n.\t\nFeed\tthis\t\nDockerfile\n\tinto\tthe\t\ndocker\timage\tbuild\n\tcommand.\n4\n.\t\nSit\tback\twhile\tDocker\tbuilds\tyour\tapplication\tinto\ta\tDocker\timage.\nOnce\tyour\tapp\tis\tcontainerized\t(made\tinto\ta\tDocker\timage),\tyou’re\tready\tto\tship\nit\tand\trun\tit\tas\ta\tcontainer.\nFigure\t8.1\tshows\tthe\tprocess\tof\tbuilding,\tshipping,\tand\trunning\tan\tapp\n(apologies\tfor\tthe\tcolours\ton\tthe\tdiagram).\nFigure\t8.1Containerizing\tan\tApp\t-\tThe\tdeep\tdive\nThe\trest\tof\tthis\tchapter\twill\twalk\tyou\tthrough\tthe\tprocess\tof\tcontainerizing\ta\nsimple\tLinux-based\tNode.js\tweb\tapp.\tThe\tprocess\tis\tthe\tsame\tfor\tWindows,\tand\nfuture\teditions\tof\tthe\tbook\twill\tinclude\ta\tWindows\texample.\nWe’ll\tcomplete\tthe\tfollowing\thigh-level\tsteps:\t-\tGet\tthe\tapp\tcode\t-\tInspect\tthe\nDockerfile\t-\tContainerize\tthe\tapp\t-\tRun\tthe\tapp\t-\tTest\tthe\tapp\t-\tLook\ta\tbit\tcloser\n-\tMove\tto\tproduction\twith\t\nMulti-stage\tBuilds\nGetting\tthe\tapplication\tcode\nThe\tapplication\tused\tin\tthis\texample\tcan\tbe\tcloned\tform\tGitHub:\nhttps://github.com/nigelpoulton/psweb.git\nClone\tthe\tsample\tapp\tfrom\tGitHub.\n$\tgit\tclone\thttps://github.com/nigelpoulton/psweb.git\nCloning\tinto\t\n'psweb'\n...\nremote:\tCounting\tobjects:\t\n15\n,\t\ndone\n.\nremote:\tCompressing\tobjects:\t\n100\n%\t\n(\n11\n/11\n)\n,\t\ndone\n.\nremote:\tTotal\t\n15\n\t\n(\ndelta\t\n2\n)\n,\treused\t\n15\n\t\n(\ndelta\t\n2\n)\n,\tpack-reused\t\n0\nUnpacking\tobjects:\t\n100\n%\t\n(\n15\n/15\n)\n,\t\ndone\n.\nChecking\tconnectivity...\t\ndone\n.\nThe\tclone\toperation\tcreates\ta\tnew\tdirectory\tcalled\t\npsweb\n.\tChange\tdirectory\tinto\npsweb\n\tand\tlist\tits\tcontents.\n$\t\ncd\n\tpsweb\n$\n$\tls\t-l\ntotal\t\n28\n-rw-r--r--\t\n1\n\troot\troot\t\t\n341\n\tSep\t\n29\n\t\n16\n:26\tapp.js\n-rw-r--r--\t\n1\n\troot\troot\t\t\n216\n\tSep\t\n29\n\t\n16\n:26\tcircle.yml\n-rw-r--r--\t\n1\n\troot\troot\t\t\n338\n\tSep\t\n29\n\t\n16\n:26\tDockerfile\n-rw-r--r--\t\n1\n\troot\troot\t\t\n421\n\tSep\t\n29\n\t\n16\n:26\tpackage.json\n-rw-r--r--\t\n1\n\troot\troot\t\t\n370\n\tSep\t\n29\n\t\n16\n:26\tREADME.md\ndrwxr-xr-x\t\n2\n\troot\troot\t\n4096\n\tSep\t\n29\n\t\n16\n:26\t\ntest\ndrwxr-xr-x\t\n2\n\troot\troot\t\n4096\n\tSep\t\n29\n\t\n16\n:26\tviews\nThis\tdirectory\tcontains\tall\tof\tthe\tapplication\tsource\tcode,\tas\twell\tas\nsubdirectories\tfor\tviews\tand\tunit\ttests.\tFeel\tfree\tto\tlook\tat\tthe\tfiles\t-\tthe\tapp\tis\nextremely\tsimple.\tWe\twon’t\tbe\tusing\tthe\tunit\ttests\tin\tthis\tchapter.\nNow\tthat\twe\thave\tthe\tapp\tcode,\tlet’s\tlook\tat\tits\tDockerfile.Inspecting\tthe\tDockerfile\nNotice\tthat\tthe\trepo\thas\ta\tfile\tcalled\t\nDockerfile\n.\tThis\tis\tthe\tfile\tthat\tdescribes\nthe\tapplication\tand\ttells\tDocker\thow\tto\tbuild\tan\timage\tfrom\tit.\nThe\tdirectory\tthat\tcontains\tyour\tapplication\tcode\tis\treferred\tto\tas\tthe\t\nbuild\ncontext\n.\tIt’s\ta\tcommon\tpractice\tto\tkeep\tyour\tDockerfile\tin\tthe\troot\tdirectory\tof\nthe\t\nbuild\tcontext\n.\tIt’s\talso\timportant\tthat\t\nDockerfile\n\tstarts\twith\ta\tcapital\t“\nD\n”\tand\nis\tall\tone\tword.\t“dockerfile”\tand\t“Docker\tfile”\tare\tnot\tvalid.\nLet’s\tlook\tat\tthe\tcontents\tof\tthe\tDockerfile.\n$\tcat\tDockerfile\nFROM\talpine\nLABEL\t\nmaintainer\n=\n\"nigelpoulton@hotmail.com\"\nRUN\tapk\tadd\t--update\tnodejs\tnodejs-npm\nCOPY\t.\t/src\nWORKDIR\t/src\nRUN\tnpm\tinstall\nEXPOSE\t\n8080\nENTRYPOINT\t\n[\n\"node\"\n,\t\n\"./app.js\"\n]\nThe\tDockerfile\thas\ttwo\tmain\tpurposes:\n1\n.\t\nTo\tdescribe\tthe\tapplication\n2\n.\t\nTo\ttell\tDocker\thow\tto\tcontainerize\tthe\tapplication\t(create\tan\timage\twith\tthe\napp\tinside)\nDo\tnot\tunderestimate\tthe\timpact\tof\tthe\tDockerfile\tfrom\ta\tdocumentation\nperspective.\tIt\thas\tthe\tability\tto\tbridge\tthe\tgap\tbetween\tdev\tand\tops!\tIt\talso\thas\nthe\tpower\tto\tspeed\tup\ton-boarding\tof\tnew\tdevelopers\tetc.\tThis\tis\tbecause\tthe\nfile\taccurately\tdescribes\tthe\tapplication\tand\tits\tdependencies\tin\tan\teasy-to-read\nformat.\nAt\ta\thigh-level,\tthe\texample\tDockerfile\tsays:\tStart\twith\tthe\t\nalpine\n\timage,\tadd\n“nigelpoulton@hotmail.com”\tas\tthe\tmaintainer,\tinstall\tNode.js\tand\tNPM,\tcopy\nin\tthe\tapplication\tcode,\tset\tthe\tworking\tdirectory,\tinstall\tdependencies,\texpose\ta\nnetwork\tport,\tand\tset\t\napp.js\n\tas\tthe\tdefault\tapplication\tto\trun.\nLet’s\tlook\tat\tit\tin\ta\tbit\tmore\tdetail.\nAll\tDockerfiles\tstart\twith\tthe\t\nFROM\n\tinstruction.\tThis\twill\tbe\tthe\tbase\tlayer\tof\tthe\nimage,\tand\tthe\trest\tof\tthe\tapp\twill\tbe\tadded\ton\ttop\tas\tadditional\tlayers.\t\nThisparticular\tapplication\tis\ta\tLinux\tapp,\tso\tit\tis\timportant\tthat\tthe\tFROM\ninstruction\trefers\tto\ta\tLinux-based\timage.\tIf\tyou\tare\tcontainerizing\ta\tWindows\napplication,\tyou\twill\tneed\tto\tspecify\tthe\tappropriate\tWindows\tbase\timage\t-\tsuch\nas\t\nmicrosoft/aspnetcore-build\n.\nAt\tthis\tpoint,\tthe\timage\tlooks\tlike\tFigure\t8.2\t.\nFigure\t8.2\nNext,\tthe\tDockerfile\tcreates\ta\tLABEL\tand\tspecifies\n“nigelpoulton@hotmail.com”\tas\tthe\tmaintainer\tof\tthe\timage.\tLabels\tare\tsimple\nkey-value\tpairs\tand\tare\tan\texcellent\tway\tof\tadding\tcustom\tmetadata\tto\tan\timage.\nIt\tis\tconsidered\ta\tbest\tpractice\tto\tlist\ta\tmaintainer\tof\tan\timage\tso\tthat\tother\npotential\tusers\thave\ta\tpoint\tof\tcontact\twhen\tworking\twith\tit.\nNote:\n\tI\twill\tnot\tbe\tmaintaining\tthis\timage.\tI’m\tincluding\tthe\tlabel\tto\tshow\nyou\thow\tto\tuse\tlabels\tas\twell\tas\tshowing\tyou\ta\tbest\tpractice.\nThe\t\nRUN\tapk\tadd\t--update\tnodejs\tnodejs-npm\n\tinstruction\tuses\tthe\tAlpine\napk\n\tpackage\tmanager\tto\tinstall\t\nnodejs\n\tand\t\nnodejs-npm\n\tinto\tthe\timage.\tThe\nRUN\tinstruction\tinstalls\tthese\tpackages\tas\ta\tnew\timage\tlayer\ton\ttop\tof\tthe\nalpine\n\tbase\timage\tcreated\tby\tthe\t\nFROM\talpine\n\tinstruction.\t\nThe\timage\tnow\nlooks\tlike\tFigure\t8.3.\nFigure\t8.3\nThe\t\nCOPY\t.\t/src\n\tinstruction\tcopies\tin\tthe\tapp\tfiles\tfrom\tthe\t\nbuild\tcontext\n.\tThe\nRUN\tinstruction\tcopies\tthese\tfiles\tinto\tthe\timage\tas\ta\tnew\tlayer.\tThe\timage\tnow\nhas\tthree\tlayers\tas\tshown\tin\tFigure\t8.4.Figure\t8.4\nNext,\tthe\tDockerfile\tuses\tthe\t\nWORKDIR\n\tinstruction\tto\tset\tthe\tworking\tdirectory\tfor\nthe\trest\tof\tthe\tinstructions\tin\tthe\tfile.\tThis\tdirectory\tis\trelative\tto\tthe\timage,\tand\nthe\tinfo\tis\tadded\tas\tmetadata\tto\tthe\timage\tconfig\tand\tnot\tas\ta\tnew\tlayer.\nThen\tthe\t\nRUN\t\nnpm\tinstall\n\tinstruction\tuses\t\nnpm\n\tto\tinstall\tapplication\ndependencies\tlisted\tin\t\npackage.json\n.\tIt\truns\twithin\tthe\tcontext\tof\tthe\t\nWORKDIR\nset\tin\tthe\tprevious\tinstruction,\tand\tinstalls\tthe\tdependencies\tas\ta\tnew\tlayer\tin\tthe\nimage.\tThe\timage\tnow\thas\tfour\tlayers\tas\tshown\tin\tFigure\t8.5.\nFigure\t8.5\nThe\tapplication\texposes\ta\tweb\tservice\ton\tTCP\tport\t8080,\tso\tthe\tDockerfile\ndocuments\tthis\twith\tthe\t\nEXPOSE\t8080\n\tinstruction.\tThis\tis\tadded\tas\timage\nmetadata\tand\tnot\tan\timage\tlayer.\nFinally,\tthe\t\nENTRYPOINT\n\tinstruction\tis\tused\tto\tset\tthe\tmain\tapplication\tthat\tthe\nimage\t(container)\tshould\trun.\tThis\tis\talso\tadded\tas\tmetadata\tand\tnot\tan\timage\nlayer.\nContainerize\tthe\tapp/build\tthe\timage\nNow\tthat\twe\thave\tthe\tapplication\tcode\tand\tthe\tDockerfile,\tlet’s\tbuild\tthe\timage!\nThe\tfollowing\tcommand\twill\tbuild\ta\tnew\timage\tcalled\t\nweb:latest\n.\tThe\tperiod\n(\n.\n)\tat\tthe\tend\tof\tthe\tcommand\ttells\tDocker\tto\tuse\tthe\tshell’s\tcurrent\tworking\ndirectory\tas\tthe\t\nbuild\tcontext\n.Be\tsure\tinclude\tthe\tperiod\t(.)\tat\tthe\tend\tof\tthe\tcommand,\tand\tbe\tsure\tto\trun\tthe\ncommand\tfrom\tthe\t\npsweb\n\tdirectory\tthat\tcontains\tthe\tDockerfile\tand\tapplication\ncode.\n$\tdocker\timage\tbuild\t-t\tweb:latest\t.\nSending\tbuild\tcontext\tto\tDocker\tdaemon\t\t\n74\n.75kB\nStep\t\n1\n/8\t:\tFROM\talpine\nlatest:\tPulling\tfrom\tlibrary/alpine\n88286f41530e:\tPull\t\ncomplete\nDigest:\tsha256:f006ecbb8...d935c0c103f4820a417d\nStatus:\tDownloaded\tnewer\timage\t\nfor\n\talpine:latest\n\t--->\t76da55c8019d\n<Snip>\nStep\t\n8\n/8\t:\tENTRYPOINT\tnode\t./app.js\n\t--->\tRunning\tin\tc576be4427a7\n\t--->\te33cdd8266d0\nRemoving\tintermediate\tcontainer\tc576be4427a7\nSuccessfully\tbuilt\te33cdd8266d0\nSuccessfully\ttagged\tweb:latest\nCheck\tthat\tthe\timage\texists\tin\tyour\tDocker\thost’s\tlocal\trepository.\n$\tdocker\timage\tls\nREPO\t\t\t\tTAG\t\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\t\t\t\t\t\t\tSIZE\nweb\t\t\t\t\tlatest\t\t\t\te33cdd8266d0\t\t\t\t\t\tAbout\ta\tminute\tago\t\t\t\n55\n.6MB\nCongratulations,\tthe\tapp\tis\tcontainerized!\nYou\tcan\tuse\tthe\t\ndocker\timage\tinspect\tweb:latest\n\tcommand\tto\tverify\tthe\nconfiguration\tof\tthe\timage.\tIt\twill\tlist\tall\tof\tthe\tsettings\tthat\twere\tconfigured\nfrom\tthe\tDockerfile.\nRun\tthe\tapp\nThe\texample\tapplication\tthat\twe’ve\tcontainerized\tis\ta\tsimple\tweb\tserver\tthat\nlistens\ton\tTCP\tport\t8080.\tYou\tcan\tverify\tthis\tin\tthe\t\napp.js\n\tfile.\nThe\tfollowing\tcommand\twill\tstart\ta\tnew\tcontainer\tcalled\t\nc1\n\tbased\ton\tthe\nweb:latest\n\timage\twe\tjust\tcreated.\tIt\tmaps\tport\t\n80\n\ton\tthe\tDocker\thost,\tto\tport\n8080\n\tinside\tthe\tcontainer.\tThis\tmeans\tthat\tyou\twill\tbe\table\tto\tpoint\ta\tweb\nbrowser\tat\tthe\tDNS\tname\tor\tIP\taddress\tof\tthe\tDocker\thost\tand\taccess\tthe\tapp.\nNote:\n\tIf\tyour\thost\tis\talready\trunning\ta\tservice\ton\tport\t80,\tyou\tcan\tspecify\ta\ndifferent\tport\tas\tpart\tof\tthe\t\ndocker\tcontainer\trun\n\tcommand.\tFor\nexample,\tto\tmap\tthe\tapp\tto\tport\t5000\ton\tthe\tDocker\thost,\tuse\tthe\t\n-p\n5000:8080\n\tflag.$\tdocker\tcontainer\trun\t-d\t--name\tc1\t\n\\\n\t\t-p\t\n80\n:8080\t\n\\\n\t\tweb:latest\nThe\t\n-d\n\tflag\truns\tthe\tcontainer\tin\tthe\tbackground,\tand\tthe\t\n-p\t80:8080\n\tflag\tmaps\nport\t80\ton\tthe\thost\tto\tport\t8080\tinside\tthe\trunning\tcontainer.\nCheck\tthat\tthe\tcontainer\tis\trunning\tand\tverify\tthe\tport\tmapping.\n$\tdocker\tcontainer\tls\nID\t\t\t\t\t\t\tIMAGE\t\t\t\t\t\t\tCOMMAND\t\t\t\t\t\t\t\t\t\t\t<Snip>\t\tPORTS\n82\n...88\t\tweb:latest\t\t\n\"node\t./app.js\"\n\t\t\t...\t\t\t\t\t\n0\n.0.0.0:80->8080/tcp\nThe\toutput\tabove\tis\tsnipped\tfor\treadability,\tbut\tshows\tthat\tthe\tapp\tcontainer\tis\nrunning.\tNote\tthat\tport\t80\tis\tmapped\ton\tall\thost\tinterfaces\t(\n0.0.0.0:80\n)\tto\tport\n8080\tin\tthe\tcontainer.\nTest\tconnectivity\nOpen\ta\tweb\tbrowser\tand\tpoint\tit\tto\tthe\tDNS\tname\tor\tIP\taddress\tof\tthe\thost\tthat\nthe\tcontainer\tis\trunning\ton.\tYou\twill\tsee\tthe\tweb\tpage\tshown\tin\tFigure\t.\nFigure\t8.6\nIf\tthe\ttest\tdoes\tnot\twork,\ttry\tthe\tfollowing:\n1\n.\t\nMake\tsure\tthat\tthe\tcontainer\tis\tup\tand\trunning\twith\tthe\t\ndocker\tcontainer\nls\n\tcommand.\tThe\tcontainer\tname\tis\t\nc1\n\tand\tyou\tshould\tsee\tthe\tport\nmapping\tas\t\n0.0.0.0:80->8080/tcp\n.\n2\n.\t\nCheck\tthat\tthe\tfirewall\tand\tother\tnetwork\tsecurity\tsettings\tare\tnot\tblocking\ntraffic\tto\tport\t80\ton\tthe\tDocker\thost.Congratulations,\tthe\tapplication\tis\tcontainerized\tand\trunning!\nLooking\ta\tbit\tcloser\nNow\tthat\tthe\tapplication\tis\tcontainerized,\tlet’s\ttake\ta\tcloser\tlook\tat\thow\tsome\tof\nthe\tmachinery\tworks.\nComment\tlines\tin\ta\tDockerfile\tstart\twith\tthe\t\n#\n\tcharacter.\nAll\tnon-comment\tlines\tare\t\nInstructions\n.\tInstructions\ttake\tthe\tformat\nINSTRUCTION\targument\n.\tInstruction\tnames\tare\tnot\tcase\tsensitive,\tbut\tit\tis\nnormal\tpractice\tto\twrite\tthem\tin\tUPPERCASE.\tThis\tmakes\treading\tthe\nDockerfile\teasier.\nThe\t\ndocker\timage\tbuild\n\tcommand\tparses\tthe\tDockerfile\tone-line-at-a-time\nstarting\tfrom\tthe\ttop.\nSome\tInstructions\tcreate\tnew\tlayers,\twhereas\tothers\tjust\tadd\tmetadata\tto\tthe\nimage.\nExamples\tof\tinstructions\tthat\tcreate\tnew\tlayers\tare\t\nFROM\n,\t\nRUN\n,\t\nand\t\nCOPY\n.\nExamples\tof\tinstructions\tthat\tcreate\tmetadata\tinclude\t\nEXPSOE\n,\t\nWORKDIR\n,\t\nENV\n,\tand\nENTRYPOINT\n.\tThe\tbasic\tpremise\tis\tthis\t-\tif\tan\tinstruction\tis\tadding\t\ncontent\n\tsuch\nas\tfiles\tand\tprograms\tto\tthe\timage,\tit\twill\tcreate\ta\tnew\tlayer.\tIf\tit\tis\tadding\ninstructions\ton\thow\tto\tbuild\tthe\timage\tand\trun\tthe\tapplication,\tit\twill\tcreate\nmetadata.\nYou\tcan\tview\tthe\tinstructions\tthat\twere\tused\tto\tbuild\tthe\timage\twith\tthe\t\ndocker\nimage\thistory\tcommand\n.\n$\tdocker\timage\t\nhistory\n\tweb:latest\nIMAGE\t\t\t\t\tCREATED\tBY\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSIZE\ne33..6d0\t\t/bin/sh\t-c\t\n#(nop)\t\tENTRYPOINT\t[\"node\"\t\"./a...\t\t\t0B\nd38..20c\t\t/bin/sh\t-c\t\n#(nop)\t\tEXPOSE\t8080/tcp\t\t\t\t\t\t\t\t\t\t\t\t\t\t0B\ne2a..0b6\t\t/bin/sh\t-c\tnpm\tinstall\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n18\n.7MB\na8e..50e\t\t/bin/sh\t-c\t\n#(nop)\tWORKDIR\t/src\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0B\n23b..b58\t\t/bin/sh\t-c\t\n#(nop)\tCOPY\tdir:03b6808e26dacac...\t\t\t22kB\nfda..b35\t\t/bin/sh\t-c\tapk\tadd\t--update\tnodejs\tnodejs-npm\t\t\t\n32\n.9MB\n8d3..501\t\t/bin/sh\t-c\t\n#(nop)\t\tLABEL\tmaintainer=nigelp...\t\t\t0B\n76d..19d\t\t/bin/sh\t-c\t\n#(nop)\t\tCMD\t[\"/bin/sh\"]\t\t\t\t\t\t\t\t\t\t\t\t\t\t0B\n<missing>\t/bin/sh\t-c\t\n#(nop)\tADD\tfile:4583e12bf5caec4...\t\t\t3.97MB\nTwo\tthings\tfrom\tthe\toutput\tabove\tare\tworth\tnoting.First,\teach\tline\tin\tthe\toutput\tcorresponds\tto\tan\tinstruction\tin\tthe\tDockerfile.\tThe\nCREATED\tBY\n\tcolumn\teven\tlists\tthe\texact\tinstruction\tthat\twas\texecuted.\nSecond,\tonly\t4\tof\tthe\timage\tlayers\tdisplayed\tin\tthe\toutput\tcontain\tany\tdata\t(the\nones\twith\tnon-zero\tvalues\tin\tthe\t\nSIZE\n\tcolumn).\tThese\tcorrespond\tto\tthe\t\nFROM\n,\nRUN\n,\tand\t\nCOPY\n\tinstructions\tin\tthe\tDockerfile.\tAlthough\tthe\tother\tinstructions\tlook\nlike\tthey\tcreate\tlayers,\tthey\tactually\tcreate\tmetadata\tinstead\tof\tlayers.\tThe\nreason\tthat\tthe\t\ndocker\timage\thistory\n\toutput\tmakes\tit\tlooks\tlike\tall\tinstructions\ncreate\tlayers\tis\tan\tartefact\tof\tthe\tway\tDocker\tbuilds\tused\tto\twork.\nUse\tthe\t\ndocker\timage\tinspect\n\tcommand\tto\tconfirm\tthat\tonly\t4\tlayers\twere\ncreated.\n$\tdocker\timage\tinspect\tweb:latest\n<Snip>\n}\n,\n\"RootFS\"\n:\t\n{\n\t\t\t\t\n\"Type\"\n:\t\n\"layers\"\n,\n\t\t\t\t\n\"Layers\"\n:\t\n[\n\t\t\t\t\t\t\t\t\n\"sha256:5bef08...00324f75e56f589aedb0\"\n,\n\t\t\t\t\t\t\t\t\n\"sha256:03f8d2...f7061341ab09fab9d2d5\"\n,\n\t\t\t\t\t\t\t\t\n\"sha256:7bb5e2...5718961a7a706c5d0085\"\n,\n\t\t\t\t\t\t\t\t\n\"sha256:110b48...541f301505b0da017b34\"\n\t\t\t\t\n]\n}\n,\nIt\tis\tconsidered\ta\tgood\tpractice\tto\tuse\timages\tfrom\tofficial\trepositories\twith\tthe\nFROM\n\tinstruction.\tThis\tis\tbecause\tthey\ttend\tto\tfollow\tbest\tpractices\tand\tbe\nrelatively\tfree\tfrom\tknown\tvulnerabilities.\tIt\tis\talso\ta\tgood\tidea\tto\tstart\tfrom\n(\nFROM\n)\tsmall\timages\tas\tthis\treduces\tthe\tpotential\tattack\tsurface.\nYou\tcan\tview\tthe\toutput\tof\tthe\t\ndocker\timage\tbuild\n\tcommand\tto\tsee\tthe\ngeneral\tprocess\tfor\tbuilding\tan\timage.\t\nAs\tthe\tsnippet\tbelow\tshows,\tthe\tbasic\nprocess\tis:\t\nspin\tup\ta\ttemporary\tcontainer\n\t>\t\nrun\tthe\tDockerfile\ninstruction\tinside\tof\tthat\tcontainer\n\t>\t\nsave\tthe\tresults\tas\ta\tnew\nimage\tlayer\n\t>\t\nremove\tthe\ttemporary\tcontainer\n.\nStep\t3/8\t:\tRUN\tapk\tadd\t--update\tnodejs\tnodejs-npm\n\t--->\tRunning\tin\t6f3..06d\t\t\t\t<----\trun\tinside\ttemp\tcontainer\nfetch\t...86_64/APKINDEX.tar.gz\nfetch\t...86_64/APKINDEX.tar.gz\n(1/9)\tInstalling...\n<Snip>\n\t--->\tfdaa341c6b35\t\t\t\t<----\tcreate\tlayer\nRemoving\tintermediate\tcontainer\t<----\tremove\ttemp\tcontainer\nStep\t4/8...Moving\tto\tproduction\twith\t\nMulti-stage\tBuilds\nWhen\tit\tcomes\tto\tDocker\timages,\tbig\tis\tbad!\nBig\tmeans\tslow.\tBig\tmeans\thard\tto\twork\twith.\tAnd\tbig\tmeans\ta\tlarge\tattack\nsurface!\nFor\tthese\treasons,\tDocker\timages\tshould\tbe\tsmall.\tThe\taim\tof\tthe\tgame\tis\tto\nonly\tship\tproduction\timages\tcontaining\tthe\tstuff\t\nneeded\n\tto\trun\tyour\tapp\tin\nproduction.\nThe\tproblem\tis…\tkeeping\timages\tsmall\t\nwas\n\thard\twork.\nFor\texample,\tthe\tway\tyou\twrite\tyour\tDockerfiles\thas\ta\thuge\timpact\ton\tthe\tsize\nof\tyour\timages.\tA\tcommon\texample\tis\tthat\tevery\t\nRUN\n\tinstruction\tadds\ta\tnew\nlayer.\tAs\ta\tresult,\tit’s\tusually\tconsidered\ta\tbest\tpractice\tto\tinclude\tmultiple\ncommands\tas\tpart\tof\ta\tsingle\tRUN\tinstruction\t-\tall\tglued\ttogether\twith\tdouble-\nampersands\t(&&)\tand\tbackslash\t()\tline-breaks.\tWhile\tthis\tisn’t\trocket\tscience,\tit\nrequires\ttime\tand\tdiscipline.\nAnother\tissue\tis\tthat\twe\tdon’t\tclean\tup\tafter\tourselves.\tWe’ll\tRUN\ta\tcommand\nagainst\tan\timage\tthat\tpulls\tsome\tbuild-time\ttools,\tand\twe’ll\tleave\tall\tthose\ttools\nin\tthe\timage\twhen\twe\tship\tit\tto\tproduction.\tNot\tideal!\nThere\twere\tways\taround\tthis\t-\tmost\tnotably\tthe\t\nbuilder\tpattern\n.\tBut\tmost\tof\nthese\trequired\tdiscipline\tand\tadded\tcomplexity.\nThe\tbuilder\tpattern\trequired\tyou\tto\thave\tat\tleast\ttwo\tDockerfiles\t-\tone\tfor\ndevelopment\tand\tone\tfor\tproduction.\tYou’d\twrite\tyour\tDockerfile.dev\tto\tstart\nfrom\ta\tlarge\tbase\timage,\tpull\tin\tany\tadditional\tbuild\ttools\trequired,\tand\tbuild\nyour\tapp.\tYou’d\tthen\tbuild\tan\timage\tfrom\tthe\tDockerfile.dev\tand\tcreate\ta\ncontainer\tfrom\tit.\tYou’d\tthen\tuse\tyour\tDockerfile.prod\tto\tbuild\ta\tnew\timage\nfrom\ta\tsmaller\tbase\timage,\tand\tcopy\tover\tthe\tapplication\tform\tthe\tcontainer\tyou\njust\tcreated\tfrom\tthe\tbuild\timage.\tAnd\teverything\tneeded\tto\tbe\tglued\ttogether\nwith\ta\tscript.\nThis\tapproach\twas\tdoable,\tbut\tat\tthe\texpense\tof\tcomplexity.\nMulti-stage\tbuilds\tto\tthe\trescue!Multi-stage\tbuilds\tare\tall\tabout\toptimizing\tbuilds\twithout\tadding\tcomplexity.\nAnd\tthey\tdeliver\ton\tthe\tpromise!\nHere’s\tthe\thigh-level…\nWith\tmulti-stage\tbuilds,\twe\thave\ta\tsingle\tDockerfile\tcontaining\tmultiple\tFROM\ninstructions.\tEach\tFROM\tinstruction\tis\ta\tnew\t\nbuild\tstage\n\tthat\tcan\teasily\tCOPY\nartefacts\tfrom\tprevious\t\nstages\n.\nLet’s\tlook\tat\tan\texample!\nThis\texample\tapp\tis\tavailable\tat\thttps://github.com/nigelpoulton/atsea-sample-\nshop-app.git\tand\tthe\tDockerfile\tis\tin\tthe\t\napp\n\tdirectory.\tIt’s\ta\tLinux-based\napplication\tso\twill\tonly\twork\ton\ta\tLinux\tDocker\thost.\nThe\trepo\tis\ta\tfork\tof\t\ndockersamples/atsea-sample-shop-app\n\tand\tI’ve\tforked\tit\nin\tcase\tthe\tupstream\trepo\tis\tremoved\tor\tdeleted.\nThe\tDockerfile\tis\tshown\tbelow:\nFROM\tnode:latest\tAS\tstorefront\nWORKDIR\t/usr/src/atsea/app/react-app\nCOPY\treact-app\t.\nRUN\tnpm\tinstall\nRUN\tnpm\trun\tbuild\nFROM\tmaven:latest\tAS\tappserver\nWORKDIR\t/usr/src/atsea\nCOPY\tpom.xml\t.\nRUN\tmvn\t-B\t-f\tpom.xml\t-s\t/usr/share/maven/ref/settings-docker.xml\tdependency\\\n:resolve\nCOPY\t.\t.\nRUN\tmvn\t-B\t-s\t/usr/share/maven/ref/settings-docker.xml\tpackage\t-DskipTests\nFROM\tjava:8-jdk-alpine\tAS\tproduction\nRUN\tadduser\t-Dh\t/home/gordon\tgordon\nWORKDIR\t/static\nCOPY\t--from=storefront\t/usr/src/atsea/app/react-app/build/\t.\nWORKDIR\t/app\nCOPY\t--from=appserver\t/usr/src/atsea/target/AtSea-0.0.1-SNAPSHOT.jar\t.\nENTRYPOINT\t[\"java\",\t\"-jar\",\t\"/app/AtSea-0.0.1-SNAPSHOT.jar\"]\nCMD\t[\"--spring.profiles.active=postgres\"]\nThe\tfirst\tthing\tto\tnote\tis\tthat\tthe\tDockerfile\thas\tthree\t\nFROM\n\tinstructions.\tEach\tof\nthese\tconstitutes\ta\tdistinct\t\nbuild\tstage\n.\t\nInternally\tthey’re\tnumbered\tform\tthe\ttop\nstarting\tat\t0.\tHowever,\twe’ve\talso\tgiven\teach\tstage\ta\tfriendly\tname.\nStage\to\tis\tcalled\t\nstorefront\n\tStage\t1\tis\tcalled\t\nappserver\n\tStage\t2\tis\tcalled\nproductionThe\t\nstorefront\n\tstage\tpulls\tthe\t\nnode:latest\n\timage\twhich\tis\tover\t600MB\tin\nsize.\tIt\tsets\tthe\tworking\tdirectory,\tcopies\tin\tsome\tapp\tcode,\tand\tuses\ttwo\tRUN\ninstructions\tto\tperform\tsome\t\nnpm\n\tmagic.\tThis\tadds\tthree\tlayers\tand\tconsiderable\nsize.\tThe\tresult\tis\tan\teven\tbigger\timage\tcontaining\tlots\tof\tbuild\tstuff\tand\tnot\nvery\tmuch\tapp\tcode.\nThe\t\nappserver\n\tstage\tpulls\tthe\t\nmaven:latest\n\timage\twhich\tis\tover\t700MB\tin\nsize.\tIt\tadds\tfour\tlayers\tof\tcontent\tvia\ttwo\tCOPY\tinstructions\tand\ttwo\tRUN\ninstructions.\tThis\tproduces\tanother\tvery\tlarge\timage\twith\tlots\tof\tbuild\ttools\tand\nvery\tlittle\tactual\tproduction\tcode.\nThe\t\nproduction\n\tstage\tstarts\tby\tpulling\tthe\t\njava:8-jdk-alpine\n\timage.\tThis\nimage\tis\tapproximately\t150MB\t-\tconsiderably\tsmaller\tthan\tthe\tnode\tand\tmaven\nimages\tused\tby\tthe\tprevious\tbuild\tstages.\tIt\tadds\ta\tuser,\tsets\tthe\tworking\ndirectory\tand\tcopies\tin\tsome\tapp\tcode\tfrom\tthe\timage\tproduced\tby\tthe\nstorefront\n\tstage.\tAfter\tthat,\tit\tsets\ta\tdifferent\tworking\tdirectory\tand\tcopies\tin\nthe\tapplication\tcode\tform\tthe\timage\tproduced\tby\tthe\t\nappserver\n\tstage.\tFinally,\tit\nsets\tthe\tmain\tapplication\tfor\tthe\timage\tto\trun\twhen\tit’s\tstarted\tas\ta\tcontainer.\nThe\timportant\tthings\tto\tnote\tare\tthat\tthe\t\nCOPY\t--from\n\tinstructions\t\nonly\tcopy\nproduction-related\tapplication\tcode\n\tfrom\tthe\timages\tbuilt\tby\tthe\tprevious\nstages.\tThey\tdo\tnot\tcopy\tacross\tbuild\tartefacts\tthat\tare\tnot\tneeded\tfor\nproduction.\nIt’s\talso\timportant\tto\tnote\tthat\twe\tonly\tneed\ta\tsingle\tDockerfile,\tand\tno\textra\narguments\tare\tneeded\tfor\tthe\t\ndocker\timage\trun\n\tcommand!\nSpeaking\tof\twhich…\tlet’s\tbuild\tit.\nClone\tthe\trepo.\n$\tgit\tclone\thttps://github.com/nigelpoulton/atsea-sample-shop-app.git\nCloning\tinto\t\n'atsea-sample-shop-app'\n...\nremote:\tCounting\tobjects:\t\n632\n,\t\ndone\n.\nremote:\tTotal\t\n632\n\t\n(\ndelta\t\n0\n)\n,\treused\t\n0\n\t\n(\ndelta\t\n0\n)\n,\tpack-reused\t\n632\nReceiving\tobjects:\t\n100\n%\t\n(\n632\n/632\n)\n,\t\n7\n.23\tMiB\t\n|\n\t\n1\n.88\tMiB/s,\t\ndone\n.\nResolving\tdeltas:\t\n100\n%\t\n(\n195\n/195\n)\n,\t\ndone\n.\nChecking\tconnectivity...\t\ndone\n.\nChange\tdirectory\tinto\tthe\t\napp\n\tfolder\tof\tthe\tcloned\trepo\tand\tverify\tthat\tthe\nDockerfile\texists.$\t\ncd\n\tatsea-sample-shop-app/app\n$\n$\tls\t-l\ntotal\t\n24\n-rw-r--r--\t\n1\n\troot\troot\t\t\n682\n\tOct\t\t\n1\n\t\n22\n:03\tDockerfile\n-rw-r--r--\t\n1\n\troot\troot\t\n4365\n\tOct\t\t\n1\n\t\n22\n:03\tpom.xml\ndrwxr-xr-x\t\n4\n\troot\troot\t\n4096\n\tOct\t\t\n1\n\t\n22\n:03\treact-app\ndrwxr-xr-x\t\n4\n\troot\troot\t\n4096\n\tOct\t\t\n1\n\t\n22\n:03\tsrc\nPerform\tthe\tbuild\t(this\tmay\ttake\tseveral\tminutes\tto\tcomplete).\n$\tdocker\timage\tbuild\t-t\tmulti:stage\t.\nSending\tbuild\tcontext\tto\tDocker\tdaemon\t\t\n3\n.658MB\nStep\t\n1\n/19\t:\tFROM\tnode:latest\tAS\tstorefront\nlatest:\tPulling\tfrom\tlibrary/node\naa18ad1a0d33:\tPull\t\ncomplete\n15a33158a136:\tPull\t\ncomplete\n<Snip>\nStep\t\n19\n/19\t:\tCMD\t--spring.profiles.active\n=\npostgres\n\t--->\tRunning\tin\tb4df9850f7ed\n\t--->\t3dc0d5e6223e\nRemoving\tintermediate\tcontainer\tb4df9850f7ed\nSuccessfully\tbuilt\t3dc0d5e6223e\nSuccessfully\ttagged\tmulti:stage\nNote:\n\tThe\t\nmulti:stage\n\ttag\tused\tin\tthe\texample\tabove\tis\tarbitrary.\tYou\tcan\ntag\tyour\timages\taccording\tto\tyour\town\trequirements\tand\tstandards\t-\tthere\nis\tno\trequirement\tto\ttag\tmulti-stage\tbuilds\tthe\tway\twe\tdid\tin\tthis\texample.\nRun\ta\t\ndocker\timage\tls\n\tto\tsee\tthe\tlist\tof\timages\tpulled\tand\tcreated\tby\tthe\tbuild\noperation.\n$\tdocker\timage\tls\nREPO\t\t\t\tTAG\t\t\t\t\t\t\t\t\t\t\t\t\tIMAGE\tID\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\t\t\tSIZE\nnode\t\t\t\tlatest\t\t\t\t\t\t\t\t\t\t9ea1c3e33a0b\t\t\t\t\n4\n\tdays\tago\t\t\t\t\t673MB\n<none>\t\t<none>\t\t\t\t\t\t\t\t\t\t6598db3cefaf\t\t\t\t\n3\n\tmins\tago\t\t\t\t\t816MB\nmaven\t\t\tlatest\t\t\t\t\t\t\t\t\t\tcbf114925530\t\t\t\t\n2\n\tweeks\tago\t\t\t\t750MB\n<none>\t\t<none>\t\t\t\t\t\t\t\t\t\td5b619b83d9e\t\t\t\t\n1\n\tmin\tago\t\t\t\t\t\t891MB\njava\t\t\t\t\n8\n-jdk-alpine\t\t\t\t3fd9dd82815c\t\t\t\t\n7\n\tmonths\tago\t\t\t145MB\nmulti\t\t\tstage\t\t\t\t\t\t\t\t\t\t\t3dc0d5e6223e\t\t\t\t\n1\n\tmin\tago\t\t\t\t\t\t210MB\nThe\ttop\tline\tin\tthe\toutput\tabove\tshows\tthe\t\nnode:latest\n\timage\tpulled\tby\tthe\nstorefront\n\tstage.\tThe\timage\tbelow\tis\tthe\timage\tproduced\tby\tthat\tstage\t(created\nby\tadding\tthe\tcode\tand\trunning\tthe\tnpm\tinstall\tand\tbuild\toperations).\tBoth\tare\nvery\tlarge\timages\twith\tlots\tof\tbuild\ttools\tincluded.\nThe\t3rd\tand\t4th\tlines\tare\tthe\timages\tpulled\tand\tproduced\tby\tthe\t\nappserver\nstage.\tThese\tare\tboth\tlarge\tand\tcontain\tlots\tof\tbuilds\ttools.The\tlast\tline\tis\tthe\t\nmulti:stage\n\timage\tbuilt\tby\tthe\tfinal\tbuild\tstage\tin\tthe\nDockerfile\t(stage2/production).\tYou\tcan\tsee\tthat\tthis\tis\tsignificantly\tsmaller\tthan\nthe\timages\tpulled\tand\tproduced\tby\tthe\tprevious\tstages.\tThis\tis\tbecause\tit’s\tbased\noff\tthe\tmuch\tsmaller\t\njava:8-jdk-alpine\n\timage\tand\thas\tonly\tadded\tthe\nproduction-related\tapp\tfiles\tfrom\tthe\tprevious\tstages.\nThe\tnet\tresult\tis\ta\tsmall\tproduction\timage\tcreated\tby\ta\tsingle\tDockerfile,\ta\nnormal\t\ndocker\timage\tbuild\n\tcommand,\tand\tzero\tadditional\tscripting!\nMulti-stage\tbuilds\twere\tnew\twith\tDocker\t17.05\tand\tare\tan\texcellent\tfeature\tfor\nbuilding\tsmall\tproduction-worthy\timages.Containerizing\tan\tapp\t-\tThe\tcommands\ndocker\timage\tbuild\n\tis\tthe\tcommand\tthat\treads\ta\tDockerfile\tand\ncontainerizes\tan\tapplication.\tThe\t\n-t\n\tflag\ttags\tthe\timage,\tthe\t\n-f\n\tflag\tlets\tyou\nspecify\tthe\tname\tand\tlocation\tof\tthe\tDockerfile.\tWith\tthe\t\n-f\n\tflag\tit\tis\npossible\tto\tuse\ta\tDockerfile\twith\tan\tarbitrary\tname.\tThe\t\nbuild\tcontext\n\tis\nwhere\tyour\tapplication\tfiles\texist,\tand\tthis\tcan\tbe\ta\tdirectory\ton\tyour\tlocal\nDocker\thost\tor\ta\tremote\tGit\trepo.\nThe\t\nFROM\n\tDockerfile\tinstruction\tin\ta\tDockerfile\tspecifies\tthe\tbase\timage\tfor\nthe\tnew\timage\tyou\twill\tbuild.\tIt\tis\tusually\tthe\tfirst\tinstruction\tin\ta\nDockerfile.\nThe\t\nRUN\n\tDockerfile\tinstruction\tallows\tyou\tto\trun\tcommands\tinside\tthe\nimage\twhich\tcreate\tnew\tlayers.\tEach\t\nRUN\n\tinstruction\tcreates\ta\tsingle\tnew\nlayer.\nThe\t\nCOPY\n\tDockerfile\tinstruction\tadds\tfiles\tinto\tthe\timage\tas\ta\tnew\tlayer.\tIt\nis\tcommon\tto\tuse\tthe\t\nCOPY\n\tinstruction\tto\tcopy\tyour\tapplication\tcode\tinto\tan\nimage.\nThe\t\nEXPOSE\n\tDockerfile\tinstruction\tdocuments\tthe\tnetwork\tport\tthat\tthe\napplication\tuses.\nThe\t\nENTRYPOINT\n\tDockerfile\tinstruction\tsets\tthe\tdefault\tapplication\tto\trun\nwhen\tthe\timage\tis\tstarted\tas\ta\tcontainer.\nOther\tDockerfile\tinstructions\tinclude\t\nLABEL\n,\t\nENV\n,\t\nONBUILD\n,\t\nHEALTHCHECK\n,\nCMD\n\tand\tmore…Chapter\tsummary\nIn\tthis\tchapter\twe\tlearned\thow\tto\tcontainerize\t(Dockerize)\tan\tapplication.\nWe\tpulled\tsome\tapplication\tcode\tfrom\ta\tremote\tGit\trepo.\tThe\trepo\tincluded\tthe\napplication\tcode,\tas\twell\tas\ta\tDockerfile\tcontaining\tinstructions\ton\thow\tto\tbuild\nthe\tapplication\tinto\tan\timage.\tWe\tlearned\tthe\tbasics\tof\tthe\thow\tDockerfiles\nwork,\tand\tfed\tone\tinto\ta\t\ndocker\timage\tbuild\n\tcommand\tto\tcreate\ta\tnew\timage.\nOnce\tthe\timage\twas\tcreated,\twe\tstarted\ta\tcontainer\tform\tit\tand\ttested\tit\tworked\nwith\ta\tweb\tbrowser.\nAfter\tthat,\twe\tsaw\thow\tmulti-stage\tbuilds\tgive\tus\ta\tsimple\tway\tto\tbuild\tand\tship\nsmaller\timages\tto\tour\tproduction\tenvironments.\nWe\talso\tlearned\tthat\tthe\tDockerfile\tis\ta\tgreat\ttool\tfor\tdocumenting\tan\tapp.\tAs\nsuch,\tit\tcan\tspeed-up\tthe\ton-boarding\tof\tnew\tdevelopers\tand\tbridge\tthe\tdivide\nbetween\tdevelopers\tand\toperations\tstaff!\nAlthough\tthe\texamples\tcited\twas\ta\tLinux-based\texample,\tthe\tprocess\tfor\ncontainerizing\tWindows\tapps\tis\tthe\tsame:\tStart\twith\tyour\tapp\tcode,\tcreate\ta\nDockerfile\tdescribing\tthe\tapp,\tbuild\tthe\timage\twith\t\ndocker\timage\tbuild\n.\tJob\ndone!9:\tSwarm\tMode\nNow\tthat\twe\tknow\thow\tto\tinstall\tDocker,\tpull\timages,\tand\twork\twith\tcontainers,\nthe\tnext\tthing\twe\tneed\tis\ta\tway\tto\twork\twith\tit\tall\tat\tscale.\tThat’s\twhere\norchestration\tand\t\nswarm\tmode\n\tcomes\tinto\tthe\tpicture.\nAs\tusual,\twe’ll\ttake\ta\tthree-stage\tapproach\twith\ta\thigh-level\texplanation\tat\tthe\ntop,\tfollowed\tby\ta\tlonger\tsection\twith\tall\tthe\tdetail\tand\tsome\texamples,\tand\nwe’ll\tfinish\tthings\tup\twith\ta\tlist\tof\tthe\tmain\tcommands\twe\tlearned.\nThe\texamples\tand\toutputs\tin\tthis\tchapter\twill\tbe\tfrom\ta\tLinux-based\tSwarm.\nHowever,\tall\tcommands\tand\tfeatures\talso\twork\twith\tDocker\ton\tWindows.\nNote:\n\tIf\tyou\tare\tfollowing\talong\twith\tWindows\tin\ta\tPowerShell\tterminal\nand\tlisting\tcommand\toptions\tover\tmultiple\tlines,\tyou\twill\tneed\tto\tindicate\ncontinuation\ton\tthe\tnext\tline\twith\tbackticks\t(`).\nWe’ll\tsplit\tthis\tchapter\tinto\tthe\tusual\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nLet’s\tgo\tbuild\ta\tswarm!Swarm\tmode\t-\tThe\tTLDR\nIt’s\tone\tthing\tto\tfollow\talong\twith\tthe\tsimple\texamples\tin\tthis\tbook,\tbut\tit’s\tan\nentirely\tdifferent\tthing\trunning\tthousands\tof\tcontainers\ton\ttens\tor\thundreds\tof\nDocker\thosts!\tThis\tis\twhere\torchestration\tcomes\tinto\tplay!\nAt\ta\thigh-level,\torchestration\tis\tall\tabout\tautomating\tand\tsimplifying\tthe\nmanagement\tof\tcontainerized\tapplications\tat\tscale.\tThings\tlike\tautomatically\nrescheduling\tcontainers\twhen\tnodes\tbreak,\tscaling\tthings\tup\twhen\tdemand\nincreases,\tand\tsmoothly\tpushing\tupdates\tand\tfixes\tinto\tlive\tproduction\nenvironments.\nFor\tthe\tlongest\ttime\torchestration\tlike\tthis\twas\thard.\tTools\tlike\t\nDocker\tSwarm\nand\t\nKubernetes\n\twere\tavailable,\tbut\tthey\twere\tcomplicated.\tThen\talong\tcame\nDocker\t1.12\tand\tthe\tnew\tnative\t\nswarm\tmode\n,\tand\tovernight\tthings\tchanged.\tAll\nthis\torchestration\tstuff\tgot\ta\twhole\tlot\teasier.\nThat’s\tthe\tquick\texplanation.\tNow\tlet’s\tget\tinto\tthe\tdetail.Swarm\tmode\t-\tThe\tdeep\tdive\nFirst\tup,\tas\tthe\ttitle\tof\tthe\tchapter\tsuggests,\twe’re\tgoing\tto\tbe\tfocusing\ton\t\nswarm\nmode\n\t-\tthe\tnative\tclustering\tand\torchestration\ttechnologies\tthat\tfirst\tshipped\tas\npart\tDocker\t1.12.\tOther\torchestration\tsolutions\texist,\tmost\tnotably\tKubernetes,\nbut\twe’re\tnot\tcovering\tthose\there.\nConcepts\tand\tterminology\nSwarm\tmode\n\tbrought\ta\tload\tof\tchanges\tand\timprovements\tto\tthe\tway\twe\nmanage\tcontainers\tat\tscale.\tAt\tthe\theart\tof\tthose\tchanges\tis\tnative\tclustering\tof\nDocker\thosts\tthat’s\tdeeply\tintegrated\tinto\tthe\tDocker\tplatform.\tWe’re\tnot\ttalking\nabout\tsomething\tlike\tKubernetes\tthat’s\ta\tseparate\ttool\trequiring\ta\thighly\tskilled\nspecialist\tto\tconfigure\tit\ton\ttop\tof\texisting\tDocker\tinfrastructures.\tNo!\tThe\nclustering\twe’re\ttalking\tabout\there\tis\ta\ttrue\tfirst-class\tcitizen\tin\tthe\tDocker\ntechnology\tstack.\tAnd\tit’s\tsimple!\nBut\tthe\tfolks\tat\tDocker,\tInc.\tdon’t\treally\tlike\tusing\tthe\tterm\t\ncluster\n.\tThey’re\ncalling\ta\tcluster\tof\torchestrated\tDocker\thosts\ta\t\nswarm\n,\tand\tthe\tDocker\thosts\nparticipating\tin\ta\t\nswarm\n\tare\tsaid\tto\toperate\tin\t\nswarm\tmode\n.\tWe’ll\ttry\tto\tbe\nconsistent\tand\tuse\tthese\tterms\tthroughout\tthe\tremainder\tof\tthe\tbook.\tWe’ll\talso\nstart\tusing\tthe\tterm\t\nsingle-engine\tmode\n\tto\trefer\tto\tDocker\thosts\tthat\tare\tnot\nrunning\tin\t\nswarm\tmode\n.\nFigure\t9.1\tshows\ta\t4-node\t\nswarm\n\twith\tnodes\trunning\tin\t\nswarm\tmode\n.\t\nIt\talso\nshows\ttwo\tnodes\tnot\tin\tthe\tswarm\toperating\tin\t\nsingle-engine\tmode\n.\nFigure\t9.1Backward\tcompatibility\nIntroducing\t\nswarm\tmode\n\twas\textremely\timportant\tfor\tDocker,\tInc.\tBut\tso\tis\nmaintaining\tbackward\tcompatibility!\tAs\ta\tresult,\t\nswarm\tmode\tis\tentirely\noptional\n\t(this\tmay\tor\tmay\tnot\tchange\tin\tthe\tfuture).\tA\tstandard\tinstallation\tof\nDocker\twill\tdefault\tto\trunning\tin\t\nsingle\tengine\tmode\n,\tensuring\t100%\tbackward\ncompatibility\twith\tprevious\tversions\tof\tDocker.\nThis\tis\tgreat\tnews\tif\tyou’re\ta\tuser\tor\tdeveloper\tof\t3rd\tparty\tclustering\ttools\t\netc.\nAs\tlong\tas\tyou\tkeep\tDocker\t1.12\tand\tlater\tin\t\nsingle-engine\tmode\n,\tall\tof\tyour\nexisting\ttools\tand\tapps\twill\twork\tas\tnormal!\tHowever,\tas\tsoon\tas\tyou\ttake\tthe\nplunge\tand\tput\tyour\tDocker\thosts\tinto\t\nswarm\tmode\n\tyou\trisk\tbreaking\tthose\t3rd\nparty\ttools\tand\tapps.\nIn\tshort,\tputting\ta\tDocker\tEngine\tinto\t\nswarm\tmode\n\tgives\tyou\tall\tof\tthe\tlatest\norchestration\tgoodness,\tit\tjust\tcomes\tat\tthe\tprice\tof\tsome\tbackward\ncompatibility.\nSwarm\tmode\tprimer\nLet’s\ttake\ta\tminute\tor\ttwo\tto\texplain\tthe\tmajor\tcomponents\tand\tconstructs\tin\ta\nswarm\n.\nA\t\nswarm\n\tconsists\tof\tone\tor\tmore\t\nnodes\n.\tThese\tcan\tbe\tphysical\tservers,\tVMs,\tor\ncloud\tinstances.\tThe\tonly\trequirement\tis\tthat\tall\tnodes\tin\ta\t\nswarm\n\tcan\ncommunicate\twith\teach\tother\tover\treliable\tnetworks.\nNodes\tare\tthen\tconfigured\tas\t\nmanagers\n\tor\t\nworkers\n.\t\nManagers\n\tlook\tafter\tthe\nstate\tof\tthe\tcluster\tand\tare\tin\tcharge\tof\tdispatching\ttasks\tto\t\nworkers\n.\t\nWorkers\naccept\ttasks\tfrom\t\nmanagers\n\tand\texecute\tthem.\nWhen\ttalking\tabout\t\ntasks\n\tin\tthe\tcontext\tof\ta\tswarm,\twe\tmean\t\ncontainers\n.\tSo,\nwhen\twe\tsay\t“managers\tdispatch\t\ntasks\n\tto\tworkers”,\twe’re\tsaying\tthey\tdispatch\ncontainer\tworkloads.\tYou\tmight\talso\thear\tthem\treferred\tto\tas\t\nreplicas\n.\tThis\nmight\tbe\tconfusing\tat\tthis\tpoint,\tso\ttry\tand\tremember\tthat\t\ntasks\n\tand\t\nreplicas\n\tare\nwords\tthat\tmean\t\ncontainers\n.\nThe\tnext\tthing\twe\tneed\tto\tknow\tabout\tis\t\nservices\n.\tAt\tthe\thighest\tlevel,\t\nservices\nare\tthe\tway\tto\trun\ttasks\ton\ta\tSwarm.\tTo\trun\ta\ttask\t(container)\ton\tSwarm\twewrap\tit\tin\ta\tservice\tand\tdeploy\tthe\tservice.\tBeneath\tthe\thood,\tservices\tare\ta\ndeclarative\tway\tof\tsetting\tthe\t\ndesired\tstate\n\ton\tthe\tcluster.\t\nFor\texample:\nSet\tthe\tnumber\tof\ttasks\t(containers)\tin\tthe\tservice\nSet\tthe\timage\tthe\tcontainers\tin\tthe\tservice\twill\tuse\nSet\tthe\tprocedure\tfor\tupdating\tto\tnewer\tversions\tof\tthe\timage\nThe\tconfiguration\tand\tstate\tof\tthe\t\nswarm\n\tis\theld\tin\ta\tdistributed\t\netcd\n\tdatabase\nlocated\ton\tall\tmanagers\tin\tthe\tswarm.\tIt’s\tkept\textremely\tup-to-date\tand\tis\nhosted\tin-memory\ton\tall\t\nmanager\tnodes\n\tto\tmake\tit\tfast.\tBut\tthe\tbest\tthing\tabout\nit\tis\tthe\tfact\tthat\tit\trequires\tzero\tconfiguration\t-\tit’s\tinstalled\tas\tpart\tof\tthe\nSwarm\tand\tjust\ttakes\tcare\tof\titself.\nSomething\telse\tthat’s\tgame\tchanging\tabout\t\nswarm\tmode\n\tis\tits\tapproach\tto\nsecurity.\tTLS\tis\tso\ttightly\tintegrated\tthat\tit’s\tnot\tpossible\tto\tbuild\ta\tswarm\nwithout\tit.\tIn\ttoday’s\tsecurity\tconscious\tworld,\tthings\tlike\tthis\tdeserve\tall\tthe\nprops\tthey\tget!\tAnyway,\t\nswarm\tmode\n\tuses\tTLS\tto\tencrypt\tcommunications,\nauthenticate\tnodes,\tand\tauthorize\troles.\tAutomatic\tkey\trotation\tis\talso\tthrown\tin\nas\tthe\ticing\ton\tthe\tcake!\tAnd\tit\tall\thappens\tso\tsmoothly\tthat\tyou\twouldn’t\teven\nknow\tit\twas\tthere!\nThat’s\tenough\tof\ta\tprimer.\tLet’s\tget\tour\thands\tdirty\twith\tsome\texamples.\nLab\tsetup\nFor\tthe\tremainder\tof\tthis\tchapter\twe’ll\tbuild\tthe\tlab\tshown\tin\tFigure\t9.2\twith\t6-\nnodes\tconfigured\tas\t3\tmanagers\tand\t3\tworkers.\tIn\tthe\texamples\twe’ll\tuse,\teach\nnode\tis\trunning\tLinux\twith\tDocker\t17.05\tor\thigher.\t\nYou\tcan\tbuild\tthe\tsame\nswarm\ton\tWindows,\tthe\tonly\tdifference\twould\tbe\tthat\tyou’d\tneed\tto\tdeploy\nWindows\tcontainers\tto\tit.\tAll\tnodes\tin\tthe\tlab\tcan\tcommunicate\tover\tthe\nnetwork.Figure\t9.2\nThe\tnames\tand\tIP\taddresses\tare\tnot\timportant\tand\tcan\tbe\tdifferent\tin\tyour\tlab.\t\nIf\nyou\tare\tfollowing\talong\twith\tthe\texamples,\tjust\tremember\tto\tsubstitute\tthem\nwith\tyour\town.\nEnabling\tswarm\tmode\nRunning\t\ndocker\tswarm\tinit\n\ton\ta\tDocker\thost\tin\t\nsingle-engine\tmode\n\twill\nswitch\tthat\tnode\tinto\t\nswarm\tmode\n\tand\tcreate\ta\tnew\t\nswarm\n.\tIt\twill\talso\tmake\tthe\nnode\tthe\tfirst\t\nmanager\n\tof\tthe\tSwarm.\nAdditional\tnodes\tcan\tthen\tbe\tjoined\tto\tthe\tswarm\tas\tworkers\tand\tmanagers\nusing\tthe\t\ndocker\tswarm\tjoin\n\tcommand.\tThis\talso\tputs\tthose\tnodes\tinto\t\nswarm\nmode\n\tas\tpart\tof\tthe\toperation.\nThe\tfollowing\tsteps\twill\tput\t\nmgr1\n\tinto\t\nswarm\tmode\n\tand\tinitialize\ta\tnew\tswarm.\nIt\twill\tthen\tjoin\t\nwrk1\n,\t\nwrk2\n,\tand\t\nwrk3\n\tas\tworker\tnodes\t-\tautomatically\tputting\nthem\tinto\t\nswarm\tmode\n.\tFinally,\tit\twill\tadd\t\nmgr2\n\tand\t\nmgr3\n\tas\tadditional\nmanagers\tand\tswitch\tthem\tinto\t\nswarm\tmode\n.\tAt\tthe\tend\tof\tthe\tprocedure\tall\t6\nnodes\twill\tbe\tpart\tof\tthe\tsame\tswarm\tand\twill\tall\tbe\toperating\tin\t\nswarm\tmode\n.\nThis\texample\twill\tuse\tthe\tIP\taddresses\tand\tDNS\tnames\tof\tthe\tnodes\tshown\tin\nFigure\t9.2.\t\nYours\tmay\tbe\tdifferent.\n1\n.\t\nLog\ton\tto\t\nmgr1\n\tand\tinitialize\ta\tnew\tswarm\t(don’t\tforget\tto\tuse\tbackticks\ninstead\tof\tbackslashes\tif\tfollowing\talong\twith\tWindows\tin\ta\tPowerShell\nterminal).$\tdocker\tswarm\tinit\t\n\\\n\t\t--advertise-addr\t\n10\n.0.0.1:2377\t\n\\\n\t\t--listen-addr\t\n10\n.0.0.1:2377\nSwarm\tinitialized:\tcurrent\tnode\t\n(\nd21lyz...c79qzkx\n)\n\tis\tnow\ta\tmanager.\nThe\tcommand\tcan\tbe\tbroken\tdown\tas\tfollows:\ndocker\tswarm\tinit\n\ttells\tDocker\tto\tinitialize\ta\tnew\tSwarm\tand\tmake\nthis\tnode\tthe\tfirst\tmanager.\tIt\talso\tenables\tswarm\tmode\ton\tthe\tnode.\n--advertise-addr\n\tis\tthe\tIP\tand\tport\tthat\tother\tnodes\tshould\tuse\tto\nconnect\tto\tthis\tmanager.\tThe\tflag\tis\toptional,\tbut\tit\tgives\tyou\tcontrol\nover\twhich\tIP\tgets\tused\ton\tnodes\twith\tmultiple\tIPs.\tIt\talso\tgives\tyou\nthe\tchance\tto\tspecify\tan\tIP\taddress\tthat\tdoes\tnot\texist\ton\tthe\tnode,\nsuch\tas\ta\tload\tbalancer\tIP\taddress.\n--listen-addr\n\tlets\tyou\tspecify\twhich\tIP\tand\tport\tyou\twant\tto\tlisten\non\tfor\tswarm\ttraffic.\tThis\twill\tusually\tmatch\tthe\t\n--advertise-addr\n,\nbut\tis\tuseful\tin\tsituations\twhere\tyou\twant\tto\trestrict\tswarm\tto\ta\nparticular\tIP\ton\ta\tsystem\twith\tmultiple\tIPs.\tIt’s\talso\trequired\tin\nsituations\twhere\tthe\t\n--advertise-addr\n\trefers\tto\ta\tremote\tIP\taddress\nlike\ta\tload\tbalancer.\nI\trecommend\tyou\tbe\tspecific\tand\talways\tuse\tboth\tflags.\tAll\tof\tthe\tWindows\nSwarm\twork\tI’ve\tdone\thas\trequired\tthese\ttwo\tflags.\nThe\tdefault\tport\tthat\tswarm\tmode\toperates\ton\tis\t\n2377\n.\tThis\tis\tentirely\ncustomizable,\tbut\tDocker,\tInc.\tare\tlooking\tto\tregister\tthis\twith\tIANA\tas\tthe\nofficial\tDocker\tSwarm\tport.\n2\n.\t\nList\tthe\tnodes\tin\tthe\tswarm\n$\tdocker\tnode\tls\nID\t\t\t\t\t\t\t\t\t\t\t\tHOSTNAME\t\t\tSTATUS\t\tAVAILABILITY\t\tMANAGER\tSTATUS\nd21...qzkx\t*\t\tmgr1\t\t\t\t\t\t\tReady\t\t\tActive\t\t\t\t\t\t\t\tLeader\nNotice\tthat\t\nmgr1\n\tis\tcurrently\tthe\tonly\tnode\tin\tthe\tswarm\tand\tis\tlisted\tas\tthe\nLeader\n.\tWe’ll\tcome\tback\tto\tthis\tin\ta\tsecond.\n3\n.\t\nFrom\t\nmagr1\n\trun\tthe\t\ndocker\tswarm\tjoin-token\n\tcommand\tto\textract\tthe\ncommands\tand\ttokens\trequired\tto\tadd\tnew\tworkers\tand\tmanagers\tto\tthe\nswarm.\n$\tdocker\tswarm\tjoin-token\tworker\nTo\tadd\ta\tmanager\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\tdocker\tswarm\tjoin\t\n\\\t\t\t--token\tSWMTKN-1-0uahebax...c87tu8dx2c\t\n\\\n\t\t\t\n10\n.0.0.1:2377\n$\tdocker\tswarm\tjoin-token\tmanager\nTo\tadd\ta\tmanager\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\tdocker\tswarm\tjoin\t\n\\\n\t\t\t--token\tSWMTKN-1-0uahebax...ue4hv6ps3p\t\n\\\n\t\t\t\n10\n.0.0.1:2377\nNotice\tthat\tthe\tcommands\tto\tjoin\ta\tworker\tand\ta\tmanager\tare\tidentical\napart\tfrom\tthe\tjoin\ttokens\t(\nSWMTKN...\n).\tThis\tmeans\tthat\twhether\ta\tnode\njoins\tas\ta\tworker\tor\ta\tmanager\tdepends\tentirely\ton\twhich\ttoken\tyou\tuse\nwhen\tjoining\tit.\tYou\tshould\talso\tprotect\tyour\tjoin\ttokens\tas\tthese\tare\tall\nthat\tis\trequired\tto\tjoin\ta\tnode\tto\ta\tSwarm.\n4\n.\t\nLog\ton\tto\t\nwrk1\n\tand\tjoin\tit\tto\tthe\tswarm\tusing\tthe\t\ndocker\tswarm\tjoin\ncommand\twith\tthe\ttoken\tused\tfor\tjoining\tworkers.\n$\tdocker\tswarm\tjoin\t\n\\\n\t\t\t\t--token\tSWMTKN-1-0uahebax...c87tu8dx2c\t\n\\\n\t\t\t\t\n10\n.0.0.1:2377\t\n\\\n\t\t\t\t--advertise-addr\t\n10\n.0.0.4:2377\t\n\\\n\t\t\t\t--listen-addr\t\n10\n.0.0.4:2377\nThis\tnode\tjoined\ta\tswarm\tas\ta\tworker.\nI’ve\tmanually\tadded\tthe\t\n--advertise-addr\n,\tand\t\n--listen-addr\n\tflags\tas\tI\nconsider\tit\tbest\tpractice\tto\tbe\tas\tspecific\tas\tpossible\twhen\tit\tcomes\tto\nnetwork\tconfiguration.\n5\n.\t\nRepeat\tthe\tprevious\tstep\ton\t\nwrk2\n\tand\t\nwrk3\n\tto\tjoin\tthem\tto\tthe\tswarm\tas\nworkers.\tMake\tsure\tyou\tuse\t\nwrk2\n\tand\t\nwrk3’s\n\town\tIP\taddresses\tfor\tthe\t\n--\nadvertise-addr\n\tand\t\n--listen-addr\n\tflags.\n6\n.\t\nLog\ton\tto\t\nmgr2\n\tand\tjoin\tit\tto\tthe\tswarm\tas\ta\tmanager\tusing\tthe\t\ndocker\nswarm\tjoin\n\tcommand\twith\tthe\ttoken\tused\tfor\tjoining\tmanagers.\n$\tdocker\tswarm\tjoin\t\n\\\n\t\t\t\t--token\tSWMTKN-1-0uahebax...ue4hv6ps3p\t\n\\\n\t\t\t\t\n10\n.0.0.1:2377\t\n\\\n\t\t\t\t--advertise-addr\t\n10\n.0.0.2:2377\t\n\\\n\t\t\t\t--listen-addr\t\n10\n.0.0.1:2377\nThis\tnode\tjoined\ta\tswarm\tas\ta\tmanager.\n7\n.\t\nRepeat\tthe\tprevious\tstep\ton\t\nmgr3\n\tremembering\tto\tuse\t\nmgr3’s\n\tIP\taddress\nfor\tthe\t\nadvertise-addr\n\tand\t\n--listen-addr\n\tflags.\n8\n.\t\nList\tthe\tnodes\tin\tthe\tswarm\tby\trunning\t\ndocker\tnode\tls\n\tfrom\tany\tof\tthe\nmanager\tnodes\tin\tthe\tswarm.$\tdocker\tnode\tls\nID\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tHOSTNAME\t\t\t\t\tSTATUS\t\tAVAILABILITY\t\tMANAGER\tSTATUS\n0g4rl...babl8\t*\t\tmgr2\t\t\t\t\t\t\t\t\tReady\t\t\tActive\t\t\t\t\t\t\t\tReachable\n2xlti...l0nyp\t\t\t\tmgr3\t\t\t\t\t\t\t\t\tReady\t\t\tActive\t\t\t\t\t\t\t\tReachable\n8yv0b...wmr67\t\t\t\twrk1\t\t\t\t\t\t\t\t\tReady\t\t\tActive\n9mzwf...e4m4n\t\t\t\twrk3\t\t\t\t\t\t\t\t\tReady\t\t\tActive\nd21ly...9qzkx\t\t\t\tmgr1\t\t\t\t\t\t\t\t\tReady\t\t\tActive\t\t\t\t\t\t\t\tLeader\ne62gf...l5wt6\t\t\t\twrk2\t\t\t\t\t\t\t\t\tReady\t\t\tActive\nCongratulations!\tYou’ve\tjust\tcreated\ta\t6-node\tswarm\twith\t3\tmanagers\tand\t3\nworkers.\tAs\tpart\tof\tthe\tprocess\tyou\tput\tthe\tDocker\tEngine\ton\teach\tnode\tinto\nswarm\tmode\n.\tAs\ta\tbonus,\tthe\t\nswarm\n\tis\tautomatically\tsecured\twith\tTLS.\nIf\tyou\tlook\tin\tthe\t\nMANAGER\tSTATUS\n\tcolumn\tin\tthe\tprevious\toutput\tyou’ll\tsee\tthat\nthe\tthree\tmanager\tnodes\tare\tshowing\tas\teither\t“Reachable”\tor\t“Leader”.\tWe’ll\nlearn\tmore\tabout\tleaders\tshortly.\tNodes\twith\tnothing\tin\tthe\t\nMANAGER\tSTATUS\ncolumn\tare\t\nworkers\n.\tAlso\tnote\tthe\tasterisk\t(\n*\n)\tafter\tthe\tID\ton\tthe\tline\tshowing\nmgr2\n.\tThis\tshows\tus\twhich\tnode\twe\tran\tthe\t\ndocker\tnode\tls\n\tcommand\tfrom.\tIn\nthis\tinstance\tthe\tcommand\twas\tissued\tfrom\t\nmgr2\n.\nNote:\n\tIt’s\ta\tpain\tto\tspecify\tthe\t\n--advertise-addr\n\tand\t\n--listen-addr\n\tflags\nevery\ttime\tyou\tjoin\ta\tnode\tto\tthe\tswarm.\tHowever,\tit\tcan\tbe\teven\tmore\tof\ta\npain\tif\tyou\tget\tthe\tnetwork\tconfiguration\tof\tyour\tswarm\twrong.\tManually\nadding\tnodes\tto\ta\tswarm\tis\tunlikely\tto\tbe\ta\tdaily\ttask\tso\tI\tthink\tit’s\tworth\nthe\textra\tup-front\teffort\tto\tuse\tthe\tflags.\tIt’s\tyour\tchoice\tthough.\tIn\tlab\nenvironments\tor\tnodes\twith\tonly\ta\tsingle\tIP\tyou\tprobably\tdon’t\tneed\tto\tuse\nthe\tflags.\nNow\tthat\twe\thave\ta\t\nswarm\n\tup\tand\trunning,\tlet’s\ttake\ta\tlook\tat\tmanager\thigh\navailability\t(H/A).\nSwarm\tmanager\thigh\tavailability\t(H/A)\nSo\tfar,\twe’ve\tadded\tthree\tmanager\tnodes\tto\ta\tswarm.\tWhy\tdid\twe\tadd\tthree\tand\nhow\tdo\tthey\twork\ttogether?\tWe’ll\tanswer\tall\tof\tthis,\tplus\tmore\tin\tthis\tsection.\nSwarm\t\nmanagers\n\thave\tnative\tsupport\tfor\thigh\tavailability\t(H/A).\tThis\tmeans\nthat\tone\tor\tmore\tcan\tfail\tand\tthe\tsurvivors\twill\tkeep\tthe\tswarm\trunning.\nTechnically\tspeaking,\tswarm\tmode\timplements\ta\tform\tof\tactive-passive\tmulti-\nmanager\tH/A.\tThis\tmeans\tthat\talthough\tyou\tmight\t-\tand\tshould\t-\thave\tmultiple\nmanagers\n,\tonly\tone\tof\tthem\tis\tever\tconsidered\t\nactive\n.\tWe\tcall\tthis\tactivemanager\tthe\t\nleader\n.\tAnd\tthe\tleader’s\tthe\tonly\tone\tthat\twill\tever\tissue\tlive\ncommands\tagainst\tthe\t\nswarm\n\tsuch\tas\tchanging\tthe\tconfiguration\tof\tthe\tswarm\nor\tissuing\ttasks\tto\tworkers.\tIf\ta\tnon-active\tmanager\treceives\tcommands\tfor\tthe\nswarm\tit’ll\tproxy\tthem\tacross\tto\tthe\tleader.\nThis\tprocess\tis\tshown\tin\tFigure\t9.3\twhere\tstep\t\n1\n\tis\tthe\tcommand\tcoming\tin\tto\ta\nmanager\n\tfrom\ta\tremote\tDocker\tclient.\tStep\t2\tis\tthe\tnon-leader\tmanager\nproxying\tthe\tcommand\tto\tthe\tleader.\tStep\t3\tis\tthe\tleader\tpushing\tthat\tcommand\nto\tthe\trelevant\tnode\tin\tthe\tswarm.\nFigure\t9.3\nSwarm\tuses\tan\timplementation\tof\tthe\t\nRaft\tconsensus\talgorithm\n\tto\tpower\nmanager\tHA,\tand\tthe\tfollowing\ttwo\tbest\tpractices\tapply:\n1\n.\t\nDeploy\tan\todd\tnumber\tof\tmanagers.\n2\n.\t\nDon’t\tdeploy\ttoo\tmany\tmanagers\t(3\tor\t5\tis\trecommended)\nHaving\tan\todd\tnumber\tof\t\nmanagers\n\tincreases\tthe\tchance\tof\treaching\tquorum\nand\tavoiding\ta\tsplit-brain.\tFor\texample,\tif\tyou\thad\t4\tmanagers\tand\tthe\tnetwork\npartitioned,\tyou\tcould\tbe\tleft\twith\ttwo\tmanagers\ton\teach\tside\tof\tthe\tpartition.\nThis\tis\tknown\tas\ta\tsplit\tbrain\t-\teach\tside\tknows\tthere\tused\tto\tbe\t4\tbut\tcan\tnow\nonly\tsee\t2.\tNeither\tside\thas\tany\tway\tof\tknowing\tif\tthe\ttwo\tit\tcan\tno\tlonger\tsee\nare\tstill\talive\tand\twhich\tside\tholds\tthe\tmajority\tshare\t(quorum).\tHowever,\tif\tyou\nhad\t3\tor\t5\tmanagers\tand\tthe\tsame\tnetwork\tpartition\toccurred,\tit\twould\tbe\nimpossible\tto\thave\tthe\tsame\tnumber\tof\tmanagers\ton\tboth\tsides\tof\tthe\tsplit.\tThis\nmeans\tthat\tone\tside\twould\thave\ta\tfar\tbetter\tchance\tof\tknowing\tif\tit\thad\tmore\tor\nless\tthan\tthe\tother\tside\tand\tachieving\tquorum.Figure\t9.4\nAs\twith\tall\tconsensus\talgorithms\t-\tmore\tparticipants\tmeans\tmore\ttime\trequired\nto\tachieve\tconsensus.\tIt’s\tlike\tdeciding\twhere\tto\teat\t-\tit’s\talways\tquicker\tand\neasier\tfor\t3\tpeople\tto\tdecide\tthan\tit\tis\tfor\t33!\tWith\tthis\tin\tmind,\tit’s\ta\tbest\npractice\tto\thave\teither\t3\tor\t5\tmanagers\tfor\tHA.\t7\tmight\twork,\tbut\tit’s\tgenerally\naccepted\tthat\t3\tor\t5\tis\toptimal.\tYou\tdefinitely\tdon’t\twant\tmore\tthan\t7\tas\tthe\ttime\ntaken\tto\tachieve\tconsensus\twill\tbe\tlonger.\nA\tfinal\tword\tof\tcaution\tregarding\tmanager\tHA.\tWhile\tit’s\tobviously\ta\tgood\npractice\tto\tspread\tyour\tmanagers\tacross\tavailability\tzones\twithin\tyour\tnetwork,\nyou\tneed\tto\tmake\tsure\tthat\tthe\tnetworks\tconnecting\tthem\tare\treliable!\tNetwork\npartitions\tcan\tbe\ta\troyal\tpain\tin\tthe\tbackside!\tThis\tmeans,\tat\tthe\ttime\tof\twriting,\nthe\tnirvana\tof\thosting\tyour\tactive\tproduction\tapplications\tand\tinfrastructure\nacross\tmultiple\tcloud\tproviders\tsuch\tas\tAWS\tand\tAzure\tis\ta\tbit\tof\ta\tdaydream.\nTake\ttime\tto\tmake\tsure\tyour\tmanagers\tare\tconnected\tvia\thigh\tspeed\treliable\nnetworks!\nNow\tthat\twe’ve\tgot\tour\t\nswarm\n\tbuilt\tand\tunderstand\tthe\tconcepts\tof\t\nleaders\n\tand\nmanager\tHA\n,\tlet’s\tmove\ton\tto\t\nservices\n.\nServices\nLike\twe\tsaid\tin\tthe\t\nSwarm\tprimer\n…\tservices\tare\ta\tnew\tconstruct\tintroduced\nwith\tDocker\t1.12\tthat\tonly\texist\tin\t\nswarm\tmode\n.\nThey\tlet\tus\t\ndeclare\n\tthe\t\ndesired\tstate\n\tfor\tan\tapplication\tservice\tand\tfeed\tthat\tto\nDocker.\tFor\texample,\tassume\tyou’ve\tgot\tan\tapp\tthat\thas\ta\tweb\tfront-end.\tYou\nhave\tan\timage\tfor\tthe\tweb\tservice,\tand\ttesting\thas\tshown\tthat\tyou\twill\tneed\t5instances\tof\tthe\tweb\tservice\tto\thandle\tnormal\tdaily\ttraffic.\tYou\twould\ttranslate\nthis\trequirement\tinto\ta\t\nservice\n\tdeclaring\tthe\timage\tthe\tcontainers\tshould\tuse,\nand\tthat\tthe\tservice\tshould\talways\thave\t5\trunning\ttasks.\nWe’ll\tsee\tsome\tof\tthe\tother\tthings\tthat\tcan\tbe\tdeclared\tas\tpart\tof\ta\tservice\tin\ta\nminute,\tbut\tbefore\twe\tdo\tthat,\tlet’s\tsee\thow\tto\tcreate\twhat\twe\tjust\tdescribed.\nWe\tcreate\ta\tservice\twith\tthe\t\ndocker\tservice\tcreate\n\tcommand.\nNote:\n\tThe\tcommand\tto\tcreate\ta\tnew\tservice\tis\tthe\tsame\ton\tWindows.\nHowever,\tthe\timage\tused\tin\tthe\texample\tbelow\tis\ta\tLinux\timage\tand\twill\nnot\twork\ton\tWindows.\tYou\tcan\tsubstitute\tthe\timage\tfor\ta\tWindows\tweb\nserver\timage\tand\tthe\tcommand\twill\twork.\tRemember,\tif\tyou\tare\ttyping\nWindows\tcommands\tform\ta\tPowerShell\tterminal\tyou\twill\tneed\tto\tuse\tthe\nbacktick\t(`)\tcharacter\tto\tindicate\tcontinuation\ton\tthe\tnext\tline.\n$\tdocker\tservice\tcreate\t--name\tweb-fe\t\n\\\n\t\t\t-p\t\n8080\n:8080\t\n\\\n\t\t\t--replicas\t\n5\n\t\n\\\n\t\t\tnigelpoulton/pluralsight-docker-ci\nz7ovearqmruwk0u2vc5o7ql0p\nLet’s\treview\tthat\tcommand\tand\toutput.\nWe\tused\t\ndocker\tservice\tcreate\n\tto\ttell\tDocker\twe\tare\tdeclaring\ta\tnew\tservice,\nand\twe\tused\tthe\t\n--name\n\tflag\tto\tname\tthe\tservice\t\nweb-fe\n.\tWe\ttold\tDocker\tto\tmap\nport\t8080\ton\tevery\tnode\tin\tthe\tswarm\tto\t8080\tinside\tof\teach\tcontainer\t(task)\tin\nthe\tservice.\tNext,\twe\tused\tthe\t\n--replicas\n\tflag\tto\ttell\tDocker\tthat\tthere\tshould\nalways\tbe\t5\ttasks/containers\tin\tthe\tservice.\tFinally,\twe\ttold\tDocker\twhich\timage\nto\tuse\tfor\tall\ttasks\tand\tcontainers\t-\tit’s\timportant\tto\tunderstand\tthat\tall\ttasks\tin\ta\nservice\tuse\tthe\tsame\timage\tand\tconfig!\nAfter\twe\thit\t\nReturn\n,\tthe\tmanager\tacting\tas\tleader\tinstantiated\t5\ttasks\tacross\tthe\nswarm\n\t-\tremember\tthat\tmanagers\talso\tact\tas\tworkers.\tEach\tworker\tor\tmanager\nthen\tpulled\tthe\timage\tand\tstarted\ta\tcontainer\tfrom\tit\trunning\ton\tport\t8080.\tThe\nswarm\tleader\talso\tensured\ta\tcopy\tof\tthe\tservice’s\tdesired\tstate\twas\treplicated\tto\nevery\tmanager\tin\tthe\tswarm.\nBut\tthis\tisn’t\tthe\tend.\tAll\t\nservices\n\tare\tconstantly\tmonitored\tby\tthe\tswarm\t-\tthe\nswarm\n\truns\ta\treconciliation\tloop\tthat\tconstantly\tcompares\tthe\t\nactual\tstate\n\tof\ttheservice\tto\tthe\t\ndesired\tstate\n.\tIf\tthe\ttwo\tstates\tmatch,\tthe\tworld\tis\ta\thappy\tplace\nand\tno\tfurther\taction\tis\tneeded.\tIf\tthey\tdon’t\tmatch,\tthe\tswarm\ttakes\tactions\tso\nthat\tthey\tdo.\tPut\tanother\tway,\tthe\tswarm\tis\tconstantly\tmaking\tsure\tthat\t\nactual\nstate\n\tmatches\t\ndesired\tstate\n.\nAs\tan\texample,\tif\tone\tof\tthe\t\nworkers\n\thosting\tone\tof\tthe\t5\t\nweb-fe\n\tcontainer\ttasks\nfails,\tthe\t\nactual\tstate\n\tfor\tthe\t\nweb-fe\n\tservice\twill\tdrop\tfrom\t5\trunning\ttasks\tto\t4.\nThis\twill\tno\tlonger\tmatch\tthe\t\ndesired\tstate\n\tof\t5,\tso\tDocker\twill\tstart\ta\tnew\t\nweb-\nfe\n\ttask\tto\tbring\t\nactual\tstate\n\tback\tin\tline\twith\t\ndesired\tstate\n.\tThis\tbehavior\tis\tvery\npowerful\tand\tallows\tthe\tservice\tto\tself-heal\tin\tthe\tevent\tof\tnode\tfailures\tand\tthe\nlikes.\nViewing\tand\tinspecting\tservices\nYou\tcan\tuse\tthe\t\ndocker\tservice\tls\n\tcommand\tto\tsee\ta\tlist\tof\tall\tservices\nrunning\ton\ta\tswarm.\n$\tdocker\tservice\tls\nID\t\t\t\t\t\t\t\tNAME\t\t\t\t\tMODE\t\t\t\t\t\t\t\tREPLICAS\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tPORTS\nz7o...uw\t\tweb-fe\t\t\treplicated\t\t\n5\n/5\t\t\t\t\t\t\t\tnigel...ci:latest\t\t\t*:8080->8080/t\n\\\ncp\nThe\toutput\tabove\tshows\ta\tsingle\trunning\tservice\tas\twell\tas\tsome\tbasic\ninformation\tabout\tstate.\tAmong\tother\tthings,\twe\tcan\tsee\tthe\tname\tof\tthe\tservice\nand\tthat\t5\tout\tof\tthe\t5\tdesired\ttasks/replicas\tare\tin\tthe\trunning\tstate.\tIf\tyou\trun\nthis\tcommand\tsoon\tafter\tdeploying\tthe\tservice\tit\tmight\tnot\tshow\tall\ntasks/replicas\tas\trunning.\tThis\tis\tprobably\tbecause\tof\tthe\ttime\tit\ttakes\tto\tpull\tthe\nimage\ton\teach\tnode.\nYou\tcan\tuse\tthe\t\ndocker\tservice\tps\n\tcommand\tto\tsee\ta\tlist\tof\ttasks\tin\ta\tservice\nand\ttheir\tstate.\n$\tdocker\tservice\tps\tweb-fe\nID\t\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\t\t\tNODE\t\tDESIRED\t\tCURRENT\n817\n...f6z\t\tweb-fe.1\t\tnigelpoulton/...\t\tmgr2\t\tRunning\t\tRunning\t\n2\n\tmins\na1d...mzn\t\tweb-fe.2\t\tnigelpoulton/...\t\twrk1\t\tRunning\t\tRunning\t\n2\n\tmins\ncc0...ar0\t\tweb-fe.3\t\tnigelpoulton/...\t\twrk2\t\tRunning\t\tRunning\t\n2\n\tmins\n6f0...azu\t\tweb-fe.4\t\tnigelpoulton/...\t\tmgr3\t\tRunning\t\tRunning\t\n2\n\tmins\ndyl...p3e\t\tweb-fe.5\t\tnigelpoulton/...\t\tmgr1\t\tRunning\t\tRunning\t\n2\n\tmins\nThe\tformat\tof\tthe\tcommand\tis\t\ndocker\tservice\tps\t<service-name\tor\nservice-id>\n.\tThe\toutput\tdisplays\teach\ttask\t(container)\ton\tits\town\tline,\tshows\nwhich\tnode\tin\tthe\tswarm\tit’s\texecuting\ton,\tand\tshows\tdesired\tstate\tand\tactual\nstate.For\tdetailed\tinformation\tabout\ta\tservice,\tuse\tthe\t\ndocker\tservice\tinspect\ncommand.\n$\tdocker\tservice\tinspect\t--pretty\tweb-fe\nID:\t\t\t\t\t\t\t\t\t\t\t\t\tz7ovearqmruwk0u2vc5o7ql0p\nName:\t\t\t\t\t\t\t\t\t\t\tweb-fe\nService\tMode:\t\t\tReplicated\n\tReplicas:\t\t\t\t\t\t\n5\nPlacement:\nUpdateConfig:\n\tParallelism:\t\t\t\n1\n\tOn\tfailure:\t\t\t\tpause\n\tMonitoring\tPeriod:\t5s\n\tMax\tfailure\tratio:\t\n0\n\tUpdate\torder:\t\t\t\t\t\tstop-first\nRollbackConfig:\n\tParallelism:\t\t\t\n1\n\tOn\tfailure:\t\t\t\tpause\n\tMonitoring\tPeriod:\t5s\n\tMax\tfailure\tratio:\t\n0\n\tRollback\torder:\t\t\t\tstop-first\nContainerSpec:\n\tImage:\t\t\tnigelpoulton/pluralsight-docker-ci:latest@sha256:7a6b01...d8d3d\nResources:\nEndpoint\tMode:\t\tvip\nPorts:\n\t\nPublishedPort\n\t\n=\n\t\n8080\n\t\t\nProtocol\n\t\n=\n\ttcp\n\t\t\nTargetPort\n\t\n=\n\t\n8080\n\t\t\nPublishMode\n\t\n=\n\tingress\nThe\texample\tabove\tuses\tthe\t\n--pretty\n\tflag\tto\tlimit\tthe\toutput\tto\tthe\tmost\ninteresting\titems\tprinted\tin\tan\teasy-to-read\tformat.\tLeaving\toff\tthe\t\n--pretty\nflag\twill\tgive\ta\tmore\tverbose\toutput.\nWe’ll\tcome\tback\tto\tsome\tof\tthese\toutputs\tlater.\nLet’s\tgo\tand\tsee\thow\tto\tscale\ta\tservice.\nScaling\ta\tservice\nAnother\tpowerful\tfeature\tof\t\nservices\n\tis\tthe\tability\tto\teasily\tscale\tthem\tup\tand\ndown.\nLet’s\tassume\tbusiness\tis\tbooming\tand\twe’re\tseeing\tdouble\tthe\tamount\tof\nanticipated\ttraffic\thitting\tthe\tweb\tfront-end.\tFortunately,\tscaling\tthe\t\nweb-fe\nservice\tis\tas\tsimple\tas\trunning\tthe\t\ndocker\tservice\tscale\n\tcommand.\n$\tdocker\tservice\tscale\tweb-fe\n=\n10\nweb-fe\tscaled\tto\t\n10The\tabove\tcommand\twill\tscale\tthe\tnumber\tof\ttasks/replicas\tfrom\t5\tto\t10.\tIn\tthe\nbackground\tit’s\tupdating\tthe\tservice’s\t\ndesired\tstate\n\tfrom\t5\tto\t10.\tRun\tanother\ndocker\tservice\tls\n\tcommand\tto\tverify\tthe\toperation\twas\tsuccessful.\n$\tdocker\tservice\tls\nID\t\t\t\t\t\t\t\tNAME\t\t\t\t\tMODE\t\t\t\t\t\t\t\tREPLICAS\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tPORTS\nz7o...uw\t\tweb-fe\t\t\treplicated\t\t\n10\n/10\t\t\t\t\t\tnigel...ci:latest\t\t\t*:8080->8080/t\n\\\ncp\nRunning\ta\t\ndocker\tservice\tps\n\tcommand\twill\tshow\tthat\tthe\ttasks\tin\tthe\tservice\nare\tbalanced\tacross\tall\tnodes\tin\tthe\tswarm\tas\tevenly\tas\tpossible.\n$\tdocker\tservice\tps\tweb-fe\nID\t\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\t\t\tNODE\t\tDESIRED\t\tCURRENT\nnwf...tpn\t\tweb-fe.1\t\tnigelpoulton/...\t\tmgr1\t\tRunning\t\tRunning\t\n7\n\tmins\nyb0...e3e\t\tweb-fe.2\t\tnigelpoulton/...\t\twrk3\t\tRunning\t\tRunning\t\n7\n\tmins\nmos...gf6\t\tweb-fe.3\t\tnigelpoulton/...\t\twrk2\t\tRunning\t\tRunning\t\n7\n\tmins\nutn...6ak\t\tweb-fe.4\t\tnigelpoulton/...\t\twrk3\t\tRunning\t\tRunning\t\n7\n\tmins\n2ge...fyy\t\tweb-fe.5\t\tnigelpoulton/...\t\tmgr3\t\tRunning\t\tRunning\t\n7\n\tmins\n64y...m49\t\tweb-fe.6\t\tigelpoulton/...\t\t\twrk3\t\tRunning\t\tRunning\tabout\ta\tmin\nild...51s\t\tweb-fe.7\t\tnigelpoulton/...\t\tmgr1\t\tRunning\t\tRunning\tabout\ta\tmin\nvah...rjf\t\tweb-fe.8\t\tnigelpoulton/...\t\twrk2\t\tRunning\t\tRunning\tabout\ta\tmins\nxe7...fvu\t\tweb-fe.9\t\tnigelpoulton/...\t\tmgr2\t\tRunning\t\tRunning\t\n45\n\tseconds\tago\nl7k...jkv\t\tweb-fe.10\tnigelpoulton/...\t\tmgr2\t\tRunning\t\tRunning\t\n46\n\tseconds\tago\nBehind\tthe\tscenes,\tswarm-mode\truns\ta\tscheduling\talgorithm\tthat\tdefaults\tto\ntrying\tto\tbalance\ttasks\tas\tevenly\tas\tpossible\tacross\tthe\tnodes\tin\tthe\tswarm.\tAt\nthe\ttime\tof\twriting,\tthis\tamounts\tto\trunning\tan\tequal\tnumber\tof\ttasks\ton\teach\nnode\twithout\ttaking\tinto\tconsideration\tthings\tlike\tCPU\tload\tetc.\nRun\tanother\t\ndocker\tservice\tscale\n\tcommand\tto\tbring\tthe\tnumber\tback\tdown\nfrom\t10\tto\t5.\n$\tdocker\tservice\tscale\tweb-fe\n=\n5\nweb-fe\tscaled\tto\t\n5\nNow\tthat\twe\tknow\thow\tto\tscale\ta\tservice,\tlet’s\tsee\thow\twe\tremove\tone.\nRemoving\ta\tservice\nRemoving\ta\tservice\tis\tsimple\t-\tmay\tbe\ttoo\tsimple.\nThe\tfollowing\t\ndocker\tservice\trm\n\tcommand\twill\tdelete\tthe\tservice\twe\ndeployed\tearlier.\n$\tdocker\tservice\trm\tweb-fe\nweb-feConfirm\tthe\tservice\tis\tgone\twith\tthe\t\ndocker\tservice\tls\n\tcommand.\n$\tdocker\tservice\tls\nID\t\t\t\t\t\tNAME\t\t\t\tMODE\t\t\tREPLICAS\t\t\t\tIMAGE\t\t\t\t\t\tPORTS\nBe\tcareful\tusing\tthe\t\ndocker\tservice\trm\n\tcommand\tas\tit\tdeletes\tall\ttasks\tin\ta\nservice\twithout\tasking\tfor\tconfirmation.\nNow\tthat\tthe\tservice\tis\tdeleted\tfrom\tthe\tsystem,\tlet’s\tgo\tand\tlook\tat\thow\tto\tpush\nrolling\tupdates\tto\ta\tservice.\nRolling\tupdates\nPushing\tupdates\tto\tdeployed\tapplications\tis\ta\tfact\tof\tlife.\tAnd\tfor\tthe\tlongest\ntime\tit’s\tbeen\treally\tpainful.\tI’ve\tlost\tmore\tthan\tenough\tweekends\tto\tmajor\napplication\tupdates,\tand\tI’ve\tno\tintention\tof\tgoing\tthere\tagain\tif\tI\tcan\thelp\tit.\nWell…\tthanks\tto\tDocker\t\nservices\n,\tpushing\tupdates\tto\twell-designed\tapps\tjust\ngot\ta\twhole\tlot\teasier!\nTo\tsee\tthis,\twe’re\tgoing\tto\tdeploy\ta\tnew\tservice.\tBut\tbefore\twe\tdo\tthat\twe’re\ngoing\tto\tcreate\ta\tnew\toverlay\tnetwork\tfor\tthe\tservice.\tThis\tisn’t\tnecessary,\tbut\tI\nwant\tyou\tto\tsee\thow\tit\tis\tdone\tand\thow\tthe\tservice\tuses\tit.\n$\tdocker\tnetwork\tcreate\t-d\toverlay\tuber-net\n43wfp6pzea470et4d57udn9ws\nThis\tcreates\ta\tnew\toverlay\tnetwork\tcalled\t“uber-net”\tthat\twe’ll\tbe\table\tto\nleverage\twith\tthe\tservice\twe’re\tabout\tto\tcreate.\tAn\toverlay\tnetwork\tessentially\ncreates\ta\tnew\tlayer\t2\tnetwork\tthat\twe\tcan\tplace\tcontainers\ton,\tand\tall\tcontainers\non\tit\twill\tbe\table\tto\tcommunicate\twith\teach\tother.\tThis\tworks\teven\tif\tthe\tDocker\nhosts\tthey’re\trunning\ton\tare\ton\tdifferent\tunderlying\tnetworks.\tBasically,\tthe\noverlay\tnetwork\tcreates\ta\tnew\tlayer\t2\tcontainer\tnetwork\ton\ttop\tof\tpotentially\nmultiple\tdifferent\tunderlying\tnetworks.\nFigure\t9.5\tshows\ttwo\tunderlay\tnetworks\tconnected\tby\ta\tlayer\t3\trouter.\tThere\tis\nthen\ta\tsingle\toverlay\tnetwork\tacross\tboth.\tDocker\thosts\tare\tconnected\tto\tthe\ttwo\nunderlay\tnetworks\tand\tcontainers\tare\tconnected\tto\tthe\toverlay.\tAll\tcontainers\ton\nthe\toverlay\tcan\tcommunicate\twith\teach\tother\teven\tif\tthey\tare\trunning\ton\tDocker\nhosts\tplumbed\tinto\tdifferent\tunderlay\tnetworks.Figure\t9.5\nRun\ta\t\ndocker\tnetwork\tls\n\tto\tverify\tthat\tthe\tnetwork\tcreated\tproperly\tand\tis\nvisible\ton\tthe\tDocker\thost.\n$\tdocker\tnetwork\tls\nNETWORK\tID\t\t\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDRIVER\t\t\t\t\t\tSCOPE\n490e2496e06b\t\t\t\t\t\t\t\tbridge\t\t\t\t\t\t\t\t\t\t\t\t\t\tbridge\t\t\t\t\t\t\nlocal\na0559dd7bb08\t\t\t\t\t\t\t\tdocker_gwbridge\t\t\t\t\tbridge\t\t\t\t\t\t\nlocal\na856a8ad9930\t\t\t\t\t\t\t\thost\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thost\t\t\t\t\t\t\t\t\nlocal\n1ailuc6rgcnr\t\t\t\t\t\t\t\tingress\t\t\t\t\t\t\t\t\t\t\t\t\toverlay\t\t\t\t\tswarm\nbe581cd6de9b\t\t\t\t\t\t\t\tnone\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnull\t\t\t\t\t\t\t\t\nlocal\n43wfp6pzea47\t\t\t\t\t\t\t\tuber-net\t\t\t\t\t\t\t\t\t\t\t\toverlay\t\t\t\t\tswarm\nThe\t\nuber-net\n\tnetwork\twas\tsuccessfully\tcreated\twith\tthe\t\nswarm\n\tscope\tand\tis\ncurrently\tonly\tvisible\ton\tmanager\tnodes\tin\tthe\tswarm.\nLet’s\tgo\tand\tcreate\ta\tnew\tservice.\n$\tdocker\tservice\tcreate\t--name\tuber-svc\t\n\\\n\t\t\t--network\tuber-net\t\n\\\n\t\t\t-p\t\n80\n:80\t--replicas\t\n12\n\t\n\\\n\t\t\tnigelpoulton/tu-demo:v1\ndhbtgvqrg2q4sg07ttfuhg8nz\nLet’s\tsee\twhat\twe\tjust\tdeclared\twith\tthat\t\ndocker\tservice\tcreate\n\tcommand.\nThe\tfirst\tthing\twe\tdid\twas\tname\tthe\tservice\tand\tthen\tuse\tthe\t\n--network\n\tflag\tto\ntell\tit\tto\tplace\tall\tcontainers\ton\tthe\tnew\t\nuber-net\n\tnetwork.\tWe\tthen\texposed\tport\n80\tacross\tthe\tentire\tswarm\tand\tmapped\tit\tto\tport\t80\tinside\tof\teach\tof\tthe\t12\nreplicas\tor\ttasks\twe\tasked\tit\tto\trun.\tFinally,\twe\ttold\tit\tto\tbase\tall\ttasks\ton\tthe\nnigelpoulton/tu-demo:v1\timage.\nRun\ta\t\ndocker\tservice\tls\n\tand\ta\t\ndocker\tservice\tps\n\tcommand\tto\tverify\tthe\nstate\tof\tthe\tnew\tservice.\n$\tdocker\tservice\tls\nID\t\t\t\t\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\tREPLICAS\t\tIMAGE\ndhbtgvqrg2q4\t\tuber-svc\t\t\n12\n/12\t\t\t\t\tnigelpoulton/tu-demo:v1\n$$\tdocker\tservice\tps\tuber-svc\nID\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\t\t\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNODE\t\tDESIRED\t\t\tCURRENT\tSTATE\n0v...7e5\t\tuber-svc.1\t\t\t\tnigelpoulton/...:v1\t\twrk3\t\tRunning\t\t\tRunning\t\n1\n\tmin\nbh...wa0\t\tuber-svc.2\t\t\t\tnigelpoulton/...:v1\t\twrk2\t\tRunning\t\t\tRunning\t\n1\n\tmin\n23\n...u97\t\tuber-svc.3\t\t\t\tnigelpoulton/...:v1\t\twrk2\t\tRunning\t\t\tRunning\t\n1\n\tmin\n82\n...5y1\t\tuber-svc.4\t\t\t\tnigelpoulton/...:v1\t\tmgr2\t\tRunning\t\t\tRunning\t\n1\n\tmin\nc3...gny\t\tuber-svc.5\t\t\t\tnigelpoulton/...:v1\t\twrk3\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne6...3u0\t\tuber-svc.6\t\t\t\tnigelpoulton/...:v1\t\twrk1\t\tRunning\t\t\tRunning\t\n1\n\tmin\n78\n...r7z\t\tuber-svc.7\t\t\t\tnigelpoulton/...:v1\t\twrk1\t\tRunning\t\t\tRunning\t\n1\n\tmin\n2m...kdz\t\tuber-svc.8\t\t\t\tnigelpoulton/...:v1\t\tmgr3\t\tRunning\t\t\tRunning\t\n1\n\tmin\nb9...k7w\t\tuber-svc.9\t\t\t\tnigelpoulton/...:v1\t\tmgr3\t\tRunning\t\t\tRunning\t\n1\n\tmin\nag...v16\t\tuber-svc.10\t\t\tnigelpoulton/...:v1\t\tmgr2\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne6...dfk\t\tuber-svc.11\t\t\tnigelpoulton/...:v1\t\tmgr1\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne2...k1j\t\tuber-svc.12\t\t\tnigelpoulton/...:v1\t\tmgr1\t\tRunning\t\t\tRunning\t\n1\n\tmin\nPassing\tthe\tservice\tthe\t\n-p\t80:80\n\tflag\twill\tensure\tthat\ta\t\nswarm-wide\n\tmapping\tis\ncreated\tthat\tmaps\ttraffic\tcoming\tin\tto\tany\tnode\tin\tthe\tswarm\ton\tport\t80\tthrough\nto\tport\t80\tinside\tof\tany\tcontainer\tin\tthe\tservice.\nOpen\ta\tweb\tbrowser\tand\tpoint\tit\tto\tthe\tIP\taddress\tof\tany\tof\tthe\tnodes\tin\tthe\nswarm\ton\tport\t80\tto\tsee\tthe\tapp\trunning\tin\tthe\tservice.\nFigure\t9.6\nAs\tyou\tcan\tsee,\tthe\tapplication\tis\ta\tsimple\tvoting\tapplication\tthat\twill\tregister\nvotes\tfor\teither\t“football”\tor\t“soccer”.\tFeel\tfree\tto\tpoint\tyour\tweb\tbrowser\tto\nother\tnodes\tin\tthe\tswarm.\tYou\twill\tbe\table\tto\treach\tthe\tweb\tserver\tfrom\tany\nnode\tin\tthe\tswam\tbecause\tthe\t\n-p\t80:80\n\tflag\tcreates\ta\tmapping\ton\tevery\thost.\nThis\tis\ttrue\teven\ton\tnodes\tthat\tare\tnot\trunning\ta\ttask\tfor\tthe\tservice\t-\t\nevery\nnode\tgets\ta\tmapping\tand\tcan\ttherefore\tredirect\tyour\trequest\tto\ta\tnode\tthat\nruns\tthe\tservice\n.Now\tlet’s\tassume\tthat\tthis\tparticular\tvote\thas\tcome\tto\tan\tend\tand\tyour\tcompany\nis\tnow\trunning\ta\tnew\tpoll.\tA\tnew\timage\thas\tbeen\tcreated\tfor\tthe\tnew\tpoll\tand\nhas\tbeen\tadded\tto\tthe\tsame\tDocker\tHub\trepository,\tbut\tthis\tone\tis\ttagged\tas\t\nv2\ninstead\tof\t\nv1\n.\nLet’s\talso\tassume\tthat\tyou’ve\tbeen\ttasked\twith\tpushing\tthe\tupdated\timage\tto\tthe\nswarm\tin\ta\tstaged\tmanner\t-\t2\tcontainers\tat\ta\ttime\twith\ta\t20\tsecond\tdelay\tin\nbetween\teach\tbatch\tof\t2.\tWe\tcan\tuse\tthe\tfollowing\t\ndocker\tservice\tupdate\ncommand\tto\taccomplish\tthis.\n$\tdocker\tservice\tupdate\t\n\\\n\t\t\t--image\tnigelpoulton/tu-demo:v2\t\n\\\n\t\t\t--update-parallelism\t\n2\n\t\n\\\n\t\t\t--update-delay\t20s\tuber-svc\nuber-svc\nLet’s\treview\tthe\tcommand.\t\ndocker\tservice\tupdate\n\tlets\tus\tmake\tupdates\tto\nrunning\tservices\tby\tupdating\tthe\tservice’s\tdesired\tstate.\tThis\ttime\twe\tgave\tit\ta\nnew\timage\ttag\t\nv2\n\tinstead\tof\t\nv1\n.\tAnd\twe\tused\tthe\t\n--update-parallelism\n\tand\nthe\t\n--upate-delay\n\tflags\tto\tmake\tsure\tthat\tthe\tnew\timage\twas\tpushed\tto\t2\ttasks\nat\ta\ttime\twith\ta\t20\tsecond\tcool-off\tperiod\tin\tbetween\teach\tpair.\tFinally,\twe\ttold\nDocker\tto\tmake\tthese\tchanges\tto\tthe\t\nuber-svc\n\tservice.\nIf\twe\trun\ta\t\ndocker\tservice\tps\n\tagainst\tthe\tservice\twe’ll\tsee\tthat\tsome\tof\tthe\ntasks\tin\tthe\tservice\tare\tat\t\nv2\n\twhile\tsome\tare\tat\t\nv1\n.\tIf\twe\tgive\tthe\toperation\nenough\ttime\tto\tcomplete\t(4\tminutes)\tall\ttasks\twill\teventually\treach\tthe\tnew\ndesired\tstate\tof\tusing\tthe\t\nv2\n\timage.\n$\tdocker\tservice\tps\tuber-svc\nID\t\t\t\t\t\t\t\tNAME\t\t\t\t\t\t\t\t\t\t\t\t\t\tIMAGE\t\t\t\t\t\t\t\tNODE\t\t\tDESIRED\t\t\tCURRENT\tSTATE\n7z...nys\t\tuber-svc.1\t\t\t\tnigel...v2\t\t\tmgr2\t\tRunning\t\t\tRunning\t\n13\n\tsecs\n0v...7e5\t\t\n\\_\nuber-svc.1\t\tnigel...v1\t\t\twrk3\t\tShutdown\t\tShutdown\t\n13\n\tsecs\nbh...wa0\t\tuber-svc.2\t\t\t\tnigel...v1\t\t\twrk2\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne3...gr2\t\tuber-svc.3\t\t\t\tnigel...v2\t\t\twrk2\t\tRunning\t\t\tRunning\t\n13\n\tsecs\n23\n...u97\t\t\n\\_\nuber-svc.3\t\tnigel...v1\t\t\twrk2\t\tShutdown\t\tShutdown\t\n13\n\tsecs\n82\n...5y1\t\tuber-svc.4\t\t\t\tnigel...v1\t\t\tmgr2\t\tRunning\t\t\tRunning\t\n1\n\tmin\nc3...gny\t\tuber-svc.5\t\t\t\tnigel...v1\t\t\twrk3\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne6...3u0\t\tuber-svc.6\t\t\t\tnigel...v1\t\t\twrk1\t\tRunning\t\t\tRunning\t\n1\n\tmin\n78\n...r7z\t\tuber-svc.7\t\t\t\tnigel...v1\t\t\twrk1\t\tRunning\t\t\tRunning\t\n1\n\tmin\n2m...kdz\t\tuber-svc.8\t\t\t\tnigel...v1\t\t\tmgr3\t\tRunning\t\t\tRunning\t\n1\n\tmin\nb9...k7w\t\tuber-svc.9\t\t\t\tnigel...v1\t\t\tmgr3\t\tRunning\t\t\tRunning\t\n1\n\tmin\nag...v16\t\tuber-svc.10\t\t\tnigel...v1\t\t\tmgr2\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne6...dfk\t\tuber-svc.11\t\t\tnigel...v1\t\t\tmgr1\t\tRunning\t\t\tRunning\t\n1\n\tmin\ne2...k1j\t\tuber-svc.12\t\t\tnigel...v1\t\t\tmgr1\t\tRunning\t\t\tRunning\t\n1\n\tmin\nYou\tcan\twitness\tthe\tupdate\thappening\tin\treal-time\tby\topening\ta\tweb\tbrowser\tto\nany\tnode\tin\tthe\tswarm\tand\thitting\trefresh\tseveral\ttimes.\tSome\tof\tthe\trequestswill\tbe\tserviced\tby\tcontainers\trunning\tthe\told\tversion\tand\tsome\twill\tbe\tserviced\nby\tcontainers\trunning\tthe\tnew\tversion.\tAfter\tenough\ttime\tall\trequests\twill\tbe\nserviced\tby\tcontainers\trunning\tthe\tupdated\tcopy\tof\tthe\tservice.\nCongratulations.\tYou’ve\tjust\tpushed\ta\trolling\tupdate\tto\ta\tlive\tcontainerized\napplication.\nIf\tyou\trun\ta\t\ndocker\tinspect\t--pretty\n\tcommand\tagainst\tthe\tservice\tyou’ll\tsee\nthe\tupdate\tparallelism\tand\tupdate\tdelay\tsettings\tyou\tjust\tused\tare\tnow\tpart\tof\tthe\nservice\tdefinition.\tThis\tmeans\tfuture\tupdates\tthat\tyou\tpush\twill\tautomatically\nuse\tthese\tsettings\tunless\tyou\toverride\tthem\tas\tpart\tof\tthe\t\ndocker\tservice\nupdate\n\tcommand.\n$\tdocker\tservice\tinspect\t--pretty\tuber-svc\nID:\t\t\t\t\t\t\t\t\t\t\t\t\tmub0dgtc8szm80ez5bs8wlt19\nName:\t\t\t\t\t\t\t\t\t\t\tuber-svc\nService\tMode:\t\t\tReplicated\n\tReplicas:\t\t\t\t\t\t\n12\nUpdateStatus:\n\tState:\t\t\t\t\t\t\t\t\tupdating\n\tStarted:\t\t\t\t\t\t\tAbout\ta\tminute\n\tMessage:\t\t\t\t\t\t\tupdate\tin\tprogress\nPlacement:\nUpdateConfig:\n\tParallelism:\t\t\t\n2\n\tDelay:\t\t\t\t\t\t\t\t\t20s\n\tOn\tfailure:\t\t\t\tpause\n\tMonitoring\tPeriod:\t5s\n\tMax\tfailure\tratio:\t\n0\n\tUpdate\torder:\t\t\t\t\t\tstop-first\nRollbackConfig:\n\tParallelism:\t\t\t\n1\n\tOn\tfailure:\t\t\t\tpause\n\tMonitoring\tPeriod:\t5s\n\tMax\tfailure\tratio:\t\n0\n\tRollback\torder:\t\t\t\tstop-first\nContainerSpec:\n\tImage:\t\t\t\tnigelpoulton/tu-demo:v2@sha256:d3c0d8c9...cf0ef2ba5eb74c\nResources:\nNetworks:\tuber-net\nEndpoint\tMode:\t\tvip\nPorts:\n\t\nPublishedPort\n\t\n=\n\t\n80\n\t\t\nProtocol\n\t\n=\n\ttcp\n\t\t\nTargetPort\n\t\n=\n\t\n80\n\t\t\nPublishMode\n\t\n=\n\tingress\nYou\tshould\talso\tnote\ta\tcouple\tof\tthings\tabout\tthe\tservice’s\tnetwork\tconfig.\tAll\nnodes\tin\tthe\tswarm\tthat\tare\trunning\ta\ttask\tfor\tthe\tservice\twill\thave\tthe\t\nuber-net\noverlay\tnetwork\tthat\twe\tcreated\tearlier.\tWe\tcan\tverify\tthis\tby\trunning\t\ndocker\nnetwork\tls\n\ton\tany\tnode\trunning\ta\ttask.You\tshould\talso\tnote\tthe\t\nNetworks\n\tportion\tof\tthe\t\ndocker\tinspect\n\toutput\tabove.\nThis\tshows\tthe\t\nuber-net\n\tnetwork\tas\twell\tas\tthe\tswarm-wide\t\n80:80\n\tport\nmapping.\nThe\tfuture\tof\tservices\nServices\tare\tthe\tpreferred\tway\tto\tdeploy\tand\tmanager\tDockerized\tapplications.\nWe\tshould\texpect\tto\tsee\tsignificant\tdevelopment\taround\tthem.\nIn\tthis\tchapter\twe’ve\tshown\tyou\thow\tto\tdeclare\ta\tservice\tusing\tthe\t\ndocker\nservice\tcreate\n\tcommand\tand\tpassing\tit\ta\tlot\tof\tflags\tand\toptions.\tIn\tthe\tfuture\nwe\tshould\texpect\tto\tbe\table\tto\tpass\tthe\tcommand\ta\tJSON\tor\tYAML\tfile\tthat\nholds\tthe\tentire\tservice\tdeclaration.\tThis\twill\tallow\tus\tto\tkeep\ta\trepository\tof\nservice\tdefinition\tfiles,\tversion\tcontrol\tthem,\tand\teasily\tpass\tthem\tto\tDocker\tto\ninstantiate\tnew\tservices.\tExpect\tthis\tvery\tsoon.\nIn\tthe\tmore\tdistant\tfuture\twe\tmay\teven\tsee\tnon-container\tworkloads\trunning\nunder\tthe\tauspices\tof\tservices.\tWe\tsaid\tearlier\tin\tthe\tchapter\tthat\tservice\t\ntasks\n\t=\ncontainers.\tHowever,\tthe\texecutor\tcomponent\tof\tthe\tswarm\tarchitecture,\twhich\ncurrently\texecutes\tcontainer\tworkloads,\tis\tpluggable.\tThis\tmeans\tyou\tmight\tbe\nable\tto\tswap\tit\tout\tin\tthe\tfuture\tfor\texecutors\tthat\tcan\trun\tthings\tlike\tunikernel\nworkloads.\tHowever,\tthis\tis\tvery\tforward\tthinking.\nA\tquick\tword\ton\tthe\tmaturity\tof\t\nswarm\tmode\nSwarm\tmode\n\tis\tbased\ton\tthe\tbattle-hardened\tand\tproduction-tested\tcode\tfrom\nthe\tDocker\tSwarm\tproject.\tAt\ta\thigh-level,\tall\tof\tthe\tgood\tstuff\tfrom\tDocker\nSwarm\twas\textracted\tand\tdumped\tinto\ta\tre-usable\ttoolkit\tcalled\t\nSwarmKit\n.\tThis\nwas\tthen\timplemented\tnatively\tinto\tthe\tDocker\tplatform,\tand\t\nswarm\tmode\n\twas\nborn.\nBut\tthe\tpoint\tto\tnote\tis\tthat\talthough\t\nswarm\tmode\n\twas\tnew\tin\tDocker\t1.12,\tit’s\nnot\tlike\tthe\tproject\trecklessly\tdropped\tin\tthousands\tof\tlines\tof\tbrand\tnew\tcode\nthat\thad\tnever\tseen\tthe\tlight\tof\tday.\tThe\tunderlying\tcode\thas\tbeen\taround\tfor\ta\nwhile\tand\twas\tbeing\tactively\tdeployed\tin\tproduction\tenvironments.\nThat\tall\tsaid,\tyou\tshould\tstill\tperform\tyour\tnormal\ttesting\tbefore\tdeciding\tto\trun\nyour\tbusiness-critical\tapps\ton\tit!\nClean-upLet’s\tclean-up\tour\tservice.\n$\tdocker\tservice\trm\tuber-svc\nuber-svc\nVerify\tthe\tuber-svc\tis\tno\tlonger\trunning\twith\tthe\t\ndocker\tservice\tls\n\tcommand.\n$\tdocker\tservice\tls\nID\t\tNAME\t\tREPLICAS\t\tIMAGE\t\tCOMMAND\nRemove\tthe\tuber-net\tnetwork\twith\t\ndocker\tnetwork\trm\tuber-net\n.Swarm\tmode\t-\tThe\tcommands\ndocker\tswarm\tinit\n\tis\tthe\tcommand\tto\tcreate\ta\tnew\tswarm.\tThe\tnode\tthat\nyou\trun\tthe\tcommand\ton\tbecomes\tthe\tfirst\tmanager\tin\tthe\tnew\tswarm\tand\nis\tswitched\tto\trun\tin\t\nswarm\tmode\n.\ndocker\tswarm\tjoin-token\n\treveals\tthe\tcommands\tand\ttokens\trequired\tto\njoin\tworkers\tand\tmanagers\tto\texisting\tswarms.\tTo\texpose\tthe\tcommand\tto\njoin\ta\tnew\tmanager\tuse\tthe\t\ndocker\tswarm\tjoin-token\tmanager\n\tcommand,\nand\tto\tget\tthe\tcommand\tto\tjoin\ta\tworker\tuse\tthe\t\ndocker\tswarm\tjoin-\ntoken\tworker\n\tcommand.\ndocker\tnode\tls\n\tlists\tall\tnodes\tin\tthe\tswarm\tand\tlists\twhich\tare\tmanagers\nand\twhich\tis\tthe\tleader.\ndocker\tservice\tcreate\n\tis\tthe\tcommand\tto\tdeclaratively\tcreate\ta\tnew\nservice.\ndocker\tservice\tls\n\tlists\trunning\tservices\tin\tthe\tswarm\tand\tgives\tbasic\tinfo\non\tthe\tstate\tof\tthe\tservice\tand\tany\ttasks\tit’s\trunning.\ndocker\tservice\tps\t<service>\n\tgives\tmore\tdetailed\tinformation\tabout\nindividual\ttasks\trunning\tin\ta\tservice.\ndocker\tservice\tinspect\n\tgives\tvery\tdetailed\tinformation\ton\ta\tservice.\tIt\naccepts\tthe\t\n--pretty\n\tflag\tto\tlimit\tthe\tinformation\treturned\tto\tthe\tmost\nimportant\tinformation.\ndocker\tservice\tscale\n\tlets\tyou\tscale\tthe\tnumber\tof\ttasks\tin\ta\tservice\tup\nand\tdown.\ndocker\tservice\tupdate\n\tlets\tyou\tupdate\tmany\tof\tthe\tproperties\tof\ta\nrunning\tservice.\ndocker\tservice\trm\n\tis\tthe\tcommand\tto\tdelete\ta\tservice\tfrom\tthe\tswarm.\nUse\tit\twith\tcaution\tas\tit\tdeletes\tall\ttasks\tin\ta\tservice\twithout\tasking\tfor\nconfirmation.Chapter\tsummary\nIn\tthis\tchapter\twe\tlearned\tabout\tswarm\tmode\tand\thow\tto\tbuild\ta\tswarm.\nWe\tused\tthe\t\ndocker\tswarm\tinit\n\tcommand\tto\tcreate\ta\tnew\tswarm\tand\tmake\tthe\nnode\twe\tran\tthe\tcommand\ton\tthe\tfirst\tmanager\tof\tthat\tswarm.\tWe\tthen\tjoined\nmanagers\tand\tworkers.\tWe\tlearned\tthat\tmanagers\toperate\tin\tan\tHA\tformation\nand\tthe\trecommended\tnumber\tof\tmanagers\tis\teither\t3\tor\t5.\nWe\tlearned\thow\tto\tdeclare\tservices\tand\trun\tthem\ton\ta\tswarm.\tWe\tsaw\thow\nnetwork\tports\tare\texposed\tacross\tthe\tentire\tswarm\tallowing\tus\tto\thit\tany\tnode\tin\nthe\tswarm\tand\treach\tthe\tservice\tendpoint\t-\teven\tif\tthe\tnode\twe\thit\twasn’t\nrunning\ta\ttask\tfor\tthe\tservice.\nWe\twrapped\tthe\tchapter\tup\tby\tscaling\ta\tservice\tup\tthen\tdown,\tand\tpushing\tan\nupdate\tto\ta\tlive\tservice\tusing\ta\trolling\tupdate.10:\tDocker\toverlay\tnetworking\nContainer\tnetworking\tis\tincreasingly\timportant.\tEspecially\tin\tproduction\nenvironments.\nIn\tthis\tchapter\twe’ll\tcover\tthe\tfundamentals\tof\tnative\tDocker\toverlay\nnetworking\tas\timplemented\tin\ta\tDocker\tswarm\tcluster.\nAt\tthe\ttime\tof\twriting\tthis\trevision\tof\tthe\tbook,\tDocker\tnetworking\ton\tWindows\nhas\tcome\ta\tlong\tway.\tThe\texamples\twe’ll\tuse\tin\tthis\tchapter\twill\tall\twork\ton\nWindows\tas\twell\tas\tLinux.\nWe’ll\tsplit\tthis\tchapter\tinto\tthe\tusual\tthree\tparts:\nThe\tTLDR\nThe\tdeep\tdive\nThe\tcommands\nLet’s\tgo\tdo\tsome\tnetworking\tmagic!Docker\toverlay\tnetworking\t-\tThe\tTLDR\nIn\tthe\treal\tworld\tit’s\tvital\tthat\tcontainers\tcan\tcommunicate\twith\teach\tother\nreliably\tand\tsecurely,\teven\twhen\tthey’re\ton\tdifferent\thosts\ton\tdifferent\tnetworks.\nThis\tis\twhere\toverlay\tnetworking\tcomes\tin\tto\tplay.\tIt\tallows\tyou\tto\tcreate\ta\tflat\nsecure\tlayer\t2\tnetwork\tspanning\tmultiple\thosts\tthat\tcontainers\tcan\tconnect\tto.\nContainers\ton\tthis\tnetwork\tcan\tthen\tcommunicate\tdirectly.\nDocker\toffers\tnative\toverlay\tnetworking\tthat\tis\tsimple\tto\tconfigure\tand\tsecure\nby\tdefault.\nBehind\tthe\tscenes\tDocker\tnetworking\tis\tcomprised\tof\t\nlibnetwork\n\tand\t\ndrivers\n.\nLibnetwork\tis\tthe\tcanonical\timplementation\tof\tthe\tContainer\tNetwork\tModel\n(CNM)\tand\tdrivers\tare\tpluggable\tcomponents\tthat\timplement\tdifferent\nnetworking\ttechnologies\tand\ttopologies.\tDocker\toffers\tnative\tdrivers\tsuch\tas\tthe\noverlay\n\tdriver,\tand\tthird\tparties\talso\toffer\tdrivers.Docker\toverlay\tnetworking\t-\tThe\tdeep\tdive\nIn\tMarch\t2015\tDocker,\tInc.\tacquired\tcontainer\tnetworking\tstartup\t\nSocket\tPlane\n.\nTwo\tof\tthe\treasons\tbehind\tthe\tacquisition\twere\tto\tbring\t\nreal\tnetworking\n\tto\nDocker,\tand\tto\tmake\tcontainer\tnetworking\tso\tsimple\tthat\teven\tdevelopers\tcould\ndo\tit\t:-P\nThey’re\tmaking\tgreat\tprogress\ton\tboth\taccounts.\nBut\thiding\tbehind\tthe\tsimple\tnetworking\tcommands\tare\ta\tlot\tof\tmoving\tparts.\nThe\tkind\tof\tstuff\tyou\tneed\tunderstand\tbefore\tdoing\tproduction\tdeployments\tand\nattempting\tto\ttroubleshoot\tissues!\nThe\trest\tof\tthis\tchapter\twill\tbe\tbroken\tinto\ttwo\tparts:\nPart\t1:\twe’ll\tbuild\tand\ttest\ta\tDocker\toverlay\tnetwork\tin\tswarm\tmode\nPart\t2:\tWe’ll\texplain\tthe\ttheory\tbehind\thow\tit\tworks.\nBuild\tand\ttest\ta\tDocker\toverlay\tnetwork\tin\tswarm\tmode\nFor\tthe\tfollowing\texamples\twe’ll\tuse\ttwo\tDocker\thosts\ton\ttwo\tseparate\tLayer\t2\nnetworks\tconnected\tby\ta\trouter\tas\tshown\tin\tFigure\t10.1.\nFigure\t10.1\nYou\tcan\tfollow\talong\twith\teither\tLinux\tor\tWindows\tDocker\thosts.\tLinux\tshould\nhave\ta\t4.4\tLinux\tkernel\t(newer\tis\talways\tbetter)\tand\tWindows\tshould\tbe\nWindows\tServer\t2016\twith\tthe\tlatest\thotfixes\tinstalled.\t\nThe\texamples\tin\tthe\nbook\thave\tbeen\ttested\tusing\tDocker\t17.05\ton\tLinux\tand\t17.03\ton\tWindows.Build\ta\tswarm\nThe\tfirst\tthing\twe’ll\tdo\tis\tconfigure\tthe\ttwo\thosts\tinto\ta\ttwo-node\tSwarm.\tWe’ll\nrun\tthe\t\ndocker\tswarm\tinit\n\tcommand\ton\t\nnode1\n\tto\tmake\tit\ta\t\nmanager\n,\tand\tthen\nwe’ll\trun\tthe\t\ndocker\tswarm\tjoin\n\tcommand\ton\t\nnode2\n\tto\tmake\tit\ta\t\nworker\n.\nWarning:\tIf\tyou\tare\tfollowing\talong\tin\tyour\town\tlab\tyou’ll\tneed\tto\tswap\nthe\tIP\taddresses,\tcontainer\tIDs,\ttokens\tetc.\twith\tthe\tcorrect\tvalues\tfor\tyour\nenvironment.\nRun\tthe\tfollowing\tcommand\ton\t\nnode1\n.\n$\tdocker\tswarm\tinit\t\n\\\n\t\t--advertise-addr\n=\n172\n.31.1.5\t\n\\\n\t\t--listen-addr\n=\n172\n.31.1.5:2377\nSwarm\tinitialized:\tcurrent\tnode\t\n(\n1ex3...o3px\n)\n\tis\tnow\ta\tmanager.\nTo\tadd\ta\tworker\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\t\tdocker\tswarm\tjoin\t\\\n\t\t\t\t--token\tSWMTKN-1-0hz2ec...2vye\t\\\n\t\t\t\t172.31.1.5:2377\nRun\tthe\tnext\tcommand\ton\t\nnode2\n.\tFor\tthis\tcommand\tto\twork\ton\tWindows\nServer\tyou\tmay\tneed\tto\tmodify\tyour\tfirewall\trules\tto\tallow\tports\t\n2377/tcp\n,\n7946/tcp\n\tand\t\n7946/udp\n.\n$\tdocker\tswarm\tjoin\t\n\\\n\t\t--token\tSWMTKN-1-0hz2ec...2vye\t\n\\\n\t\t\n172\n.31.1.5:2377\nThis\tnode\tjoined\ta\tswarm\tas\ta\tworker.\nWe\tnow\thave\ta\ttwo-node\tSwarm\twhere\t\nnode1\n\tis\ta\tmanager\tand\t\nnode2\n\tis\ta\nworker.\nCreate\ta\tnew\toverlay\tnetwork\nNow\tlet’s\tcreate\ta\tnew\t\noverlay\tnetwork\n\tcalled\t\nuber-net\n.\nRun\tthe\tfollowing\tcommand\tfrom\t\nnode1\n\tthat\twas\tjust\tcreated\tas\ta\t\nmanager\n.\t\nFor\nthis\tto\twork\ton\tWindows\tyou\tmay\tneed\tto\tadd\ta\trule\tfor\tport\t\n4789/udp\n\ton\tyour\nWindows\tDocker\thosts.\n$\tdocker\tnetwork\tcreate\t-d\toverlay\tuber-net\nc740ydi1lm89khn5kd52skrd9That’s\tit!\tYou’ve\tjust\tcreated\ta\tbrand-new\toverlay\tnetwork\tthat\tis\tavailable\tto\tall\nhosts\tin\tthe\tswarm\tand\thas\tits\tcontrol\tplane\tencrypted\twith\tTLS!\t\nIf\tyou\twant\tto\nencrypt\tthe\tdata\tplane\tyou\tcan\tjust\tadd\tthe\t\n-o\tencrypted\n\tflag\tto\tthe\tcommand.\nYou\tcan\tlist\tall\tnetworks\ton\teach\tnode\twith\tthe\t\ndocker\tnetwork\tls\n\tcommand.\n$\tdocker\tnetwork\tls\nNETWORK\tID\t\t\t\t\t\tNAME\t\t\t\t\t\t\t\t\t\t\t\t\t\tDRIVER\t\t\t\t\tSCOPE\nddac4ff813b7\t\t\t\tbridge\t\t\t\t\t\t\t\t\t\t\t\tbridge\t\t\t\t\t\nlocal\n389a7e7e8607\t\t\t\tdocker_gwbridge\t\t\tbridge\t\t\t\t\t\nlocal\na09f7e6b2ac6\t\t\t\thost\t\t\t\t\t\t\t\t\t\t\t\t\t\thost\t\t\t\t\t\t\t\nlocal\nehw16ycy980s\t\t\t\tingress\t\t\t\t\t\t\t\t\t\t\toverlay\t\t\t\tswarm\n2b26c11d3469\t\t\t\tnone\t\t\t\t\t\t\t\t\t\t\t\t\t\tnull\t\t\t\t\t\t\t\nlocal\nc740ydi1lm89\t\t\t\tuber-net\t\t\t\t\t\t\t\t\t\toverlay\t\t\t\tswarm\nThe\toutput\twill\tlook\tmore\tlike\tthis\ton\ta\tWindows\tserver:\nNETWORK\tID\t\t\t\t\t\tNAME\t\t\t\t\t\t\t\t\t\t\t\t\tDRIVER\t\t\t\t\t\tSCOPE\n8iltzv6sbtgc\t\t\t\tingress\t\t\t\t\t\t\t\t\t\toverlay\t\t\t\t\tswarm\n6545b2a61b6f\t\t\t\tnat\t\t\t\t\t\t\t\t\t\t\t\t\t\tnat\t\t\t\t\t\t\t\t\tlocal\n96d0d737c2ee\t\t\t\tnone\t\t\t\t\t\t\t\t\t\t\t\t\tnull\t\t\t\t\t\t\t\tlocal\nnil5ouh44qco\t\t\t\tuber-net\t\t\t\t\t\t\t\t\toverlay\t\t\t\t\tswarm\nThe\tnetwork\twe\tcreated\tis\tat\tthe\tbottom\tof\tthe\tlist\tcalled\t\nuber-net\n.\tThe\tother\nnetworks\twere\tautomatically\tcreated\twhen\tDocker\twas\tinstalled\tand\twhen\twe\ncreated\tthe\tswarm.\tWe’re\tonly\tinterested\tin\tthe\t\nuber-net\n\toverlay\tnetwork.\nIf\tyou\trun\tthe\t\ndocker\tnetwork\tls\n\tcommand\ton\t\nnode2\n\tyou’ll\tnotice\tthat\tit\tcan’t\nsee\tthe\t\nuber-net\n\tnetwork.\tThis\tis\tbecause\tnew\toverlay\tnetworks\tare\tonly\tmade\navailable\tto\tworker\tnodes\tthat\tare\trunning\tcontainers\tattached\tto\tthe\toverlay.\nThis\treduces\tthe\tscope\tof\tthe\tnetwork\tgossip\tprotocol\tand\thelps\twith\tscalability.\nAttach\ta\tservice\tto\tthe\toverlay\tnetwork\nLet’s\tcreate\ta\tnew\t\nDocker\tservice\n\tand\tattach\tit\tto\tthe\t\nuber-net\n\toverlay\tnetwork.\nWe’ll\tcreate\tthe\tservice\twith\ttwo\treplicas\t(containers)\tso\tthat\tone\truns\ton\t\nnode1\nand\tthe\tother\truns\ton\t\nnode2\n.\tThis\twill\tautomatically\textend\tthe\t\nuber-net\noverlay\tto\t\nnode2\nRun\tthe\tfollowing\tcommands\tfrom\t\nnode1\n.\nLinux\texample:\n$\tdocker\tservice\tcreate\t--name\t\ntest\n\t\n\\\n\t\t\t--network\tuber-net\t\n\\\n\t\t\t--replicas\t\n2\n\t\n\\\n\t\t\tubuntu\tsleep\tinfinityWindows\texample:\n>\tdocker\tservice\tcreate\t--name\ttest\t`\n\t\t--network\tuber-net\t`\n\t\t--replicas\t2\t`\n\t\tmicrosoft\\powershell:nanoserver\tStart-Sleep\t3600\nNote:\n\tThe\tWindows\texample\tabove\tuses\tthe\tbacktick\tcharacter\tto\tsplit\nparameters\tover\tmultiple\tlines\tto\tmake\tthe\tcommand\tmore\treadable.\nThe\tcommand\tcreates\ta\tnew\tservice\tcalled\t\ntest\n,\tattaches\tit\tto\tthe\t\nuber-net\noverlay\tnetwork,\tand\tcreates\ttwo\tcontainers\t(replicas)\tbased\ton\tthe\timage\nprovided.\tIn\tboth\texamples\twe\tissued\ta\tsleep\tcommand\tto\tthe\tcontainer\tto\tkeep\nthem\trunning\tand\tstop\tthem\tfrom\texiting.\nBecause\twe’re\trunning\ttwo\tcontainers\t(replicas)\tand\tthe\tSwarm\thas\ttwo\tnodes,\none\tcontainer\twill\trun\ton\teach\tnode.\nVerify\tthe\toperation\twith\ta\t\ndocker\tservice\tps\n\tcommand.\n$\tdocker\tservice\tps\t\ntest\nID\t\t\t\t\t\t\t\t\t\tNAME\t\t\t\tIMAGE\t\t\tNODE\t\t\t\tDESIRED\tSTATE\t\tCURRENT\tSTATE\n77q...rkx\t\t\ttest.1\t\tubuntu\t\tnode1\t\t\tRunning\t\t\t\t\t\t\t\tRunning\n97v...pa5\t\t\ttest.2\t\tubuntu\t\tnode2\t\t\tRunning\t\t\t\t\t\t\t\tRunning\nWhen\tSwarm\tstarts\ta\tcontainer\ton\tan\toverlay\tnetwork\tit\tautomatically\textends\nthat\tnetwork\tto\tthe\tnode\tthe\tcontainer\tis\trunning\ton.\tThis\tmeans\tthat\tthe\t\nuber-\nnet\n\tnetwork\tis\tnow\tvisible\ton\t\nnode2\n.\nCongratulations!\tYou’ve\tcreated\ta\tnew\toverlay\tnetwork\tspanning\ttwo\tnodes\ton\nseparate\tphysical\tunderlay\tnetworks,\tand\tyou’ve\tscheduled\ttwo\tcontainers\ton\nthe\tnetwork.\tHow\tsimple\twas\tthat!Figure\t10.2\nTest\tthe\toverlay\tnetwork\nNow\tlet’s\ttest\tthe\toverlay\tnetwork\twith\tthe\tping\tcommand.\nTo\tdo\tthis,\twe\tneed\tto\tdo\ta\tbit\tof\tdigging\taround\tto\tget\teach\tcontainer’s\tIP\naddress.\nRun\ta\t\ndocker\tnetwork\tinspect\n\tto\tsee\tthe\t\nSubnet\n\tassigned\tto\tthe\toverlay.\n$\tdocker\tnetwork\tinspect\tuber-net\n[\n\t\t\t\t\n{\n\t\t\t\t\t\t\t\t\n\"Name\"\n:\t\n\"uber-net\"\n,\n\t\t\t\t\t\t\t\t\n\"Id\"\n:\t\n\"c740ydi1lm89khn5kd52skrd9\"\n,\n\t\t\t\t\t\t\t\t\n\"Scope\"\n:\t\n\"swarm\"\n,\n\t\t\t\t\t\t\t\t\n\"Driver\"\n:\t\n\"overlay\"\n,\n\t\t\t\t\t\t\t\t\n\"EnableIPv6\"\n:\tfalse,\n\t\t\t\t\t\t\t\t\n\"IPAM\"\n:\t\n{\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Driver\"\n:\t\n\"default\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Options\"\n:\tnull,\n\t\t\t\t\t\t\t\t\t\t\t\t\n\"Config\"\n:\t\n[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"Subnet\"\n:\t\n\"10.0.0.0/24\"\n,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\"Gateway\"\n:\t\n\"10.0.0.1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n}\n<Snip>\nThe\toutput\tabove\tshows\tthat\t\nuber-net\n’s\tsubnet\tis\t\n10.0.0.0/24\n.\tNote\tthat\tthis\ndoes\tnot\tmatch\teither\tof\tthe\tphysical\tunderlay\tnetworks\t(\n172.31.1.0/24\n\tand\n192.168.1.0/24\n).\nRun\tthe\tfollowing\ttwo\tcommands\ton\t\nnode1\n\tand\t\nnode2\n\tto\tget\tthe\tcontainer\tID’s\nand\ttheir\tIP\taddresses.\tBe\tsure\tto\tuse\tthe\tCONTAINER\tID\tfrom\tyour\town\tlab\tin\nthe\tsecond\tcommand.$\tdocker\tcontainer\tls\nCONTAINER\tID\t\t\tIMAGE\t\t\t\t\t\t\t\t\t\t\tCOMMAND\t\t\t\t\t\t\t\t\t\t\tCREATED\t\t\t\t\t\tSTATUS\n396c8b142a85\t\t\tubuntu:latest\t\t\t\n\"sleep\tinfinity\"\n\t\t\n2\n\thours\tago\t\tUp\t\n2\n\thrs\n$\n$\tdocker\tcontainer\tinspect\t\n\\\n\t\t--format\n=\n'{{range\t.NetworkSettings.Networks}}{{.IPAddress}}{{end}}'\n\t396c8b\n\\\n142a85\n10\n.0.0.3\nMake\tsure\tyou\trun\tthese\tcommands\ton\tboth\tnodes\tto\tget\tthe\tIP\taddresses\tof\nboth\tcontainers.\nFigure\t10.3\tshows\tthe\tconfiguration\tso\tfar.\nFigure\t10.3\nAs\twe\tcan\tsee,\tthere\tis\ta\tLayer\t2\toverlay\tnetwork\tspanning\tboth\thosts,\tand\teach\ncontainer\thas\tan\tIP\taddress\ton\tthis\toverlay\tnetwork.\tThis\tmeans\tthat\tthe\ncontainer\ton\t\nnode1\n\twill\tbe\table\tto\tping\tthe\tcontainer\ton\t\nnode2\n\tusing\tits\n10.0.0.4\n\taddress\tfrom\tthe\toverlay\tnetwork.\tThis\tworks\tdespite\tthe\tfact\tthat\nboth\tnodes\tare\ton\tseparate\tLayer\t2\tunderlay\tnetworks.\tLet’s\tprove\tit.\nLog\ton\tto\tthe\tcontainer\ton\t\nnode1\n\tand\tping\tthe\tremote\tcontainer.\nTo\tdo\tthis\ton\tthe\tLinux\tUbuntu\tcontainer\tyou\twill\tneed\tto\tinstall\tthe\t\nping\n\tutility.\nIf\tyou’re\tfollowing\talong\twith\tthe\tWindows\tPowerShell\texample\tthe\t\nping\n\tutility\nis\talready\tinstalled.\nRemember\tthat\tthe\tcontainer\tIDs\tused\tbelow\twill\tbe\tdifferent\tin\tyour\nenvironment.\nLinux\texample:$\n\t\ndocker\n\t\ncontainer\n\t\nexec\n\t\n-\nit\n\t\n396\nc8b142a85\n\t\nbash\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\n\t\napt\n-\nget\n\t\nupdate\n<\nSnip\n>\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\n\t\napt\n-\nget\n\t\ninstall\n\t\niputils\n-\nping\nReading\n\t\npackage\n\t\nlists\n...\n\t\nDone\nBuilding\n\t\ndependency\n\t\ntree\nReading\n\t\nstate\n\t\ninformation\n...\n\t\nDone\n<\nSnip\n>\nSetting\n\t\nup\n\t\niputils\n-\nping\n\t\n(\n3\n:\n20121221\n-\n5u\nbuntu2\n)\n\t\n...\nProcessing\n\t\ntriggers\n\t\nfor\n\t\nlibc\n-\nbin\n\t\n(\n2.23\n-\n0u\nbuntu3\n)\n\t\n...\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\nroot\n@396\nc8b142a85\n:\n/\n#\n\t\nping\n\t\n10.0.0.4\nPING\n\t\n10.0.0.4\n\t\n(\n10.0.0.4\n)\n\t\n56\n(\n84\n)\n\t\nbytes\n\t\nof\n\t\ndata\n.\n64\n\t\nbytes\n\t\nfrom\n\t\n10.0.0.4\n:\n\t\nicmp_seq\n=\n1\n\t\nttl\n=\n64\n\t\ntime\n=\n1.06\n\t\nms\n64\n\t\nbytes\n\t\nfrom\n\t\n10.0.0.4\n:\n\t\nicmp_seq\n=\n2\n\t\nttl\n=\n64\n\t\ntime\n=\n1.07\n\t\nms\n64\n\t\nbytes\n\t\nfrom\n\t\n10.0.0.4\n:\n\t\nicmp_seq\n=\n3\n\t\nttl\n=\n64\n\t\ntime\n=\n1.03\n\t\nms\n64\n\t\nbytes\n\t\nfrom\n\t\n10.0.0.4\n:\n\t\nicmp_seq\n=\n4\n\t\nttl\n=\n64\n\t\ntime\n=\n1.26\n\t\nms\n^\nC\nroot\n@396\nc8b142a85\n:\n/\n#\nWindows\texample:\n>\tdocker\tcontainer\texec\t-it\t1a4f29e5a4b6\tPowerShell.exe\nWindows\tPowerShell\nCopyright\t(C)\t2016\tMicrosoft\tCorporation.\tAll\trights\treserved.\nPS\tC:\\>\nPS\tC:\\>\tping\t10.0.0.4\nPinging\t10.0.0.4\twith\t32\tbytes\tof\tdata:\nReply\tfrom\t10.0.0.4:\tbytes=32\ttime=1ms\tTTL=128\nReply\tfrom\t10.0.0.4:\tbytes=32\ttime<1ms\tTTL=128\nReply\tfrom\t10.0.0.4:\tbytes=32\ttime=2ms\tTTL=128\nReply\tfrom\t10.0.0.4:\tbytes=32\ttime=2ms\tTTL=12\nPS\tC:\\>\nAs\tshown\tabove,\tthe\tcontainer\ton\t\nnode1\n\tcan\tping\tthe\tcontainer\ton\t\nnode2\n\tusing\nthe\toverlay\tnetwork.\nYou\tcan\talso\ttrace\tthe\troute\tof\tthe\tping\tcommand\tfrom\twithin\tthe\tcontainer.\nThis\twill\treport\tonly\ta\tsingle\thop,\tproving\tthat\tthe\tcontainers\tare\tcommunicating\ndirectly\tover\tthe\toverlay\tnetwork\t-\tblissfully\tunaware\tof\tany\tunderlay\tnetworks\nthat\tare\tbeing\ttraversed.\nFor\tthe\ttraceroute\tto\twork\ton\tthe\tLinux\texample\tyou\twill\tneed\tto\tinstall\tthe\ntraceroute\tpackage.\nLinux\texample:$\n\t\nroot\n@396\nc8b142a85\n:\n/\n#\n\t\ntraceroute\n\t\n10.0.0.4\ntraceroute\n\t\nto\n\t\n10.0.0.4\n\t\n(\n10.0.0.4\n),\n\t\n30\n\t\nhops\n\t\nmax\n,\n\t\n60\n\t\nbyte\n\t\npackets\n\t\n1\n\t\t\ntest\n-\nsvc\n.2.97\nv\n...\na5\n.\nuber\n-\nnet\n\t\n(\n10.0.0.4\n)\n\t\t\n1.110\nms\n\t\t\n1.034\nms\n\t\t\n1.073\nms\nWindows\texample:\nPS\tC:\\>\ttracert\t10.0.0.3\nTracing\troute\tto\ttest.2.ttcpiv3p...7o4.uber-net\t[10.0.0.4]\nover\ta\tmaximum\tof\t30\thops:\n\t\t1\t\t<1\tms\t\t<1\tms\t\t<1\tms\t\ttest.2.ttcpiv3p...7o4.uber-net\t[10.0.0.4]\nTrace\tcomplete.\nSo\tfar,\twe’ve\tcreated\tan\toverlay\tnetwork\twith\ta\tsingle\tcommand.\tWe\tthen\tadded\ncontainers\tto\tthe\toverlay\tnetwork\ton\ttwo\thosts\ton\ttwo\tdifferent\tLayer\t2\nnetworks.\tOnce\twe\tworked\tout\tthe\tcontainer’s\tIP\taddresses,\twe\tproved\tthat\tthey\ncould\ttalk\tdirectly\tover\tthe\toverlay\tnetwork.\nThe\ttheory\tof\thow\tit\tall\tworks\nNow\tthat\twe’ve\tseen\thow\tto\tbuild\tand\tuse\ta\tcontainer\toverlay\tnetwork,\tlet’s\tfind\nout\thow\tit’s\tall\tput\ttogether\tbehind\tthe\tscenes.\nNote:\n\tIn\tthis\tsection\tsome\tof\tthe\tdetail\twill\tbe\tspecific\tto\tLinux.\tHowever,\nthe\tsame\toverall\tprinciples\tapply\tto\tWindows.\nVXLAN\tprimer\nFirst\tand\tforemost,\tDocker\toverlay\tnetworking\tuses\tVXLAN\ttunnels\tto\tcreate\nvirtual\tLayer\t2\toverlay\tnetworks.\tSo,\tbefore\twe\tgo\tany\tfurther,\tlet’s\tdo\ta\tquick\nVXLAN\tprimer.\nAt\tthe\thighest\tlevel,\tVXLANs\tlet\tyou\tcreate\ta\tvirtual\tLayer\t2\tnetwork\ton\ttop\tof\nan\texisting\tLayer\t3\tinfrastructure.\tThe\texample\twe\tused\tearlier\tcreated\ta\tnew\n10.0.0.0/24\tLayer\t2\tnetwork\ton\ttop\tof\ta\tLayer\t3\tIP\tnetwork\tcomprising\ttwo\nLayer\t2\tnetworks\t-\t172.31.1.0/24\tand\t192.168.1.0/24.\tThis\tis\tshown\tin\tFigure\n10.4\tbelow.Figure\t10.4\nThe\tbeauty\tof\tVXLAN\tis\tthat\tit’s\tan\tencapsulation\ttechnology\tthat\texisting\nrouters\tand\tnetwork\tinfrastructure\tjust\tsee\tas\tregular\tIP/UDP\tpackets\tand\thandle\nwithout\tissue.\nTo\tcreate\tthe\tvirtual\tLayer\t2\toverlay\tnetwork\ta\tVXLAN\t\ntunnel\n\tis\tcreated\nthrough\tthe\tunderlying\tLayer\t3\tIP\tinfrastructure.\tYou\tmight\thear\tthe\tterm\nunderlay\tnetwork\n\tused\tto\trefer\tto\tthe\tunderlying\tLayer\t3\tinfrastructure.\nEach\tend\tof\tthe\tVXLAN\ttunnel\tis\tterminated\tby\ta\tVXLAN\tTunnel\tEndpoint\n(VTEP).\tIt’s\tthis\tVTEP\tthat\tperforms\tthe\tencapsulation/de-encapsulation\tand\nother\tmagic\trequired\tto\tmake\tall\tof\tthis\twork.\tSee\tFigure\t10.5.\nFigure\t10.5\nWalk\tthrough\tour\ttwo-container\texampleIn\tthe\texample\twe\tbuilt\tearlier,\twe\thad\ttwo\thosts\tconnected\tvia\tan\tIP\tnetwork.\nEach\thost\tran\ta\tsingle\tcontainer,\tand\twe\tcreated\ta\tsingle\tVXLAN\toverlay\nnetwork\tfor\tthe\tcontainers\tto\tconnect\tto.\nTo\taccomplish\tthis,\ta\tnew\t\nnetwork\tnamespace\n\twas\tcreated\ton\teach\thost.\tA\nnetwork\tnamespace\n\tis\tlike\ta\tcontainer,\tbut\tinstead\tof\trunning\tan\tapplication\tit\nruns\tan\tisolated\tnetwork\tstack\t-\tone\tthat’s\tsandboxed\tfrom\tthe\tnetwork\tstack\ton\nthe\thost\titself.\nA\tvirtual\tswitch\t(a.k.a.\tvirtual\tbridge)\tcalled\t\nBr0\n\tis\tcreated\tinside\tthe\tnetwork\nnamespace.\tA\tVTEP\tis\talso\tcreated\twith\tone\tend\tplumbed\tinto\tthe\t\nBr0\n\tvirtual\nswitch,\tand\tthe\tother\tend\tplumbed\tinto\tthe\thost\tnetwork\tstack.\tThe\tend\tin\tthe\nhost\tnetwork\tstack\tgets\tan\tIP\taddress\ton\tthe\tunderlay\tnetwork\tthe\thost\tis\nconnected\tto\tand\tis\tbound\tto\ta\tUDP\tsocket\ton\tport\t4789.\tThe\ttwo\tVTEPs\ton\neach\thost\tcreate\tthe\toverlay\tvia\ta\tVXLAN\ttunnel\tas\tseen\tin\tFigure\t10.6.\nFigure\t10.6\nThis\tis\tessentially\tthe\tVXLAN\toverlay\tnetwork\tcreated\tand\tready\tfor\tuse.\nEach\tcontainer\tthen\tgets\tits\town\tvirtual\tEthernet\t(veth)\tadapter\tthat\tis\talso\nplumbed\tinto\tthe\tlocal\t\nBr0\n\tvirtual\tswitch.\tThe\ttopology\tnow\tlooks\tlike\tFigure\n10.7,\tand\tit\tshould\tbe\tgetting\teasier\tto\tsee\thow\tthe\ttwo\tcontainers\tcan\ncommunicate\tover\tthe\tVXLAN\toverlay\tnetwork\tdespite\ttheir\thosts\tbeing\ton\ttwo\nseparate\tnetworks.Figure\t10.7\nCommunication\texample\nNow\tthat\twe’ve\tseen\tthe\tmain\tplumbing\telements\tlet’s\tsee\thow\tthe\ttwo\ncontainers\tcommunicate.\nFor\tthis\texample,\twe’ll\tcall\tthe\tcontainer\ton\tnode1\t“\nC1\n”\tand\tthe\tcontainer\ton\nnode2\t“\nC2\n”.\tAnd\tlet’s\tassume\t\nC1\n\twants\tto\tping\t\nC2\n\tlike\twe\tdid\tin\tthe\tpractical\nexample\tearlier\tin\tthe\tchapter.\nFigure\t10.8\nContainer\t\nC1\n\tcreates\tthe\tping\trequests\tand\tsets\tthe\tdestination\tIP\taddress\tto\tbe\nthe\t\n10.0.0.4\n\taddress\tof\t\nC2\n.\tIt\tsends\tthe\ttraffic\tover\tits\t\nveth\n\tinterface\twhich\tis\nconnected\tto\tthe\t\nBr0\n\tvirtual\tswitch.\tThe\tvirtual\tswitch\tdoesn’t\tknow\twhere\tto\nsend\tthe\tpacket\tas\tit\tdoesn’t\thave\tan\tentry\tin\tits\tMAC\taddress\ttable\t(ARP\ttable)\nthat\tcorresponds\tto\tthe\tdestination\tIP\taddress.\tAs\ta\tresult,\tit\tfloods\tthe\tpacket\ttoall\tports.\tThe\tVTEP\tinterface\tconnected\tto\t\nBr0\n\tknows\thow\tto\tforward\tthe\tframe\nso\tresponds\twith\tits\town\tMAC\taddress.\tThis\tis\ta\t\nproxy\tARP\n\treply\tand\tresults\tin\nthe\t\nBr0\n\tswitch\t\nlearning\n\thow\tto\tforward\tthe\tpacket\tand\tit\tupdates\tits\tARP\ttable\nmapping\t10.0.0.4\tto\tthe\tMAC\taddress\tof\tthe\tVTEP.\nNow\tthat\tthe\t\nBr0\n\tswitch\thas\t\nlearned\n\thow\tto\tforward\ttraffic\tto\t\nC2\n\tall\tfuture\npackets\tfor\t\nC2\n\twill\tbe\ttransmitted\tdirectly\tto\tthe\tVTEP\tinterface.\tThe\tVTEP\ninterface\tknows\tabout\t\nC2\n\tbecause\tall\tnewly\tstarted\tcontainers\thave\ttheir\nnetwork\tdetails\tpropagated\tto\tother\tnodes\tin\tthe\tswarm\tusing\tthe\tnetwork’s\nbuilt-in\tgossip\tprotocol.\nThe\tswitch\tthen\tsends\tthe\tpacket\tto\tthe\tVTEP\tinterface\twhich\tencapsulates\tthe\nframes\tso\tthey\tcan\tbe\tsent\tover\tthe\tunderlay\ttransport\tinfrastructure.\tAt\ta\tfairly\nhigh\tlevel\tthis\tencapsulation\tincludes\tadding\ta\tVXLAN\theader\tto\tthe\tEthernet\nframe.\tThe\tVXLAN\theader\tcontains\tthe\tVXLAN\tnetwork\tID\t(VNID)\twhich\tis\nused\tto\tmap\tframes\tfrom\tVLANs\tto\tVXLANs\tand\tvice\tversa.\tEach\tVLAN\tgets\nmapped\tto\tVNID\tso\tthat\ton\tthe\treceiving\tend\tthe\tpacket\tcan\tbe\tde-encapsulated\nand\tforwarded\ton\tto\tthe\tcorrect\tVLAN.\tThis\tobviously\tmaintains\tnetwork\nisolation.\tThe\tencapsulation\talso\twraps\tthe\tframe\tin\ta\tIP/UDP\tpacket\twith\tthe\tIP\naddress\tof\tthe\tVTEP\ton\tnode2\tin\tthe\t\ndestination\tIP\tfield\n\tand\tthe\tUDP\tport\t4789\nsocket\tinformation.\tThis\tencapsulation\tallows\tthe\tdata\tto\tbe\tsent\tacross\tthe\nunderlying\tnetworks\twithout\tthe\tunderlying\tnetworks\thaving\tto\tknow\tanything\nabout\tVXLAN.\nWhen\tthe\tpacket\tarrives\tat\tnode2,\tthe\tkernel\tsees\tthat\tit’s\taddressed\tto\tUDP\tport\n4789.\tThe\tkernel\talso\tknows\tthat\tit\thas\ta\tVTEP\tinterface\tbound\tto\tthat\tsocket.\nAs\ta\tresult,\tit\tsends\tthe\tpacket\tto\tthe\tVTEP\twhich\treads\tthe\tVNID,\tde-\nencapsulates\tthe\tpacket\tand\tsends\tit\ton\tto\tits\town\tlocal\t\nBr0\n\tswitch\ton\tthe\tVLAN\nthat\tcorresponds\tthe\tVNID.\tFrom\tthere\tit\tis\tdelivered\tto\tcontainer\tC2.\nThat’s\tthe\tbasics\tof\thow\tVXLAN\ttechnology\tis\tleveraged\tby\tnative\tDocker\noverlay\tnetworks.\nWe’re\tonly\tscratching\tthe\tsurface\there,\tbut\tit\tshould\tbe\tenough\tfor\tyou\tto\tbe\nable\tto\tstart\tthe\tball\trolling\twith\tany\tpotential\tproduction\tDocker\tdeployments.\nIt\tshould\talso\tgive\tyou\tthe\tknowledge\trequired\tto\ttalk\tto\tyour\tnetworking\tteam\nabout\tthe\tnetworking\taspects\tof\tyour\tDocker\tinfrastructure.One\tfinal\tthing\tto\tmention\tabout\tDocker\toverlay\tnetworks\tis\tthat\tDocker\talso\nsupports\tLayer\t3\trouting\twithin\tthe\tsame\toverlay\tnetwork.\tFor\texample,\tyou\tcan\ncreate\tan\toverlay\tnetwork\twith\ttwo\tsubnets,\tand\tDocker\twill\ttake\tcare\tof\trouting\nbetween\tthem.\tThe\tcommand\tto\tcreate\ta\tnetwork\tlike\tthis\tcould\tbe\t\ndocker\nnetwork\tcreate\t--subnet=10.1.1.0/24\t--subnet=11.1.1.0/24\t-d\toverlay\nprod-net\n.\tThis\twould\tresult\tin\ttwo\tvirtual\tswitches\t\nBr0\n\tand\t\nBr1\n\tbeing\tcreated\ninside\tthe\t\nnetwork\tnamespace\n\tand\trouting\thappens\tby\tdefault.Docker\toverlay\tnetworking\t-\tThe\tcommands\ndocker\tnetwork\tcreate\n\tis\tthe\tcommand\tthat\twe\tuse\tto\tcreate\ta\tnew\ncontainer\tnetwork.\tThe\t\n-d\n\tflag\tlets\tyou\tspecify\tthe\tdriver\tto\tuse,\tand\tthe\nmost\tcommon\tdriver\tis\tthe\t\noverlay\n\tdriver.\tHowever,\tyou\tcan\talso\tspecify\nso-called\t\nremote\n\tdrivers\tfrom\t3rd\tparties.\tThe\tcontrol\tplane\tis\tencrypted\tby\ndefault.\tTo\tencrypt\tthe\tdata\tplane\tjust\tadd\tthe\t\n-o\tencrypted\n\tflag.\ndocker\tnetwork\tls\n\tlists\tall\tof\tthe\tcontainer\tnetworks\tvisible\tto\ta\tDocker\nhost.\tDocker\thosts\trunning\tin\t\nswarm\tmode\n\tonly\tsee\toverlay\tnetworks\tif\nthey\tare\thosting\tcontainers\trunning\ton\tthat\tparticular\tnetwork.\tThis\thelps\nreduce\tthe\tamount\tnetwork-related\tgossiping\tbetween\tnodes.\ndocker\tnetwork\tinspect\n\tshows\tyou\tdetailed\tinformation\tabout\ta\nparticular\tcontainer\tnetwork.\tThis\tincludes\t\nscope\n,\t\ndriver\n,\t\nIPv6\n,\t\nsubnet\nconfiguration\n,\t\nVXLAN\tnetwork\tID\n,\tand\t\nencryption\tstate\n.\ndocker\tnetwork\trm\n\tdeletes\ta\tnetworkChapter\tSummary\nIn\tthis\tchapter\twe\tsaw\tthe\tsimplicity\tof\tcreating\tnew\tDocker\toverlay\tnetworks\nusing\tthe\t\ndocker\tnetwork\tcreate\n\tcommand.\tWe\tthen\tlearned\thow\tthey\tare\ncreated\tbehind\tthe\tscenes\tusing\tVXLAN\ttechnology.\tThis\tonly\tscratches\tthe\nsurface\tof\twhat\tyou\tcan\tdo\twith\tnative\tDocker\toverlay\tnetworking.11:\tSecurity\tin\tDocker\nGood\tsecurity\tis\tall\tabout\tlayers,\tand\tDocker\thas\tlots\tof\tlayers.\tIt\tsupports\tall\nthe\tmajor\tLinux\tsecurity\ttechnologies,\tas\twell\tas\thaving\ta\tlot\tof\tits\town\t-\tand\nmost\tof\tthem\tare\tsimple\tand\teasy\tto\tconfigure.\nIn\tthis\tchapter,\twe’ll\tlook\tat\tsome\tof\tthe\ttechnologies\tthat\tmake\trunning\ncontainers\ton\tDocker\tvery\tsecure.\nWhen\twe\tget\tto\tthe\tdeep\tdive\tpart\tof\tthe\tchapter\twe’ll\tdivide\tthings\tup\tinto\ttwo\ncategories:\nLinux\tsecurity\ttechnologies\nDocker\tplatform\tsecurity\ttechnologies\nNote:\n\tLarge\tparts\tof\tthis\tchapter\tare\tLinux\tspecific.\tHowever,\tthe\t\nDocker\nplatform\tsecurity\ttechnologies\n\tsection\tis\tplatform\tagnostic\tand\tapplies\nequally\tto\tLinux\tand\tWindows.Security\tin\tDocker\t-\tThe\tTLDR\nSecurity\tis\tall\tabout\tlayers!\tThe\tmore\tsecurity\tlayers\tyou\thave,\tthe\tmore\tsecure\nyou\tare.\tWell…\tDocker\toffers\ta\tlot\tof\tsecurity\tlayers.\tFigure\t11.1\tshows\tsome\tof\nthe\tsecurity\ttechnologies\tthat\twe’ll\tcover\tin\tthe\tchapter.\nFigure\t11.1\nDocker\ton\tLinux\tleverages\tmost\tof\tthe\tcommon\tLinux\tsecurity\ttechnologies.\nThese\tinclude\t\nnamespaces\n,\t\ncontrol\tgroups\t(cgroups)\n,\t\ncapabilities\n,\t\nmandatory\naccess\tcontrol\t(MAC)\tsystems\n,\tand\t\nseccomp\n.\tFor\teach\tone,\tDocker\timplements\nsensible\tdefaults\tfor\ta\tseamless\tand\t\nmoderately\tsecure\n\tout-of-the-box\nexperience.\tHowever,\tit\talso\tallows\tyou\tto\tcustomize\teach\tone\tto\tyour\town\nspecific\trequirements.\nThe\tDocker\tplatform\titself\toffers\tsome\texcellent\tnative\tsecurity\ttechnologies.\nAnd\tone\tof\tthe\tbest\tthings\tabout\tthese\tis\tthat\tthey’re\t\namazingly\tsimple\tto\tuse!\nDocker\tSwarm\tMode\n\tis\tsecure\tby\tdefault.\tYou\tget\tall\tof\tthe\tfollowing\twith\nzero\tconfiguration\trequired;\tcryptographic\tnode\tIDs,\tmutual\tauthentication,\nautomatic\tCA\tconfiguration,\tautomatic\tcertificate\trotation,\tencrypted\tcluster\nstore,\tencrypted\tnetworks,\tand\tmore.\nDocker\tContent\tTrust\t(DCT)\n\tlets\tyou\tsign\tyour\timages\tand\tverify\tthe\tintegrity\nand\tpublisher\tof\timages\tyou\tpull.\nDocker\tSecurity\tScanning\n\tanalyses\tDocker\timages,\tdetects\tknown\nvulnerabilities,\tand\tprovides\tyou\twith\ta\tdetailed\treport.Docker\tsecrets\n\tmakes\tsecrets\tfirst-class\tcitizens\tin\tthe\tDocker\tecosystem.\tThey\nget\tstored\tin\tthe\tencrypted\tcluster\tstore,\tencrypted\tin-flight\twhen\tdelivered\tto\ncontainers,\tand\tstored\tin\tin-memory\tfilesystems\twhen\tin\tuse.\nThe\timportant\tthing\tto\tknow\tis\tthat\tDocker\tworks\twith\tthe\tmajor\tLinux\tsecurity\ntechnologies\tas\twell\tas\tproviding\tits\town\textensive\tand\tgrowing\tset\tof\tsecurity\ntechnologies.\tWhile\tthe\tLinux\tsecurity\ttechnologies\tcan\tbe\ta\tbit\tcomplicated\tto\nconfigure,\tthe\tDocker\tplatforms\tsecurity\ttechnologies\tare\tvery\tsimple.Security\tin\tDocker\t-\tThe\tdeep\tdive\nWe\tall\tknow\tthat\tsecurity\tis\timportant.\tWe\talso\tknow\tthat\tsecurity\tcan\tbe\ncomplicated\tand\tboring!\nWhen\tDocker\tdecided\tto\tbake\tsecurity\tinto\tits\tplatform,\tit\tdecided\tto\tmake\tit\nsimple\tand\teasy.\tThey\tknew\tthat\tif\tsecurity\twas\thard\tto\tconfigure\tpeople\nwouldn’t\tuse\tit.\tAs\ta\tresult,\tmost\tof\tthe\tsecurity\ttechnologies\toffered\tby\tthe\nDocker\tplatform\tare\tsimple\tto\tuse.\tThey\talso\tship\twith\tsensible\tdefaults\t-\tthis\nmeans\tthat\tyou\tget\ta\t\nfairly\tsecure\n\tplatform\tat\tzero\teffort.\tOf\tcourse,\tthe\tdefaults\nare\tnot\tperfect,\tbut\tthey’re\tusually\tenough\tto\tgive\tyou\ta\tsafe\tstart.\tIf\tthey\tdon’t\nsuit\tyour\tneeds\tyou\tcan\talways\tcustomize\tthem.\nWe’ll\torganize\tthe\trest\tof\tthis\tchapter\tas\tfollows:\nLinux\tsecurity\ttechnologies\nNamespaces\nControl\tGroups\nCapabilities\nMandatory\tAccess\tControl\nseccomp\nDocker\tplatform\tsecurity\ttechnologies\nSwarm\tMode\nDocker\tSecurity\tScanning\nDocker\tContent\tTrust\nDocker\tsecrets\nLinux\tsecurity\ttechnologies\nAll\t\ngood\n\tcontainer\tplatforms\tshould\tuse\t\nnamespaces\n\tand\t\ncgroups\n\tto\tbuild\ncontainers.\tThe\t\nbest\n\tcontainer\tplatforms\twill\talso\tintegrate\twith\tother\tLinux\nsecurity\ttechnologies\tsuch\tas\t\ncapabilities\n,\t\nMandatory\tAccess\tControl\tsystems\nlike\tSELinux\tand\tAppArmor,\tand\t\nseccomp\n.\tAs\texpected,\tDocker\tintegrates\twith\nthem\tall!\nIn\tthis\tsection\tof\tthe\tchapter\twe’ll\ttake\ta\t\nbrief\n\tlook\tat\tsome\tof\tthe\tmajor\tLinux\nsecurity\ttechnologies\tused\tby\tDocker.\tWe\twon’t\tgo\tinto\tdetail\tas\tI\twant\tthe\nfocus\tof\tthe\tchapter\tto\tbe\ton\tthe\tDocker\tplatform\ttechnologies.Namespaces\nKernel\tnamespaces\tare\tat\tthe\tvery\theart\tof\tcontainers!\tThey\tlet\tus\tslice\tup\tan\noperating\tsystem\t(OS)\tso\tthat\tit\tlooks\tand\tfeels\tlike\tmultiple\tisolated\toperating\nsystems.\tThis\tlets\tus\tdo\treally\tcool\tthings\tlike\trun\tmultiple\tweb\tservers\ton\tthe\nsame\tOS\twithout\thaving\tport\tconflicts.\tIt\talso\tlets\tus\trun\tmultiple\tapps\ton\tthe\nsame\tOS\twithout\tthem\tfighting\tover\tshared\tconfig\tfiles\tand\tshared\tlibraries.\nA\tcouple\tof\tquick\texamples:\nYou\tcan\trun\tmultiple\tweb\tservers,\teach\trequiring\tport\t443,\ton\ta\tsingle\tOS.\nTo\tdo\tthis\tyou\tjust\trun\teach\tweb\tserver\tapp\tinside\tof\tits\town\t\nnetwork\nnamespace\n.\tThis\tworks\tbecause\teach\t\nnetwork\tnamespace\n\tgets\tits\town\tIP\naddress\tand\tfull\trange\tof\tports.\nYou\tcan\trun\tmultiple\tapplications,\teach\trequiring\ttheir\town\tparticular\nversion\tof\ta\tshared\tlibrary\tor\tconfiguration\tfile.\tTo\tdo\tthis\tyou\trun\teach\napplication\tinside\tof\tits\town\t\nmount\tnamespace\n.\tThis\tworks\tbecause\teach\nmount\tnamespace\n\tcan\thave\tits\town\tisolated\tcopy\tof\tany\tdirectory\ton\tthe\nsystem\t(e.g.\t/etc,\t/var,\t/dev\tetc.)\nFigure\t11.2\tshows\ta\thigh-level\texample\tof\ttwo\tweb\tserver\tapplications\trunning\non\ta\tsingle\thost\tand\tboth\tusing\tport\t443.\tEach\tweb\tserver\tapp\tis\trunning\tinside\nof\tits\town\tnetwork\tnamespace.\nFigure\t11.2\nDocker\ton\tLinux\tcurrently\tutilizes\tthe\tfollowing\tkernel\tnamespaces:\nProcess\tID\t(pid)\nNetwork\t(net)Filesystem/mount\t(mnt)\nInter-process\tCommunication\t(ipc)\nUser\t(user)\nUTS\t(uts)\nWe’ll\tbriefly\texplain\twhat\teach\tone\tdoes\tin\ta\tmoment.\tBut\tthe\tmost\timportant\nthing\tto\tunderstand\tis\tthat\t\nDocker\tcontainers\tare\tan\torganized\tcollection\tof\nnamespaces\n.\tLet\tme\trepeat\tthat…\t\nA\tDocker\tcontainer\tis\tan\torganized\ncollection\tof\tnamespaces\n.\nFor\texample,\tevery\tcontainer\tis\tmade\tup\tof\tits\town\t\npid\n,\t\nnet\n,\t\nmnt\n,\t\nipc\n,\t\nuts\n,\tand\npotentially\t\nuser\n\tnamespace.\tThe\torganized\tcollection\tof\tthese\tnamespaces\tis\nwhat\twe\tcall\ta\tcontainer.\tFigure\t11.3\tshows\ta\tsingle\tLinux\thost\trunning\ttwo\ncontainers.\nFigure\t11.3\nLet’s\tbriefly\tlook\tat\thow\tDocker\tuses\teach\tnamespace:\nProcess\tID\tnamespace:\tDocker\tuses\tthe\t\npid\n\tnamespace\tto\tprovide\tisolated\nprocess\ttrees\tfor\teach\tcontainer.\tEvery\tcontainer\tgets\tits\town\tprocess\ttree\nmeaning\tthat\tevery\tcontainer\tcan\thave\tits\town\tPID\t1.\tPID\tnamespaces\talso\nmean\tthat\ta\tcontainer\tcannot\tsee\tor\taccess\tto\tthe\tprocess\ttree\tof\tother\ncontainers\tor\thost\tit’s\trunning\ton.\nNetwork\tnamespace:\tDocker\tuses\tthe\t\nnet\n\tnamespace\tto\tprovide\teach\ncontainer\tits\town\tisolated\tnetwork\tstack.\tThis\tstack\tincludes;\tinterfaces,\tIP\naddresses,\tport\tranges,\tand\trouting\ttables.\tFor\texample,\tevery\tcontainer\ngets\tits\town\t\neth0\n\tinterface\twith\tits\town\tunique\tIP\tand\trange\tof\tports.\nMount\tnamespace:\tEvery\tcontainer\tgets\tits\town\tunique\tisolated\troot\t\n/\nfilesystem.\tThis\tmeans\tthat\tevery\tcontainer\tcan\thave\tits\town\t\n/etc\n,\t\n/var\n,\n/dev\n\tetc.\tProcesses\tinside\tof\ta\tcontainer\tcannot\taccess\tthe\tmountnamespace\tof\tthe\tLinux\thost\tor\tother\tcontainers\t-\tthey\tcan\tonly\tsee\tand\naccess\ttheir\town\tisolated\tmount\tnamespace.\nInter-process\tCommunication\tnamespace:\tDocker\tuses\tthe\t\nipc\n\tnamespace\nfor\tshared\tmemory\taccess\twithin\ta\tcontainer.\tIt\talso\tisolates\tthe\tcontainer\nfrom\tshared\tmemory\toutside\tof\tthe\tcontainer.\nUser\tnamespace:\tDocker\tlets\tyou\tuse\t\nuser\n\tnamespaces\tto\tmap\tusers\tinside\nof\ta\tcontainer\tto\ta\tdifferent\tuser\ton\tthe\tLinux\thost.\tA\tcommon\texample\nwould\tbe\tmapping\tthe\t\nroot\n\tuser\tof\ta\tcontainer\tto\ta\tnon-root\tuser\ton\tthe\nLinux\thost.\tUser\tnamespaces\tare\tquite\tnew\tto\tDocker\tand\tare\tcurrently\noptional.\nUTS\tnamespace:\tDocker\tuses\tthe\t\nuts\n\tnamespace\tto\tprovide\teach\tcontainer\nwith\tits\town\thostname.\nRemember…\ta\tcontainer\tis\tan\torganized\tcollection\tof\tnamespaces!!!\nFigure\t11.4\nControl\tGroups\nIf\tnamespaces\tare\tabout\tisolation,\t\ncontrol\tgroups\t(cgroups)\n\tare\tabout\tsetting\nlimits.\nThink\tof\tcontainers\tas\tsimilar\tto\trooms\tin\ta\thotel.\tYes,\teach\troom\tis\tisolated,\tbut\neach\troom\talso\tshares\ta\tcommon\tset\tof\tresources\t-\tthings\tlike\twater\tsupply,\nelectricity\tsupply,\tshared\tswimming\tpool,\tshared\tgym,\tshared\tbreakfast\tbar\tetc.\nCgroups\tlet\tus\tset\tlimits\ton\tcontainers\tso\tthat\t(sticking\twith\tthe\thotel\tanalogy)\nno\tsingle\tcontainer\tcan\tuse\tall\tof\tthe\twater\tor\teat\teverything\tat\tthe\tbreakfast\tbar.\nIn\tthe\treal\tworld\t(not\tthe\tsilly\thotel\tanalogy)\tcontainers\tare\tisolated\tfrom\teach\nother\tbut\tall\tshare\ta\tcommon\tset\tof\tOS\tresources\t-\tthings\tlike\tCPU,\tRAM\tand\ndisk\tI/O.\tCgroups\tlet\tus\tset\tlimits\ton\teach\tof\tthese\tso\tthat\ta\tsingle\tcontainer\ncannot\tuse\tall\tof\tthe\tCPU,\tRAM,\tor\tstorage\tI/O\tof\tthe\tLinux\thost.\nCapabilitiesIt’s\ta\tbad\tidea\tto\trun\tcontainers\tas\troot\t-\troot\tis\tall-powerful\tand\ttherefore\tvery\ndangerous.\tBut\tit’s\ta\tpain\tin\tthe\tbackside\trunning\tcontainers\tas\tnon-root\t-\tnon-\nroot\tis\tso\tpowerless\tit’s\tpractically\tuseless.\tWhat\twe\tneed\tis\ta\ttechnology\tthat\nlets\tus\tpick\tand\tchoose\twhich\troot\tpowers\tour\tcontainers\tneed\tin\torder\tto\trun.\nEnter\t\ncapabilities!\nUnder\tthe\thood,\tthe\tLinux\troot\taccount\tis\tmade\tup\tof\ta\tlong\tlist\tof\tcapabilities.\nSome\tof\tthese\tinclude:\nCAP_CHOWN\n\tlets\tyou\tchange\tfile\townership\nCAP_NET_BIND_SERVICE\n\tlets\tyou\tbind\ta\tsocket\tto\tlow\tnumbered\tnetwork\nports\nCAP_SETUID\n\tlets\tyou\televate\tthe\tprivilege\tlevel\tof\ta\tprocess\nCAP_SYS_BOOT\n\tlets\tyou\treboot\tthe\tsystem.\nThe\tlist\tgoes\ton.\nDocker\tworks\twith\t\ncapabilities\n\tso\tthat\tyou\tcan\trun\tcontainers\tas\troot,\tbut\tstrip\nout\tthe\troot\tcapabilities\tthat\tyou\tdon’t\tneed.\tFor\texample,\tif\tthe\tonly\troot\nprivilege\tyour\tcontainer\tneeds\tis\tthe\tability\tto\tbind\tto\tlow\tnumbered\tnetwork\nports,\tyou\tshould\tstart\ta\tcontainer\tand\tdrop\tall\troot\tcapabilities,\tthen\tadd\tback\nthe\tCAP_NET_BIND_SERVICE\tcapability.\nDocker\talso\timposes\trestrictions\tso\tthat\tcontainers\tcannot\tre-add\tthe\tremoved\ncapabilities.\nMandatory\tAccess\tControl\tsystems\nDocker\tworks\twith\tmajor\tLinux\tMAC\ttechnologies\tsuch\tas\tAppArmor\tand\nSELinux.\nDepending\ton\tyour\tLinux\tdistribution,\tDocker\tapplies\ta\tdefault\tAppArmor\nprofile\tto\tall\tnew\tcontainers.\tAccording\tto\tthe\tDocker\tdocumentation,\tthis\ndefault\tprofile\tis\t“moderately\tprotective\twhile\tproviding\twide\tapplication\ncompatibility”.\nDocker\talso\tlets\tyou\tstart\tcontainers\twithout\ta\tpolicy\tapplied,\tas\twell\tas\tgiving\nyou\tthe\tability\tto\tcustomize\tpolicies\tto\tmeet\tyour\tspecific\trequirements.\nseccompDocker\tuses\tseccomp,\tin\tfilter\tmode,\tto\tlimit\tthe\tsyscalls\ta\tcontainer\tcan\tmake\nto\tthe\thost’s\tkernel.\nAs\tper\tthe\tDocker\tsecurity\tphilosophy,\tall\tnew\tcontainers\tget\ta\tdefault\tseccomp\nprofile\tconfigured\twith\tsensible\tdefaults.\tThis\tis\tintended\tto\tprovide\tmoderate\nsecurity\twithout\timpacting\tapplication\tcompatibility.\nAs\talways,\tyou\tcan\tcustomize\tseccomp\tprofiles\tand\tyou\tcan\tpass\ta\tflag\tto\nDocker\tso\tthat\tcontainers\tcan\tbe\tstarted\twithout\ta\tseccomp\tprofile.\nFinal\tthoughts\ton\tthe\tLinux\tsecurity\ttechnologies\nDocker\tsupports\tmost\tof\tthe\timportant\tLinux\tsecurity\ttechnologies\tand\tships\nwith\tsensible\tdefaults\tthat\tadd\tsecurity\tbut\taren’t\ttoo\trestrictive.\nFigure\t11.5\nSome\tof\tthese\ttechnologies\tcan\tbe\tcomplicated\tto\tcustomize\tas\tthey\tcan\trequire\ndeep\tknowledge\tof\thow\tthey\twork\tand\thow\tthe\tLinux\tkernel\tworks.\tHopefully\nthey\twill\tget\tsimpler\tto\tconfigure\tin\tthe\tfuture,\tbut\tfor\tnow,\tthe\tdefault\nconfigurations\tthat\tship\twith\tDocker\tare\ta\tgood\tplace\tto\tstart.\nDocker\tplatform\tsecurity\ttechnologies\nIn\tthis\tsection\tof\tthe\tchapter\twe’ll\ttake\ta\tlook\tat\tsome\tof\tthe\tmajor\tsecurity\ntechnologies\toffered\tby\tthe\tDocker\tplatform.\nSecurity\tin\tSwarm\tModeSwarm\tMode\tis\tthe\tfuture\tof\tDocker.\tIt\tlets\tyou\tcluster\tmultiple\tDocker\thosts\nand\tdeploy\tyour\tapplications\tin\ta\tdeclarative\tway.\tEvery\tSwarm\tis\tcomprised\tof\nmanagers\n\tand\t\nworkers\n\tthat\tcan\tbe\tLinux\tor\tWindows.\tManagers\tmake\tup\tthe\ncontrol\tplane\tof\tthe\tcluster\tand\tare\tresponsible\tfor\tconfiguring\tthe\tcluster\tand\ndispatching\twork\tto\tit.\tWorkers\tare\tthe\tnodes\tthat\trun\tyour\tapplication\tcode\tas\ncontainers.\nAs\texpected,\tSwarm\tMode\tincludes\tmany\tsecurity\tfeatures\tthat\tare\tenabled\tout-\nof-the-box\twith\tsensible\tdefaults.\tThese\tinclude:\nCryptographic\tnode\tIDs\nMutual\tauthentication\tvia\tTLS\nSecure\tjoin\ttokens\nCA\tconfiguration\twith\tautomatic\tcertificate\trotation\nEncrypted\tcluster\tstore\t(config\tDB)\nEncrypted\tnetworks\nLet’s\twalk\tthrough\tthe\tprocess\tof\tbuilding\ta\tsecure\tSwarm\tand\tconfiguring\tsome\nof\tthe\tsecurity\taspects.\nTo\tfollow\talong\tyou\twill\tneed\tat\tleast\tthree\tDocker\thosts\trunning\tDocker\t1.13\tor\nlater.\tThe\texamples\tcited\there\tuse\tthree\tDocker\thosts\tcalled\t“mgr1”,\t“mgr2”,\nand\t“wrk1”.\tEach\tone\tis\trunning\tDocker\t17.06.0-ce\ton\tUbuntu\t16.04.\tThere\tis\nnetwork\tconnectivity\tbetween\tall\tthree\thosts\tand\tall\tthree\tcan\tping\teach\tother\tby\nname.\tThe\tsetup\tis\tshown\tin\tFigure\t11.6.\nFigure\t11.6\nConfigure\ta\tsecure\tSwarm\nRun\tthe\tfollowing\tcommand\tfrom\tthe\tnode\tyou\twant\tto\tbe\tthe\tfirst\tmanager\tin\nthe\tnew\tSwarm.\tIn\tthe\texample,\twe\twill\trun\tit\tform\t“mgr1”.$\tdocker\tswarm\tinit\nSwarm\tinitialized:\tcurrent\tnode\t\n(\n7xam...662z\n)\n\tis\tnow\ta\tmanager.\nTo\tadd\ta\tworker\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\t\tdocker\tswarm\tjoin\t--token\t\n\\\n\t\t\t\t\tSWMTKN-1-1dmtwu...r17stb-ehp8g...hw738q\t\n172\n.31.5.251:2377\nTo\tadd\ta\tmanager\tto\tthis\tswarm,\trun\t\n'docker\tswarm\tjoin-token\tmanager'\nand\tfollow\tthe\tinstructions.\nThat’s\tit!\tThat\tis\tliterally\tall\tyou\tneed\tto\tdo\tto\tconfigure\ta\tsecure\tSwarm!\nYou\tnow\thave\ta\tsingle-node\tsecure\tSwarm.\t“mgr1”\tis\tconfigured\tas\tthe\tfirst\nmanager\tof\tthe\tSwarm\tand\talso\tas\tthe\troot\tCA.\tThe\tSwarm\thas\tbeen\tgiven\ta\ncryptographic\tID\tand\t“mgr1”\thas\tissued\titself\twith\ta\tclient\tcertificate\tthat\nidentifies\tit\tas\ta\tmanager\tin\tthe\tSwarm.\tCertificate\trotation\thas\tbeen\tconfigured\nwith\tthe\tdefault\tvalue\tof\t90\tdays\tand\ta\tcluster\tconfig\tdatabase\thas\tbeen\nconfigured\tand\tencrypted.\tA\tset\tof\tsecure\ttokens\thave\talso\tbeen\tcreated\tso\tthat\nnew\tmanagers\tand\tnew\tworkers\tcan\tbe\tjoined\tto\tthe\tSwarm.\tAnd\tall\tof\tthis\twith\na\t\nsingle\tcommand!\nFigure\t11.7\tshows\thow\tthe\tlab\tlooks\tnow.\nFigure\t11.7\nNow\tlet’s\tjoin\t“mgr2”\tas\tan\tadditional\tmanager.\nJoining\tnew\tmanagers\tto\ta\tSwarm\tis\ta\ttwo-step\tprocess.\tIn\tthe\tfirst\tstep\tyou’ll\nextract\tthe\ttoken\trequired\tto\tjoin\tnew\tmanagers\tto\tthe\tSwarm.\tIn\tthe\tsecond\tstep\nyou’ll\trun\ta\t\ndocker\tswarm\tjoin\n\tcommand\ton\t“mgr2”.\tAs\tlong\tas\tyou\tincludethe\tmanager\tjoin\ttoken\tas\tpart\tof\tthe\t\ndocker\tswarm\tjoin\n\tcommand,\t“mgr2”\nwill\tjoin\tthe\tSwarm\tas\ta\tmanager.\nRun\tthe\tfollowing\tcommand\tfrom\t“mgr1”\textract\tthe\tmanager\tjoin\ttoken.\n$\tdocker\tswarm\tjoin-token\tmanager\nTo\tadd\ta\tmanager\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\t\tdocker\tswarm\tjoin\t--token\t\n\\\n\t\t\t\tSWMTKN-1-1dmtwu...r17stb-2axi5...8p7glz\t\n\\\n\t\t\t\t\n172\n.31.5.251:2377\nThe\toutput\tof\tthe\tcommand\tabove\thas\tbeen\tedited\tso\tthat\tit\tdoesn’t\twrap\tover\nmultiple\tlines.\tThe\toutput\tgives\tyou\tthe\texact\tcommand\tyou\tneed\tto\trun\ton\nnodes\tthat\tyou\twish\tto\tjoin\tthe\tSwarm\tas\tmanagers.\tThe\tjoin\ttoken\tand\tIP\naddress\twill\tbe\tdifferent\tin\tyour\tlab.\nCopy\tthe\tcommand\tand\trun\tit\ton\t“mgr2”\tas\tshown\tbelow:\n$\tdocker\tswarm\tjoin\t--token\tSWMTKN-1-1dmtwu...r17stb-2axi5...8p7glz\t\n\\\n>\t\n172\n.31.5.251:2377\nThis\tnode\tjoined\ta\tswarm\tas\ta\tmanager.\n“mgr2”\thas\tnow\tjoined\tthe\tSwarm\tas\tan\tadditional\tmanager.\nThe\tformat\tof\tthe\tjoin\tcommand\tis\t\ndocker\tswarm\tjoin\t--token\n<manager-join-token>\t<ip-of-existing-manager>:<default-swarm-\nport>\n.\nYou\tcan\tverify\tthe\toperation\tby\trunning\ta\t\ndocker\tnode\tls\n\tcommand\ton\teither\nof\tthe\ttwo\tmanagers.\n$\tdocker\tnode\tls\nID\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tHOSTNAME\t\t\tSTATUS\t\t\t\tAVAILABILITY\t\t\t\tMANAGER\tSTATUS\n7xamk...ge662z\t\t\t\tmgr1\t\t\t\t\t\t\tReady\t\t\t\t\tActive\t\t\t\t\t\t\t\t\t\tLeader\ni0ue4...zcjm7f\t*\t\tmgr2\t\t\t\t\t\t\tReady\t\t\t\t\tActive\t\t\t\t\t\t\t\t\t\tReachable\nThe\toutput\tabove\tshows\tthat\t“mgr1”\tand\t“mgr2”\tare\tboth\tpart\tof\tthe\tSwarm\tand\nare\tboth\tSwarm\tmanagers.\tThe\tupdated\tconfiguration\tis\tshown\tin\tFigure\t11.8.Figure\t11.8\nAdding\ta\tSwarm\tworker\tis\ta\tsimilar\ttwo-step\tprocess.\tStep\t1\tis\tto\textract\tthe\njoin\ttoken\tfor\tnew\tworkers,\tand\tstep\t2\tis\tto\trun\ta\t\ndocker\tswarm\tjoin\n\tcommand\non\tthe\tnode\tyou\twant\tto\tjoin\tas\ta\tworker.\nRun\tthe\tfollowing\tcommand\ton\teither\tof\tthe\tmanagers\tto\texpose\tthe\tworker\tjoin\ntoken.\n$\tdocker\tswarm\tjoin-token\tworker\nTo\tadd\ta\tworker\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\t\tdocker\tswarm\tjoin\t--token\t\n\\\n\t\t\t\tSWMTKN-1-1dmtw...17stb-ehp8g...w738q\t\n\\\n\t\t\t\t\n172\n.31.5.251:2377\nThe\toutput\tof\tthe\tcommand\tabove\thas\tbeen\tedited\tso\tthat\tit\tdoesn’t\twrap\tover\nmultiple\tlines.\tIt\tgives\tyou\tthe\texact\tcommand\tyou\tneed\tto\trun\ton\tnodes\tthat\nyou\twish\tto\tjoin\tthe\tSwarm\tas\tworkers.\tThe\tjoin\ttoken\tand\tIP\taddress\twill\tbe\ndifferent\tin\tyour\tlab.\nCopy\tthe\tcommand\tand\trun\tit\ton\t“wrk1”\tas\tshown\tbelow:\n$\tdocker\tswarm\tjoin\t--token\tSWMTKN-1-1dmtw...17stb-ehp8g...w738q\t\n\\\n>\t\n172\n.31.5.251:2377\nThis\tnode\tjoined\ta\tswarm\tas\ta\tworker.\nRun\tanother\t\ndocker\tnode\tls\n\tcommand\tfrom\teither\tof\tthe\tSwarm\tmanagers.\n$\tdocker\tnode\tls\nID\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tHOSTNAME\t\t\t\t\tSTATUS\t\t\t\t\tAVAILABILITY\t\t\tMANAGER\tSTATUS\n7xamk...ge662z\t*\t\t\tmgr1\t\t\t\t\t\t\t\t\tReady\t\t\t\t\t\tActive\t\t\t\t\t\t\t\t\tLeader\nailrd...ofzv1u\t\t\t\t\twrk1\t\t\t\t\t\t\t\t\tReady\t\t\t\t\t\tActive\ni0ue4...zcjm7f\t\t\t\t\tmgr2\t\t\t\t\t\t\t\t\tReady\t\t\t\t\t\tActive\t\t\t\t\t\t\t\t\tReachableYou\tnow\thave\ta\tSwarm\twith\ttwo\tmanagers\tand\tone\tworker.\tThe\tmanagers\tare\nconfigured\tfor\thigh\tavailability\t(HA)\tand\tthe\tcluster\tstore\tis\treplicated\tto\tthem\nboth.\tThis\tupdated\tconfiguration\tis\tshown\tin\tFigure\t11.9.\nFigure\t11.9\nLooking\tbehind\tthe\tscenes\tat\tSwarm\tsecurity\nNow\tthat\twe’ve\tbuilt\ta\tsecure\tSwarm\tlet’s\ttake\ta\tminute\tto\tlook\tbehind\tthe\nscenes\tat\tsome\tof\tthe\tsecurity\ttechnologies\tinvolved.\nSwarm\tjoin\ttokens\nThe\tonly\tthing\tthat\tis\tneeded\tto\tjoin\tmanagers\tand\tworkers\tto\tan\texisting\tSwarm\nis\tthe\trelevant\tjoin\ttoken.\tFor\tthis\treason,\tit\tis\tvital\tthat\tyou\tkeep\tyour\tjoin-\ntokens\tsafe!\tNo\tposting\tthem\ton\tpublic\tGitHub\tpages!\nEvery\tSwarm\tmaintains\ttwo\tdistinct\tjoin\ttokens:\t-\tOne\tfor\tjoining\tnew\tmanagers\n-\tOne\tfor\tjoining\tnew\tworkers\nIt’s\tworth\tunderstanding\tthe\tformat\tof\tthe\tSwarm\tjoin\ttoken.\tEvery\tjoin\ttoken\tis\ncomprised\tof\t4\tdistinct\tfields\tseparated\tby\tdashes\t(\n-\n):\nPREFIX\t-\tVERSION\t-\tSWARM\tID\t-\tTOKEN\nThe\tprefix\tis\talways\t“SWMTKN”.\tThe\tversion\tfield\tindicates\tthe\tversion\tof\tthe\nSwarm.\tThe\tSwarm\tID\tfield\tis\ta\thash\tof\tthe\tSwarm’s\tcertificate.\tThe\ttoken\nportion\tis\tthe\tpart\tthat\tdetermines\tif\tthe\ttoken\tcan\tbe\tused\tto\tjoin\tthe\tnode\tas\ta\nmanager\tor\tworker.As\tyou\tcan\tsee\tbelow,\tthe\tmanager\tand\tworker\tjoin\ttokens\tfor\ta\tgiven\tSwarm\nare\tidentical\texcept\tfor\tthe\tfinal\tTOKEN\tfield.\nMANAGER:\tSWMTKN-1-1dmtwusdc…r17stb-\n2axi53zjbs45lqxykaw8p7glz\nWORKER:\t\nSWMTKN-1-1dmtwusdc…r17stb-\nehp8gltji64jbl45zl6hw738q\nIf\tyou\tsuspect\tthat\teither\tof\tyour\tjoin\ttokens\thas\tbeen\tcompromised\tyou\tcan\nrevoke\tthem\tand\tissue\tnew\tones\twith\ta\tsingle\tcommand.\tThe\tfollowing\texample\nrevokes\tthe\texisting\t\nmanager\n\tjoin\ttoken\tand\tissues\ta\tnew\tone.\n$\tdocker\tswarm\tjoin-token\t--rotate\tmanager\nSuccessfully\trotated\tmanager\tjoin\ttoken.\nTo\tadd\ta\tmanager\tto\tthis\tswarm,\trun\tthe\tfollowing\tcommand:\n\t\t\t\tdocker\tswarm\tjoin\t--token\t\n\\\n\t\t\t\t\tSWMTKN-1-1dmtwu...r17stb-1i7txlh6k3hb921z3yjtcjrc7\t\n\\\n\t\t\t\t\t\n172\n.31.5.251:2377\nNotice\tthat\tthe\tonly\tdifference\tbetween\tthe\told\tand\tnew\tjoin\ttokens\tis\tthe\tlast\nfield.\tThe\tSwarm\tID\tremains\tthe\tsame.\nJoin\ttokens\tare\tstored\tin\tthe\tcluster\tconfig\tdatabase\twhich\tis\tencrypted\tby\ndefault.\nTLS\tand\tmutual\tauthentication\nEvery\tmanager\tand\tworker\tthat\tjoins\ta\tSwarm\tis\tissued\ta\tclient\tcertificate.\tThis\ncertificate\tis\tused\tfor\tmutual\tauthentication.\tIt\tidentifies\tthe\tnode,\twhich\tSwarm\nthe\tnode\tis\ta\tmember\tof,\tand\trole\tthe\tnode\tperforms\tin\tthe\tSwarm\t(manager\tor\nworker).\nOn\ta\tLinux\thost\tyou\tcan\tinspect\ta\tnode’s\tclient\tcertificate\twith\tthe\tfollowing\ncommand.\n$\tsudo\topenssl\tx509\t\n\\\n\t\t-in\t/var/lib/docker/swarm/certificates/swarm-node.crt\t\n\\\n\t\t-text\n\t\tCertificate:\n\t\t\t\t\t\tData:\n\t\t\t\t\t\t\t\t\t\tVersion:\t\n3\n\t\n(\n0x2\n)\n\t\t\t\t\t\t\t\t\t\tSerial\tNumber:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n80\n:2c:a7:b1:28...a8:af:89:a1:2a:51:89\n\t\t\t\t\t\tSignature\tAlgorithm:\tecdsa-with-SHA256\n\t\t\t\t\t\t\t\t\t\tIssuer:\t\nCN\n=\nswarm-ca\n\t\t\t\t\t\t\t\t\t\tValidity\t\t\t\t\t\t\t\t\t\t\t\t\t\tNot\tBefore:\tJul\t\n19\n\t\n07\n:56:00\t\n2017\n\tGMT\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tNot\tAfter\t:\tOct\t\n17\n\t\n08\n:56:00\t\n2017\n\tGMT\n\t\t\t\t\t\t\t\t\t\tSubject:\t\nO\n=\nmfbkgjm2tlametbnfqt2zid8x,\t\nOU\n=\nswarm-manager,\n\t\t\t\t\t\t\t\t\t\t\nCN\n=\n7xamk8w3hz9q5kgr7xyge662z\n\t\t\t\t\t\t\t\t\t\tSubject\tPublic\tKey\tInfo:\n<SNIP>\nThe\t\nSubject\n\tdata\tin\tthe\toutput\tabove\tuses\tthe\tstandard\t\nO\n,\t\nOU\n,\tand\t\nCN\n\tfields\tto\nspecify\tthe\tSwarm\tID,\tthe\tnode’s\trole,\tand\tthe\tnode\tID.\nThe\torganization\t\nO\n\tfield\tstores\tthe\tSwarm\tID\nThe\torganizational\tunit\t\nOU\n\tfield\tstores\tthe\tnodes\trole\tin\tthe\tSwarm\nThe\tcanonical\tname\t\nCN\n\tfield\tstores\tthe\tnodes\tcrypto\tID.\nThis\tis\tshown\tin\tFigure\t11.10.\nFigure\t11.10\nWe\tcan\talso\tsee\tthe\tcertificate\trotation\tperiod\tin\tthe\t\nValidity\n\tsection.\nWe\tcan\tmatch\tthese\tvalues\tto\tthe\tcorresponding\tvalues\tshown\tin\tthe\toutput\tof\ta\ndocker\tsystem\tinfo\n\tcommand.\n$\tdocker\tsystem\tinfo\n<SNIP>\nSwarm:\tactive\n\tNodeID:\t7xamk8w3hz9q5kgr7xyge662z\n\tIs\tManager:\t\ntrue\n\tClusterID:\tmfbkgjm2tlametbnfqt2zid8x\n\t...\n\t<SNIP>\n\t...\n\tCA\tConfiguration:\n\t\tExpiry\tDuration:\t\n3\n\tmonths\n\t\tForce\tRotate:\t\n0\n\tRoot\tRotation\tIn\tProgress:\t\nfalse\n\t<SNIP>\nConfiguring\tsome\tCA\tsettingsYou\tcan\tconfigure\tthe\tcertificate\trotation\tperiod\tfor\tthe\tSwarm\twith\tthe\t\ndocker\nswarm\tupdate\n\tcommand.\tThe\texample\tbelow\tchanges\tthe\tcertificate\trotation\nperiod\tto\t30\tdays.\n$\tdocker\tswarm\tupdate\t--cert-expiry\t720h\nSwarm\tupdated.\nSwarm\tallows\tnodes\tto\trenew\tcertificates\tearly\t(slightly\tbefore\tthey\texpire)\tso\nthat\tnot\tall\tnodes\tin\tthe\tSwarm\ttry\tand\tupdate\ttheir\tcertificates\tat\tthe\tsame\ttime.\nYou\tcan\tconfigure\tan\texternal\tCA\twhen\tcreating\ta\tSwarm\tby\tpassing\tthe\t\n--\nexternal-ca\n\tflag\tto\tthe\t\ndocker\tswarm\tinit\n\tcommand.\nThe\tnew\t\ndocker\tswarm\tca\n\tsub-command\tcan\tbe\tused\tto\tmanage\tCA\trelated\nconfiguration.\tRun\tthe\tcommand\twith\tthe\t\n--help\n\tflag\tto\tsee\ta\tlist\tof\tthings\tit\ncan\tdo.\n$\tdocker\tswarm\tca\t--help\nUsage:\t\tdocker\tswarm\tca\t\n[\nOPTIONS\n]\nManage\troot\tCA\nOptions:\n\t\t\t\t\t\t--ca-cert\tpem-file\t\t\t\t\t\t\t\t\t\tPath\tto\tthe\tPEM-formatted\troot\tCA\n\t\t\t\t\t\tcertificate\tto\tuse\t\nfor\n\tthe\tnew\tcluster\n\t\t\t\t\t\t--ca-key\tpem-file\t\t\t\t\t\t\t\t\t\t\tPath\tto\tthe\tPEM-formatted\troot\tCA\n\t\t\t\t\t\tkey\tto\tuse\t\nfor\n\tthe\tnew\tcluster\n\t\t\t\t\t\t--cert-expiry\tduration\t\t\t\t\t\tValidity\tperiod\t\nfor\n\tnode\tcertificates\n\t\t\t\t\t\t\n(\nns\n|\nus\n|\nms\n|\ns\n|\nm\n|\nh\n)\n\t\n(\ndefault\t2160h0m0s\n)\n\t\t-d,\t--detach\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tExit\timmediately\tinstead\tof\twaiting\t\nfor\n\t\t\t\t\t\tthe\troot\trotation\tto\tconverge\n\t\t\t\t\t\t--external-ca\texternal-ca\t\t\tSpecifications\tof\tone\tor\tmore\tcertificate\n\t\t\t\t\t\tsigning\tendpoints\n\t\t\t\t\t\t--help\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tPrint\tusage\n\t\t-q,\t--quiet\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSuppress\tprogress\toutput\n\t\t\t\t\t\t--rotate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRotate\tthe\tswarm\tCA\t-\t\nif\n\tno\tcertificate\n\t\t\t\t\t\tor\tkey\tare\tprovided,\tnew\tones\twill\tbe\tgenerated\nThe\tcluster\tstore\nThe\tcluster\tstore\tis\tthe\tbrains\tof\ta\tSwarm\tand\tis\tthe\tplace\twhere\tcluster\tconfig\nand\tstate\tare\tstored.\nThe\tstore\tis\tcurrently\tbased\ton\tan\timplementation\tof\t\netcd\n\tand\tis\tautomatically\nconfigured\tto\treplicate\titself\tto\tall\tmanagers\tin\tthe\tSwarm.\tIt\tis\talso\tencrypted\nby\tdefault.The\tcluster\tstore\tis\tbecoming\ta\tcritical\tcomponent\tof\tmany\tDocker\tplatform\ntechnologies.\tFor\texample,\tDocker\tnetworking\tand\tDocker\tsecrets\tboth\tleverage\nthe\tcluster\tstore.\tThis\tis\tone\tof\tthe\treasons\tthat\tSwarm\tMode\tis\tso\timportant\tto\nthe\tfuture\tof\tDocker\t-\tmany\tparts\tof\tthe\tDocker\tplatform\talready\tleverage\tthe\ncluster\tstore\tand\tmore\twill\tleverage\tit\tin\tthe\tfuture.\tThe\tmoral\tof\tthe\tstory…\tif\nyou’re\tnot\trunning\tin\tSwarm\tMode\tyou’ll\tbe\tlimited\tas\tto\twhat\tother\tDocker\nfeatures\tyou\tcan\tuse.\nThe\tday-to-day\tmaintenance\tof\tthe\tcluster\tstore\tis\ttaken\tcare\tof\tautomatically\tby\nDocker.\tHowever,\tin\tproduction\tenvironments\tyou\tshould\thave\tstrong\tbackup\nand\trecovery\tsolutions\tin\tplace\tfor\tit.\nThat’s\tenough\tfor\tnow\tabout\tSwarm\tMode\tsecurity.\nDetecting\tvulnerabilities\twith\tDocker\tSecurity\tScanning\nThe\tability\tto\tquickly\tidentify\tcode\tvulnerabilities\tis\tvital.\tDocker\tSecurity\nScanning\tmakes\tdetecting\tknown\tvulnerabilities\tin\tDocker\timages\treally\tsimple.\nNote:\n\tAt\tthe\ttime\tof\twriting,\tDocker\tSecurity\tScanning\tis\tavailable\tfor\nprivate\trepositories\ton\tDocker\tHub.\tIt\tis\talso\tavailable\tas\tpart\tof\tthe\tDocker\nEnterprise\tEdition\ton\tpremises\tsolution.\tAll\tofficial\tDocker\timages\tare\nscanned\tand\tscan\treports\tare\tavailable\tin\ttheir\trepos.\nDocker\tSecurity\tScanning\tperforms\tbinary-level\tscans\tof\tDocker\timages\tand\nchecks\tthe\tsoftware\tin\tthem\tagainst\tdatabases\tof\tknown\tvulnerabilities\t(CVE\ndatabases).\tAfter\tthe\tscan\tis\tperformed\ta\tdetailed\treport\tis\tmade\tavailable.\nOpen\ta\tweb\tbrowser\tto\thttps://hub.docker.com\tand\tsearch\tfor\tthe\t\nAlpine\n\timage.\nFigure\t11.11\tshows\tthe\t\nTags\n\ttab\tof\tthe\tAlpine\timage\trepo.Figure\t11.11\nBecause\tthe\tAlpine\timage\tis\tan\tofficial\timage\tit\tgets\tscanned\tand\tscan\treports\nare\tavailable.\tAs\tyou\tcan\tsee,\tthe\timages\ttagged\tas\t\nedge\n,\t\nlatest\n,\tand\t\n3.6\n\tare\nfree\tfrom\tknown\tvulnerabilities.\tHowever,\tthe\t\nalpine:3.5\n\timage\thas\tknown\nvulnerabilities\t(red).\nIf\tyou\tdrill\tinto\tthe\t\nalpine:3.5\n\timage\tyou\tget\ta\tmore\tdetailed\treport\tas\tshown\nin\tFigure\t11.12.\nFigure\t11.12This\tis\ta\tsimple\tand\teasy\tway\tto\tget\tdetailed\tinformation\tabout\tknown\nvulnerabilities\tin\tyour\tsoftware.\nDocker\tTrusted\tRegistry\t(DTR),\twhich\tis\tan\ton-premises\tDocker\tregistry\nincluded\tas\tpart\tof\tDocker\tEnterprise\tEdition,\tprovides\tthe\tsame\tcapabilities\tand\ngives\tyou\tcontrol\tover\thow\tand\twhen\timage\tscans\tare\tperformed.\tFor\texample,\nDTR\tlets\tyou\tdecide\tif\timages\tshould\tbe\tautomatically\tscanned\tas\tsoon\tas\tthey\nare\tpushed,\tor\tif\tscans\tshould\tonly\tbe\ttriggered\tmanually.\tIt\talso\tallows\tyou\tto\nmanually\tupload\tCVE\tdatabase\tupdates\t-\tthis\tis\tideal\tfor\tsituations\twhere\tyour\nDTR\tinfrastructure\tis\tair-gapped\tfrom\tthe\tinternet\tand\tcannot\tautomatically\tsync\nupdates.\nSigning\tand\tverifying\timages\twith\tDocker\tContent\tTrust\nDocker\tContent\tTrust\t(DCT)\tmakes\tit\tsimple\tand\teasy\tto\tverify\tthe\tintegrity\tand\nthe\tpublisher\tof\timages\tthat\tyou\tdownload.\tThis\tis\tespecially\timportant\twhen\npulling\timages\tover\tuntrusted\tnetworks\tsuch\tas\tthe\tinternet.\nAt\ta\thigh\tlevel,\tDCT\tallows\tdevelopers\tto\tsign\ttheir\timages\twhen\tthey\tare\npushed\tto\tDocker\tHub\tor\tDocker\tTrusted\tRegistry.\tIt\twill\talso\tautomatically\nverify\timages\twhen\tthey\tare\tpulled.\tThis\thigh-level\tprocess\tis\tshown\tin\tFigure\n11.13\nFigure\t11.13\nDCT\tcan\talso\tprovide\timportant\t\ncontext\n.\tThis\tincludes\tthings\tlike;\twhether\tor\nnot\tan\timage\thas\tbeen\tsigned\tfor\tuse\tin\ta\tproduction\tenvironment,\tor\twhether\tan\nimage\thas\tbeen\tsuperseded\tby\ta\tnewer\tversion\tand\tis\ttherefore\tstale.\nAt\tthe\ttime\tof\twriting,\tthe\t\ncontext\n\tofferings\tof\tDTC\tare\tin\ttheir\tinfancy\tand\nquite\tcomplex\tto\tconfigure.\tAs\tand\twhen\tit\tmatures\tand\tbecomes\tmore\tstable\tit\nwill\tbe\tincluded\tin\tan\tupdate\tto\tthe\tbook.All\tyou\tneed\tto\tdo\tto\tenable\tDCT\ton\ta\tDocker\thost\tis\texport\tand\tenvironment\nvariable\tcalled\t\nDOCKER_CONTENT_TRUST\n\twith\ta\tvalue\tof\t\n1\n.\n$\t\nexport\n\t\nDOCKER_CONTENT_TRUST\n=\n1\nIn\tthe\treal\tworld\tyou\tmay\twant\tto\tmake\tthis\ta\tmore\tpermanent\tfeature\tof\tyour\nsystem.\nIf\tyou\tare\tusing\tDocker\tUniversal\tControl\tPlane\t(part\tof\tDocker\tEnterprise\nEdition)\tyou\tneed\tto\tset\tthe\t\nOnly\trun\tsigned\timages\n\tcheckbox\tas\tshown\tin\nFigure\t11.14.\tThis\twill\tforce\tall\tnodes\tin\tthe\tUCP\tcluster\tto\tonly\twork\twith\nsigned\timages.\nFigure\t11.14\nYou\tcan\tsee\tfrom\tFigure\t11.14\tthat\tUniversal\tControl\tPlane\ttakes\tDCT\tone\tstep\nfurther\tby\tgiving\tthe\toption\tto\tlist\tsecurity\tprincipals\tthat\tare\trequired\tto\tsign\tan\nimage\tbefore\tit\tcan\tbe\tused.\tFor\texample,\tyou\tmight\thave\ta\tcorporate\tpolicy\tthat\nall\timages\tused\tin\tproduction\tneed\tto\tbe\tsigned\tby\tthe\t\nsecops\n\tteam.\nOnce\tDCT\thas\tbeen\tenabled\tyou\twill\tno\tlonger\tbe\table\tto\tpull\tand\twork\twith\nunsigned\timages.\tFigure\t11.15\tshows\tthe\terrors\tyou\twill\tget\tif\tyou\tattempt\tto\npull\tan\tunsigned\timage\tusing\tthe\tDocker\tCLI\tand\tthe\tUniversal\tControl\tPlane\nweb\tUI\t(both\texamples\tare\tattempting\tto\tpull\tan\timage\ttagged\tas\t“unsigned”)\nFigure\t11.15\nFigure\t11.16\tshows\thow\tDCT\tprevents\ta\tDocker\tclient\tfrom\tpulling\tan\timage\nthat\thas\tbeen\ttampered\twith.\tFigure\t11.17\tshows\tDCT\tpreventing\ta\tclient\npulling\tan\timage\tthat\tis\tstale.\nFigure\t11.16\t-\tPulling\tan\timage\tthat\thas\tbeen\ttampered\twith\nFigure\t11.17\t-\tPulling\ta\tstale\timage\nDocker\tContent\tTrust\tis\tan\timportant\ttechnology\tfor\thelping\tyou\tverify\tthe\nimages\tyou\tare\tpulling\tfrom\tDocker\tregistries.\tIt’s\tsimple\tto\tconfigure\tin\tits\nbasic\tform,\tbut\tmore\tadvanced\tfeatures\tsuch\tas\t\ncontext\n\tare\tcurrently\tmore\ncomplex\tto\tconfigure.\nDocker\tsecrets\nMany\tapplications\tneed\tsecrets.\tThings\tlike\tpasswords,\tTLS\tcertificates,\tSSH\nkeys\tand\tmore.\nPrior\tto\tDocker\t1.13\tthere\twas\tno\tstandard\tway\tof\tmaking\tsecrets\tavailable\tto\napps\tin\ta\tsecure\tway.\tIt\twas\tcommon\tfor\tdevelopers\tto\tinsert\tsecrets\tinto\tapps\nvia\tplain\ttext\tenvironment\tvariables\t(we’ve\tall\tdone\tit).\tThis\twas\tfar\tfrom\tideal.\nDocker\t1.13\tintroduced\t\nDocker\tSecrets\n,\teffectively\tmaking\tsecrets\tfirst-class\ncitizens\tin\tthe\tDocker\tecosystem.\tFor\texample,\tthere\tis\ta\twhole\tnew\t\ndocker\nsecret\n\tsub-command\tdedicated\tto\tmanaging\tsecrets.\tThere’s\talso\ta\tpage\tfor\ncreating\tand\tmanaging\tsecrets\tin\tthe\tDocker\tUniversal\tControl\tPlane\tUI.\tBehind\nthe\tscenes\tsecrets\tare\tencrypted\tat\trest,\tencrypted\tin-flight,\tmounted\tin\tin-\nmemory\tfilesystems,\tand\tonly\tavailable\tto\tservices/containers\tthat\thave\tbeen\nexplicitly\tgranted\taccess\tto\tthem.\tIt’s\tquite\ta\tcomprehensive\tend-to-end\tsolution.\nFigure\t11.18\tshows\ta\thigh-level\tworkflow:Figure\t11.18\nThe\tfollowing\tsteps\twalk\tthrough\tthe\thigh-level\tworkflow\tshown\tin\tFigure\n11.18.\n1\n.\t\nThe\tsecret\tis\tcreated\tand\tposted\tto\tthe\tSwarm\n2\n.\t\nIt\tgets\tstored\tin\tthe\tencrypted\tcluster\tstore\t(all\tmanagers\thave\taccess\tto\tthe\ncluster\tstore)\n3\n.\t\nThe\tblue\tservice\tis\tcreated\tand\tthe\tsecret\tis\tattached\tto\tit\n4\n.\t\nThe\tsecret\tis\tencrypted\tin-flight\twhile\tit\tis\tdelivered\tto\tthe\tcontainers\tin\tthe\nblue\tservice\n5\n.\t\nThe\tsecret\tis\tmounted\tinto\tthe\tcontainers\tof\tthe\tblue\tservice\tas\tan\nunencrypted\tfile\tat\t\n/run/secrets/\n.\tThis\tis\tan\tin-memory\ttmpfs\tfilesystem\n(this\tstep\tis\tdifferent\ton\tWindows\tDocker\thosts\tas\tthey\tdo\tnot\thave\tthe\nnotion\tof\tan\tin-memory\tfilesystem\tlike\ttmpfs)\n6\n.\t\nOnce\tthe\tcontainer\t(service\ttask)\tcompletes\tthe\tin-memory\tfilesystem\tis\ntorn\tdown.\n7\n.\t\nThe\tred\tcontainers/service\tcannot\taccess\tthe\tsecret.\nFrom\tthe\tcommand\tline\tyou\tcan\tcreate\tand\tmanage\tsecrets\twith\tthe\t\ndocker\nsecret\n\tsub-command,\tand\tyou\tcan\tattach\tthem\tto\tservices\tby\tspecifying\tthe\t\n--\nsecret\n\tflag\tto\tthe\t\ndocker\tservice\tcreate\n\tcommand.Chapter\tSummary\nDocker\tcan\tbe\tconfigured\tto\tbe\textremely\tsecure.\tIt\tsupports\tall\tof\tthe\tmajor\nLinux\tsecurity\ttechnologies\tincluding;\tkernel\tnamespaces,\tcgroups,\tcapabilities,\nMAC,\tand\tseccomp.\tFor\tall\tof\tthese\tit\tships\twith\tsensible\tdefaults,\tbut\tyou\tcan\ncustomize\tthem\tand\teven\tdisable\tthem.\nOver\tand\tabove\tthe\tgeneral\tLinux\tsecurity\ttechnologies,\tthe\tDocker\tplatform\nalso\tincludes\tan\textensive\tset\tof\tits\town\tsecurity\ttechnologies.\tSwarm\tMode\tis\nbuilt\ton\tTLS\tand\tis\tinsanely\tsimple\tto\tconfigure\tand\tcustomize.\tSecurity\nScanning\tperforms\tbinary-level\tinspections\tof\tDocker\timages\tand\tprovides\ndetailed\treports\tof\tknown\tvulnerabilities.\tDocker\tContent\tTrust\tlets\tyou\tsign\tand\nverify\tcontent,\tand\tsecrets\tare\tnow\tfirst-class\tcitizens\tin\tDocker.\nThe\tnet\tresult\tis\tthat\tyour\tDocker\tenvironment\tcan\tbe\tconfigured\tto\tbe\tas\tsecure\nor\tinsecure\tas\tyou\tdesire\t-\tit\tall\tdepends\ton\thow\tyou\tconfigure\tit.12:\tWhat\tnext\nHopefully\tyou’re\tnow\tcomfortable\ttalking\tabout\tDocker\tand\tworking\twith\tit.\nTaking\tyour\tjourney\tto\tthe\tnext\tstep\tis\tsimple\tin\ttoday’s\tworld.\tIt’s\tinsanely\teasy\nto\tspin\tup\tinfrastructure\tand\tworkloads\tin\tthe\tcloud\twhere\tyou\tcan\tbuild\tand\ttest\nDocker\tuntil\tyou’re\ta\tworld\tauthority!\nYou\tcan\talso\thead\tover\tto\tmy\tvideo\ttraining\tcourses\tat\t\nPluralsight\n.\tIf\tyou’re\tnot\na\tmember\tof\tPluralsight\tthen\tbecome\tone!\tYes,\tit\tcosts\tmoney,\tbut\tit’s\tdefinitely\na\tservice\twhere\tyou\tget\tvalue\tfor\tyour\tmoney!\tAnd\tif\tyou’re\tunsure…\tthey\nalways\thave\ta\tfree\ttrial\tperiod\twhere\tyou\tcan\tget\taccess\tto\tmy\tcourses\tfor\tfree\nfor\ta\tlimited\tperiod.\nI’d\talso\trecommend\tyou\thit\tevents\tlike\t\nDockercon\n\tand\tyour\tlocal\t\nDocker\nmeetups\n.\nFeedback\nA\tmassive\tthanks\tfor\treading\tmy\tbook.\tI\treally\thope\tit\twas\tuseful\tfor\tyou!\nNow\tlet\tme\task\ta\tfavor…\nIt\ttakes\ta\t\nlot\n\tof\teffort\tto\twrite\ta\tbook!\tMy\thope\tin\twriting\tthis\tbook,\tis\tthat\tit\ninspires\tyou\tand\topens\tnew\topportunities.\tIf\tyou’ve\tenjoyed\tit,\tshow\tit\tsome\nlove\twith\ta\tfew\tstars\tand\ta\treview\ton\tAmazon!\nTo\tquote\tWilliam\tShakespeare\t“\nThey\tdo\tnot\tlove,\tthat\tdo\tnot\tshow\ttheir\tlove.\n”\nSo,\tif\tyou\tlove\tthe\tbook,\tshow\tit\twith\tsome\tstars!”\nFeel\tfree\tto\thit\tme\ton\t\nTwitter\n\tas\twell,\tbut\tstars\tand\tcars\tare\twhat\tI\tdream\tabout\nat\tnight\t;-)\nThanks\tagain\tfor\treading\tmy\tbook\tand\tgood\tluck\tdriving\tyour\tcareer\tforward!!"
}